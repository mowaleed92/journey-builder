import{c as q,a as n,j as e,B as ke,L as Y,o as G,p as Ue,n as Ce,f as D,P as se,i as K,T as Se,k as Me,S as te,A as Ee,q as Je,C as Ge,e as We,s as V,t as Xe}from"./index-CxUWKkPj.js";import{C as _e,V as de,P as Ie,I as fe,H as be,R as ee,U as Qe,F as Te,u as Ye,B as ge,d as Ke,e as je,a as es,f as ss,c as ts,E as as,b as ls,D as rs,L as ns}from"./useAIEnabled-hcTM4abB.js";const is=q("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);const os=q("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const me=q("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const cs=q("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);const we=q("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);const ce=q("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);const ds=q("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);const ms=q("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);const $e=q("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);const xs=q("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);const us=q("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);const hs=q("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const ps=q("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);const fs=q("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);const Le=q("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const bs=q("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);const gs=q("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function ye(s,v){const l=v[s.fact],t=s.value;switch(s.op){case"eq":return l===t;case"neq":return l!==t;case"gt":return typeof l=="number"&&typeof t=="number"&&l>t;case"gte":return typeof l=="number"&&typeof t=="number"&&l>=t;case"lt":return typeof l=="number"&&typeof t=="number"&&l<t;case"lte":return typeof l=="number"&&typeof t=="number"&&l<=t;case"contains":return Array.isArray(l)||typeof l=="string"&&typeof t=="string"?l.includes(t):!1;case"in":return Array.isArray(t)?t.includes(l):!1;default:return!1}}function xe(s,v){return s.all?s.all.every(l=>"fact"in l?ye(l,v):xe(l,v)):s.any?s.any.some(l=>"fact"in l?ye(l,v):xe(l,v)):!0}function js(s,v){return s.condition?xe(s.condition,v):!0}function ws(s,v,l){const t=v.filter(m=>m.from===s).sort((m,o)=>(o.priority??0)-(m.priority??0));for(const m of t)if(js(m,l))return m.to;return t.find(m=>!m.condition)?.to??null}function ve(s,v){const l={};if(s.score!==void 0&&s.score!==null&&(l["quiz.scorePercent"]=s.score),s.weak_topics&&s.weak_topics.length>0&&(l["quiz.weakTopics"]=s.weak_topics),v?.questions){const t=v.questions.length;l["quiz.totalCount"]=t,s.score!==void 0&&s.score!==null&&(l["quiz.correctCount"]=Math.round(s.score/100*t))}return s.attempts_count!==void 0&&(l["block.attemptsCount"]=s.attempts_count),s.time_spent_seconds!==void 0&&(l["block.timeSpentSeconds"]=s.time_spent_seconds),s.status&&(l["block.status"]=s.status),s.output_json&&Object.entries(s.output_json).forEach(([t,r])=>{l[`output.${t}`]=r}),l}function ys({term:s,contextSnippet:v,trackId:l,moduleId:t}){const[r,m]=n.useState(!1),[o,k]=n.useState(null),[N,y]=n.useState(!1),[p,b]=n.useState(null),[g,f]=n.useState(null),a=n.useRef(null),h=n.useRef(null);n.useEffect(()=>{if(r&&a.current){const d=a.current.getBoundingClientRect(),j=window.innerHeight,_=150,S=j-d.bottom<_&&d.top>_;f({top:S?d.top-_-8:d.bottom+8,left:Math.max(16,Math.min(d.left,window.innerWidth-280)),arrowPosition:S?"bottom":"top"})}},[r]),n.useEffect(()=>{const d=j=>{h.current&&!h.current.contains(j.target)&&a.current&&!a.current.contains(j.target)&&m(!1)};return r&&(document.addEventListener("mousedown",d),document.addEventListener("touchstart",d)),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("touchstart",d)}},[r]);const i=async()=>{if(!o){y(!0),b(null);try{const d=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/glossary-explain",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({term:s,contextSnippet:v,trackId:l,moduleId:t})});if(!d.ok)throw new Error("Failed to fetch explanation");const j=await d.json();k(j.explanation)}catch(d){b("تعذر تحميل الشرح"),console.error("Glossary fetch error:",d)}finally{y(!1)}}},C=()=>{m(!r),!r&&!o&&i()};return e.jsxs(e.Fragment,{children:[e.jsx("span",{ref:a,className:"english-term",onClick:C,onKeyDown:d=>d.key==="Enter"&&C(),role:"button",tabIndex:0,"aria-expanded":r,"aria-haspopup":"dialog",children:s}),r&&g&&e.jsxs("div",{ref:h,className:"glossary-popup fixed",style:{top:g.top,left:g.left,width:"260px"},role:"dialog","aria-label":`شرح ${s}`,children:[e.jsx("div",{className:"glossary-popup-arrow",style:{[g.arrowPosition==="top"?"top":"bottom"]:"-6px",left:"20px",transform:g.arrowPosition==="top"?"rotate(45deg)":"rotate(225deg)"}}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-700",children:[e.jsx(ke,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"font-english text-blue-300 font-medium",children:s})]}),e.jsxs("div",{className:"arabic-content text-sm",children:[N&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(Y,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"جاري التحميل..."})]}),p&&e.jsx("div",{className:"text-red-400 text-sm",children:p}),o&&!N&&e.jsx("p",{className:"text-slate-200 leading-relaxed",children:o})]})]})]})}const vs=/\b([A-Za-z][A-Za-z0-9]*(?:\s+[A-Za-z][A-Za-z0-9]*){0,3})\b/g,Ns=new Set(["a","an","the","is","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","may","might","must","shall","can","need","dare","ought","used","to","of","in","for","on","with","at","by","from","up","about","into","over","after","and","or","but","if","then","else","when","where","why","how","all","each","every","both","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","just","also","now","here","there","this","that","these","those","i","you","he","she","it","we","they","me","him","her","us","them","my","your","his","its","our","their","what","which","who","whom"]),ks=[/^[A-Z]{2,}$/,/^[A-Z][a-z]+[A-Z]/,/\d/,/^(API|SDK|UI|UX|CSS|HTML|JS|JSON|XML|SQL|HTTP|REST|GraphQL|Git|npm|AI|ML|GPT|LLM|RAG|NLP|CNN|RNN|LSTM|GAN|VAE|RL|DL|IoT|AWS|GCP|Azure|Docker|K8s|Kubernetes|React|Vue|Angular|Node|Python|Java|Go|Rust|Swift|Kotlin|TypeScript|JavaScript|PHP|Ruby|Scala|Clojure|Haskell|Elixir|Erlang|C|CPP|CSharp|FSharp|VB|Perl|Lua|Dart|Flutter|Android|iOS|macOS|Windows|Linux|Unix|Ubuntu|Debian|Fedora|CentOS|RedHat|SUSE|Arch|Alpine|Mint|Elementary|Pop|Manjaro|Kali|Parrot|BlackArch|Tails|Qubes|Whonix)$/i];function Cs(s){const v=s.toLowerCase();if(Ns.has(v)||s.length<2)return!1;for(const l of ks)if(l.test(s))return!0;return!!(s.length>=4&&/^[A-Z]/.test(s))}function Ss(s,v,l){const r=Math.max(0,v-100),m=Math.min(s.length,v+l+100);let o=s.slice(r,m);return r>0&&(o="..."+o),m<s.length&&(o=o+"..."),o}function Ms({children:s,trackId:v,moduleId:l,className:t=""}){const r=n.useMemo(()=>{const m=s,o=[];let k=0;const N=[...m.matchAll(vs)];for(const y of N){const p=y[1],b=y.index;if(!Cs(p))continue;b>k&&o.push(m.slice(k,b));const g=Ss(m,b,p.length);o.push(e.jsx(ys,{term:p,contextSnippet:g,trackId:v,moduleId:l},`${p}-${b}`)),k=b+p.length}return k<m.length&&o.push(m.slice(k)),o.length>0?o:m},[s,v,l]);return e.jsx("span",{className:`arabic-content ${t}`,children:r})}function Es({content:s,onComplete:v,isCompleted:l,trackId:t,moduleId:r}){const{t:m}=G(),{isRTL:o,direction:k,primaryLanguage:N}=Ue(),[y,p]=n.useState(0),[b,g]=n.useState(!1);n.useEffect(()=>{const C=document.getElementById("read-content-scroll");if(!C)return;const d=()=>{C.scrollHeight<=C.clientHeight&&(g(!0),p(100))},j=()=>{const _=C.scrollHeight-C.clientHeight;if(_<=0){g(!0),p(100);return}const L=C.scrollTop/_*100;p(Math.min(100,L)),L>=90&&g(!0)};return d(),C.addEventListener("scroll",j),window.addEventListener("resize",d),()=>{C.removeEventListener("scroll",j),window.removeEventListener("resize",d)}},[s.markdown]);const f=C=>{const d=C.split(`
`),j=[];let _=!1,L="";return d.forEach((S,u)=>{if(S.startsWith("```")){_?(j.push(e.jsx("pre",{className:"bg-slate-900 text-slate-100 p-4 rounded-lg overflow-x-auto my-4 text-sm font-mono",children:e.jsx("code",{children:L})},`code-${u}`)),L="",_=!1):(_=!0,S.slice(3));return}if(_){L+=(L?`
`:"")+S;return}if(S.startsWith("### "))j.push(e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mt-6 mb-3",children:S.slice(4)},u));else if(S.startsWith("## "))j.push(e.jsx("h2",{className:"text-xl font-bold text-slate-900 mt-8 mb-4",children:S.slice(3)},u));else if(S.startsWith("# "))j.push(e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mt-8 mb-4",children:S.slice(2)},u));else if(S.startsWith("- ")||S.startsWith("* "))j.push(e.jsx("li",{className:"text-slate-700 ml-4 mb-2 list-disc",children:h(S.slice(2))},u));else if(S.match(/^\d+\. /)){const I=S.replace(/^\d+\. /,"");j.push(e.jsx("li",{className:"text-slate-700 ml-4 mb-2 list-decimal",children:h(I)},u))}else S.startsWith("> ")?j.push(e.jsx("blockquote",{className:"border-l-4 border-primary-500 pl-4 py-2 my-4 bg-primary-50 text-slate-700 italic",children:h(S.slice(2))},u)):S.trim()===""?j.push(e.jsx("div",{className:"h-4"},u)):j.push(e.jsx("p",{className:"text-slate-700 leading-relaxed mb-4",children:h(S)},u))}),j},a=(C,d)=>o&&typeof C=="string"?e.jsx(Ms,{trackId:t,moduleId:r,className:"inline",children:C},d):C,h=C=>{const d=[];let j=C,_=0;for(;j.length>0;){const L=j.match(/\*\*(.+?)\*\*/),S=j.match(/\*(.+?)\*/),u=j.match(/`(.+?)`/),I=j.match(/\[(.+?)\]\((.+?)\)/),$=[L?{type:"bold",match:L,index:L.index}:null,S?{type:"italic",match:S,index:S.index}:null,u?{type:"code",match:u,index:u.index}:null,I?{type:"link",match:I,index:I.index}:null].filter(Boolean).sort((x,c)=>x.index-c.index);if($.length===0){d.push(o?a(j,_++):j);break}const E=$[0];if(E.index>0){const x=j.slice(0,E.index);d.push(o?a(x,_++):x)}switch(E.type){case"bold":d.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:o?a(E.match[1],_++):E.match[1]},_++)),j=j.slice(E.index+E.match[0].length);break;case"italic":d.push(e.jsx("em",{className:"italic",children:o?a(E.match[1],_++):E.match[1]},_++)),j=j.slice(E.index+E.match[0].length);break;case"code":d.push(e.jsx("code",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono text-slate-800",children:E.match[1]},_++)),j=j.slice(E.index+E.match[0].length);break;case"link":d.push(e.jsx("a",{href:E.match[2],target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:text-primary-800 underline",children:E.match[1]},_++)),j=j.slice(E.index+E.match[0].length);break}}return d},i={continue:m("blocks.read.continue"),complete:m("blocks.markComplete"),scroll:m("blocks.read.continue"),minRead:m("track.min")};return e.jsxs("div",{className:"flex flex-col h-full bg-white",dir:k,children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{className:`flex items-center gap-3 mb-2 ${o?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center",children:e.jsx(ke,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{className:o?"text-right":"",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.estimatedReadTime&&e.jsxs("div",{className:`flex items-center gap-1 text-sm text-slate-500 ${o?"flex-row-reverse":""}`,children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.estimatedReadTime," ",i.minRead]})]})]})]}),e.jsx("div",{className:"h-1 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-primary-500 transition-all duration-300 ${o?"ml-auto":""}`,style:{width:`${y}%`,marginLeft:o?"auto":void 0,marginRight:o?"0":void 0}})})]}),e.jsx("div",{id:"read-content-scroll",className:`flex-1 overflow-y-auto px-6 py-6 ${o?"arabic-content":""}`,children:e.jsx("div",{className:"max-w-3xl mx-auto",children:f(s.markdown)})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("button",{onClick:v,disabled:!b&&!l,className:`
            w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all
            ${o?"flex-row-reverse":""}
            ${b||l?"bg-primary-600 text-white hover:bg-primary-700 shadow-sm":"bg-slate-200 text-slate-400 cursor-not-allowed"}
          `,children:[l?i.continue:b?i.complete:i.scroll,o?e.jsx(_e,{className:"w-5 h-5"}):e.jsx(D,{className:"w-5 h-5"})]})})]})}function _s({content:s,onComplete:v,isCompleted:l}){const{t}=G(),[r,m]=n.useState(!1),[o,k]=n.useState(!1),[N,y]=n.useState(0),[p,b]=n.useState(!1),[g,f]=n.useState(!1),[a,h]=n.useState(!1),i=n.useRef(null),C=n.useRef(null),d=s.url.includes("youtube.com")||s.url.includes("youtu.be"),j=s.url.includes("vimeo.com"),_=c=>{const M=c.split(".").pop()?.toLowerCase().split("?")[0];return{mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4",avi:"video/x-msvideo",wmv:"video/x-ms-wmv"}[M||""]||"video/mp4"},L=c=>{const M=c.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&]+)/);return M?M[1]:null},S=c=>{const M=c.match(/vimeo\.com\/(\d+)/);return M?M[1]:null};n.useEffect(()=>{if(i.current){const c=i.current,M=()=>{const W=c.currentTime/c.duration*100;y(W),W>=80&&b(!0)},A=()=>m(!0),O=()=>m(!1),F=()=>{m(!1),b(!0)},U=()=>{console.error("Video loading error:",c.error),h(!0)};return c.addEventListener("timeupdate",M),c.addEventListener("play",A),c.addEventListener("pause",O),c.addEventListener("ended",F),c.addEventListener("error",U),()=>{c.removeEventListener("timeupdate",M),c.removeEventListener("play",A),c.removeEventListener("pause",O),c.removeEventListener("ended",F),c.removeEventListener("error",U)}}},[]);const u=()=>{i.current&&(r?i.current.pause():i.current.play())},I=()=>{i.current&&(i.current.muted=!o,k(!o))},$=()=>{i.current&&(document.fullscreenElement?document.exitFullscreen():i.current.requestFullscreen())},E=c=>{if(i.current&&C.current){const M=C.current.getBoundingClientRect(),A=(c.clientX-M.left)/M.width*100;i.current.currentTime=A/100*i.current.duration}},x=c=>{const M=Math.floor(c/60),A=Math.floor(c%60);return`${M}:${A.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"relative flex-1 bg-black flex items-center justify-center",children:[d?e.jsx("iframe",{className:"w-full h-full",src:`https://www.youtube.com/embed/${L(s.url)}?rel=0&modestbranding=1`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onLoad:()=>b(!0)}):j?e.jsx("iframe",{className:"w-full h-full",src:`https://player.vimeo.com/video/${S(s.url)}`,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0,onLoad:()=>b(!0)}):e.jsxs(e.Fragment,{children:[e.jsxs("video",{ref:i,className:"w-full h-full object-contain",playsInline:!0,children:[e.jsx("source",{src:s.url,type:_(s.url)}),"Your browser does not support the video tag."]}),a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/90",children:e.jsxs("div",{className:"text-center px-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-error/20 flex items-center justify-center",children:e.jsx(de,{className:"w-8 h-8 text-error"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Video Unavailable"}),e.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Unable to load this video. The file may be in an unsupported format or the URL may be incorrect."}),e.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Continue Anyway"})]})})]}),!d&&!j&&!r&&e.jsx("button",{onClick:u,className:"absolute inset-0 flex items-center justify-center bg-black/30 hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/90 flex items-center justify-center shadow-xl",children:e.jsx(se,{className:"w-10 h-10 text-slate-900 ml-1"})})})]}),!d&&!j&&e.jsxs("div",{className:"bg-slate-800 px-4 py-3",children:[e.jsx("div",{ref:C,className:"h-1.5 bg-slate-600 rounded-full cursor-pointer mb-3",onClick:E,children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all",style:{width:`${N}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:u,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:r?e.jsx(Ie,{className:"w-5 h-5 text-white"}):e.jsx(se,{className:"w-5 h-5 text-white ml-0.5"})}),e.jsx("button",{onClick:I,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:o?e.jsx(fs,{className:"w-5 h-5 text-white"}):e.jsx(ps,{className:"w-5 h-5 text-white"})}),e.jsxs("span",{className:"text-sm text-slate-300",children:[i.current?x(i.current.currentTime):"0:00"," / "," ",s.duration?x(s.duration):i.current?x(i.current.duration||0):"0:00"]})]}),e.jsx("button",{onClick:$,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:e.jsx(ms,{className:"w-5 h-5 text-white"})})]})]})]}),e.jsxs("div",{className:"bg-slate-800 border-t border-slate-700",children:[e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-primary-400"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:s.title})]}),s.transcript&&e.jsx("button",{onClick:()=>f(!g),className:"text-sm text-primary-400 hover:text-primary-300 mt-2",children:g?"Hide transcript":"Show transcript"}),g&&s.transcript&&e.jsx("div",{className:"mt-4 p-4 bg-slate-900 rounded-lg max-h-48 overflow-y-auto",children:e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed whitespace-pre-wrap",children:s.transcript})})]}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-700",children:e.jsxs("button",{onClick:v,disabled:!p&&!l,className:`
              w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all
              ${p||l?"bg-primary-600 text-white hover:bg-primary-700":"bg-slate-700 text-slate-400 cursor-not-allowed"}
            `,children:[t(l?"blocks.continue":p?"blocks.markComplete":"blocks.video.loading"),e.jsx(D,{className:"w-5 h-5"})]})})]})]})}function Is({content:s,onComplete:v,isCompleted:l}){const{t}=G(),[r,m]=n.useState(!0),[o,k]=n.useState(!1),[N,y]=n.useState(!1),p=()=>{m(!1)},b=()=>{m(!1),y(!0)};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:s.title})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:s.url?e.jsxs("div",{className:"relative",children:[r&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-100 rounded-xl",children:e.jsx(Y,{className:"w-8 h-8 text-slate-400 animate-spin"})}),N?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 bg-slate-100 rounded-xl",children:[e.jsx(fe,{className:"w-12 h-12 text-slate-400 mb-4"}),e.jsx("p",{className:"text-slate-500",children:t("blocks.image.failed")})]}):e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.url,alt:s.alt||s.title,className:`w-full rounded-xl shadow-lg transition-transform cursor-pointer ${o?"scale-150 cursor-zoom-out":"cursor-zoom-in"}`,onLoad:p,onError:b,onClick:()=>k(!o)}),e.jsx("button",{onClick:()=>k(!o),className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:o?e.jsx(gs,{className:"w-5 h-5"}):e.jsx(bs,{className:"w-5 h-5"})})]}),s.caption&&e.jsx("p",{className:"mt-4 text-center text-slate-600 italic",children:s.caption})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 bg-slate-100 rounded-xl",children:[e.jsx(fe,{className:"w-12 h-12 text-slate-400 mb-4"}),e.jsx("p",{className:"text-slate-500",children:t("blocks.image.noImage")})]})})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4",children:e.jsx("div",{className:"max-w-4xl mx-auto flex justify-end",children:e.jsxs("button",{onClick:v,disabled:l,className:`flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all ${l?"bg-emerald-100 text-emerald-700 cursor-default":"bg-primary-600 text-white hover:bg-primary-700"}`,children:[t(l?"blocks.complete":"blocks.continue"),e.jsx(D,{className:"w-5 h-5"})]})})})]})}function Ts({content:s,onComplete:v,previousAttempt:l}){const{t}=G(),[r,m]=n.useState(0),[o,k]=n.useState({}),[N,y]=n.useState(!1),[p,b]=n.useState(!1),[g,f]=n.useState([]),[a,h]=n.useState(null);n.useEffect(()=>{let x=[...s.questions];s.shuffleQuestions&&(x=x.sort(()=>Math.random()-.5)),f(x)},[s.questions,s.shuffleQuestions]);const i=g[r],C=s.passingScore??50,d=i&&o[i.id]!==void 0,j=i&&o[i.id]===i.correctIndex,_=()=>i?s.shuffleChoices?i.choices.map((c,M)=>({choice:c,originalIndex:M})).sort(()=>Math.random()-.5):i.choices.map((x,c)=>({choice:x,originalIndex:c})):[],[L]=n.useState([]);s.shuffleChoices||i?.choices.map((x,c)=>({choice:x,originalIndex:c})),n.useEffect(()=>{if(i&&s.shuffleChoices){const x=i.choices.map((c,M)=>({choice:c,originalIndex:M}));L.length=0,L.push(...x.sort(()=>Math.random()-.5))}},[r,i,s.shuffleChoices]);const S=x=>{d||(k({...o,[i.id]:x}),b(!0))},u=()=>{b(!1),r<g.length-1?m(r+1):I()},I=()=>{let x=0;const c=new Set;g.forEach(O=>{o[O.id]===O.correctIndex?x++:O.tags.forEach(F=>c.add(F))});const M=Math.round(x/g.length*100),A={score:M,correctCount:x,totalCount:g.length,answers:o,weakTopics:Array.from(c),passed:M>=C};h(A),y(!0)},$=()=>{k({}),m(0),y(!1),b(!1),h(null),s.shuffleQuestions&&f([...s.questions].sort(()=>Math.random()-.5))},E=()=>{a&&v(a)};return N&&a?e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsx("div",{className:`w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center ${a.passed?"bg-success/20":"bg-warning/20"}`,children:a.passed?e.jsx(is,{className:"w-12 h-12 text-emerald-600"}):e.jsx(be,{className:"w-12 h-12 text-warning"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:a.passed?t("blocks.quiz.result.passed"):t("blocks.quiz.result.failed")}),e.jsx("p",{className:"text-slate-600 mb-6",children:a.passed?t("blocks.quiz.result.passedMessage"):t("blocks.quiz.result.failedMessage")}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"text-5xl font-bold text-slate-900 mb-2",children:[a.score,"%"]}),e.jsxs("div",{className:"text-slate-500",children:[a.correctCount," ",t("blocks.quiz.of")," ",a.totalCount," ",t("blocks.quiz.result.correct")]}),e.jsx("div",{className:"mt-4 h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${a.passed?"bg-success":"bg-warning"}`,style:{width:`${a.score}%`}})}),e.jsxs("div",{className:"mt-2 text-sm text-slate-500",children:[t("blocks.quiz.result.yourScore"),": ",C,"%"]})]}),a.weakTopics.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-700 mb-2",children:"Topics to review:"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:a.weakTopics.map(x=>e.jsx("span",{className:"px-3 py-1 bg-warning/20 text-warning rounded-full text-sm",children:x},x))})]}),e.jsxs("div",{className:"flex gap-3",children:[s.allowRetry!==!1&&!a.passed&&e.jsxs("button",{onClick:$,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium bg-slate-100 text-slate-700 hover:bg-slate-200 transition-colors",children:[e.jsx(ee,{className:"w-5 h-5"}),t("blocks.quiz.retry")]}),e.jsxs("button",{onClick:E,className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${a.passed?"bg-primary-600 text-white hover:bg-primary-700":"bg-warning text-white hover:bg-warning/90"}`,children:[a.passed?t("blocks.continue"):t("blocks.aiHelp.askForHelp"),e.jsx(D,{className:"w-5 h-5"})]})]})]})})}):i?e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]}),e.jsxs("div",{className:"text-sm font-medium text-slate-500",children:[t("blocks.quiz.question")," ",r+1," ",t("blocks.quiz.of")," ",g.length]})]}),e.jsx("div",{className:"flex gap-1.5",children:g.map((x,c)=>e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${c<r?o[g[c].id]===g[c].correctIndex?"bg-emerald-500":"bg-red-500":c===r?"bg-blue-500":"bg-slate-200"}`},c))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-6",children:i.prompt}),e.jsx("div",{className:"space-y-3",children:(s.shuffleChoices?_():i.choices.map((x,c)=>({choice:x,originalIndex:c}))).map(({choice:x,originalIndex:c})=>{const M=o[i.id]===c,A=c===i.correctIndex,O=d;let F="bg-white hover:bg-slate-50 border-slate-200",U="text-slate-700",W=null;return O?A?(F="bg-emerald-50 border-emerald-500",U="text-emerald-900",W=e.jsx(K,{className:"w-6 h-6 text-emerald-600"})):M&&!A&&(F="bg-error/10 border-error",U="text-red-900",W=e.jsx(Le,{className:"w-6 h-6 text-red-600"})):M&&(F="bg-blue-50 border-blue-500",U="text-blue-900"),e.jsxs("button",{onClick:()=>S(c),disabled:d,className:`w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all ${F} ${d?"cursor-default":"cursor-pointer"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center font-medium ${O?A?"border-emerald-500 bg-emerald-500 text-white":M?"border-red-500 bg-red-500 text-white":"border-slate-300 text-slate-500":M?"border-blue-500 bg-blue-500 text-white":"border-slate-300 text-slate-500"}`,children:String.fromCharCode(65+c)}),e.jsx("span",{className:`flex-1 text-left font-medium ${U}`,children:x}),W]},c)})}),p&&i.explanation&&e.jsxs("div",{className:`mt-6 p-4 rounded-lg ${j?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsx("h4",{className:`font-medium mb-1 ${j?"text-emerald-800":"text-amber-800"}`,children:t(j?"blocks.quiz.result.correct":"blocks.quiz.result.incorrect")}),e.jsx("p",{className:`text-sm ${j?"text-emerald-700":"text-amber-700"}`,children:i.explanation})]})]})}),d&&e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("button",{onClick:u,className:"w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:[r<g.length-1?t("blocks.quiz.next"):t("blocks.submit"),e.jsx(D,{className:"w-5 h-5"})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full"})})}function $s({content:s,onComplete:v,previousOutput:l}){const{t}=G(),[r,m]=n.useState(new Set(l?.completedSteps||[])),[o,k]=n.useState(!1),[N,y]=n.useState({}),[p,b]=n.useState(null),[g,f]=n.useState({}),[a,h]=n.useState(l?.validationHistory||{}),i=s.steps.every(u=>r.has(u.id)),C=u=>{const I=new Set(r);I.has(u)?I.delete(u):I.add(u),m(I)},d=()=>{v({completedSteps:Array.from(r),validationHistory:a})},j=(u,I)=>{y($=>({...$,[u]:I})),f($=>({...$,[u]:null}))},_=async u=>{const I=N[u.id]?.trim();if(I){b(u.id);try{const $=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/mission-validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({question:u.instruction,userAnswer:I,expectedCriteria:u.expectedCriteria||"The answer should demonstrate understanding of the concept."})});if(!$.ok)throw new Error("Validation failed");const E=await $.json();f(c=>({...c,[u.id]:E}));const x={answer:I,correct:E.correct,feedback:E.feedback,score:E.score,timestamp:new Date().toISOString()};h(c=>({...c,[u.id]:[...c[u.id]||[],x]})),E.correct&&m(c=>new Set([...c,u.id]))}catch($){console.error("AI validation error:",$),f(E=>({...E,[u.id]:{correct:!1,feedback:t("blocks.mission.unableToValidate"),score:0}}))}finally{b(null)}}},L=u=>{f(I=>({...I,[u]:null})),y(I=>({...I,[u]:""})),m(I=>{const $=new Set(I);return $.delete(u),$})},S=u=>{const I=r.has(u.id),$=p===u.id,E=g[u.id],x=a[u.id]?.length||0;switch(u.verificationMethod){case"ai_validate":return e.jsxs("div",{className:"mt-3 space-y-3",children:[!I&&e.jsxs(e.Fragment,{children:[u.inputType==="textarea"?e.jsx("textarea",{value:N[u.id]||"",onChange:c=>j(u.id,c.target.value),placeholder:t("blocks.mission.inputPlaceholder"),rows:4,disabled:$,className:"w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none disabled:bg-slate-50 disabled:text-slate-400"}):e.jsx("input",{type:"text",value:N[u.id]||"",onChange:c=>j(u.id,c.target.value),placeholder:t("blocks.mission.inputPlaceholder"),disabled:$,className:"w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-slate-50 disabled:text-slate-400"}),e.jsx("button",{onClick:()=>_(u),disabled:$||!N[u.id]?.trim(),className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors",children:$?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 animate-spin"}),t("blocks.mission.checking")]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4"}),t("blocks.mission.submitAnswer")]})})]}),E&&e.jsx("div",{className:`p-4 rounded-lg ${E.correct?"bg-emerald-50 border border-emerald-200":"bg-error/10 border border-error/20"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[E.correct?e.jsx(K,{className:"w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5"}):e.jsx(Le,{className:"w-5 h-5 text-error flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`font-medium ${E.correct?"text-success":"text-error"}`,children:E.correct?t("blocks.mission.correct"):t("blocks.mission.notQuiteRight")}),e.jsxs("span",{className:`text-sm px-2 py-0.5 rounded ${E.correct?"bg-emerald-200 text-emerald-800":"bg-error/20 text-error"}`,children:[t("blocks.mission.score"),": ",E.score,"%"]})]}),e.jsx("p",{className:`text-sm ${E.correct?"text-success":"text-error"}`,children:E.feedback}),!E.correct&&e.jsxs("button",{onClick:()=>L(u.id),className:"mt-3 flex items-center gap-1 text-sm text-error hover:text-error/80 font-medium",children:[e.jsx(ee,{className:"w-4 h-4"}),t("blocks.mission.tryAgain")]})]})]})}),x>0&&e.jsx("div",{className:"text-xs text-slate-500",children:x===1?t("blocks.mission.attemptsMade",{count:x}):t("blocks.mission.attemptsMadePlural",{count:x})})]});case"screenshot":return e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg cursor-pointer text-sm text-slate-600 transition-colors w-fit",children:[e.jsx(Qe,{className:"w-4 h-4"}),t(o?"blocks.mission.screenshotUploaded":"blocks.mission.uploadScreenshot"),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:()=>{k(!0),C(u.id)}})]})});case"url_check":return e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"url",placeholder:t("blocks.mission.pasteUrl"),className:"w-full px-4 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:c=>{c.target.value&&C(u.id)}})});default:return null}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-6 mb-6",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:t("blocks.mission.yourMission")}),e.jsx("p",{className:"text-orange-800",children:t("blocks.mission.missionDescription")})]}),s.externalUrl&&e.jsxs("a",{href:s.externalUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 bg-primary-50 border border-primary-200 rounded-xl mb-6 hover:bg-primary-100 transition-colors group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center",children:e.jsx(me,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-primary-900",children:t("blocks.mission.openExternal")}),e.jsx("div",{className:"text-sm text-primary-600 truncate",children:s.externalUrl})]}),e.jsx(D,{className:"w-5 h-5 text-primary-400 group-hover:translate-x-1 transition-transform"})]}),e.jsx("div",{className:"space-y-4",children:s.steps.map((u,I)=>{const $=r.has(u.id);return e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${$?"bg-emerald-50 border-emerald-300":"bg-white border-slate-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>{(u.verificationMethod==="self_report"||!u.verificationMethod)&&C(u.id)},disabled:u.verificationMethod==="ai_validate",className:`mt-0.5 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${$?"border-emerald-500 bg-emerald-500":u.verificationMethod==="ai_validate"?"border-slate-200 bg-slate-50 cursor-default":"border-slate-300 hover:border-slate-400"}`,children:$?e.jsx(K,{className:"w-4 h-4 text-white"}):e.jsx(os,{className:"w-4 h-4 text-transparent"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-slate-500",children:[t("blocks.mission.step")," ",I+1]}),u.verificationMethod==="ai_validate"&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-primary-100 text-primary-700 rounded",children:t("blocks.mission.aiValidated")})]}),e.jsx("p",{className:`font-medium mt-1 ${$?"text-emerald-800":"text-slate-900"}`,children:u.instruction}),S(u)]})]})},u.id)})}),s.completionMessage&&i&&e.jsx("div",{className:"mt-6 p-4 bg-emerald-50 border border-emerald-200 rounded-xl",children:e.jsx("p",{className:"text-emerald-800 font-medium",children:s.completionMessage})})]})}),e.jsxs("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-slate-500",children:t("blocks.mission.stepsCompleted",{completed:r.size,total:s.steps.length})}),e.jsx("span",{className:`text-sm font-medium ${i?"text-emerald-600":"text-slate-400"}`,children:t(i?"blocks.mission.readyToContinue":"blocks.mission.completeAllSteps")})]}),e.jsxs("button",{onClick:d,disabled:!i,className:`w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${i?"bg-primary-600 text-white hover:bg-primary-700":"bg-slate-200 text-slate-400 cursor-not-allowed"}`,children:[t("blocks.continue"),e.jsx(D,{className:"w-5 h-5"})]})]})]})}function Ls({content:s,onComplete:v,previousOutput:l}){const[t,r]=n.useState(l||{}),[m,o]=n.useState({}),[k,N]=n.useState(new Set),y=(a,h)=>{if(a.required&&(!h||typeof h=="string"&&!h.trim()))return"This field is required";if(a.validation&&typeof h=="string"){if(a.validation.minLength&&h.length<a.validation.minLength)return`Must be at least ${a.validation.minLength} characters`;if(a.validation.maxLength&&h.length>a.validation.maxLength)return`Must be no more than ${a.validation.maxLength} characters`;if(a.validation.pattern&&!new RegExp(a.validation.pattern).test(h))return"Invalid format"}return null},p=(a,h)=>{r({...t,[a]:h});const i=s.fields.find(C=>C.id===a);if(i&&k.has(a)){const C=y(i,h);o({...m,[a]:C||""})}},b=a=>{N(new Set([...k,a]));const h=s.fields.find(i=>i.id===a);if(h){const i=y(h,t[a]);o({...m,[a]:i||""})}},g=()=>{const a={};let h=!1;s.fields.forEach(i=>{const C=y(i,t[i.id]);C&&(a[i.id]=C,h=!0)}),o(a),N(new Set(s.fields.map(i=>i.id))),h||v(t)},f=a=>{const C=`w-full px-4 py-3 border rounded-lg text-slate-900 placeholder-slate-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ${m[a.id]&&k.has(a.id)?"border-red-500 bg-red-50":"border-slate-200 bg-white"}`;switch(a.type){case"text":return e.jsx("input",{type:"text",value:t[a.id]||"",onChange:d=>p(a.id,d.target.value),onBlur:()=>b(a.id),placeholder:a.placeholder,className:C});case"textarea":return e.jsx("textarea",{value:t[a.id]||"",onChange:d=>p(a.id,d.target.value),onBlur:()=>b(a.id),placeholder:a.placeholder,rows:4,className:`${C} resize-none`});case"select":return e.jsxs("select",{value:t[a.id]||"",onChange:d=>p(a.id,d.target.value),onBlur:()=>b(a.id),className:C,children:[e.jsx("option",{value:"",children:a.placeholder||"Select an option..."}),a.options?.map(d=>e.jsx("option",{value:d,children:d},d))]});case"checkbox":return e.jsx("div",{className:"space-y-2",children:a.options?.map(d=>{const j=t[a.id]||[],_=j.includes(d);return e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg cursor-pointer hover:bg-slate-100 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:()=>{const L=_?j.filter(S=>S!==d):[...j,d];p(a.id,L)},className:"w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-700",children:d})]},d)})});case"radio":return e.jsx("div",{className:"space-y-2",children:a.options?.map(d=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg cursor-pointer hover:bg-slate-100 transition-colors",children:[e.jsx("input",{type:"radio",name:a.id,checked:t[a.id]===d,onChange:()=>p(a.id,d),className:"w-5 h-5 border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-700",children:d})]},d))});default:return null}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-teal-100 flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:s.fields.map(a=>{const h=m[a.id],i=h&&k.has(a.id);return e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:e.jsxs("span",{className:"text-sm font-medium text-slate-700",children:[a.label,a.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),f(a),i&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-red-600",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:h})]})]},a.id)})})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("button",{onClick:g,className:"w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:[s.submitLabel||"Submit",e.jsx(D,{className:"w-5 h-5"})]})})]})}function Rs({content:s,weakTopics:v,wrongQuestions:l,onComplete:t}){const{t:r}=G(),{enabled:m,helpModel:o,isLoading:k}=Ye(),[N,y]=n.useState([]),[p,b]=n.useState(""),[g,f]=n.useState(!1),[a,h]=n.useState(!1),[i,C]=n.useState("gpt-4o-mini"),d=n.useRef(null),j=n.useRef(null),_=s.maxTurns??5,L=2,S=N.filter(x=>x.role==="user").length;n.useEffect(()=>{S>=L&&h(!0)},[S]),n.useEffect(()=>{d.current?.scrollIntoView({behavior:"smooth"})},[N]),n.useEffect(()=>{k||u()},[k]),n.useEffect(()=>{!k&&o&&C(o)},[k,o]);const u=async()=>{f(!0);let x="";s.mode==="targeted_remediation"&&l&&l.length>0?(x=`لاحظت أنك واجهت صعوبة في بعض الأسئلة. دعني أساعدك في شرح المفاهيم:

`,l.slice(0,3).forEach((M,A)=>{x+=`**السؤال ${A+1}:** ${M.prompt}
`,x+=`إجابتك: ${M.userAnswer}
`,x+=`الإجابة الصحيحة: ${M.correctAnswer}
`,M.explanation&&(x+=`${M.explanation}
`),x+=`
`}),v&&v.length>0&&(x+=`
المواضيع الرئيسية التي يجب مراجعتها: **${v.join("، ")}**

`),x+="هل تريد مني شرح أي من هذه المفاهيم بمزيد من التفصيل؟ لا تتردد في طرح الأسئلة!"):s.mode==="guided_explanation"?x="أنا هنا لمساعدتك في فهم هذه المادة. ماذا تريد مني أن أشرح لك؟ يمكنك السؤال عن مفاهيم محددة أو طلب أمثلة.":x="مرحباً! أنا مساعدك الذكي للتعلم. أنا هنا لمساعدتك على فهم المادة بشكل أفضل. ما هي أسئلتك؟",y([{role:"assistant",content:x}]),f(!1)},I=async()=>{if(!p.trim()||g||S>=_)return;const x={role:"user",content:p.trim()};y(c=>[...c,x]),b(""),f(!0);try{const c=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/ai-help",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({messages:[...N,x],mode:s.mode,weakTopics:v,wrongQuestions:l,model:i,language:"ar"})});if(!c.ok)throw new Error("Failed to get AI response");const A={role:"assistant",content:(await c.json()).response};y(O=>[...O,A])}catch{const M={role:"assistant",content:"أعتذر، ولكنني أواجه مشكلة في الاتصال الآن. يرجى المحاولة مرة أخرى أو المتابعة عندما تكون جاهزاً."};y(A=>[...A,M])}finally{f(!1)}},$=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),I())},E=()=>{t({conversationHistory:N})};return k?e.jsxs("div",{className:"flex flex-col h-full bg-slate-900 items-center justify-center",children:[e.jsx(Y,{className:"w-10 h-10 text-blue-500 animate-spin"}),e.jsx("p",{className:"text-slate-400 mt-4",children:r("blocks.aiHelp.loadingAssistant")})]}):m?e.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[e.jsx("div",{className:"border-b border-slate-700 px-6 py-4 bg-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:s.title}),e.jsx("p",{className:"text-sm text-slate-400",children:s.mode==="targeted_remediation"?r("blocks.aiHelp.personalizedHelp"):s.mode==="guided_explanation"?r("blocks.aiHelp.guidedLearning"):r("blocks.aiHelp.askAnything")})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[N.map((x,c)=>e.jsxs("div",{className:`flex gap-4 ${x.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex-shrink-0 flex items-center justify-center ${x.role==="assistant"?"bg-gradient-to-br from-blue-500 to-cyan-400":"bg-slate-600"}`,children:x.role==="assistant"?e.jsx(ge,{className:"w-5 h-5 text-white"}):e.jsx(hs,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:`flex-1 max-w-[80%] rounded-2xl px-5 py-4 ${x.role==="assistant"?"bg-slate-800 text-slate-100":"bg-blue-600 text-white"}`,children:e.jsx("div",{className:"text-sm max-w-none",children:x.content.split(`
`).map((M,A)=>{if(M.startsWith("**")&&M.endsWith("**"))return e.jsx("p",{className:"font-semibold text-white mb-2",children:M.slice(2,-2)},A);if(M.includes("**")){const O=M.split(/\*\*(.+?)\*\*/g);return e.jsx("p",{className:"mb-2",children:O.map((F,U)=>U%2===1?e.jsx("strong",{className:"text-white",children:F},U):F)},A)}return M?e.jsx("p",{className:"mb-2",children:M},A):e.jsx("br",{},A)})})})]},c)),g&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"bg-slate-800 rounded-2xl px-5 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-slate-400 animate-spin"}),e.jsx("span",{className:"text-slate-400 text-sm",children:r("blocks.aiHelp.thinking")})]})})]}),e.jsx("div",{ref:d})]})}),e.jsx("div",{className:"border-t border-slate-700 px-6 py-4 bg-slate-800",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[S<_?e.jsx("div",{className:"flex gap-3 mb-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:j,value:p,onChange:x=>b(x.target.value),onKeyDown:$,placeholder:r(S===0?"blocks.aiHelp.askQuestion":"blocks.aiHelp.continueConversation"),rows:1,className:"w-full px-4 py-3 pr-12 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:g}),e.jsx("button",{onClick:I,disabled:!p.trim()||g,className:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-lg bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx($e,{className:"w-4 h-4 text-white"})})]})}):e.jsx("div",{className:"text-center py-2 mb-4",children:e.jsx("p",{className:"text-slate-400 text-sm",children:r("blocks.aiHelp.reachedLimit")})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:[S," / ",_," ",r("blocks.aiHelp.messages"),!a&&e.jsxs("span",{className:"mx-2 text-amber-400",children:["(",r("blocks.aiHelp.askMoreToontinue",{count:L-S}),")"]})]}),e.jsxs("button",{onClick:E,disabled:!a,className:`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all ${a?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-700 text-slate-400 cursor-not-allowed"}`,children:[r("blocks.aiHelp.continue"),e.jsx(D,{className:"w-5 h-5"})]})]})]})})]}):e.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[e.jsx("div",{className:"border-b border-slate-700 px-6 py-4 bg-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:s.title}),e.jsx("p",{className:"text-sm text-slate-400",children:r("blocks.aiHelp.aiPowered")})]})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-500/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(Ee,{className:"w-8 h-8 text-amber-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:r("blocks.aiHelp.unavailable")}),e.jsx("p",{className:"text-slate-400 mb-6",children:r("blocks.aiHelp.unavailableMessage")}),e.jsxs("button",{onClick:()=>t({conversationHistory:[]}),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors mx-auto",children:[r("blocks.aiHelp.continue"),e.jsx(D,{className:"w-5 h-5"})]})]})})]})}function As({content:s,facts:v,onComplete:l,allowRetry:t=!0}){const{t:r}=G(),[m,o]=n.useState(null),[k,N]=n.useState(!0);n.useEffect(()=>{y()},[]);const y=()=>{N(!0),setTimeout(()=>{const g=v["quiz.scorePercent"],f=v["block.attemptsCount"],a=v["quiz.weakTopics"];let h=!0,i=r("blocks.checkpoint.messages.greatProgress");g!==void 0&&(g>=70?(h=!0,i=r("blocks.checkpoint.messages.excellentWork",{score:g})):g>=50?(h=!0,i=r("blocks.checkpoint.messages.goodJob",{score:g})):(h=!1,i=r("blocks.checkpoint.messages.needsReview",{score:g}))),!h&&f&&f>=3&&(i=r("blocks.checkpoint.messages.multipleAttempts",{attempts:f})),!h&&a&&a.length>0&&(i+=" "+r("blocks.checkpoint.messages.focusOn",{topics:a.join("، ")})),o({passed:h,score:g,message:i}),N(!1)},1500)},p=()=>{m&&l(m.passed)},b=()=>{l(!1)};return k?e.jsx("div",{className:"flex flex-col h-full bg-white items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-blue-100 flex items-center justify-center animate-pulse",children:e.jsx(Ke,{className:"w-10 h-10 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:r("blocks.checkpoint.evaluating")}),e.jsx("p",{className:"text-slate-500",children:r("blocks.checkpoint.checkingUnderstanding")}),e.jsxs("div",{className:"mt-8 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 animate-bounce",style:{animationDelay:"300ms"}})]})]})}):m?e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsx("div",{className:`w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center ${m.passed?"bg-emerald-100":"bg-amber-100"}`,children:m.passed?e.jsx(K,{className:"w-12 h-12 text-emerald-600"}):e.jsx(Ee,{className:"w-12 h-12 text-amber-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-slate-500 mb-4",children:s.description}),e.jsxs("div",{className:`p-6 rounded-xl mb-6 ${m.passed?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[m.score!==void 0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:`text-4xl font-bold ${m.passed?"text-emerald-700":"text-amber-700"}`,children:[m.score,"%"]}),e.jsx("div",{className:"text-sm text-slate-500 mt-1",children:r("blocks.checkpoint.yourScore")})]}),e.jsx("p",{className:`${m.passed?"text-emerald-800":"text-amber-800"}`,children:m.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:p,className:`w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${m.passed?"bg-blue-600 text-white hover:bg-blue-700":"bg-amber-500 text-white hover:bg-amber-600"}`,children:[m.passed?r("blocks.checkpoint.continue"):r("blocks.checkpoint.getHelp"),e.jsx(Je,{className:"w-5 h-5"})]}),!m.passed&&t&&e.jsxs("button",{onClick:b,className:"w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium bg-slate-100 text-slate-700 hover:bg-slate-200 transition-colors",children:[e.jsx(ee,{className:"w-5 h-5"}),r("blocks.checkpoint.tryAgain")]})]})]})})}):null}function zs({content:s,onComplete:v,isCompleted:l}){const[t,r]=n.useState(s.autoplay??!0),[m,o]=n.useState(!1),[k,N]=n.useState(0);n.useEffect(()=>{if(t){const g=setInterval(()=>{N(f=>f>=100?(s.loop||(r(!1),o(!0)),s.loop?0:100):f+1)},50);return()=>clearInterval(g)}},[t,s.loop]);const y=()=>{r(!t)},p=()=>{N(0),r(!0)},b=()=>{switch(s.animationType){case"lottie":return e.jsx("div",{className:"relative w-full h-full flex items-center justify-center bg-slate-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-48 h-48 mx-auto mb-4 bg-gradient-to-br from-blue-400 to-cyan-400 rounded-3xl flex items-center justify-center animate-pulse",children:e.jsx(je,{className:"w-20 h-20 text-white"})}),e.jsxs("p",{className:"text-slate-500 text-sm",children:["Lottie animation: ",s.url]})]})});case"video":return e.jsx("video",{className:"w-full h-full object-contain bg-black",src:s.url,autoPlay:s.autoplay,loop:s.loop,muted:!0,playsInline:!0,onEnded:()=>o(!0)});case"interactive":return e.jsx("div",{className:"relative w-full h-full flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-800",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full border-4 border-blue-400 flex items-center justify-center",style:{background:`conic-gradient(from 0deg, #3b82f6 ${k*3.6}deg, transparent ${k*3.6}deg)`},children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-800 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold",children:[Math.round(k),"%"]})})}),e.jsx("p",{className:"text-slate-300",children:"Interactive animation"})]})});default:return null}};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[e.jsx("div",{className:"border-b border-slate-700 px-6 py-4 bg-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 text-cyan-400"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:s.title})]})}),e.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[b(),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:!t&&k===0&&s.animationType!=="video"&&e.jsx("button",{onClick:y,className:"w-20 h-20 rounded-full bg-white/90 flex items-center justify-center shadow-xl pointer-events-auto hover:bg-white transition-colors",children:e.jsx(se,{className:"w-10 h-10 text-slate-900 ml-1"})})})]}),e.jsxs("div",{className:"bg-slate-800 border-t border-slate-700",children:[s.animationType!=="video"&&e.jsxs("div",{className:"px-6 py-3 border-b border-slate-700",children:[e.jsx("div",{className:"h-1.5 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 transition-all duration-100",style:{width:`${k}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-3",children:[e.jsx("button",{onClick:y,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:t?e.jsx(Ie,{className:"w-5 h-5 text-white"}):e.jsx(se,{className:"w-5 h-5 text-white ml-0.5"})}),e.jsx("button",{onClick:p,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:e.jsx(ee,{className:"w-5 h-5 text-white"})})]})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("button",{onClick:v,disabled:!m&&!l&&s.animationType!=="interactive",className:`w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${m||l||s.animationType==="interactive"?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-700 text-slate-400 cursor-not-allowed"}`,children:[l?"Continue":"Mark as Complete",e.jsx(D,{className:"w-5 h-5"})]})})]})]})}const Hs={javascript:"bg-yellow-500",typescript:"bg-blue-500",python:"bg-green-500",java:"bg-orange-500",csharp:"bg-purple-500",cpp:"bg-pink-500",c:"bg-gray-500",ruby:"bg-red-500",go:"bg-cyan-500",rust:"bg-orange-600",php:"bg-indigo-500",swift:"bg-orange-400",kotlin:"bg-purple-400",sql:"bg-blue-400",html:"bg-orange-500",css:"bg-blue-500",json:"bg-gray-400",bash:"bg-green-600",shell:"bg-green-600",markdown:"bg-slate-500"};function qs({content:s,onComplete:v,isCompleted:l}){const[t,r]=n.useState(!1),m=s.showLineNumbers??!0,o=async()=>{try{await navigator.clipboard.writeText(s.code),r(!0),setTimeout(()=>r(!1),2e3)}catch(p){console.error("Failed to copy:",p)}},k=s.code.split(`
`),N=new Set(s.highlightLines||[]),y=Hs[s.language.toLowerCase()]||"bg-slate-500";return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center",children:e.jsx(es,{className:"w-5 h-5 text-slate-200"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 ${y} text-white text-xs font-medium rounded`,children:s.language}),s.description&&e.jsx("span",{className:"text-sm text-slate-500",children:s.description})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"relative rounded-xl overflow-hidden bg-slate-900 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-slate-800 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"})]}),e.jsx("span",{className:"text-xs text-slate-400 ml-2",children:s.language})]}),e.jsx("button",{onClick:o,className:"flex items-center gap-1.5 px-2 py-1 text-xs text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-3.5 h-3.5 text-green-400"}),e.jsx("span",{className:"text-green-400",children:"Copied!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Copy"})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm",children:e.jsx("code",{children:k.map((p,b)=>{const g=b+1,f=N.has(g);return e.jsxs("div",{className:`flex ${f?"bg-yellow-500/10 -mx-4 px-4":""}`,children:[m&&e.jsx("span",{className:"select-none text-slate-500 text-right pr-4 min-w-[3rem]",children:g}),e.jsx("span",{className:`flex-1 ${f?"text-yellow-200":"text-slate-100"}`,children:p||" "})]},b)})})})})]}),s.description&&e.jsx("div",{className:"mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:e.jsx("p",{className:"text-slate-700 text-sm",children:s.description})})]})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4",children:e.jsx("div",{className:"max-w-4xl mx-auto flex justify-end",children:e.jsxs("button",{onClick:v,disabled:l,className:`flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all ${l?"bg-emerald-100 text-emerald-700 cursor-default":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[l?"Completed":"Continue",e.jsx(D,{className:"w-5 h-5"})]})})})]})}function Os({content:s,onComplete:v,previousOutput:l}){const{t}=G(),[r,m]=n.useState(l?.userSolution||""),[o,k]=n.useState(l?.solutionViewed||!1),[N,y]=n.useState(l?.hintsViewed||0),[p,b]=n.useState(!1),g=s.hints||[],f=()=>{N<g.length&&(y(N+1),b(!0))},a=()=>{k(!o)},h=()=>{v({userSolution:r,hintsViewed:N,solutionViewed:o})},i=r.trim().length>0||o;return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-violet-100 flex items-center justify-center",children:e.jsx(ts,{className:"w-5 h-5 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-purple-50 border border-violet-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"font-semibold text-violet-900 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-violet-200 flex items-center justify-center text-xs font-bold text-violet-700",children:"?"}),t("blocks.exercise.problem")]}),e.jsx("div",{className:"text-violet-800 whitespace-pre-wrap",children:s.problem})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:t("blocks.exercise.yourSolution")}),e.jsx("textarea",{value:r,onChange:C=>m(C.target.value),rows:8,placeholder:t("blocks.exercise.placeholder"),className:"w-full px-4 py-3 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-transparent resize-none font-mono text-sm"})]}),g.length>0&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-amber-600"}),e.jsxs("span",{className:"font-medium text-amber-900",children:[t("blocks.exercise.hints")," (",N," / ",g.length,")"]})]}),N<g.length&&e.jsx("button",{onClick:f,className:"px-3 py-1.5 text-sm bg-amber-200 text-amber-800 rounded-lg hover:bg-amber-300 transition-colors font-medium",children:t("blocks.exercise.showHint")})]}),p&&N>0&&e.jsx("div",{className:"space-y-2",children:g.slice(0,N).map((C,d)=>e.jsxs("div",{className:"flex gap-3 p-3 bg-white/50 rounded-lg",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-amber-200 flex-shrink-0 flex items-center justify-center text-xs font-bold text-amber-700",children:d+1}),e.jsx("p",{className:"text-amber-800 text-sm",children:C})]},d))}),N>0&&e.jsx("button",{onClick:()=>b(!p),className:"mt-2 text-sm text-amber-700 hover:text-amber-900",children:t(p?"blocks.exercise.hideHints":"blocks.exercise.showHints")})]}),e.jsxs("div",{className:"border border-slate-200 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:a,className:"w-full flex items-center justify-between p-4 bg-slate-50 hover:bg-slate-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-emerald-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:t("blocks.exercise.solution")})]}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:o?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4"}),t("blocks.exercise.hide")]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-4 h-4"}),t("blocks.exercise.show")]})})]}),o&&e.jsxs("div",{className:"p-4 border-t border-slate-200",children:[e.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 mb-4",children:e.jsx("pre",{className:"whitespace-pre-wrap text-emerald-800 font-mono text-sm",children:s.solution})}),s.solutionExplanation&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-slate-900 mb-2",children:t("blocks.exercise.explanation")}),e.jsx("p",{className:"text-slate-700 text-sm whitespace-pre-wrap",children:s.solutionExplanation})]})]})]})]})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("div",{className:"flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:"text-sm text-slate-500",children:r.trim()?t("blocks.exercise.solutionWritten"):t(o?"blocks.exercise.solutionViewed":"blocks.exercise.writeOrView")}),e.jsxs("button",{onClick:h,disabled:!i,className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${i?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-200 text-slate-400 cursor-not-allowed"}`,children:[t("blocks.continue"),e.jsx(D,{className:"w-5 h-5"})]})]})})]})}const Vs={link:ns,download:rs,video:de,document:Te},Ne={link:{bg:"bg-blue-100",icon:"text-blue-600",hover:"hover:bg-blue-50"},download:{bg:"bg-emerald-100",icon:"text-emerald-600",hover:"hover:bg-emerald-50"},video:{bg:"bg-rose-100",icon:"text-rose-600",hover:"hover:bg-rose-50"},document:{bg:"bg-amber-100",icon:"text-amber-600",hover:"hover:bg-amber-50"}};function Fs({content:s,onComplete:v,previousOutput:l}){const[t,r]=n.useState(new Set(l?.viewedResources||[])),m=p=>{if(r(b=>new Set([...b,p.id])),p.type==="download"){const b=document.createElement("a");b.href=p.url,b.download=p.title,b.target="_blank",document.body.appendChild(b),b.click(),document.body.removeChild(b)}else window.open(p.url,"_blank","noopener,noreferrer")},o=()=>{v({viewedResources:Array.from(t)})},k=t.size,N=s.resources.length,y=N>0?k/N*100:0;return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-indigo-100 flex items-center justify-center",children:e.jsx(ls,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${y}%`}})}),e.jsxs("span",{className:"text-sm text-slate-500",children:[k," / ",N," viewed"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:s.resources.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(we,{className:"w-12 h-12 text-slate-300 mb-4"}),e.jsx("p",{className:"text-slate-500",children:"No resources available"})]}):e.jsx("div",{className:"space-y-3",children:s.resources.map(p=>{const b=Vs[p.type]||we,g=Ne[p.type]||Ne.link,f=t.has(p.id);return e.jsxs("button",{onClick:()=>m(p),className:`w-full flex items-center gap-4 p-4 rounded-xl border transition-all text-left group ${f?"border-emerald-200 bg-emerald-50/50":`border-slate-200 ${g.hover}`}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 ${f?"bg-emerald-100":g.bg}`,children:f?e.jsx(K,{className:"w-6 h-6 text-emerald-600"}):e.jsx(b,{className:`w-6 h-6 ${g.icon}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-slate-900 truncate",children:p.title}),p.type==="download"&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-slate-100 text-slate-600 rounded",children:"Download"})]}),p.description&&e.jsx("p",{className:"text-sm text-slate-500 mt-1 line-clamp-2",children:p.description}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-slate-400",children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:p.url})]})]}),e.jsx(me,{className:`w-5 h-5 flex-shrink-0 transition-transform group-hover:translate-x-0.5 group-hover:-translate-y-0.5 ${f?"text-emerald-500":"text-slate-400"}`})]},p.id)})})})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("div",{className:"flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:"text-sm text-slate-500",children:k===N?"All resources viewed!":`${N-k} resource${N-k!==1?"s":""} remaining`}),e.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-6 py-3 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:["Continue",e.jsx(D,{className:"w-5 h-5"})]})]})})]})}function Ds({journeyVersionId:s,userId:v,graph:l,onComplete:t,onExit:r,trackDirection:m,trackLanguage:o,trackIdProp:k,currentModuleIdProp:N}){const{t:y}=G(),{showToast:p}=We(),[b,g]=n.useState(null),[f,a]=n.useState(null),[h,i]=n.useState(null),[C,d]=n.useState(!0),[j,_]=n.useState(null),[L,S]=n.useState(new Map),[u,I]=n.useState({}),[$,E]=n.useState(!1),[x,c]=n.useState(null),[M,A]=n.useState(null),[O,F]=n.useState(m||"ltr"),[U,W]=n.useState(o||"en"),[ae,Re]=n.useState(k),[le,Ae]=n.useState(N),ue=n.useRef(Date.now());n.useEffect(()=>{he(),ze()},[]);const ze=async()=>{try{const{data:w}=await V.from("journey_versions").select("module_id").eq("id",s).single();if(!w)return;Ae(w.module_id);const{data:R}=await V.from("modules").select("track_id").eq("id",w.module_id).single();if(!R||(Re(R.track_id),m))return;const{data:T}=await V.from("tracks").select("direction, primary_language").eq("id",R.track_id).single();T&&(F(T.direction||"ltr"),W(T.primary_language||"en"))}catch(w){console.error("Error loading track settings:",w)}},he=async()=>{d(!0),_(null);try{const{data:w,error:R}=await V.from("user_journey_runs").select("*").eq("user_id",v).eq("journey_version_id",s).neq("status","completed").neq("status","abandoned").maybeSingle();if(R)throw console.error("Failed to fetch existing run:",R),new Error(y("journey.error.failed"));let T=w;if(!T){const{data:Z,error:P}=await V.from("user_journey_runs").insert({user_id:v,journey_version_id:s,current_block_id:l.startBlockId,status:"in_progress",started_at:new Date().toISOString()}).select().single();if(P)throw console.error("Failed to create journey run:",P),new Error(y("journey.error.failed"));T=Z}g(T);const{data:z,error:H}=await V.from("user_block_states").select("*").eq("run_id",T.id);if(H&&console.error("Failed to load block states:",H),z){const Z=new Map;z.forEach(P=>{Z.set(P.block_id,P)}),S(Z)}const X=T.current_block_id||l.startBlockId;await re(X,T.id)}catch(w){console.error("Journey initialization error:",w);const R=w instanceof Error?w.message:"Failed to initialize journey";_(R),p("error",R)}finally{d(!1)}},re=async(w,R)=>{const T=l.blocks.find(H=>H.id===w);if(!T){console.error("Block not found:",w);return}a(T),ue.current=Date.now(),await V.from("user_journey_runs").update({current_block_id:w}).eq("id",R);let z=L.get(w);if(!z){const{data:H,error:X}=await V.from("user_block_states").select("*").eq("run_id",R).eq("block_id",w).maybeSingle();if(X&&console.error("Error fetching block state:",X),H)z=H,S(Z=>new Map(Z).set(w,H));else{const{data:Z,error:P}=await V.from("user_block_states").insert({run_id:R,block_id:w,status:"in_progress",started_at:new Date().toISOString()}).select().single();!P&&Z&&(z=Z,S(ne=>new Map(ne).set(w,Z)))}}if(z&&z.status==="not_started"){const{data:H}=await V.from("user_block_states").update({status:"in_progress",started_at:new Date().toISOString()}).eq("id",z.id).select().single();H&&(z=H,S(X=>new Map(X).set(w,H)))}i(z||null)},B=n.useCallback(async(w,R,T)=>{if(!f||!b||!h)return;const z=Math.floor((Date.now()-ue.current)/1e3),{data:H}=await V.from("user_block_states").update({status:"completed",output_json:w||{},score:R??null,weak_topics:T||[],time_spent_seconds:(h.time_spent_seconds||0)+z,completed_at:new Date().toISOString(),attempts_count:(h.attempts_count||0)+1}).eq("id",h.id).select().single();H&&S(P=>new Map(P).set(f.id,H));const X=ve({score:R,weak_topics:T,attempts_count:(h.attempts_count||0)+1,time_spent_seconds:(h.time_spent_seconds||0)+z,status:"completed",output_json:w},f.type==="quiz"?f.content:void 0),Z=ws(f.id,l.edges,X);if(Z)await re(Z,b.id);else{await V.from("user_journey_runs").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",b.id);const P=Array.from(L.values());H&&P.push(H);const ne=P.reduce((J,oe)=>J+(oe.time_spent_seconds||0),0),ie=P.filter(J=>J.score!==null).map(J=>J.score),De=ie.length>0?ie.reduce((J,oe)=>J+oe,0)/ie.length:0;c({totalTime:ne,blocksCompleted:P.filter(J=>J.status==="completed").length,averageScore:Math.round(De)});const Ze=await Oe();A(Ze),E(!0)}},[f,b,h,l.edges,L]),He=n.useCallback(async w=>{if(!f)return;const R=f.content;if(w.passed)I({});else{const T=R.questions.filter(z=>w.answers[z.id]!==z.correctIndex).map(z=>({prompt:z.prompt,userAnswer:z.choices[w.answers[z.id]]||"No answer",correctAnswer:z.choices[z.correctIndex],explanation:z.explanation}));I({wrongQuestions:T,weakTopics:w.weakTopics})}await B({answers:w.answers,passed:w.passed},w.score,w.weakTopics)},[f,B]),qe=n.useCallback(async w=>{await B({passed:w},w?100:0)},[B]),Oe=async()=>{if(!ae||!le)return null;try{const{data:w}=await V.from("modules").select("order_index").eq("id",le).single();if(!w)return null;const{data:R}=await V.from("modules").select("id, title, journey_versions(id, status)").eq("track_id",ae).eq("order_index",w.order_index+1).maybeSingle();if(!R)return null;const T=R.journey_versions?.find(z=>z.status==="published");return T?{versionId:T.id,moduleTitle:R.title}:null}catch(w){return console.error("Error checking for next module:",w),null}},Ve=async()=>{if(b)try{const{error:w}=await V.from("user_block_states").delete().eq("run_id",b.id);if(w)throw console.error("Failed to clear block states:",w),new Error("Failed to reset progress");const{error:R}=await V.from("user_journey_runs").update({status:"in_progress",current_block_id:l.startBlockId,completed_at:null}).eq("id",b.id);if(R)throw console.error("Failed to reset journey run:",R),new Error("Failed to restart journey");S(new Map),E(!1),c(null),p("success",y("journey.completion.restart")),await re(l.startBlockId,b.id)}catch(w){console.error("Restart journey error:",w),p("error",y("journey.error.failed"))}},Fe=w=>{const R=Math.floor(w/60),T=w%60;return R>0?`${R}m ${T}s`:`${T}s`},Be=()=>{if(!f||!h)return null;const w=h.status==="completed";switch(f.type){case"read":return e.jsx(Es,{content:f.content,onComplete:()=>B(),isCompleted:w,trackId:ae,moduleId:le});case"video":return e.jsx(_s,{content:f.content,onComplete:()=>B(),isCompleted:w});case"image":return e.jsx(Is,{content:f.content,onComplete:()=>B(),isCompleted:w});case"quiz":return e.jsx(Ts,{content:f.content,onComplete:He,previousAttempt:h.output_json?.answers?{score:h.score||0,correctCount:Math.round((h.score||0)/100*f.content.questions.length),totalCount:f.content.questions.length,answers:h.output_json.answers,weakTopics:h.weak_topics||[],passed:(h.score||0)>=(f.content.passingScore??50)}:void 0});case"mission":return e.jsx($s,{content:f.content,onComplete:T=>B(T),previousOutput:h.output_json});case"form":return e.jsx(Ls,{content:f.content,onComplete:T=>B(T),previousOutput:h.output_json});case"ai_help":return e.jsx(Rs,{content:f.content,weakTopics:u.weakTopics,wrongQuestions:u.wrongQuestions,onComplete:T=>B(T)});case"checkpoint":const R=ve(h);return e.jsx(As,{content:f.content,facts:R,onComplete:qe});case"animation":return e.jsx(zs,{content:f.content,onComplete:()=>B(),isCompleted:w});case"code":return e.jsx(qs,{content:f.content,onComplete:()=>B(),isCompleted:w});case"exercise":return e.jsx(Os,{content:f.content,onComplete:T=>B(T),previousOutput:h.output_json});case"resource":return e.jsx(Fs,{content:f.content,onComplete:T=>B(T),previousOutput:h.output_json});default:return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("p",{className:"text-slate-500",children:["Unknown block type: ",f.type]})})}};if(C)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"w-12 h-12 text-primary-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:y("journey.loading")})]})});if(j)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-100",children:e.jsxs("div",{className:"text-center max-w-md px-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-error/20 rounded-full flex items-center justify-center",children:e.jsx(Me,{className:"w-8 h-8 text-error"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-2",children:y("journey.error.title")}),e.jsx("p",{className:"text-slate-600 mb-6",children:j}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>he(),className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-primary-600 text-white rounded-xl font-semibold hover:bg-primary-700 transition-colors",children:[e.jsx(ee,{className:"w-5 h-5"}),y("journey.error.tryAgain")]}),e.jsxs("button",{onClick:r,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-slate-200 text-slate-700 rounded-xl font-semibold hover:bg-slate-300 transition-colors",children:[e.jsx(ce,{className:"w-5 h-5"}),y("journey.error.backToDashboard")]})]})]})});if($)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-600 via-blue-700 to-cyan-600 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-lg w-full p-8 text-center",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"w-24 h-24 mx-auto bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(us,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center animate-bounce",children:e.jsx(te,{className:"w-4 h-4 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:y("journey.completion.title")}),e.jsx("p",{className:"text-slate-600 mb-8",children:y("journey.completion.congratulations")}),x&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-primary-600"})}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:x.blocksCompleted}),e.jsx("div",{className:"text-xs text-slate-500",children:y("journey.completion.stats.blocksCompleted")})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-warning/20 rounded-lg flex items-center justify-center",children:e.jsx(xs,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:[x.averageScore,"%"]}),e.jsx("div",{className:"text-xs text-slate-500",children:y("journey.completion.stats.averageScore")})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-emerald-100 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-emerald-600"})}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:Fe(x.totalTime)}),e.jsx("div",{className:"text-xs text-slate-500",children:y("journey.completion.stats.timeSpent")})]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:M?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>t(M),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors",children:[e.jsx(te,{className:"w-5 h-5"}),y("journey.completion.continueToNext",{module:M.moduleTitle})]}),e.jsxs("button",{onClick:()=>t(),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-slate-100 text-slate-700 rounded-xl font-semibold hover:bg-slate-200 transition-colors",children:[e.jsx(ce,{className:"w-5 h-5"}),y("journey.completion.backToDashboard")]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>t(),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors",children:[e.jsx(ce,{className:"w-5 h-5"}),y("journey.completion.backToDashboard")]}),e.jsxs("button",{onClick:Ve,className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-slate-100 text-slate-700 rounded-xl font-semibold hover:bg-slate-200 transition-colors",children:[e.jsx(ee,{className:"w-5 h-5"}),y("journey.completion.restart")]})]})})]})});const pe=Array.from(L.values()).filter(w=>w.status==="completed").length,Pe=pe/l.blocks.length*100,Q=O==="rtl";return e.jsx(Xe,{direction:O,primaryLanguage:U,children:e.jsxs("div",{className:"flex flex-col h-screen bg-slate-100",children:[e.jsxs("header",{className:`bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between ${Q?"flex-row-reverse":""}`,children:[e.jsxs("button",{onClick:r,className:`flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors ${Q?"flex-row-reverse":""}`,children:[e.jsx(_e,{className:`w-5 h-5 ${Q?"rotate-180":""}`}),e.jsx("span",{className:"font-medium",children:y("journey.exit")})]}),e.jsxs("div",{className:`flex items-center gap-4 ${Q?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-48 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-primary-600 transition-all duration-300 ${Q?"mr-auto":""}`,style:{width:`${Pe}%`,marginLeft:Q?"auto":void 0,marginRight:Q?"0":void 0}})}),e.jsxs("span",{className:"text-sm text-slate-500 font-medium",children:[pe," / ",l.blocks.length]})]})]}),e.jsx("main",{className:"flex-1 overflow-hidden",children:Be()})]})})}export{Ds as JourneyRunner};

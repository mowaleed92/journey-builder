import{c as q,a as n,j as e,B as ke,L as X,o as ee,p as Ue,n as Ce,f as Z,P as se,k as Q,T as Se,i as Ee,S as te,A as Me,q as Je,C as Ye,e as Ge,s as F,t as We}from"./index-vT5yFsa4.js";import{C as _e,V as de,P as Ie,I as fe,H as be,R as K,U as Xe,F as Te,u as Qe,B as ge,d as Ke,e as je,a as es,f as ss,c as ts,b as as,D as rs,L as ls}from"./useAIEnabled-12KJL6FL.js";const ns=q("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);const is=q("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const me=q("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const os=q("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);const cs=q("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const we=q("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);const ce=q("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);const ds=q("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);const ms=q("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);const $e=q("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);const us=q("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);const xs=q("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);const hs=q("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const ps=q("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);const fs=q("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);const Le=q("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const bs=q("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);const gs=q("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function ye(s,N){const r=N[s.fact],a=s.value;switch(s.op){case"eq":return r===a;case"neq":return r!==a;case"gt":return typeof r=="number"&&typeof a=="number"&&r>a;case"gte":return typeof r=="number"&&typeof a=="number"&&r>=a;case"lt":return typeof r=="number"&&typeof a=="number"&&r<a;case"lte":return typeof r=="number"&&typeof a=="number"&&r<=a;case"contains":return Array.isArray(r)||typeof r=="string"&&typeof a=="string"?r.includes(a):!1;case"in":return Array.isArray(a)?a.includes(r):!1;default:return!1}}function ue(s,N){return s.all?s.all.every(r=>"fact"in r?ye(r,N):ue(r,N)):s.any?s.any.some(r=>"fact"in r?ye(r,N):ue(r,N)):!0}function js(s,N){return s.condition?ue(s.condition,N):!0}function ws(s,N,r){const a=N.filter(h=>h.from===s).sort((h,i)=>(i.priority??0)-(h.priority??0));for(const h of a)if(js(h,r))return h.to;return a.find(h=>!h.condition)?.to??null}function ve(s,N){const r={};if(s.score!==void 0&&s.score!==null&&(r["quiz.scorePercent"]=s.score),s.weak_topics&&s.weak_topics.length>0&&(r["quiz.weakTopics"]=s.weak_topics),N?.questions){const a=N.questions.length;r["quiz.totalCount"]=a,s.score!==void 0&&s.score!==null&&(r["quiz.correctCount"]=Math.round(s.score/100*a))}return s.attempts_count!==void 0&&(r["block.attemptsCount"]=s.attempts_count),s.time_spent_seconds!==void 0&&(r["block.timeSpentSeconds"]=s.time_spent_seconds),s.status&&(r["block.status"]=s.status),s.output_json&&Object.entries(s.output_json).forEach(([a,x])=>{r[`output.${a}`]=x}),r}function ys({term:s,contextSnippet:N,trackId:r,moduleId:a}){const[x,h]=n.useState(!1),[i,b]=n.useState(null),[M,v]=n.useState(!1),[p,o]=n.useState(null),[k,f]=n.useState(null),t=n.useRef(null),c=n.useRef(null);n.useEffect(()=>{if(x&&t.current){const m=t.current.getBoundingClientRect(),w=window.innerHeight,I=150,l=w-m.bottom<I&&m.top>I;f({top:l?m.top-I-8:m.bottom+8,left:Math.max(16,Math.min(m.left,window.innerWidth-280)),arrowPosition:l?"bottom":"top"})}},[x]),n.useEffect(()=>{const m=w=>{c.current&&!c.current.contains(w.target)&&t.current&&!t.current.contains(w.target)&&h(!1)};return x&&(document.addEventListener("mousedown",m),document.addEventListener("touchstart",m)),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m)}},[x]);const d=async()=>{if(!i){v(!0),o(null);try{const m=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/glossary-explain",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({term:s,contextSnippet:N,trackId:r,moduleId:a})});if(!m.ok)throw new Error("Failed to fetch explanation");const w=await m.json();b(w.explanation)}catch(m){o("تعذر تحميل الشرح"),console.error("Glossary fetch error:",m)}finally{v(!1)}}},C=()=>{h(!x),!x&&!i&&d()};return e.jsxs(e.Fragment,{children:[e.jsx("span",{ref:t,className:"english-term",onClick:C,onKeyDown:m=>m.key==="Enter"&&C(),role:"button",tabIndex:0,"aria-expanded":x,"aria-haspopup":"dialog",children:s}),x&&k&&e.jsxs("div",{ref:c,className:"glossary-popup fixed",style:{top:k.top,left:k.left,width:"260px"},role:"dialog","aria-label":`شرح ${s}`,children:[e.jsx("div",{className:"glossary-popup-arrow",style:{[k.arrowPosition==="top"?"top":"bottom"]:"-6px",left:"20px",transform:k.arrowPosition==="top"?"rotate(45deg)":"rotate(225deg)"}}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-700",children:[e.jsx(ke,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"font-english text-blue-300 font-medium",children:s})]}),e.jsxs("div",{className:"arabic-content text-sm",children:[M&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"جاري التحميل..."})]}),p&&e.jsx("div",{className:"text-red-400 text-sm",children:p}),i&&!M&&e.jsx("p",{className:"text-slate-200 leading-relaxed",children:i})]})]})]})}const vs=/\b([A-Za-z][A-Za-z0-9]*(?:\s+[A-Za-z][A-Za-z0-9]*){0,3})\b/g,Ns=new Set(["a","an","the","is","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","may","might","must","shall","can","need","dare","ought","used","to","of","in","for","on","with","at","by","from","up","about","into","over","after","and","or","but","if","then","else","when","where","why","how","all","each","every","both","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","just","also","now","here","there","this","that","these","those","i","you","he","she","it","we","they","me","him","her","us","them","my","your","his","its","our","their","what","which","who","whom"]),ks=[/^[A-Z]{2,}$/,/^[A-Z][a-z]+[A-Z]/,/\d/,/^(API|SDK|UI|UX|CSS|HTML|JS|JSON|XML|SQL|HTTP|REST|GraphQL|Git|npm|AI|ML|GPT|LLM|RAG|NLP|CNN|RNN|LSTM|GAN|VAE|RL|DL|IoT|AWS|GCP|Azure|Docker|K8s|Kubernetes|React|Vue|Angular|Node|Python|Java|Go|Rust|Swift|Kotlin|TypeScript|JavaScript|PHP|Ruby|Scala|Clojure|Haskell|Elixir|Erlang|C|CPP|CSharp|FSharp|VB|Perl|Lua|Dart|Flutter|Android|iOS|macOS|Windows|Linux|Unix|Ubuntu|Debian|Fedora|CentOS|RedHat|SUSE|Arch|Alpine|Mint|Elementary|Pop|Manjaro|Kali|Parrot|BlackArch|Tails|Qubes|Whonix)$/i];function Cs(s){const N=s.toLowerCase();if(Ns.has(N)||s.length<2)return!1;for(const r of ks)if(r.test(s))return!0;return!!(s.length>=4&&/^[A-Z]/.test(s))}function Ss(s,N,r){const x=Math.max(0,N-100),h=Math.min(s.length,N+r+100);let i=s.slice(x,h);return x>0&&(i="..."+i),h<s.length&&(i=i+"..."),i}function Es({children:s,trackId:N,moduleId:r,className:a=""}){const x=n.useMemo(()=>{const h=s,i=[];let b=0;const M=[...h.matchAll(vs)];for(const v of M){const p=v[1],o=v.index;if(!Cs(p))continue;o>b&&i.push(h.slice(b,o));const k=Ss(h,o,p.length);i.push(e.jsx(ys,{term:p,contextSnippet:k,trackId:N,moduleId:r},`${p}-${o}`)),b=o+p.length}return b<h.length&&i.push(h.slice(b)),i.length>0?i:h},[s,N,r]);return e.jsx("span",{className:`arabic-content ${a}`,children:x})}function Ms({content:s,onComplete:N,isCompleted:r,trackId:a,moduleId:x}){const{t:h}=ee(),{isRTL:i,direction:b,primaryLanguage:M}=Ue(),[v,p]=n.useState(0),[o,k]=n.useState(!1);n.useEffect(()=>{const C=document.getElementById("read-content-scroll");if(!C)return;const m=()=>{C.scrollHeight<=C.clientHeight&&(k(!0),p(100))},w=()=>{const I=C.scrollHeight-C.clientHeight;if(I<=0){k(!0),p(100);return}const T=C.scrollTop/I*100;p(Math.min(100,T)),T>=90&&k(!0)};return m(),C.addEventListener("scroll",w),window.addEventListener("resize",m),()=>{C.removeEventListener("scroll",w),window.removeEventListener("resize",m)}},[s.markdown]);const f=C=>{const m=C.split(`
`),w=[];let I=!1,T="";return m.forEach((l,S)=>{if(l.startsWith("```")){I?(w.push(e.jsx("pre",{className:"bg-slate-900 text-slate-100 p-4 rounded-lg overflow-x-auto my-4 text-sm font-mono",children:e.jsx("code",{children:T})},`code-${S}`)),T="",I=!1):(I=!0,l.slice(3));return}if(I){T+=(T?`
`:"")+l;return}if(l.startsWith("### "))w.push(e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mt-6 mb-3",children:l.slice(4)},S));else if(l.startsWith("## "))w.push(e.jsx("h2",{className:"text-xl font-bold text-slate-900 mt-8 mb-4",children:l.slice(3)},S));else if(l.startsWith("# "))w.push(e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mt-8 mb-4",children:l.slice(2)},S));else if(l.startsWith("- ")||l.startsWith("* "))w.push(e.jsx("li",{className:"text-slate-700 ml-4 mb-2 list-disc",children:c(l.slice(2))},S));else if(l.match(/^\d+\. /)){const _=l.replace(/^\d+\. /,"");w.push(e.jsx("li",{className:"text-slate-700 ml-4 mb-2 list-decimal",children:c(_)},S))}else l.startsWith("> ")?w.push(e.jsx("blockquote",{className:"border-l-4 border-primary-500 pl-4 py-2 my-4 bg-primary-50 text-slate-700 italic",children:c(l.slice(2))},S)):l.trim()===""?w.push(e.jsx("div",{className:"h-4"},S)):w.push(e.jsx("p",{className:"text-slate-700 leading-relaxed mb-4",children:c(l)},S))}),w},t=(C,m)=>i&&typeof C=="string"?e.jsx(Es,{trackId:a,moduleId:x,className:"inline",children:C},m):C,c=C=>{const m=[];let w=C,I=0;for(;w.length>0;){const T=w.match(/\*\*(.+?)\*\*/),l=w.match(/\*(.+?)\*/),S=w.match(/`(.+?)`/),_=w.match(/\[(.+?)\]\((.+?)\)/),R=[T?{type:"bold",match:T,index:T.index}:null,l?{type:"italic",match:l,index:l.index}:null,S?{type:"code",match:S,index:S.index}:null,_?{type:"link",match:_,index:_.index}:null].filter(Boolean).sort((j,u)=>j.index-u.index);if(R.length===0){m.push(i?t(w,I++):w);break}const g=R[0];if(g.index>0){const j=w.slice(0,g.index);m.push(i?t(j,I++):j)}switch(g.type){case"bold":m.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:i?t(g.match[1],I++):g.match[1]},I++)),w=w.slice(g.index+g.match[0].length);break;case"italic":m.push(e.jsx("em",{className:"italic",children:i?t(g.match[1],I++):g.match[1]},I++)),w=w.slice(g.index+g.match[0].length);break;case"code":m.push(e.jsx("code",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono text-slate-800",children:g.match[1]},I++)),w=w.slice(g.index+g.match[0].length);break;case"link":m.push(e.jsx("a",{href:g.match[2],target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:text-primary-800 underline",children:g.match[1]},I++)),w=w.slice(g.index+g.match[0].length);break}}return m},d={continue:h("blocks.read.continue"),complete:h("blocks.markComplete"),scroll:h("blocks.read.continue"),minRead:h("track.min")};return e.jsxs("div",{className:"flex flex-col h-full bg-white",dir:b,children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{className:`flex items-center gap-3 mb-2 ${i?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center",children:e.jsx(ke,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{className:i?"text-right":"",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.estimatedReadTime&&e.jsxs("div",{className:`flex items-center gap-1 text-sm text-slate-500 ${i?"flex-row-reverse":""}`,children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.estimatedReadTime," ",d.minRead]})]})]})]}),e.jsx("div",{className:"h-1 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-primary-500 transition-all duration-300 ${i?"ml-auto":""}`,style:{width:`${v}%`,marginLeft:i?"auto":void 0,marginRight:i?"0":void 0}})})]}),e.jsx("div",{id:"read-content-scroll",className:`flex-1 overflow-y-auto px-6 py-6 ${i?"arabic-content":""}`,children:e.jsx("div",{className:"max-w-3xl mx-auto",children:f(s.markdown)})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("button",{onClick:N,disabled:!o&&!r,className:`
            w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all
            ${i?"flex-row-reverse":""}
            ${o||r?"bg-primary-600 text-white hover:bg-primary-700 shadow-sm":"bg-slate-200 text-slate-400 cursor-not-allowed"}
          `,children:[r?d.continue:o?d.complete:d.scroll,i?e.jsx(_e,{className:"w-5 h-5"}):e.jsx(Z,{className:"w-5 h-5"})]})})]})}function _s({content:s,onComplete:N,isCompleted:r}){const{t:a}=ee(),[x,h]=n.useState(!1),[i,b]=n.useState(!1),[M,v]=n.useState(0),[p,o]=n.useState(!1),[k,f]=n.useState(!1),[t,c]=n.useState(!1),d=n.useRef(null),C=n.useRef(null),m=s.url.includes("youtube.com")||s.url.includes("youtu.be"),w=s.url.includes("vimeo.com"),I=u=>{const E=u.split(".").pop()?.toLowerCase().split("?")[0];return{mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4",avi:"video/x-msvideo",wmv:"video/x-ms-wmv"}[E||""]||"video/mp4"},T=u=>{const E=u.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&]+)/);return E?E[1]:null},l=u=>{const E=u.match(/vimeo\.com\/(\d+)/);return E?E[1]:null};n.useEffect(()=>{if(d.current){const u=d.current,E=()=>{const Y=u.currentTime/u.duration*100;v(Y),Y>=80&&o(!0)},z=()=>h(!0),H=()=>h(!1),V=()=>{h(!1),o(!0)},U=()=>{console.error("Video loading error:",u.error),c(!0)};return u.addEventListener("timeupdate",E),u.addEventListener("play",z),u.addEventListener("pause",H),u.addEventListener("ended",V),u.addEventListener("error",U),()=>{u.removeEventListener("timeupdate",E),u.removeEventListener("play",z),u.removeEventListener("pause",H),u.removeEventListener("ended",V),u.removeEventListener("error",U)}}},[]);const S=()=>{d.current&&(x?d.current.pause():d.current.play())},_=()=>{d.current&&(d.current.muted=!i,b(!i))},R=()=>{d.current&&(document.fullscreenElement?document.exitFullscreen():d.current.requestFullscreen())},g=u=>{if(d.current&&C.current){const E=C.current.getBoundingClientRect(),z=(u.clientX-E.left)/E.width*100;d.current.currentTime=z/100*d.current.duration}},j=u=>{const E=Math.floor(u/60),z=Math.floor(u%60);return`${E}:${z.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"relative flex-1 bg-black flex items-center justify-center",children:[m?e.jsx("iframe",{className:"w-full h-full",src:`https://www.youtube.com/embed/${T(s.url)}?rel=0&modestbranding=1`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onLoad:()=>o(!0)}):w?e.jsx("iframe",{className:"w-full h-full",src:`https://player.vimeo.com/video/${l(s.url)}`,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0,onLoad:()=>o(!0)}):e.jsxs(e.Fragment,{children:[e.jsxs("video",{ref:d,className:"w-full h-full object-contain",playsInline:!0,children:[e.jsx("source",{src:s.url,type:I(s.url)}),"Your browser does not support the video tag."]}),t&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/90",children:e.jsxs("div",{className:"text-center px-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-error/20 flex items-center justify-center",children:e.jsx(de,{className:"w-8 h-8 text-error"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Video Unavailable"}),e.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Unable to load this video. The file may be in an unsupported format or the URL may be incorrect."}),e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Continue Anyway"})]})})]}),!m&&!w&&!x&&e.jsx("button",{onClick:S,className:"absolute inset-0 flex items-center justify-center bg-black/30 hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/90 flex items-center justify-center shadow-xl",children:e.jsx(se,{className:"w-10 h-10 text-slate-900 ml-1"})})})]}),!m&&!w&&e.jsxs("div",{className:"bg-slate-800 px-4 py-3",children:[e.jsx("div",{ref:C,className:"h-1.5 bg-slate-600 rounded-full cursor-pointer mb-3",onClick:g,children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all",style:{width:`${M}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:S,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:x?e.jsx(Ie,{className:"w-5 h-5 text-white"}):e.jsx(se,{className:"w-5 h-5 text-white ml-0.5"})}),e.jsx("button",{onClick:_,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:i?e.jsx(fs,{className:"w-5 h-5 text-white"}):e.jsx(ps,{className:"w-5 h-5 text-white"})}),e.jsxs("span",{className:"text-sm text-slate-300",children:[d.current?j(d.current.currentTime):"0:00"," / "," ",s.duration?j(s.duration):d.current?j(d.current.duration||0):"0:00"]})]}),e.jsx("button",{onClick:R,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:e.jsx(ms,{className:"w-5 h-5 text-white"})})]})]})]}),e.jsxs("div",{className:"bg-slate-800 border-t border-slate-700",children:[e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-primary-400"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:s.title})]}),s.transcript&&e.jsx("button",{onClick:()=>f(!k),className:"text-sm text-primary-400 hover:text-primary-300 mt-2",children:k?"Hide transcript":"Show transcript"}),k&&s.transcript&&e.jsx("div",{className:"mt-4 p-4 bg-slate-900 rounded-lg max-h-48 overflow-y-auto",children:e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed whitespace-pre-wrap",children:s.transcript})})]}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-700",children:e.jsxs("button",{onClick:N,disabled:!p&&!r,className:`
              w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all
              ${p||r?"bg-primary-600 text-white hover:bg-primary-700":"bg-slate-700 text-slate-400 cursor-not-allowed"}
            `,children:[a(r?"blocks.continue":p?"blocks.markComplete":"blocks.video.loading"),e.jsx(Z,{className:"w-5 h-5"})]})})]})]})}function Is({content:s,onComplete:N,isCompleted:r}){const{t:a}=ee(),[x,h]=n.useState(!0),[i,b]=n.useState(!1),[M,v]=n.useState(!1),p=()=>{h(!1)},o=()=>{h(!1),v(!0)};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:s.title})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:s.url?e.jsxs("div",{className:"relative",children:[x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-100 rounded-xl",children:e.jsx(X,{className:"w-8 h-8 text-slate-400 animate-spin"})}),M?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 bg-slate-100 rounded-xl",children:[e.jsx(fe,{className:"w-12 h-12 text-slate-400 mb-4"}),e.jsx("p",{className:"text-slate-500",children:"Failed to load image"})]}):e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.url,alt:s.alt||s.title,className:`w-full rounded-xl shadow-lg transition-transform cursor-pointer ${i?"scale-150 cursor-zoom-out":"cursor-zoom-in"}`,onLoad:p,onError:o,onClick:()=>b(!i)}),e.jsx("button",{onClick:()=>b(!i),className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:i?e.jsx(gs,{className:"w-5 h-5"}):e.jsx(bs,{className:"w-5 h-5"})})]}),s.caption&&e.jsx("p",{className:"mt-4 text-center text-slate-600 italic",children:s.caption})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 bg-slate-100 rounded-xl",children:[e.jsx(fe,{className:"w-12 h-12 text-slate-400 mb-4"}),e.jsx("p",{className:"text-slate-500",children:"No image set"})]})})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4",children:e.jsx("div",{className:"max-w-4xl mx-auto flex justify-end",children:e.jsxs("button",{onClick:N,disabled:r,className:`flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all ${r?"bg-emerald-100 text-emerald-700 cursor-default":"bg-primary-600 text-white hover:bg-primary-700"}`,children:[a(r?"blocks.complete":"blocks.continue"),e.jsx(Z,{className:"w-5 h-5"})]})})})]})}function Ts({content:s,onComplete:N,previousAttempt:r}){const{t:a}=ee(),[x,h]=n.useState(0),[i,b]=n.useState({}),[M,v]=n.useState(!1),[p,o]=n.useState(!1),[k,f]=n.useState([]),[t,c]=n.useState(null);n.useEffect(()=>{let j=[...s.questions];s.shuffleQuestions&&(j=j.sort(()=>Math.random()-.5)),f(j)},[s.questions,s.shuffleQuestions]);const d=k[x],C=s.passingScore??50,m=d&&i[d.id]!==void 0,w=d&&i[d.id]===d.correctIndex,I=()=>d?s.shuffleChoices?d.choices.map((u,E)=>({choice:u,originalIndex:E})).sort(()=>Math.random()-.5):d.choices.map((j,u)=>({choice:j,originalIndex:u})):[],[T]=n.useState([]);s.shuffleChoices||d?.choices.map((j,u)=>({choice:j,originalIndex:u})),n.useEffect(()=>{if(d&&s.shuffleChoices){const j=d.choices.map((u,E)=>({choice:u,originalIndex:E}));T.length=0,T.push(...j.sort(()=>Math.random()-.5))}},[x,d,s.shuffleChoices]);const l=j=>{m||(b({...i,[d.id]:j}),o(!0))},S=()=>{o(!1),x<k.length-1?h(x+1):_()},_=()=>{let j=0;const u=new Set;k.forEach(H=>{i[H.id]===H.correctIndex?j++:H.tags.forEach(V=>u.add(V))});const E=Math.round(j/k.length*100),z={score:E,correctCount:j,totalCount:k.length,answers:i,weakTopics:Array.from(u),passed:E>=C};c(z),v(!0)},R=()=>{b({}),h(0),v(!1),o(!1),c(null),s.shuffleQuestions&&f([...s.questions].sort(()=>Math.random()-.5))},g=()=>{t&&N(t)};return M&&t?e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsx("div",{className:`w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center ${t.passed?"bg-success/20":"bg-warning/20"}`,children:t.passed?e.jsx(ns,{className:"w-12 h-12 text-emerald-600"}):e.jsx(be,{className:"w-12 h-12 text-warning"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:t.passed?a("blocks.quiz.result.passed"):a("blocks.quiz.result.failed")}),e.jsx("p",{className:"text-slate-600 mb-6",children:t.passed?a("blocks.quiz.result.passedMessage"):a("blocks.quiz.result.failedMessage")}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"text-5xl font-bold text-slate-900 mb-2",children:[t.score,"%"]}),e.jsxs("div",{className:"text-slate-500",children:[t.correctCount," ",a("blocks.quiz.of")," ",t.totalCount," ",a("blocks.quiz.result.correct")]}),e.jsx("div",{className:"mt-4 h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${t.passed?"bg-success":"bg-warning"}`,style:{width:`${t.score}%`}})}),e.jsxs("div",{className:"mt-2 text-sm text-slate-500",children:[a("blocks.quiz.result.yourScore"),": ",C,"%"]})]}),t.weakTopics.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-700 mb-2",children:"Topics to review:"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:t.weakTopics.map(j=>e.jsx("span",{className:"px-3 py-1 bg-warning/20 text-warning rounded-full text-sm",children:j},j))})]}),e.jsxs("div",{className:"flex gap-3",children:[s.allowRetry!==!1&&!t.passed&&e.jsxs("button",{onClick:R,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium bg-slate-100 text-slate-700 hover:bg-slate-200 transition-colors",children:[e.jsx(K,{className:"w-5 h-5"}),a("blocks.quiz.retry")]}),e.jsxs("button",{onClick:g,className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${t.passed?"bg-primary-600 text-white hover:bg-primary-700":"bg-warning text-white hover:bg-warning/90"}`,children:[t.passed?a("blocks.continue"):a("blocks.aiHelp.askForHelp"),e.jsx(Z,{className:"w-5 h-5"})]})]})]})})}):d?e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]}),e.jsxs("div",{className:"text-sm font-medium text-slate-500",children:[a("blocks.quiz.question")," ",x+1," ",a("blocks.quiz.of")," ",k.length]})]}),e.jsx("div",{className:"flex gap-1.5",children:k.map((j,u)=>e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${u<x?i[k[u].id]===k[u].correctIndex?"bg-emerald-500":"bg-red-500":u===x?"bg-blue-500":"bg-slate-200"}`},u))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-6",children:d.prompt}),e.jsx("div",{className:"space-y-3",children:(s.shuffleChoices?I():d.choices.map((j,u)=>({choice:j,originalIndex:u}))).map(({choice:j,originalIndex:u})=>{const E=i[d.id]===u,z=u===d.correctIndex,H=m;let V="bg-white hover:bg-slate-50 border-slate-200",U="text-slate-700",Y=null;return H?z?(V="bg-emerald-50 border-emerald-500",U="text-emerald-900",Y=e.jsx(Q,{className:"w-6 h-6 text-emerald-600"})):E&&!z&&(V="bg-error/10 border-error",U="text-red-900",Y=e.jsx(Le,{className:"w-6 h-6 text-red-600"})):E&&(V="bg-blue-50 border-blue-500",U="text-blue-900"),e.jsxs("button",{onClick:()=>l(u),disabled:m,className:`w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all ${V} ${m?"cursor-default":"cursor-pointer"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center font-medium ${H?z?"border-emerald-500 bg-emerald-500 text-white":E?"border-red-500 bg-red-500 text-white":"border-slate-300 text-slate-500":E?"border-blue-500 bg-blue-500 text-white":"border-slate-300 text-slate-500"}`,children:String.fromCharCode(65+u)}),e.jsx("span",{className:`flex-1 text-left font-medium ${U}`,children:j}),Y]},u)})}),p&&d.explanation&&e.jsxs("div",{className:`mt-6 p-4 rounded-lg ${w?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsx("h4",{className:`font-medium mb-1 ${w?"text-emerald-800":"text-amber-800"}`,children:a(w?"blocks.quiz.result.correct":"blocks.quiz.result.incorrect")}),e.jsx("p",{className:`text-sm ${w?"text-emerald-700":"text-amber-700"}`,children:d.explanation})]})]})}),m&&e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("button",{onClick:S,className:"w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:[x<k.length-1?a("blocks.quiz.next"):a("blocks.submit"),e.jsx(Z,{className:"w-5 h-5"})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full"})})}function $s({content:s,onComplete:N,previousOutput:r}){ee();const[a,x]=n.useState(new Set(r?.completedSteps||[])),[h,i]=n.useState(!1),[b,M]=n.useState({}),[v,p]=n.useState(null),[o,k]=n.useState({}),[f,t]=n.useState(r?.validationHistory||{}),c=s.steps.every(l=>a.has(l.id)),d=l=>{const S=new Set(a);S.has(l)?S.delete(l):S.add(l),x(S)},C=()=>{N({completedSteps:Array.from(a),validationHistory:f})},m=(l,S)=>{M(_=>({..._,[l]:S})),k(_=>({..._,[l]:null}))},w=async l=>{const S=b[l.id]?.trim();if(S){p(l.id);try{const _=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/mission-validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({question:l.instruction,userAnswer:S,expectedCriteria:l.expectedCriteria||"The answer should demonstrate understanding of the concept."})});if(!_.ok)throw new Error("Validation failed");const R=await _.json();k(j=>({...j,[l.id]:R}));const g={answer:S,correct:R.correct,feedback:R.feedback,score:R.score,timestamp:new Date().toISOString()};t(j=>({...j,[l.id]:[...j[l.id]||[],g]})),R.correct&&x(j=>new Set([...j,l.id]))}catch(_){console.error("AI validation error:",_),k(R=>({...R,[l.id]:{correct:!1,feedback:"Unable to validate your answer. Please try again.",score:0}}))}finally{p(null)}}},I=l=>{k(S=>({...S,[l]:null})),M(S=>({...S,[l]:""})),x(S=>{const _=new Set(S);return _.delete(l),_})},T=l=>{const S=a.has(l.id),_=v===l.id,R=o[l.id],g=f[l.id]?.length||0;switch(l.verificationMethod){case"ai_validate":return e.jsxs("div",{className:"mt-3 space-y-3",children:[!S&&e.jsxs(e.Fragment,{children:[l.inputType==="textarea"?e.jsx("textarea",{value:b[l.id]||"",onChange:j=>m(l.id,j.target.value),placeholder:"Type your answer here...",rows:4,disabled:_,className:"w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none disabled:bg-slate-50 disabled:text-slate-400"}):e.jsx("input",{type:"text",value:b[l.id]||"",onChange:j=>m(l.id,j.target.value),placeholder:"Type your answer here...",disabled:_,className:"w-full px-4 py-3 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-slate-50 disabled:text-slate-400"}),e.jsx("button",{onClick:()=>w(l),disabled:_||!b[l.id]?.trim(),className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors",children:_?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),"Checking..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4"}),"Submit Answer"]})})]}),R&&e.jsx("div",{className:`p-4 rounded-lg ${R.correct?"bg-emerald-50 border border-emerald-200":"bg-error/10 border border-error/20"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[R.correct?e.jsx(Q,{className:"w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5"}):e.jsx(Le,{className:"w-5 h-5 text-error flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`font-medium ${R.correct?"text-success":"text-error"}`,children:R.correct?"Correct!":"Not quite right"}),e.jsxs("span",{className:`text-sm px-2 py-0.5 rounded ${R.correct?"bg-emerald-200 text-emerald-800":"bg-error/20 text-error"}`,children:["Score: ",R.score,"%"]})]}),e.jsx("p",{className:`text-sm ${R.correct?"text-success":"text-error"}`,children:R.feedback}),!R.correct&&e.jsxs("button",{onClick:()=>I(l.id),className:"mt-3 flex items-center gap-1 text-sm text-error hover:text-error/80 font-medium",children:[e.jsx(K,{className:"w-4 h-4"}),"Try Again"]})]})]})}),g>0&&e.jsxs("div",{className:"text-xs text-slate-500",children:[g," attempt",g!==1?"s":""," made"]})]});case"screenshot":return e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg cursor-pointer text-sm text-slate-600 transition-colors w-fit",children:[e.jsx(Xe,{className:"w-4 h-4"}),h?"Screenshot uploaded":"Upload screenshot",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:()=>{i(!0),d(l.id)}})]})});case"url_check":return e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"url",placeholder:"Paste URL here...",className:"w-full px-4 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:j=>{j.target.value&&d(l.id)}})});default:return null}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-6 mb-6",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"Your Mission"}),e.jsx("p",{className:"text-orange-800",children:"Complete the following steps to proceed. This is a hands-on activity that will help reinforce your learning."})]}),s.externalUrl&&e.jsxs("a",{href:s.externalUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 bg-primary-50 border border-primary-200 rounded-xl mb-6 hover:bg-primary-100 transition-colors group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center",children:e.jsx(me,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-primary-900",children:"Open external resource"}),e.jsx("div",{className:"text-sm text-primary-600 truncate",children:s.externalUrl})]}),e.jsx(Z,{className:"w-5 h-5 text-primary-400 group-hover:translate-x-1 transition-transform"})]}),e.jsx("div",{className:"space-y-4",children:s.steps.map((l,S)=>{const _=a.has(l.id);return e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${_?"bg-emerald-50 border-emerald-300":"bg-white border-slate-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>{(l.verificationMethod==="self_report"||!l.verificationMethod)&&d(l.id)},disabled:l.verificationMethod==="ai_validate",className:`mt-0.5 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${_?"border-emerald-500 bg-emerald-500":l.verificationMethod==="ai_validate"?"border-slate-200 bg-slate-50 cursor-default":"border-slate-300 hover:border-slate-400"}`,children:_?e.jsx(Q,{className:"w-4 h-4 text-white"}):e.jsx(is,{className:"w-4 h-4 text-transparent"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-slate-500",children:["Step ",S+1]}),l.verificationMethod==="ai_validate"&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-primary-100 text-primary-700 rounded",children:"AI Validated"})]}),e.jsx("p",{className:`font-medium mt-1 ${_?"text-emerald-800":"text-slate-900"}`,children:l.instruction}),T(l)]})]})},l.id)})}),s.completionMessage&&c&&e.jsx("div",{className:"mt-6 p-4 bg-emerald-50 border border-emerald-200 rounded-xl",children:e.jsx("p",{className:"text-emerald-800 font-medium",children:s.completionMessage})})]})}),e.jsxs("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm text-slate-500",children:[a.size," of ",s.steps.length," steps completed"]}),e.jsx("span",{className:`text-sm font-medium ${c?"text-emerald-600":"text-slate-400"}`,children:c?"Ready to continue!":"Complete all steps"})]}),e.jsxs("button",{onClick:C,disabled:!c,className:`w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${c?"bg-primary-600 text-white hover:bg-primary-700":"bg-slate-200 text-slate-400 cursor-not-allowed"}`,children:["Continue",e.jsx(Z,{className:"w-5 h-5"})]})]})]})}function Ls({content:s,onComplete:N,previousOutput:r}){const[a,x]=n.useState(r||{}),[h,i]=n.useState({}),[b,M]=n.useState(new Set),v=(t,c)=>{if(t.required&&(!c||typeof c=="string"&&!c.trim()))return"This field is required";if(t.validation&&typeof c=="string"){if(t.validation.minLength&&c.length<t.validation.minLength)return`Must be at least ${t.validation.minLength} characters`;if(t.validation.maxLength&&c.length>t.validation.maxLength)return`Must be no more than ${t.validation.maxLength} characters`;if(t.validation.pattern&&!new RegExp(t.validation.pattern).test(c))return"Invalid format"}return null},p=(t,c)=>{x({...a,[t]:c});const d=s.fields.find(C=>C.id===t);if(d&&b.has(t)){const C=v(d,c);i({...h,[t]:C||""})}},o=t=>{M(new Set([...b,t]));const c=s.fields.find(d=>d.id===t);if(c){const d=v(c,a[t]);i({...h,[t]:d||""})}},k=()=>{const t={};let c=!1;s.fields.forEach(d=>{const C=v(d,a[d.id]);C&&(t[d.id]=C,c=!0)}),i(t),M(new Set(s.fields.map(d=>d.id))),c||N(a)},f=t=>{const C=`w-full px-4 py-3 border rounded-lg text-slate-900 placeholder-slate-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ${h[t.id]&&b.has(t.id)?"border-red-500 bg-red-50":"border-slate-200 bg-white"}`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:a[t.id]||"",onChange:m=>p(t.id,m.target.value),onBlur:()=>o(t.id),placeholder:t.placeholder,className:C});case"textarea":return e.jsx("textarea",{value:a[t.id]||"",onChange:m=>p(t.id,m.target.value),onBlur:()=>o(t.id),placeholder:t.placeholder,rows:4,className:`${C} resize-none`});case"select":return e.jsxs("select",{value:a[t.id]||"",onChange:m=>p(t.id,m.target.value),onBlur:()=>o(t.id),className:C,children:[e.jsx("option",{value:"",children:t.placeholder||"Select an option..."}),t.options?.map(m=>e.jsx("option",{value:m,children:m},m))]});case"checkbox":return e.jsx("div",{className:"space-y-2",children:t.options?.map(m=>{const w=a[t.id]||[],I=w.includes(m);return e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg cursor-pointer hover:bg-slate-100 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:()=>{const T=I?w.filter(l=>l!==m):[...w,m];p(t.id,T)},className:"w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-700",children:m})]},m)})});case"radio":return e.jsx("div",{className:"space-y-2",children:t.options?.map(m=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg cursor-pointer hover:bg-slate-100 transition-colors",children:[e.jsx("input",{type:"radio",name:t.id,checked:a[t.id]===m,onChange:()=>p(t.id,m),className:"w-5 h-5 border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-700",children:m})]},m))});default:return null}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-teal-100 flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:s.fields.map(t=>{const c=h[t.id],d=c&&b.has(t.id);return e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:e.jsxs("span",{className:"text-sm font-medium text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),f(t),d&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-red-600",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:c})]})]},t.id)})})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("button",{onClick:k,className:"w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:[s.submitLabel||"Submit",e.jsx(Z,{className:"w-5 h-5"})]})})]})}function Rs({content:s,weakTopics:N,wrongQuestions:r,onComplete:a}){const{enabled:x,helpModel:h,isLoading:i}=Qe(),[b,M]=n.useState([]),[v,p]=n.useState(""),[o,k]=n.useState(!1),[f,t]=n.useState(!1),[c,d]=n.useState("gpt-4o-mini"),C=n.useRef(null),m=n.useRef(null),w=s.maxTurns??5,I=2,T=b.filter(g=>g.role==="user").length;n.useEffect(()=>{T>=I&&t(!0)},[T]),n.useEffect(()=>{C.current?.scrollIntoView({behavior:"smooth"})},[b]),n.useEffect(()=>{i||l()},[i]),n.useEffect(()=>{!i&&h&&d(h)},[i,h]);const l=async()=>{k(!0);let g="";s.mode==="targeted_remediation"&&r&&r.length>0?(g=`I noticed you had trouble with some questions. Let me help explain the concepts:

`,r.slice(0,3).forEach((u,E)=>{g+=`**Question ${E+1}:** ${u.prompt}
`,g+=`Your answer: ${u.userAnswer}
`,g+=`Correct answer: ${u.correctAnswer}
`,u.explanation&&(g+=`${u.explanation}
`),g+=`
`}),N&&N.length>0&&(g+=`
The main topics we should review: **${N.join(", ")}**

`),g+="Would you like me to explain any of these concepts in more detail? Feel free to ask questions!"):s.mode==="guided_explanation"?g="I'm here to help guide you through this material. What would you like me to explain? You can ask about specific concepts or request examples.":g="Hi! I'm your AI learning assistant. I'm here to help you understand the material better. What questions do you have?",M([{role:"assistant",content:g}]),k(!1)},S=async()=>{if(!v.trim()||o||T>=w)return;const g={role:"user",content:v.trim()};M(j=>[...j,g]),p(""),k(!0);try{const j=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/ai-help",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({messages:[...b,g],mode:s.mode,weakTopics:N,wrongQuestions:r,model:c})});if(!j.ok)throw new Error("Failed to get AI response");const E={role:"assistant",content:(await j.json()).response};M(z=>[...z,E])}catch{const u={role:"assistant",content:"I apologize, but I'm having trouble connecting right now. Let me provide a brief explanation based on what we've discussed. Please try asking again or continue when ready."};M(E=>[...E,u])}finally{k(!1)}},_=g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),S())},R=()=>{a({conversationHistory:b})};return i?e.jsxs("div",{className:"flex flex-col h-full bg-slate-900 items-center justify-center",children:[e.jsx(X,{className:"w-10 h-10 text-blue-500 animate-spin"}),e.jsx("p",{className:"text-slate-400 mt-4",children:"Loading AI assistant..."})]}):x?e.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[e.jsx("div",{className:"border-b border-slate-700 px-6 py-4 bg-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:s.title}),e.jsx("p",{className:"text-sm text-slate-400",children:s.mode==="targeted_remediation"?"Personalized help based on your quiz results":s.mode==="guided_explanation"?"Interactive guided learning":"Ask me anything about the material"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[b.map((g,j)=>e.jsxs("div",{className:`flex gap-4 ${g.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex-shrink-0 flex items-center justify-center ${g.role==="assistant"?"bg-gradient-to-br from-blue-500 to-cyan-400":"bg-slate-600"}`,children:g.role==="assistant"?e.jsx(ge,{className:"w-5 h-5 text-white"}):e.jsx(hs,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:`flex-1 max-w-[80%] rounded-2xl px-5 py-4 ${g.role==="assistant"?"bg-slate-800 text-slate-100":"bg-blue-600 text-white"}`,children:e.jsx("div",{className:"text-sm max-w-none",children:g.content.split(`
`).map((u,E)=>{if(u.startsWith("**")&&u.endsWith("**"))return e.jsx("p",{className:"font-semibold text-white mb-2",children:u.slice(2,-2)},E);if(u.includes("**")){const z=u.split(/\*\*(.+?)\*\*/g);return e.jsx("p",{className:"mb-2",children:z.map((H,V)=>V%2===1?e.jsx("strong",{className:"text-white",children:H},V):H)},E)}return u?e.jsx("p",{className:"mb-2",children:u},E):e.jsx("br",{},E)})})})]},j)),o&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"bg-slate-800 rounded-2xl px-5 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-slate-400 animate-spin"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"Thinking..."})]})})]}),e.jsx("div",{ref:C})]})}),e.jsx("div",{className:"border-t border-slate-700 px-6 py-4 bg-slate-800",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[T<w?e.jsx("div",{className:"flex gap-3 mb-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:m,value:v,onChange:g=>p(g.target.value),onKeyDown:_,placeholder:T===0?"Ask a question about the concepts...":"Continue the conversation...",rows:1,className:"w-full px-4 py-3 pr-12 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o}),e.jsx("button",{onClick:S,disabled:!v.trim()||o,className:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-lg bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx($e,{className:"w-4 h-4 text-white"})})]})}):e.jsx("div",{className:"text-center py-2 mb-4",children:e.jsx("p",{className:"text-slate-400 text-sm",children:"You've reached the conversation limit. Click continue to proceed."})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:[T," / ",w," messages",!f&&e.jsxs("span",{className:"ml-2 text-amber-400",children:["(ask at least ",I-T," more to continue)"]})]}),e.jsxs("button",{onClick:R,disabled:!f,className:`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all ${f?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-700 text-slate-400 cursor-not-allowed"}`,children:["Continue",e.jsx(Z,{className:"w-5 h-5"})]})]})]})})]}):e.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[e.jsx("div",{className:"border-b border-slate-700 px-6 py-4 bg-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:s.title}),e.jsx("p",{className:"text-sm text-slate-400",children:"AI-powered learning assistance"})]})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-500/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(Me,{className:"w-8 h-8 text-amber-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"AI Assistant Unavailable"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"The AI help feature is currently disabled. You can continue with the course by clicking the button below."}),e.jsxs("button",{onClick:()=>a({conversationHistory:[]}),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors mx-auto",children:["Continue",e.jsx(Z,{className:"w-5 h-5"})]})]})})]})}function As({content:s,facts:N,onComplete:r,allowRetry:a=!0}){const[x,h]=n.useState(null),[i,b]=n.useState(!0);n.useEffect(()=>{M()},[]);const M=()=>{b(!0),setTimeout(()=>{const o=N["quiz.scorePercent"],k=N["block.attemptsCount"],f=N["quiz.weakTopics"];let t=!0,c="Great progress! You can continue to the next section.";o!==void 0&&(o>=70?(t=!0,c=`Excellent work! You scored ${o}% and demonstrated strong understanding.`):o>=50?(t=!0,c=`Good job! You scored ${o}%. You can continue, but consider reviewing the material.`):(t=!1,c=`You scored ${o}%. Let's review the concepts you found challenging.`)),!t&&k&&k>=3&&(c=`After ${k} attempts, let's take a different approach and get some personalized help.`),!t&&f&&f.length>0&&(c+=` We'll focus on: ${f.join(", ")}.`),h({passed:t,score:o,message:c}),b(!1)},1500)},v=()=>{x&&r(x.passed)},p=()=>{r(!1)};return i?e.jsx("div",{className:"flex flex-col h-full bg-white items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-blue-100 flex items-center justify-center animate-pulse",children:e.jsx(Ke,{className:"w-10 h-10 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Evaluating Progress"}),e.jsx("p",{className:"text-slate-500",children:"Checking your understanding..."}),e.jsxs("div",{className:"mt-8 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 animate-bounce",style:{animationDelay:"300ms"}})]})]})}):x?e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsx("div",{className:`w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center ${x.passed?"bg-emerald-100":"bg-amber-100"}`,children:x.passed?e.jsx(Q,{className:"w-12 h-12 text-emerald-600"}):e.jsx(Me,{className:"w-12 h-12 text-amber-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-slate-500 mb-4",children:s.description}),e.jsxs("div",{className:`p-6 rounded-xl mb-6 ${x.passed?"bg-emerald-50 border border-emerald-200":"bg-amber-50 border border-amber-200"}`,children:[x.score!==void 0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:`text-4xl font-bold ${x.passed?"text-emerald-700":"text-amber-700"}`,children:[x.score,"%"]}),e.jsx("div",{className:"text-sm text-slate-500 mt-1",children:"Your Score"})]}),e.jsx("p",{className:`${x.passed?"text-emerald-800":"text-amber-800"}`,children:x.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:v,className:`w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${x.passed?"bg-blue-600 text-white hover:bg-blue-700":"bg-amber-500 text-white hover:bg-amber-600"}`,children:[x.passed?"Continue":"Get Help",e.jsx(Je,{className:"w-5 h-5"})]}),!x.passed&&a&&e.jsxs("button",{onClick:p,className:"w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium bg-slate-100 text-slate-700 hover:bg-slate-200 transition-colors",children:[e.jsx(K,{className:"w-5 h-5"}),"Try Again"]})]})]})})}):null}function zs({content:s,onComplete:N,isCompleted:r}){const[a,x]=n.useState(s.autoplay??!0),[h,i]=n.useState(!1),[b,M]=n.useState(0);n.useEffect(()=>{if(a){const k=setInterval(()=>{M(f=>f>=100?(s.loop||(x(!1),i(!0)),s.loop?0:100):f+1)},50);return()=>clearInterval(k)}},[a,s.loop]);const v=()=>{x(!a)},p=()=>{M(0),x(!0)},o=()=>{switch(s.animationType){case"lottie":return e.jsx("div",{className:"relative w-full h-full flex items-center justify-center bg-slate-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-48 h-48 mx-auto mb-4 bg-gradient-to-br from-blue-400 to-cyan-400 rounded-3xl flex items-center justify-center animate-pulse",children:e.jsx(je,{className:"w-20 h-20 text-white"})}),e.jsxs("p",{className:"text-slate-500 text-sm",children:["Lottie animation: ",s.url]})]})});case"video":return e.jsx("video",{className:"w-full h-full object-contain bg-black",src:s.url,autoPlay:s.autoplay,loop:s.loop,muted:!0,playsInline:!0,onEnded:()=>i(!0)});case"interactive":return e.jsx("div",{className:"relative w-full h-full flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-800",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full border-4 border-blue-400 flex items-center justify-center",style:{background:`conic-gradient(from 0deg, #3b82f6 ${b*3.6}deg, transparent ${b*3.6}deg)`},children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-800 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold",children:[Math.round(b),"%"]})})}),e.jsx("p",{className:"text-slate-300",children:"Interactive animation"})]})});default:return null}};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[e.jsx("div",{className:"border-b border-slate-700 px-6 py-4 bg-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 text-cyan-400"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:s.title})]})}),e.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[o(),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:!a&&b===0&&s.animationType!=="video"&&e.jsx("button",{onClick:v,className:"w-20 h-20 rounded-full bg-white/90 flex items-center justify-center shadow-xl pointer-events-auto hover:bg-white transition-colors",children:e.jsx(se,{className:"w-10 h-10 text-slate-900 ml-1"})})})]}),e.jsxs("div",{className:"bg-slate-800 border-t border-slate-700",children:[s.animationType!=="video"&&e.jsxs("div",{className:"px-6 py-3 border-b border-slate-700",children:[e.jsx("div",{className:"h-1.5 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 transition-all duration-100",style:{width:`${b}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-3",children:[e.jsx("button",{onClick:v,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:a?e.jsx(Ie,{className:"w-5 h-5 text-white"}):e.jsx(se,{className:"w-5 h-5 text-white ml-0.5"})}),e.jsx("button",{onClick:p,className:"w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors",children:e.jsx(K,{className:"w-5 h-5 text-white"})})]})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("button",{onClick:N,disabled:!h&&!r&&s.animationType!=="interactive",className:`w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${h||r||s.animationType==="interactive"?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-700 text-slate-400 cursor-not-allowed"}`,children:[r?"Continue":"Mark as Complete",e.jsx(Z,{className:"w-5 h-5"})]})})]})]})}const qs={javascript:"bg-yellow-500",typescript:"bg-blue-500",python:"bg-green-500",java:"bg-orange-500",csharp:"bg-purple-500",cpp:"bg-pink-500",c:"bg-gray-500",ruby:"bg-red-500",go:"bg-cyan-500",rust:"bg-orange-600",php:"bg-indigo-500",swift:"bg-orange-400",kotlin:"bg-purple-400",sql:"bg-blue-400",html:"bg-orange-500",css:"bg-blue-500",json:"bg-gray-400",bash:"bg-green-600",shell:"bg-green-600",markdown:"bg-slate-500"};function Os({content:s,onComplete:N,isCompleted:r}){const[a,x]=n.useState(!1),h=s.showLineNumbers??!0,i=async()=>{try{await navigator.clipboard.writeText(s.code),x(!0),setTimeout(()=>x(!1),2e3)}catch(p){console.error("Failed to copy:",p)}},b=s.code.split(`
`),M=new Set(s.highlightLines||[]),v=qs[s.language.toLowerCase()]||"bg-slate-500";return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center",children:e.jsx(es,{className:"w-5 h-5 text-slate-200"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 ${v} text-white text-xs font-medium rounded`,children:s.language}),s.description&&e.jsx("span",{className:"text-sm text-slate-500",children:s.description})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"relative rounded-xl overflow-hidden bg-slate-900 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-slate-800 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"})]}),e.jsx("span",{className:"text-xs text-slate-400 ml-2",children:s.language})]}),e.jsx("button",{onClick:i,className:"flex items-center gap-1.5 px-2 py-1 text-xs text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-3.5 h-3.5 text-green-400"}),e.jsx("span",{className:"text-green-400",children:"Copied!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Copy"})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm",children:e.jsx("code",{children:b.map((p,o)=>{const k=o+1,f=M.has(k);return e.jsxs("div",{className:`flex ${f?"bg-yellow-500/10 -mx-4 px-4":""}`,children:[h&&e.jsx("span",{className:"select-none text-slate-500 text-right pr-4 min-w-[3rem]",children:k}),e.jsx("span",{className:`flex-1 ${f?"text-yellow-200":"text-slate-100"}`,children:p||" "})]},o)})})})})]}),s.description&&e.jsx("div",{className:"mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:e.jsx("p",{className:"text-slate-700 text-sm",children:s.description})})]})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4",children:e.jsx("div",{className:"max-w-4xl mx-auto flex justify-end",children:e.jsxs("button",{onClick:N,disabled:r,className:`flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all ${r?"bg-emerald-100 text-emerald-700 cursor-default":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[r?"Completed":"Continue",e.jsx(Z,{className:"w-5 h-5"})]})})})]})}function Fs({content:s,onComplete:N,previousOutput:r}){const[a,x]=n.useState(r?.userSolution||""),[h,i]=n.useState(r?.solutionViewed||!1),[b,M]=n.useState(r?.hintsViewed||0),[v,p]=n.useState(!1),o=s.hints||[],k=()=>{b<o.length&&(M(b+1),p(!0))},f=()=>{i(!h)},t=()=>{N({userSolution:a,hintsViewed:b,solutionViewed:h})},c=a.trim().length>0||h;return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-violet-100 flex items-center justify-center",children:e.jsx(ts,{className:"w-5 h-5 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-purple-50 border border-violet-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"font-semibold text-violet-900 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-violet-200 flex items-center justify-center text-xs font-bold text-violet-700",children:"?"}),"Problem"]}),e.jsx("div",{className:"text-violet-800 whitespace-pre-wrap",children:s.problem})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Your Solution"}),e.jsx("textarea",{value:a,onChange:d=>x(d.target.value),rows:8,placeholder:"Write your solution here...",className:"w-full px-4 py-3 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-transparent resize-none font-mono text-sm"})]}),o.length>0&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-amber-600"}),e.jsxs("span",{className:"font-medium text-amber-900",children:["Hints (",b," / ",o.length,")"]})]}),b<o.length&&e.jsx("button",{onClick:k,className:"px-3 py-1.5 text-sm bg-amber-200 text-amber-800 rounded-lg hover:bg-amber-300 transition-colors font-medium",children:"Show Hint"})]}),v&&b>0&&e.jsx("div",{className:"space-y-2",children:o.slice(0,b).map((d,C)=>e.jsxs("div",{className:"flex gap-3 p-3 bg-white/50 rounded-lg",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-amber-200 flex-shrink-0 flex items-center justify-center text-xs font-bold text-amber-700",children:C+1}),e.jsx("p",{className:"text-amber-800 text-sm",children:d})]},C))}),b>0&&e.jsx("button",{onClick:()=>p(!v),className:"mt-2 text-sm text-amber-700 hover:text-amber-900",children:v?"Hide hints":"Show hints"})]}),e.jsxs("div",{className:"border border-slate-200 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:f,className:"w-full flex items-center justify-between p-4 bg-slate-50 hover:bg-slate-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-emerald-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Solution"})]}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:h?e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"w-4 h-4"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4"}),"Show"]})})]}),h&&e.jsxs("div",{className:"p-4 border-t border-slate-200",children:[e.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 mb-4",children:e.jsx("pre",{className:"whitespace-pre-wrap text-emerald-800 font-mono text-sm",children:s.solution})}),s.solutionExplanation&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-slate-900 mb-2",children:"Explanation"}),e.jsx("p",{className:"text-slate-700 text-sm whitespace-pre-wrap",children:s.solutionExplanation})]})]})]})]})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("div",{className:"flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:"text-sm text-slate-500",children:a.trim()?"Solution written":h?"Solution viewed":"Write your solution or view the answer"}),e.jsxs("button",{onClick:t,disabled:!c,className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${c?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-200 text-slate-400 cursor-not-allowed"}`,children:["Continue",e.jsx(Z,{className:"w-5 h-5"})]})]})})]})}const Hs={link:ls,download:rs,video:de,document:Te},Ne={link:{bg:"bg-blue-100",icon:"text-blue-600",hover:"hover:bg-blue-50"},download:{bg:"bg-emerald-100",icon:"text-emerald-600",hover:"hover:bg-emerald-50"},video:{bg:"bg-rose-100",icon:"text-rose-600",hover:"hover:bg-rose-50"},document:{bg:"bg-amber-100",icon:"text-amber-600",hover:"hover:bg-amber-50"}};function Vs({content:s,onComplete:N,previousOutput:r}){const[a,x]=n.useState(new Set(r?.viewedResources||[])),h=p=>{if(x(o=>new Set([...o,p.id])),p.type==="download"){const o=document.createElement("a");o.href=p.url,o.download=p.title,o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else window.open(p.url,"_blank","noopener,noreferrer")},i=()=>{N({viewedResources:Array.from(a)})},b=a.size,M=s.resources.length,v=M>0?b/M*100:0;return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-indigo-100 flex items-center justify-center",children:e.jsx(as,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${v}%`}})}),e.jsxs("span",{className:"text-sm text-slate-500",children:[b," / ",M," viewed"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:s.resources.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(we,{className:"w-12 h-12 text-slate-300 mb-4"}),e.jsx("p",{className:"text-slate-500",children:"No resources available"})]}):e.jsx("div",{className:"space-y-3",children:s.resources.map(p=>{const o=Hs[p.type]||we,k=Ne[p.type]||Ne.link,f=a.has(p.id);return e.jsxs("button",{onClick:()=>h(p),className:`w-full flex items-center gap-4 p-4 rounded-xl border transition-all text-left group ${f?"border-emerald-200 bg-emerald-50/50":`border-slate-200 ${k.hover}`}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 ${f?"bg-emerald-100":k.bg}`,children:f?e.jsx(Q,{className:"w-6 h-6 text-emerald-600"}):e.jsx(o,{className:`w-6 h-6 ${k.icon}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-slate-900 truncate",children:p.title}),p.type==="download"&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-slate-100 text-slate-600 rounded",children:"Download"})]}),p.description&&e.jsx("p",{className:"text-sm text-slate-500 mt-1 line-clamp-2",children:p.description}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-slate-400",children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:p.url})]})]}),e.jsx(me,{className:`w-5 h-5 flex-shrink-0 transition-transform group-hover:translate-x-0.5 group-hover:-translate-y-0.5 ${f?"text-emerald-500":"text-slate-400"}`})]},p.id)})})})}),e.jsx("div",{className:"border-t border-slate-200 px-6 py-4 bg-slate-50",children:e.jsxs("div",{className:"flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:"text-sm text-slate-500",children:b===M?"All resources viewed!":`${M-b} resource${M-b!==1?"s":""} remaining`}),e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-6 py-3 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:["Continue",e.jsx(Z,{className:"w-5 h-5"})]})]})})]})}function Zs({journeyVersionId:s,userId:N,graph:r,onComplete:a,onExit:x,trackDirection:h,trackLanguage:i,trackIdProp:b,currentModuleIdProp:M}){const{t:v}=ee(),{showToast:p}=Ge(),[o,k]=n.useState(null),[f,t]=n.useState(null),[c,d]=n.useState(null),[C,m]=n.useState(!0),[w,I]=n.useState(null),[T,l]=n.useState(new Map),[S,_]=n.useState({}),[R,g]=n.useState(!1),[j,u]=n.useState(null),[E,z]=n.useState(null),[H,V]=n.useState(h||"ltr"),[U,Y]=n.useState(i||"en"),[ae,Re]=n.useState(b),[re,Ae]=n.useState(M),xe=n.useRef(Date.now());n.useEffect(()=>{he(),ze()},[]);const ze=async()=>{try{const{data:y}=await F.from("journey_versions").select("module_id").eq("id",s).single();if(!y)return;Ae(y.module_id);const{data:L}=await F.from("modules").select("track_id").eq("id",y.module_id).single();if(!L||(Re(L.track_id),h))return;const{data:$}=await F.from("tracks").select("direction, primary_language").eq("id",L.track_id).single();$&&(V($.direction||"ltr"),Y($.primary_language||"en"))}catch(y){console.error("Error loading track settings:",y)}},he=async()=>{m(!0),I(null);try{const{data:y,error:L}=await F.from("user_journey_runs").select("*").eq("user_id",N).eq("journey_version_id",s).neq("status","completed").neq("status","abandoned").maybeSingle();if(L)throw console.error("Failed to fetch existing run:",L),new Error(v("journey.error.failed"));let $=y;if(!$){const{data:D,error:P}=await F.from("user_journey_runs").insert({user_id:N,journey_version_id:s,current_block_id:r.startBlockId,status:"in_progress",started_at:new Date().toISOString()}).select().single();if(P)throw console.error("Failed to create journey run:",P),new Error(v("journey.error.failed"));$=D}k($);const{data:A,error:O}=await F.from("user_block_states").select("*").eq("run_id",$.id);if(O&&console.error("Failed to load block states:",O),A){const D=new Map;A.forEach(P=>{D.set(P.block_id,P)}),l(D)}const G=$.current_block_id||r.startBlockId;await le(G,$.id)}catch(y){console.error("Journey initialization error:",y);const L=y instanceof Error?y.message:"Failed to initialize journey";I(L),p("error",L)}finally{m(!1)}},le=async(y,L)=>{const $=r.blocks.find(O=>O.id===y);if(!$){console.error("Block not found:",y);return}t($),xe.current=Date.now(),await F.from("user_journey_runs").update({current_block_id:y}).eq("id",L);let A=T.get(y);if(!A){const{data:O,error:G}=await F.from("user_block_states").select("*").eq("run_id",L).eq("block_id",y).maybeSingle();if(G&&console.error("Error fetching block state:",G),O)A=O,l(D=>new Map(D).set(y,O));else{const{data:D,error:P}=await F.from("user_block_states").insert({run_id:L,block_id:y,status:"in_progress",started_at:new Date().toISOString()}).select().single();!P&&D&&(A=D,l(ne=>new Map(ne).set(y,D)))}}if(A&&A.status==="not_started"){const{data:O}=await F.from("user_block_states").update({status:"in_progress",started_at:new Date().toISOString()}).eq("id",A.id).select().single();O&&(A=O,l(G=>new Map(G).set(y,O)))}d(A||null)},B=n.useCallback(async(y,L,$)=>{if(!f||!o||!c)return;const A=Math.floor((Date.now()-xe.current)/1e3),{data:O}=await F.from("user_block_states").update({status:"completed",output_json:y||{},score:L??null,weak_topics:$||[],time_spent_seconds:(c.time_spent_seconds||0)+A,completed_at:new Date().toISOString(),attempts_count:(c.attempts_count||0)+1}).eq("id",c.id).select().single();O&&l(P=>new Map(P).set(f.id,O));const G=ve({score:L,weak_topics:$,attempts_count:(c.attempts_count||0)+1,time_spent_seconds:(c.time_spent_seconds||0)+A,status:"completed",output_json:y},f.type==="quiz"?f.content:void 0),D=ws(f.id,r.edges,G);if(D)await le(D,o.id);else{await F.from("user_journey_runs").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",o.id);const P=Array.from(T.values());O&&P.push(O);const ne=P.reduce((J,oe)=>J+(oe.time_spent_seconds||0),0),ie=P.filter(J=>J.score!==null).map(J=>J.score),Ze=ie.length>0?ie.reduce((J,oe)=>J+oe,0)/ie.length:0;u({totalTime:ne,blocksCompleted:P.filter(J=>J.status==="completed").length,averageScore:Math.round(Ze)});const De=await Fe();z(De),g(!0)}},[f,o,c,r.edges,T]),qe=n.useCallback(async y=>{if(!f)return;const L=f.content;if(y.passed)_({});else{const $=L.questions.filter(A=>y.answers[A.id]!==A.correctIndex).map(A=>({prompt:A.prompt,userAnswer:A.choices[y.answers[A.id]]||"No answer",correctAnswer:A.choices[A.correctIndex],explanation:A.explanation}));_({wrongQuestions:$,weakTopics:y.weakTopics})}await B({answers:y.answers,passed:y.passed},y.score,y.weakTopics)},[f,B]),Oe=n.useCallback(async y=>{await B({passed:y},y?100:0)},[B]),Fe=async()=>{if(!ae||!re)return null;try{const{data:y}=await F.from("modules").select("order_index").eq("id",re).single();if(!y)return null;const{data:L}=await F.from("modules").select("id, title, journey_versions(id, status)").eq("track_id",ae).eq("order_index",y.order_index+1).maybeSingle();if(!L)return null;const $=L.journey_versions?.find(A=>A.status==="published");return $?{versionId:$.id,moduleTitle:L.title}:null}catch(y){return console.error("Error checking for next module:",y),null}},He=async()=>{if(o)try{const{error:y}=await F.from("user_block_states").delete().eq("run_id",o.id);if(y)throw console.error("Failed to clear block states:",y),new Error("Failed to reset progress");const{error:L}=await F.from("user_journey_runs").update({status:"in_progress",current_block_id:r.startBlockId,completed_at:null}).eq("id",o.id);if(L)throw console.error("Failed to reset journey run:",L),new Error("Failed to restart journey");l(new Map),g(!1),u(null),p("success",v("journey.completion.restart")),await le(r.startBlockId,o.id)}catch(y){console.error("Restart journey error:",y),p("error",v("journey.error.failed"))}},Ve=y=>{const L=Math.floor(y/60),$=y%60;return L>0?`${L}m ${$}s`:`${$}s`},Be=()=>{if(!f||!c)return null;const y=c.status==="completed";switch(f.type){case"read":return e.jsx(Ms,{content:f.content,onComplete:()=>B(),isCompleted:y,trackId:ae,moduleId:re});case"video":return e.jsx(_s,{content:f.content,onComplete:()=>B(),isCompleted:y});case"image":return e.jsx(Is,{content:f.content,onComplete:()=>B(),isCompleted:y});case"quiz":return e.jsx(Ts,{content:f.content,onComplete:qe,previousAttempt:c.output_json?.answers?{score:c.score||0,correctCount:Math.round((c.score||0)/100*f.content.questions.length),totalCount:f.content.questions.length,answers:c.output_json.answers,weakTopics:c.weak_topics||[],passed:(c.score||0)>=(f.content.passingScore??50)}:void 0});case"mission":return e.jsx($s,{content:f.content,onComplete:$=>B($),previousOutput:c.output_json});case"form":return e.jsx(Ls,{content:f.content,onComplete:$=>B($),previousOutput:c.output_json});case"ai_help":return e.jsx(Rs,{content:f.content,weakTopics:S.weakTopics,wrongQuestions:S.wrongQuestions,onComplete:$=>B($)});case"checkpoint":const L=ve(c);return e.jsx(As,{content:f.content,facts:L,onComplete:Oe});case"animation":return e.jsx(zs,{content:f.content,onComplete:()=>B(),isCompleted:y});case"code":return e.jsx(Os,{content:f.content,onComplete:()=>B(),isCompleted:y});case"exercise":return e.jsx(Fs,{content:f.content,onComplete:$=>B($),previousOutput:c.output_json});case"resource":return e.jsx(Vs,{content:f.content,onComplete:$=>B($),previousOutput:c.output_json});default:return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("p",{className:"text-slate-500",children:["Unknown block type: ",f.type]})})}};if(C)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"w-12 h-12 text-primary-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:v("journey.loading")})]})});if(w)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-100",children:e.jsxs("div",{className:"text-center max-w-md px-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-error/20 rounded-full flex items-center justify-center",children:e.jsx(Ee,{className:"w-8 h-8 text-error"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-2",children:v("journey.error.title")}),e.jsx("p",{className:"text-slate-600 mb-6",children:w}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>he(),className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-primary-600 text-white rounded-xl font-semibold hover:bg-primary-700 transition-colors",children:[e.jsx(K,{className:"w-5 h-5"}),v("journey.error.tryAgain")]}),e.jsxs("button",{onClick:x,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-slate-200 text-slate-700 rounded-xl font-semibold hover:bg-slate-300 transition-colors",children:[e.jsx(ce,{className:"w-5 h-5"}),v("journey.error.backToDashboard")]})]})]})});if(R)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-600 via-blue-700 to-cyan-600 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-lg w-full p-8 text-center",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"w-24 h-24 mx-auto bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(xs,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center animate-bounce",children:e.jsx(te,{className:"w-4 h-4 text-white"})})]}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:v("journey.completion.title")}),e.jsx("p",{className:"text-slate-600 mb-8",children:v("journey.completion.congratulations")}),j&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-primary-600"})}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:j.blocksCompleted}),e.jsx("div",{className:"text-xs text-slate-500",children:v("journey.completion.stats.blocksCompleted")})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-warning/20 rounded-lg flex items-center justify-center",children:e.jsx(us,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:[j.averageScore,"%"]}),e.jsx("div",{className:"text-xs text-slate-500",children:v("journey.completion.stats.averageScore")})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-emerald-100 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-emerald-600"})}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:Ve(j.totalTime)}),e.jsx("div",{className:"text-xs text-slate-500",children:v("journey.completion.stats.timeSpent")})]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:E?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>a(E),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors",children:[e.jsx(te,{className:"w-5 h-5"}),"Continue to: ",E.moduleTitle]}),e.jsxs("button",{onClick:()=>a(),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-slate-100 text-slate-700 rounded-xl font-semibold hover:bg-slate-200 transition-colors",children:[e.jsx(ce,{className:"w-5 h-5"}),v("journey.completion.backToDashboard")]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>a(),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors",children:[e.jsx(ce,{className:"w-5 h-5"}),v("journey.completion.backToDashboard")]}),e.jsxs("button",{onClick:He,className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-slate-100 text-slate-700 rounded-xl font-semibold hover:bg-slate-200 transition-colors",children:[e.jsx(K,{className:"w-5 h-5"}),v("journey.completion.restart")]})]})})]})});const pe=Array.from(T.values()).filter(y=>y.status==="completed").length,Pe=pe/r.blocks.length*100,W=H==="rtl";return e.jsx(We,{direction:H,primaryLanguage:U,children:e.jsxs("div",{className:"flex flex-col h-screen bg-slate-100",children:[e.jsxs("header",{className:`bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between ${W?"flex-row-reverse":""}`,children:[e.jsxs("button",{onClick:x,className:`flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors ${W?"flex-row-reverse":""}`,children:[e.jsx(_e,{className:`w-5 h-5 ${W?"rotate-180":""}`}),e.jsx("span",{className:"font-medium",children:v("journey.exit")})]}),e.jsxs("div",{className:`flex items-center gap-4 ${W?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-48 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-primary-600 transition-all duration-300 ${W?"mr-auto":""}`,style:{width:`${Pe}%`,marginLeft:W?"auto":void 0,marginRight:W?"0":void 0}})}),e.jsxs("span",{className:"text-sm text-slate-500 font-medium",children:[pe," / ",r.blocks.length]})]})]}),e.jsx("main",{className:"flex-1 overflow-hidden",children:Be()})]})})}export{Zs as JourneyRunner};

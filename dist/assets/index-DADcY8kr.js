const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CYe1HlWo.js","assets/index-BQRv0S5j.css"])))=>i.map(i=>d[i]);
import{c as _,r as t,u as De,a as Re,j as e,C as ve,B as ie,S as W,b as Qe,L as Y,d as ge,e as We,s as Q,f as Xe,X as xe,I as he,V as me,g as Le,h as Se,P as Ke,i as ze,R as et,D as tt,k as Ie,A as Ae,U as Pe,F as be,l as Ge,m as ye,n as Oe,H as fe,T as Me,o as Fe,p as qe,q as Te,t as Ne,v as st,w as lt,x as at,y as rt,_ as we,z as nt,E as it}from"./index-CYe1HlWo.js";const ot=_("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);const ct=_("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);const dt=_("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);const Ve=_("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const ut=_("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);const ke=_("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const Ce=_("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const xt=_("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);const ht=_("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const Ue=_("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const mt=_("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);const pt=_("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);const gt=_("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);const _e=_("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const bt=_("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const ft=_("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const jt=_("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);const vt=_("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);const yt=_("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const Nt=_("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const wt=_("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const kt=_("MonitorPlay",[["path",{d:"m10 7 5 3-5 3Z",key:"29ljg6"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]);const Ct=_("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);const St=_("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);const It=_("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);const ue=_("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const At=_("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);const Mt=_("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);const Tt=_("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);const Je=_("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const _t=_("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);const Et=_("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);const He=_("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const re=_("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Bt=_("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);const $t=_("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);const Dt=_("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);const Rt=_("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const Lt=_("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);function zt({children:a,activeTab:s,onTabChange:i,onExit:l}){const[o,u]=t.useState(!1),n=De(),d=Re(),c=[{id:"dashboard",label:"Dashboard",icon:bt,path:"/admin"},{id:"tracks",label:"Tracks",icon:ie,path:"/admin/tracks"},{id:"builder",label:"Journey Builder",icon:_e,path:"/admin/builder"},{id:"ai-studio",label:"AI Studio",icon:W,path:"/admin/ai-studio"},{id:"settings",label:"Settings",icon:Qe,path:"/admin/settings"}],p=h=>{n(h.path),i(h.id)},C=(()=>{const h=d.pathname;return h.startsWith("/admin/builder")?"builder":h.startsWith("/admin/tracks")?"tracks":h.startsWith("/admin/ai-studio")?"ai-studio":h.startsWith("/admin/settings")?"settings":"dashboard"})();return e.jsxs("div",{className:"min-h-screen bg-slate-900 flex",children:[e.jsxs("aside",{className:`bg-slate-800 border-r border-slate-700 flex flex-col transition-all duration-300 ${o?"w-16":"w-64"}`,children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[!o&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"https://res.cloudinary.com/dujh5xuoi/image/upload/v1754423073/%D8%AA%D8%B9%D9%84%D9%91%D9%85_AIFinal_edvr4e.png",alt:"Platform logo",className:"max-h-8 w-auto object-contain"}),e.jsx("span",{className:"font-bold text-white",children:"Admin"})]}),e.jsx("button",{onClick:()=>u(!o),className:"p-1.5 rounded-lg hover:bg-slate-700 text-slate-400 transition-colors",children:e.jsx(ve,{className:`w-5 h-5 transition-transform ${o?"rotate-180":""}`})})]}),e.jsx("nav",{className:"flex-1 p-2 space-y-1",role:"navigation","aria-label":"Admin navigation",children:c.map(h=>{const j=h.icon,f=C===h.id||s===h.id;return e.jsxs("button",{onClick:()=>p(h),"aria-label":h.label,"aria-current":f?"page":void 0,className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors ${f?"bg-blue-600 text-white":"text-slate-400 hover:bg-slate-700 hover:text-white"}`,children:[e.jsx(j,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),!o&&e.jsx("span",{className:"font-medium",children:h.label})]},h.id)})}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-400 hover:bg-slate-700 hover:text-white transition-colors",children:[e.jsx(ve,{className:"w-5 h-5 flex-shrink-0"}),!o&&e.jsx("span",{className:"font-medium",children:"Back to App"})]})})]}),e.jsx("main",{className:"flex-1 overflow-hidden",children:a})]})}function Pt({selectedCount:a,totalCount:s,onSelectAll:i,onSelectNone:l,onDelete:o,isDeleting:u=!1,itemName:n="items"}){return a===0?null:e.jsxs("div",{className:"sticky top-0 z-10 bg-slate-800 border-b border-slate-700 px-4 py-3 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm font-medium text-white",children:[a," of ",s," ",n," selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a<s?e.jsxs("button",{onClick:i,disabled:u,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[e.jsx(ut,{className:"w-4 h-4"}),"Select All"]}):null,e.jsxs("button",{onClick:l,disabled:u,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[e.jsx(He,{className:"w-4 h-4"}),"Clear Selection"]})]})]}),e.jsx("button",{onClick:o,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4"}),"Delete Selected (",a,")"]})})]})}function Gt({isSelected:a,onToggleSelect:s,children:i,className:l="",disabled:o=!1}){return e.jsxs("div",{className:`relative group ${l} ${a?"ring-2 ring-blue-500":""} ${o?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:u=>{const n=u.target,d=n.closest("button"),c=n.closest("input, textarea, select");!d&&!c&&!o&&s()},children:[e.jsx("div",{className:`absolute top-3 left-3 z-10 w-6 h-6 rounded border-2 flex items-center justify-center transition-all ${a?"bg-blue-600 border-blue-600":"bg-slate-700 border-slate-600 group-hover:border-slate-500"}`,onClick:u=>{u.stopPropagation(),o||s()},children:a&&e.jsx(ge,{className:"w-4 h-4 text-white"})}),i]})}const Ze=["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3184325/pexels-photo-3184325.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181676/pexels-photo-1181676.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/4050315/pexels-photo-4050315.jpeg?auto=compress&cs=tinysrgb&w=800"];function Ot({onEditJourney:a}){const{showToast:s}=We(),[i,l]=t.useState([]),[o,u]=t.useState(!0),[n,d]=t.useState(""),[c,p]=t.useState(!1),[b,C]=t.useState(null),[h,j]=t.useState(null),[f,y]=t.useState(null),[m,I]=t.useState(null),[A,T]=t.useState(!1),[S,V]=t.useState(!1),[D,B]=t.useState(!1),[q,z]=t.useState(new Set),[w,k]=t.useState(new Set),[L,E]=t.useState(!1);t.useEffect(()=>{R()},[]);const R=async()=>{u(!0);const{data:x}=await Q.from("tracks").select(`
        *,
        modules (
          *,
          journey_versions (id, status, version)
        )
      `).order("created_at",{ascending:!1});x&&l(x),u(!1)},se=async x=>{T(!0);try{const{error:g}=await Q.from("tracks").insert({title:x.title,description:x.description,level:x.level,cover_image_url:x.cover_image_url||null,tags:JSON.stringify([])});if(g)throw g;s("success","Track created successfully"),await R(),p(!1)}catch(g){console.error("Error creating track:",g),s("error","Failed to create track. Please try again.")}finally{T(!1)}},K=async(x,g)=>{V(!0);try{const r=i.find(ae=>ae.id===x)?.modules?.length||0,{data:N,error:M}=await Q.from("modules").insert({track_id:x,title:g.title,description:g.description,order_index:r}).select().single();if(M)throw M;if(!N)throw new Error("Module creation failed");const{data:$,error:P}=await Q.from("journey_versions").insert({module_id:N.id,version:1,status:"draft",graph_json:{startBlockId:"",blocks:[],edges:[]}}).select().single();P?(console.error("Error creating journey version:",P),s("warning","Module created but journey setup failed. Please try editing the module.")):s("success","Module created successfully"),await R(),C(null),$&&a(N.id,$.id)}catch(H){console.error("Error creating module:",H),s("error","Failed to create module. Please try again.")}finally{V(!1)}},O=async x=>{if(confirm("Are you sure you want to delete this track and all its modules?")){y(x);try{const{error:g}=await Q.from("tracks").delete().eq("id",x);if(g)throw g;s("success","Track deleted successfully"),await R()}catch(g){console.error("Error deleting track:",g),s("error","Failed to delete track. Please try again.")}finally{y(null)}}},G=async x=>{if(confirm("Are you sure you want to delete this module?")){I(x);try{const{error:g}=await Q.from("modules").delete().eq("id",x);if(g)throw g;s("success","Module deleted successfully"),await R()}catch(g){console.error("Error deleting module:",g),s("error","Failed to delete module. Please try again.")}finally{I(null)}}},F=async()=>{const x=q.size,g=i.filter(r=>q.has(r.id)).slice(0,5).map(r=>r.title).join(", "),H=x<=5?`Delete ${x} track${x>1?"s":""} (${g})?`:`Delete ${x} tracks (${g}, and ${x-5} more)?`;if(confirm(`${H}

This will also delete all associated modules and content. This action cannot be undone.`)){E(!0);try{const{error:r}=await Q.from("tracks").delete().in("id",Array.from(q));if(r)throw r;s("success",`Successfully deleted ${x} track${x>1?"s":""}`),z(new Set),await R()}catch(r){console.error("Error bulk deleting tracks:",r),s("error","Failed to delete some tracks. Please try again.")}finally{E(!1)}}},U=async()=>{const x=w.size,g=i.flatMap(r=>r.modules||[]).filter(r=>w.has(r.id)).slice(0,5).map(r=>r.title).join(", "),H=x<=5?`Delete ${x} module${x>1?"s":""} (${g})?`:`Delete ${x} modules (${g}, and ${x-5} more)?`;if(confirm(`${H}

This will also delete all associated journeys and content. This action cannot be undone.`)){E(!0);try{const{error:r}=await Q.from("modules").delete().in("id",Array.from(w));if(r)throw r;s("success",`Successfully deleted ${x} module${x>1?"s":""}`),k(new Set),await R()}catch(r){console.error("Error bulk deleting modules:",r),s("error","Failed to delete some modules. Please try again.")}finally{E(!1)}}},le=x=>{const g=new Set(q);g.has(x)?g.delete(x):g.add(x),z(g)},J=x=>{const g=new Set(w);g.has(x)?g.delete(x):g.add(x),k(g)},X=()=>{z(new Set(ee.map(x=>x.id)))},oe=x=>{const g=i.find(r=>r.id===x);if(!g)return;const H=(g.modules||[]).map(r=>r.id);k(new Set([...w,...H]))},de=()=>{z(new Set)},ee=i.filter(x=>x.title.toLowerCase().includes(n.toLowerCase()));return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Track Manager"}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ue,{className:"w-5 h-5"}),"New Track"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Je,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500"}),e.jsx("input",{type:"text",placeholder:"Search tracks...",value:n,onChange:x=>d(x.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Y,{className:"w-8 h-8 text-blue-500 animate-spin"})}):ee.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"No tracks yet"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"Create your first learning track to get started"}),e.jsxs("button",{onClick:()=>p(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(ue,{className:"w-5 h-5"}),"Create Track"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{selectedCount:q.size,totalCount:ee.length,onSelectAll:X,onSelectNone:de,onDelete:F,isDeleting:L,itemName:"tracks"}),e.jsx("div",{className:"p-6 space-y-4",children:ee.map(x=>e.jsxs(Gt,{isSelected:q.has(x.id),onToggleSelect:()=>le(x.id),disabled:L,className:"bg-slate-800 border border-slate-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 pl-8",children:[x.cover_image_url?e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:x.cover_image_url,alt:x.title,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center flex-shrink-0",children:e.jsx(ie,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:x.title}),e.jsx("p",{className:"text-sm text-slate-400",children:x.description||"No description"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${x.level==="beginner"?"bg-emerald-500/20 text-emerald-400":x.level==="intermediate"?"bg-amber-500/20 text-amber-400":"bg-rose-500/20 text-rose-400"}`,children:x.level}),e.jsxs("span",{className:"text-xs text-slate-500",children:[x.modules?.length||0," modules"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),j(x)},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",disabled:f===x.id||L,children:e.jsx(St,{className:"w-5 h-5"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),O(x.id)},disabled:f===x.id||L,className:"p-2 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:f===x.id?e.jsx(Y,{className:"w-5 h-5 animate-spin"}):e.jsx(re,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"border-t border-slate-700",children:[w.size>0&&(x.modules||[]).some(g=>w.has(g.id))&&e.jsxs("div",{className:"bg-slate-900/50 px-4 py-2 border-b border-slate-700 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-slate-400",children:[(x.modules||[]).filter(g=>w.has(g.id)).length," module",(x.modules||[]).filter(g=>w.has(g.id)).length>1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),oe(x.id)},className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Select All"}),e.jsx("button",{onClick:g=>{g.stopPropagation(),U()},disabled:L,className:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 transition-colors",children:"Delete Selected"})]})]}),x.modules?.map(g=>{const H=g.journey_versions?.find(M=>M.status==="published"),r=g.journey_versions?.find(M=>M.status==="draft"),N=H||r;return e.jsxs("div",{className:`px-4 py-3 flex items-center justify-between hover:bg-slate-700/50 transition-colors border-b border-slate-700 last:border-b-0 ${w.has(g.id)?"bg-blue-500/10":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:w.has(g.id),onChange:M=>{M.stopPropagation(),J(g.id)},disabled:L,className:"w-4 h-4 rounded border-slate-600 text-blue-600 focus:ring-blue-500 focus:ring-offset-slate-900"}),e.jsx("div",{className:"w-8 h-8 rounded bg-slate-700 flex items-center justify-center text-sm font-medium text-slate-300",children:g.order_index+1}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-slate-200",children:g.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[H&&e.jsx("span",{className:"text-emerald-400",children:"Published"}),r&&!H&&e.jsx("span",{className:"text-amber-400",children:"Draft"}),!N&&e.jsx("span",{className:"text-slate-500",children:"No content"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:M=>{M.stopPropagation(),a(g.id,N?.id)},className:"flex items-center gap-1 px-3 py-1.5 text-sm text-blue-400 hover:text-blue-300 hover:bg-blue-500/10 rounded-lg transition-colors",children:["Edit Journey",e.jsx(Xe,{className:"w-4 h-4"})]}),e.jsx("button",{onClick:M=>{M.stopPropagation(),G(g.id)},disabled:m===g.id||L,className:"p-1.5 text-slate-500 hover:text-red-400 rounded transition-colors disabled:opacity-50",children:m===g.id?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"})})]})]},g.id)}),e.jsxs("button",{onClick:g=>{g.stopPropagation(),C(x.id)},disabled:L,className:"w-full px-4 py-3 flex items-center justify-center gap-2 text-slate-400 hover:text-white hover:bg-slate-700/50 transition-colors disabled:opacity-50",children:[e.jsx(ue,{className:"w-4 h-4"}),"Add Module"]})]})]},x.id))})]})}),c&&e.jsx(Ft,{onClose:()=>p(!1),onCreate:se,isCreating:A}),b&&e.jsx(qt,{onClose:()=>C(null),onCreate:x=>K(b,x),isCreating:S}),h&&e.jsx(Vt,{track:h,onClose:()=>j(null),isSaving:D,onSave:async x=>{B(!0);try{const{error:g}=await Q.from("tracks").update(x).eq("id",h.id);if(g)throw g;s("success","Track updated successfully"),await R(),j(null)}catch(g){console.error("Error updating track:",g),s("error","Failed to update track. Please try again.")}finally{B(!1)}}})]})}function Ft({onClose:a,onCreate:s,isCreating:i}){const[l,o]=t.useState(""),[u,n]=t.useState(""),[d,c]=t.useState("beginner"),[p,b]=t.useState(""),[C,h]=t.useState(!1);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-lg p-6 border border-slate-700 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Create New Track"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cover Image"}),e.jsx("div",{className:"relative",children:p?e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-slate-900",children:[e.jsx("img",{src:p,alt:"Cover preview",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>b(""),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(xe,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:()=>h(!C),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-500 transition-colors",children:[e.jsx(he,{className:"w-8 h-8 text-slate-500"}),e.jsx("span",{className:"text-sm text-slate-400",children:"Add cover image"})]})}),C&&!p&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("input",{type:"url",value:p,onChange:j=>b(j.target.value),placeholder:"Paste image URL...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Or choose from gallery:"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Ze.map((j,f)=>e.jsx("button",{onClick:()=>{b(j),h(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:e.jsx("img",{src:j,alt:"",className:"w-full h-full object-cover"})},f))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:l,onChange:j=>o(j.target.value),placeholder:"e.g., GenAI Fundamentals",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:u,onChange:j=>n(j.target.value),placeholder:"What will learners gain from this track?",rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Level"}),e.jsxs("select",{value:d,onChange:j=>c(j.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:a,disabled:i,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:()=>s({title:l,description:u,level:d,cover_image_url:p||void 0}),disabled:!l.trim()||i,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[i&&e.jsx(Y,{className:"w-4 h-4 animate-spin"}),i?"Creating...":"Create Track"]})]})]})})}function qt({onClose:a,onCreate:s,isCreating:i}){const[l,o]=t.useState(""),[u,n]=t.useState("");return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-md p-6 border border-slate-700",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Add New Module"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:l,onChange:d=>o(d.target.value),placeholder:"e.g., Introduction to AI",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:u,onChange:d=>n(d.target.value),placeholder:"What will this module cover?",rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:a,disabled:i,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:()=>s({title:l,description:u}),disabled:!l.trim()||i,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[i&&e.jsx(Y,{className:"w-4 h-4 animate-spin"}),i?"Creating...":"Create Module"]})]})]})})}function Vt({track:a,onClose:s,onSave:i,isSaving:l}){const[o,u]=t.useState(a.title),[n,d]=t.useState(a.description||""),[c,p]=t.useState(a.level),[b,C]=t.useState(a.cover_image_url||""),[h,j]=t.useState(!1);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-lg p-6 border border-slate-700 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Edit Track"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cover Image"}),e.jsx("div",{className:"relative",children:b?e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-slate-900",children:[e.jsx("img",{src:b,alt:"Cover preview",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>C(""),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(xe,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:()=>j(!h),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-500 transition-colors",children:[e.jsx(he,{className:"w-8 h-8 text-slate-500"}),e.jsx("span",{className:"text-sm text-slate-400",children:"Add cover image"})]})}),h&&!b&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("input",{type:"url",value:b,onChange:f=>C(f.target.value),placeholder:"Paste image URL...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Or choose from gallery:"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Ze.map((f,y)=>e.jsx("button",{onClick:()=>{C(f),j(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:e.jsx("img",{src:f,alt:"",className:"w-full h-full object-cover"})},y))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:o,onChange:f=>u(f.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:n,onChange:f=>d(f.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Level"}),e.jsxs("select",{value:c,onChange:f=>p(f.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:s,disabled:l,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:()=>i({title:o,description:n,level:c,cover_image_url:b||null}),disabled:!o.trim()||l,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[l&&e.jsx(Y,{className:"w-4 h-4 animate-spin"}),l?"Saving...":"Save Changes"]})]})]})})}function te({icon:a,onClick:s,active:i,title:l}){return e.jsx("button",{type:"button",onClick:s,title:l,className:`p-2 rounded-lg transition-colors ${i?"bg-blue-500 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,children:a})}function Ut({value:a,onChange:s,direction:i="rtl",placeholder:l="ابدأ الكتابة...",className:o=""}){const u=t.useRef(null),[n,d]=t.useState(null),[c,p]=t.useState(""),[b,C]=t.useState(""),h=t.useCallback((m,I)=>{document.execCommand(m,!1,I),u.current?.focus(),j()},[]),j=t.useCallback(()=>{u.current&&s(u.current.innerHTML)},[s]),f=t.useCallback(m=>{if(!c)return;let I="";if(m==="image")I=`<img src="${c}" alt="${b}" class="inline-media rounded-lg max-w-full my-2" />`;else if(c.includes("youtube.com")||c.includes("youtu.be")){const A=c.match(/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/\s]{11})/)?.[1];A&&(I=`<iframe src="https://www.youtube.com/embed/${A}" class="inline-media rounded-lg w-full aspect-video my-2" frameborder="0" allowfullscreen></iframe>`)}else I=`<video src="${c}" controls class="inline-media rounded-lg max-w-full my-2"></video>`;I&&(document.execCommand("insertHTML",!1,I),j()),d(null),p(""),C("")},[c,b,j]),y=t.useCallback(()=>{const m=prompt("أدخل الرابط:");m&&h("createLink",m)},[h]);return e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 overflow-hidden ${o}`,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 border-b border-slate-700 bg-slate-900/50",children:[e.jsx(te,{icon:e.jsx(dt,{className:"w-4 h-4"}),onClick:()=>h("bold"),title:"غامق"}),e.jsx(te,{icon:e.jsx(gt,{className:"w-4 h-4"}),onClick:()=>h("italic"),title:"مائل"}),e.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),e.jsx(te,{icon:e.jsx(mt,{className:"w-4 h-4"}),onClick:()=>h("formatBlock","h1"),title:"عنوان رئيسي"}),e.jsx(te,{icon:e.jsx(pt,{className:"w-4 h-4"}),onClick:()=>h("formatBlock","h2"),title:"عنوان فرعي"}),e.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),e.jsx(te,{icon:e.jsx(vt,{className:"w-4 h-4"}),onClick:()=>h("insertUnorderedList"),title:"قائمة نقطية"}),e.jsx(te,{icon:e.jsx(jt,{className:"w-4 h-4"}),onClick:()=>h("insertOrderedList"),title:"قائمة مرقمة"}),e.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),e.jsx(te,{icon:e.jsx(he,{className:"w-4 h-4"}),onClick:()=>d("image"),title:"إدراج صورة"}),e.jsx(te,{icon:e.jsx(me,{className:"w-4 h-4"}),onClick:()=>d("video"),title:"إدراج فيديو"}),e.jsx(te,{icon:e.jsx(Le,{className:"w-4 h-4"}),onClick:y,title:"إدراج رابط"}),e.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),e.jsx(te,{icon:e.jsx(At,{className:"w-4 h-4"}),onClick:()=>h("formatBlock","blockquote"),title:"اقتباس"}),e.jsx(te,{icon:e.jsx(Se,{className:"w-4 h-4"}),onClick:()=>h("formatBlock","pre"),title:"كود"}),e.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),e.jsx(te,{icon:i==="rtl"?e.jsx(ct,{className:"w-4 h-4"}):e.jsx(ot,{className:"w-4 h-4"}),onClick:()=>{u.current&&(u.current.dir=u.current.dir==="rtl"?"ltr":"rtl")},title:"تغيير الاتجاه"}),e.jsx("div",{className:"flex-1"}),e.jsx(te,{icon:e.jsx($t,{className:"w-4 h-4"}),onClick:()=>h("undo"),title:"تراجع"}),e.jsx(te,{icon:e.jsx(Mt,{className:"w-4 h-4"}),onClick:()=>h("redo"),title:"إعادة"})]}),e.jsx("div",{ref:u,contentEditable:!0,dir:i,className:`min-h-[200px] p-4 outline-none rich-text-content ${i==="rtl"?"rtl":""}`,onInput:j,dangerouslySetInnerHTML:{__html:a},"data-placeholder":l,style:{minHeight:"200px"}}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:n==="image"?"إدراج صورة":"إدراج فيديو"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:n==="image"?"رابط الصورة":"رابط الفيديو"}),e.jsx("input",{type:"url",value:c,onChange:m=>p(m.target.value),placeholder:n==="image"?"https://example.com/image.jpg":"https://youtube.com/watch?v=...",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",dir:"ltr"})]}),n==="image"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"النص البديل (اختياري)"}),e.jsx("input",{type:"text",value:b,onChange:m=>C(m.target.value),placeholder:"وصف الصورة",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n==="video"&&e.jsx("p",{className:"text-sm text-slate-400",children:"يمكنك استخدام روابط YouTube أو روابط فيديو مباشرة"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{d(null),p(""),C("")},className:"flex-1 px-4 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:()=>f(n),disabled:!c,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"إدراج"})]})]})})]})}function Jt({onRecordingComplete:a,onClose:s,showLibrarySave:i=!0}){const[l,o]=t.useState(null),[u,n]=t.useState("idle"),[d,c]=t.useState(0),[p,b]=t.useState(null),[C,h]=t.useState(null),[j,f]=t.useState(!0),y=t.useRef(null),m=t.useRef(null),I=t.useRef(null),A=t.useRef(null),T=t.useRef([]),S=t.useRef(null),V=t.useRef(null),D=t.useRef(null),B=t.useRef(null);t.useEffect(()=>()=>{q(),D.current&&clearInterval(D.current),B.current&&cancelAnimationFrame(B.current)},[]);const q=t.useCallback(()=>{S.current&&(S.current.getTracks().forEach(O=>O.stop()),S.current=null),V.current&&(V.current.getTracks().forEach(O=>O.stop()),V.current=null)},[]),z=t.useCallback(async O=>{h(null),n("preparing"),o(O),T.current=[];try{let G;if(O==="camera")G=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:"user"},audio:j}),S.current=G,y.current&&(y.current.srcObject=G,await y.current.play());else if(O==="screen"){const U=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080},audio:!0});if(j)try{const J=(await navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0];U.addTrack(J)}catch{console.log("Could not add microphone audio")}G=U,S.current=G,y.current&&(y.current.srcObject=G,await y.current.play())}else{const U=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080},audio:!1}),le=await navigator.mediaDevices.getUserMedia({video:{width:320,height:240,facingMode:"user"},audio:j});S.current=U,V.current=le,y.current&&(y.current.srcObject=U,await y.current.play()),m.current&&(m.current.srcObject=le,await m.current.play());const J=I.current,X=J.getContext("2d");J.width=1920,J.height=1080;const oe=()=>{if(u==="stopped")return;X.drawImage(y.current,0,0,J.width,J.height);const ee=320,x=240,g=20;X.save(),X.beginPath(),X.arc(J.width-g-ee/2,J.height-g-x/2,Math.min(ee,x)/2,0,Math.PI*2),X.clip(),X.drawImage(m.current,J.width-g-ee,J.height-g-x,ee,x),X.restore(),B.current=requestAnimationFrame(oe)};oe();const de=J.captureStream(30);j&&le.getAudioTracks().length>0&&de.addTrack(le.getAudioTracks()[0]),G=de}const F=new MediaRecorder(G,{mimeType:"video/webm;codecs=vp9"});F.ondataavailable=U=>{U.data.size>0&&T.current.push(U.data)},F.onstop=()=>{const U=new Blob(T.current,{type:"video/webm"});b(U),n("stopped"),q(),B.current&&cancelAnimationFrame(B.current)},A.current=F,F.start(1e3),n("recording"),c(0),D.current=window.setInterval(()=>{c(U=>U+1)},1e3)}catch(G){console.error("Recording error:",G),h("فشل في بدء التسجيل. تأكد من إعطاء الصلاحيات المطلوبة."),n("idle"),o(null),q()}},[j,q]),w=t.useCallback(()=>{A.current&&u==="recording"&&(A.current.pause(),n("paused"),D.current&&clearInterval(D.current))},[u]),k=t.useCallback(()=>{A.current&&u==="paused"&&(A.current.resume(),n("recording"),D.current=window.setInterval(()=>{c(O=>O+1)},1e3))},[u]),L=t.useCallback(()=>{A.current&&(A.current.stop(),D.current&&clearInterval(D.current))},[]),E=t.useCallback(()=>{b(null),n("idle"),o(null),c(0),h(null),q()},[q]),R=t.useCallback(()=>{p&&l&&a&&a(p,l)},[p,l,a]),se=t.useCallback(()=>{if(p){const O=URL.createObjectURL(p),G=document.createElement("a");G.href=O,G.download=`recording-${Date.now()}.webm`,G.click(),URL.revokeObjectURL(O)}},[p]),K=O=>{const G=Math.floor(O/60),F=O%60;return`${G.toString().padStart(2,"0")}:${F.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"تسجيل فيديو"}),s&&e.jsx("button",{onClick:s,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[u==="idle"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-slate-300 text-center mb-6",children:"اختر نوع التسجيل"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>z("camera"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-500/20 flex items-center justify-center group-hover:bg-blue-500/30 transition-colors",children:e.jsx(Ve,{className:"w-7 h-7 text-blue-400"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-medium",children:"الكاميرا"}),e.jsx("div",{className:"text-xs text-slate-400",children:"تسجيل من الكاميرا فقط"})]})]}),e.jsxs("button",{onClick:()=>z("screen"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-emerald-500/20 flex items-center justify-center group-hover:bg-emerald-500/30 transition-colors",children:e.jsx(Ct,{className:"w-7 h-7 text-emerald-400"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-medium",children:"الشاشة"}),e.jsx("div",{className:"text-xs text-slate-400",children:"تسجيل الشاشة فقط"})]})]}),e.jsxs("button",{onClick:()=>z("camera_screen"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-amber-500/20 flex items-center justify-center group-hover:bg-amber-500/30 transition-colors",children:e.jsx(kt,{className:"w-7 h-7 text-amber-400"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-medium",children:"الشاشة + الكاميرا"}),e.jsx("div",{className:"text-xs text-slate-400",children:"مثل Loom"})]})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 pt-4",children:e.jsxs("button",{onClick:()=>f(!j),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${j?"bg-blue-500/20 text-blue-400":"bg-slate-700 text-slate-400"}`,children:[j?e.jsx(wt,{className:"w-4 h-4"}):e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:j?"الصوت مفعل":"الصوت معطل"})]})}),C&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-sm text-center",children:C})]}),u==="preparing"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Y,{className:"w-12 h-12 text-blue-400 animate-spin mb-4"}),e.jsx("p",{className:"text-slate-300",children:"جاري التحضير..."})]}),(u==="recording"||u==="paused")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative aspect-video bg-black rounded-xl overflow-hidden",children:[e.jsx("video",{ref:y,className:"w-full h-full object-contain",muted:!0,playsInline:!0}),l==="camera_screen"&&e.jsx("video",{ref:m,className:"absolute bottom-4 right-4 w-32 h-24 rounded-full object-cover border-2 border-white shadow-lg",muted:!0,playsInline:!0}),e.jsx("canvas",{ref:I,className:"hidden"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("div",{className:`recording-indicator ${u==="paused"?"opacity-50":""}`,children:e.jsx("span",{className:"text-sm font-medium",children:u==="paused"?"متوقف مؤقتاً":"جاري التسجيل"})})}),e.jsx("div",{className:"absolute top-4 right-4 bg-black/50 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-white font-mono text-sm",children:K(d)})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[u==="recording"?e.jsx("button",{onClick:w,className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors",title:"إيقاف مؤقت",children:e.jsx(Ke,{className:"w-6 h-6 text-white"})}):e.jsx("button",{onClick:k,className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors",title:"استئناف",children:e.jsx(ze,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:L,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full transition-colors",title:"إيقاف التسجيل",children:e.jsx(He,{className:"w-6 h-6 text-white fill-current"})})]})]}),u==="stopped"&&p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-video bg-black rounded-xl overflow-hidden",children:e.jsx("video",{src:URL.createObjectURL(p),controls:!0,className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-slate-400 text-sm",children:["المدة: ",K(d)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"إعادة التسجيل"})]}),e.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{children:"تنزيل"})]}),i&&e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:"حفظ"})]})]})]})]})]})]})}function Ht({block:a,allBlocks:s,edges:i,onUpdate:l,onAddEdge:o,onRemoveEdge:u,onClose:n}){const{enabled:d,isLoading:c}=Ie(),[p,b]=t.useState("content"),C=(f,y)=>{l({content:{...a.content,[f]:y}})},h=i.filter(f=>f.from===a.id),j=s.filter(f=>f.id!==a.id&&!h.some(y=>y.to===f.id));return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit Block"}),e.jsx("button",{onClick:n,className:"p-1.5 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:a.content.title||"",onChange:f=>C("title",f.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Block title"})]}),e.jsx(Ee,{title:"Content",isOpen:p==="content",onToggle:()=>b(p==="content"?"":"content"),children:Zt(a,C,d,c)}),e.jsx(Ee,{title:"Connections",isOpen:p==="connections",onToggle:()=>b(p==="connections"?"":"connections"),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Define what happens after this block."}),h.length>0&&e.jsx("div",{className:"space-y-2",children:h.map(f=>{const y=s.find(m=>m.id===f.to);return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-900 rounded-lg group",children:[e.jsx("span",{className:"text-sm text-slate-300 flex-1",children:y?.content?.title||"Unknown block"}),f.condition&&e.jsx("span",{className:"text-xs text-amber-400 mr-2",children:"Conditional"}),e.jsx("button",{onClick:()=>u(f.to),className:"p-1 text-slate-500 hover:text-red-400 hover:bg-red-500/10 rounded transition-colors",title:"Remove connection",children:e.jsx(re,{className:"w-4 h-4"})})]},`${f.from}-${f.to}`)})}),j.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Connect to:"}),e.jsxs("select",{onChange:f=>{f.target.value&&(o(f.target.value),f.target.value="")},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a block..."}),j.map(f=>e.jsx("option",{value:f.id,children:f.content?.title||f.type},f.id))]})]}),a.type==="quiz"&&e.jsxs("div",{className:"mt-4 p-3 bg-slate-900/50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Conditional Routing"}),e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Add connections with conditions based on quiz score."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>{const f=j[0];f&&o(f.id,{all:[{fact:"quiz.scorePercent",op:"gte",value:50}]})},disabled:j.length===0,className:"w-full px-3 py-2 text-sm bg-emerald-600/20 text-emerald-400 rounded-lg hover:bg-emerald-600/30 disabled:opacity-50 transition-colors",children:'Add "Pass" connection (score >= 50%)'}),e.jsx("button",{onClick:()=>{const f=j[0];f&&o(f.id,{all:[{fact:"quiz.scorePercent",op:"lt",value:50}]})},disabled:j.length===0,className:"w-full px-3 py-2 text-sm bg-amber-600/20 text-amber-400 rounded-lg hover:bg-amber-600/30 disabled:opacity-50 transition-colors",children:'Add "Fail" connection (score < 50%)'})]})]})]})})]})})]})}function Ee({title:a,isOpen:s,onToggle:i,children:l}){return e.jsxs("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:i,className:"w-full flex items-center justify-between px-4 py-3 bg-slate-800 text-white hover:bg-slate-700 transition-colors",children:[e.jsx("span",{className:"font-medium",children:a}),s?e.jsx(Ce,{className:"w-4 h-4"}):e.jsx(ke,{className:"w-4 h-4"})]}),s&&e.jsx("div",{className:"p-4 bg-slate-800/50",children:l})]})}function Zt(a,s,i,l){const o=a.content;switch(a.type){case"read":return e.jsx(Yt,{content:o,updateContent:s,aiEnabled:i,aiSettingsLoading:l});case"video":return e.jsx(Qt,{content:o,updateContent:s,aiEnabled:i,aiSettingsLoading:l});case"image":return e.jsx(Wt,{content:o,updateContent:s});case"quiz":return e.jsx(Xt,{content:o,updateContent:s,aiEnabled:i,aiSettingsLoading:l});case"mission":return e.jsx(Kt,{content:o,updateContent:s});case"form":return e.jsx(es,{content:o,updateContent:s});case"ai_help":return e.jsx(ts,{content:o,updateContent:s});case"checkpoint":return e.jsx(ss,{content:o,updateContent:s});case"animation":return e.jsx(ls,{content:o,updateContent:s});case"code":return e.jsx(rs,{content:o,updateContent:s});case"exercise":return e.jsx(ns,{content:o,updateContent:s});case"resource":return e.jsx(is,{content:o,updateContent:s});default:return e.jsx("p",{className:"text-slate-500",children:"No editor available for this block type."})}}function Yt({content:a,updateContent:s,aiEnabled:i,aiSettingsLoading:l}){const[o,u]=t.useState(!1),[n,d]=t.useState(""),[c,p]=t.useState(!1),[b,C]=t.useState("markdown"),h=async()=>{if(!(!n.trim()||!i)){u(!0);try{const I=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"content",topic:n,existingContent:a.markdown||""})})).json();I.result&&(s("markdown",I.result),p(!1),d(""))}catch(m){console.error("AI generation failed:",m)}finally{u(!1)}}},j=m=>m?m.replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>").replace(/^- (.*$)/gm,"<li>$1</li>").replace(/\n/g,"<br>"):"",f=m=>m?m.replace(/<h1>(.*?)<\/h1>/g,`# $1
`).replace(/<h2>(.*?)<\/h2>/g,`## $1
`).replace(/<h3>(.*?)<\/h3>/g,`### $1
`).replace(/<strong>(.*?)<\/strong>/g,"**$1**").replace(/<b>(.*?)<\/b>/g,"**$1**").replace(/<em>(.*?)<\/em>/g,"*$1*").replace(/<i>(.*?)<\/i>/g,"*$1*").replace(/<code>(.*?)<\/code>/g,"`$1`").replace(/<blockquote>(.*?)<\/blockquote>/g,`> $1
`).replace(/<li>(.*?)<\/li>/g,`- $1
`).replace(/<br\s*\/?>/g,`
`).replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").trim():"",y=m=>{const I=f(m);s("markdown",I)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Editor Mode:"}),e.jsxs("div",{className:"flex bg-slate-900 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>C("markdown"),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm transition-colors ${b==="markdown"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:[e.jsx(be,{className:"w-4 h-4"}),"Markdown"]}),e.jsxs("button",{onClick:()=>C("richtext"),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm transition-colors ${b==="richtext"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:[e.jsx(Bt,{className:"w-4 h-4"}),"Rich Text"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:["Content (",b==="markdown"?"Markdown":"Rich Text",")"]}),b==="markdown"?e.jsx("textarea",{value:a.markdown||"",onChange:m=>s("markdown",m.target.value),rows:12,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:`# Heading

Your content here...`}):e.jsx(Ut,{value:j(a.markdown||""),onChange:y,direction:"ltr",placeholder:"Start writing your content...",className:"min-h-[300px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Est. Read Time (minutes)"}),e.jsx("input",{type:"number",value:a.estimatedReadTime||3,onChange:m=>s("estimatedReadTime",parseInt(m.target.value)||3),min:1,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),!i&&!l?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg text-amber-400 text-sm",children:[e.jsx(Ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"AI content generation is disabled by the administrator."})]}):c?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:n,onChange:m=>d(m.target.value),placeholder:"What topic should this content cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:h,disabled:o||!n.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[o?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),o?"Generating...":"Generate"]})]})]}):e.jsxs("button",{onClick:()=>p(!0),disabled:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"Generate Content with AI"]})]})}function Qt({content:a,updateContent:s,aiEnabled:i,aiSettingsLoading:l}){const[o,u]=t.useState("url"),[n,d]=t.useState(!1),[c,p]=t.useState(""),[b,C]=t.useState(!1),[h,j]=t.useState(!1),f=async()=>{if(!(!c.trim()||!i)){d(!0);try{const I=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"video_script",topic:c,duration:5})})).json();I.result&&(s("transcript",I.result),s("description",`Video script: ${c}`),C(!1),p(""))}catch(m){console.error("AI generation failed:",m)}finally{d(!1)}}},y=async(m,I)=>{const A=URL.createObjectURL(m);s("url",A),s("recordingMode",I),j(!1),u("url")};return h?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Jt,{onRecordingComplete:y,onClose:()=>{j(!1),u("url")},showLibrarySave:!0}),e.jsx("p",{className:"text-xs text-slate-400 text-center",children:"Note: In production, videos will be uploaded to Taalam storage."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>u("url"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="url"?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[e.jsx(Le,{className:"w-4 h-4"}),"URL"]}),e.jsxs("button",{onClick:()=>u("upload"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="upload"?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[e.jsx(Pe,{className:"w-4 h-4"}),"Upload"]}),e.jsxs("button",{onClick:()=>{u("record"),j(!0)},className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="record"?"bg-red-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[e.jsx(Ve,{className:"w-4 h-4"}),"Record"]})]}),o==="url"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Video URL"}),e.jsx("input",{type:"url",value:a.url||"",onChange:m=>s("url",m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://youtube.com/watch?v=... or video URL"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Supports YouTube, Vimeo, and direct video URLs"})]}):o==="upload"?e.jsxs("div",{className:"border-2 border-dashed border-slate-700 rounded-lg p-6 text-center",children:[e.jsx(me,{className:"w-10 h-10 text-slate-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Drag and drop or click to upload"}),e.jsx("input",{type:"file",accept:"video/*",className:"hidden"}),e.jsx("button",{className:"px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Choose File"})]}):null,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Transcript / Script"}),e.jsx("textarea",{value:a.transcript||"",onChange:m=>s("transcript",m.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Video transcript or script..."})]}),!i&&!l?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg text-amber-400 text-sm",children:[e.jsx(Ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"AI script generation is disabled by the administrator."})]}):b?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:c,onChange:m=>p(m.target.value),placeholder:"What should the video script cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:f,disabled:n||!c.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),n?"Generating...":"Generate"]})]})]}):e.jsxs("button",{onClick:()=>C(!0),disabled:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"Generate Script with AI"]})]})}function Wt({content:a,updateContent:s}){const i=["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=800"],[l,o]=t.useState(!1);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Image URL"}),e.jsx("input",{type:"url",value:a.url||"",onChange:u=>s("url",u.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/image.jpg"})]}),a.url?e.jsx("div",{className:"relative aspect-video bg-slate-900 rounded-lg overflow-hidden",children:e.jsx("img",{src:a.url,alt:"Preview",className:"w-full h-full object-contain"})}):e.jsxs("button",{onClick:()=>o(!l),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-600 transition-colors",children:[e.jsx(he,{className:"w-8 h-8 text-slate-600"}),e.jsx("span",{className:"text-sm text-slate-400",children:"Choose from gallery or paste URL above"})]}),l&&!a.url&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map((u,n)=>e.jsx("button",{onClick:()=>{s("url",u),o(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:e.jsx("img",{src:u,alt:"",className:"w-full h-full object-cover"})},n))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Caption (optional)"}),e.jsx("input",{type:"text",value:a.caption||"",onChange:u=>s("caption",u.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Image caption..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Alt Text"}),e.jsx("input",{type:"text",value:a.alt||"",onChange:u=>s("alt",u.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe the image for accessibility..."})]})]})}function Xt({content:a,updateContent:s,aiEnabled:i,aiSettingsLoading:l}){const o=a.questions||[],[u,n]=t.useState(!1),[d,c]=t.useState(""),[p,b]=t.useState(!1),C=()=>{const y={id:`q_${Date.now()}`,prompt:"",choices:["","","",""],correctIndex:0,tags:[]};s("questions",[...o,y])},h=(y,m)=>{const I=o.map((A,T)=>T===y?{...A,...m}:A);s("questions",I)},j=y=>{s("questions",o.filter((m,I)=>I!==y))},f=async()=>{if(!(!d.trim()||!i)){n(!0);try{const m=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"quiz",topic:d})})).json();if(m.result&&Array.isArray(m.result)){const I=m.result.map((A,T)=>({...A,id:`q_${Date.now()}_${T}`}));s("questions",[...o,...I]),b(!1),c("")}}catch(y){console.error("AI generation failed:",y)}finally{n(!1)}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Passing Score (%)"})}),e.jsx("input",{type:"number",value:a.passingScore||50,onChange:y=>s("passingScore",parseInt(y.target.value)||50),min:0,max:100,className:"w-20 px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"space-y-4",children:o.map((y,m)=>e.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-slate-600"}),e.jsxs("span",{className:"text-sm font-medium text-slate-400",children:["Q",m+1]})]}),e.jsx("button",{onClick:()=>j(m),className:"p-1 text-slate-500 hover:text-red-400",children:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsx("input",{type:"text",value:y.prompt,onChange:I=>h(m,{prompt:I.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Question..."}),e.jsx("div",{className:"space-y-2",children:y.choices.map((I,A)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:y.correctIndex===A,onChange:()=>h(m,{correctIndex:A}),className:"w-4 h-4 text-emerald-500"}),e.jsx("input",{type:"text",value:I,onChange:T=>{const S=[...y.choices];S[A]=T.target.value,h(m,{choices:S})},className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Option ${A+1}`})]},A))}),e.jsx("input",{type:"text",value:y.explanation||"",onChange:I=>h(m,{explanation:I.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Explanation (shown after answer)..."}),e.jsx("input",{type:"text",value:y.tags.join(", "),onChange:I=>h(m,{tags:I.target.value.split(",").map(A=>A.trim()).filter(Boolean)}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tags (comma-separated)..."})]},y.id))}),e.jsxs("button",{onClick:C,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Add Question"]}),!i&&!l?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg text-amber-400 text-sm",children:[e.jsx(Ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"AI question generation is disabled by the administrator."})]}):p?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:d,onChange:y=>c(y.target.value),placeholder:"What topic should the questions cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:f,disabled:u||!d.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[u?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),u?"Generating...":"Generate"]})]})]}):e.jsxs("button",{onClick:()=>b(!0),disabled:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"Generate Questions with AI"]})]})}function Kt({content:a,updateContent:s}){const i=a.steps||[],[l,o]=t.useState(null),u=()=>{const c={id:`step_${Date.now()}`,instruction:"",verificationMethod:"self_report"};s("steps",[...i,c])},n=(c,p)=>{const b=i.map((C,h)=>h===c?{...C,...p}:C);s("steps",b)},d=c=>{s("steps",i.filter((p,b)=>b!==c))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description||"",onChange:c=>s("description",c.target.value),rows:2,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"What is this mission about?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"External URL (optional)"}),e.jsx("input",{type:"url",value:a.externalUrl||"",onChange:c=>s("externalUrl",c.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Steps"}),i.map((c,p)=>e.jsx("div",{className:"p-3 bg-slate-900 rounded-lg space-y-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded bg-slate-700 flex items-center justify-center text-xs text-slate-400 mt-1",children:p+1}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{type:"text",value:c.instruction,onChange:b=>n(p,{instruction:b.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Step instruction / question..."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:c.verificationMethod||"self_report",onChange:b=>n(p,{verificationMethod:b.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"self_report",children:"Self Report"}),e.jsx("option",{value:"screenshot",children:"Screenshot"}),e.jsx("option",{value:"url_check",children:"URL Check"}),e.jsx("option",{value:"ai_validate",children:"AI Validation"})]}),c.verificationMethod==="ai_validate"&&e.jsx("button",{onClick:()=>o(l===c.id?null:c.id),className:"px-2 py-1 text-xs bg-blue-600/20 text-blue-400 rounded hover:bg-blue-600/30 transition-colors",children:l===c.id?"Hide Options":"AI Options"})]}),c.verificationMethod==="ai_validate"&&l===c.id&&e.jsxs("div",{className:"space-y-2 p-2 bg-slate-800 rounded border border-slate-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Expected Criteria"}),e.jsx("textarea",{value:c.expectedCriteria||"",onChange:b=>n(p,{expectedCriteria:b.target.value}),rows:2,className:"w-full px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white placeholder-slate-500 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Describe what makes a correct answer (e.g., 'Must mention key concept X and demonstrate understanding of Y')"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Input Type"}),e.jsxs("select",{value:c.inputType||"text",onChange:b=>n(p,{inputType:b.target.value}),className:"w-full px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"text",children:"Single Line (short answer)"}),e.jsx("option",{value:"textarea",children:"Multi Line (long answer)"})]})]})]})]}),e.jsx("button",{onClick:()=>d(p),className:"p-1 text-slate-500 hover:text-red-400",children:e.jsx(re,{className:"w-4 h-4"})})]})},c.id))]}),e.jsxs("button",{onClick:u,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Add Step"]}),e.jsx("div",{className:"p-3 bg-blue-900/20 border border-blue-700/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-300",children:[e.jsx("strong",{children:"AI Validation:"})," When selected, learners must provide an answer that will be evaluated by AI against your criteria. The AI will provide feedback and mark the step as complete if correct."]})})]})}function es({content:a,updateContent:s}){const i=a.fields||[],l=n=>{const d={id:`field_${Date.now()}`,type:n,label:"",required:!1};s("fields",[...i,d])},o=(n,d)=>{const c=i.map((p,b)=>b===n?{...p,...d}:p);s("fields",c)},u=n=>{s("fields",i.filter((d,c)=>c!==n))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description||"",onChange:n=>s("description",n.target.value),rows:2,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Fields"}),i.map((n,d)=>e.jsx("div",{className:"p-2 bg-slate-900 rounded-lg space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:n.type,onChange:c=>o(d,{type:c.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"textarea",children:"Textarea"}),e.jsx("option",{value:"select",children:"Select"}),e.jsx("option",{value:"checkbox",children:"Checkbox"}),e.jsx("option",{value:"radio",children:"Radio"})]}),e.jsx("input",{type:"text",value:n.label,onChange:c=>o(d,{label:c.target.value}),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Label..."}),e.jsxs("label",{className:"flex items-center gap-1 text-xs text-slate-400",children:[e.jsx("input",{type:"checkbox",checked:n.required,onChange:c=>o(d,{required:c.target.checked})}),"Required"]}),e.jsx("button",{onClick:()=>u(d),className:"p-1 text-slate-500 hover:text-red-400",children:e.jsx(re,{className:"w-4 h-4"})})]})},n.id))]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["text","textarea","select","checkbox","radio"].map(n=>e.jsxs("button",{onClick:()=>l(n),className:"px-3 py-1 bg-slate-700 text-white text-sm rounded hover:bg-slate-600 transition-colors",children:["+ ",n]},n))})]})}function ts({content:a,updateContent:s}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Mode"}),e.jsxs("select",{value:a.mode||"targeted_remediation",onChange:i=>s("mode",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"targeted_remediation",children:"Targeted Remediation"}),e.jsx("option",{value:"open_chat",children:"Open Chat"}),e.jsx("option",{value:"guided_explanation",children:"Guided Explanation"})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:a.mode==="targeted_remediation"?"AI focuses on topics the learner struggled with":a.mode==="open_chat"?"Open-ended conversation about the material":"Step-by-step guided explanation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Max Turns"}),e.jsx("input",{type:"number",value:a.maxTurns||5,onChange:i=>s("maxTurns",parseInt(i.target.value)||5),min:1,max:20,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}function ss({content:a,updateContent:s}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description||"",onChange:i=>s("description",i.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"What does this checkpoint evaluate?"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Checkpoints evaluate learner progress and can branch to different paths based on performance. Use the Connections section to set up conditional routing."})]})}function ls({content:a,updateContent:s}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Animation Type"}),e.jsxs("select",{value:a.animationType||"lottie",onChange:i=>s("animationType",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"lottie",children:"Lottie"}),e.jsx("option",{value:"video",children:"Video"}),e.jsx("option",{value:"interactive",children:"Interactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Animation URL"}),e.jsx("input",{type:"url",value:a.url||"",onChange:i=>s("url",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:a.autoplay??!0,onChange:i=>s("autoplay",i.target.checked)}),"Autoplay"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:a.loop??!1,onChange:i=>s("loop",i.target.checked)}),"Loop"]})]})]})}const as=["javascript","typescript","python","java","csharp","cpp","c","ruby","go","rust","php","swift","kotlin","sql","html","css","json","bash","shell","markdown","yaml","xml"];function rs({content:a,updateContent:s}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Language"}),e.jsx("select",{value:a.language||"javascript",onChange:i=>s("language",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:as.map(i=>e.jsx("option",{value:i,children:i.charAt(0).toUpperCase()+i.slice(1)},i))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Code"}),e.jsx("textarea",{value:a.code||"",onChange:i=>s("code",i.target.value),rows:12,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:"// Your code here..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description (optional)"}),e.jsx("input",{type:"text",value:a.description||"",onChange:i=>s("description",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the code..."})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:a.showLineNumbers??!0,onChange:i=>s("showLineNumbers",i.target.checked)}),"Show Line Numbers"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Highlight Lines (comma-separated)"}),e.jsx("input",{type:"text",value:(a.highlightLines||[]).join(", "),onChange:i=>{const l=i.target.value.split(",").map(o=>parseInt(o.trim())).filter(o=>!isNaN(o)&&o>0);s("highlightLines",l)},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 1, 3, 5-7"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Lines to highlight (e.g., 1, 3, 5)"})]})]})}function ns({content:a,updateContent:s}){const i=a.hints||[],l=()=>{s("hints",[...i,""])},o=(n,d)=>{const c=i.map((p,b)=>b===n?d:p);s("hints",c)},u=n=>{s("hints",i.filter((d,c)=>c!==n))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:a.description||"",onChange:n=>s("description",n.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Problem"}),e.jsx("textarea",{value:a.problem||"",onChange:n=>s("problem",n.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Describe the problem or exercise..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Hints (optional)"}),e.jsx("div",{className:"space-y-2",children:i.map((n,d)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded bg-slate-700 flex items-center justify-center text-xs text-slate-400 mt-1",children:d+1}),e.jsx("input",{type:"text",value:n,onChange:c=>o(d,c.target.value),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Hint..."}),e.jsx("button",{onClick:()=>u(d),className:"p-1 text-slate-500 hover:text-red-400",children:e.jsx(re,{className:"w-4 h-4"})})]},d))}),e.jsxs("button",{onClick:l,className:"mt-2 flex items-center gap-2 px-3 py-1 bg-slate-700 text-white text-sm rounded hover:bg-slate-600 transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Add Hint"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Solution"}),e.jsx("textarea",{value:a.solution||"",onChange:n=>s("solution",n.target.value),rows:6,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:"The solution..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Solution Explanation (optional)"}),e.jsx("textarea",{value:a.solutionExplanation||"",onChange:n=>s("solutionExplanation",n.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Explain why this solution works..."})]})]})}function is({content:a,updateContent:s}){const i=a.resources||[],l=()=>{const n={id:`res_${Date.now()}`,title:"",url:"",type:"link"};s("resources",[...i,n])},o=(n,d)=>{const c=i.map((p,b)=>b===n?{...p,...d}:p);s("resources",c)},u=n=>{s("resources",i.filter((d,c)=>c!==n))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:a.description||"",onChange:n=>s("description",n.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of resources..."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Resources"}),i.map((n,d)=>e.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.title,onChange:c=>o(d,{title:c.target.value}),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Resource title..."}),e.jsxs("select",{value:n.type,onChange:c=>o(d,{type:c.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"link",children:"Link"}),e.jsx("option",{value:"download",children:"Download"}),e.jsx("option",{value:"video",children:"Video"}),e.jsx("option",{value:"document",children:"Document"})]}),e.jsx("button",{onClick:()=>u(d),className:"p-1 text-slate-500 hover:text-red-400",children:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsx("input",{type:"url",value:n.url,onChange:c=>o(d,{url:c.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."}),e.jsx("input",{type:"text",value:n.description||"",onChange:c=>o(d,{description:c.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Description (optional)..."})]},n.id))]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Add Resource"]})]})}function os({onGenerate:a,onClose:s,existingGraph:i}){const{enabled:l,contentModel:o,isLoading:u}=Ie(),[n,d]=t.useState(1),[c,p]=t.useState(!1),[b,C]=t.useState(""),[h,j]=t.useState(""),[f,y]=t.useState("beginners"),[m,I]=t.useState("beginner"),[A,T]=t.useState(20),[S,V]=t.useState(6),[D,B]=t.useState(!0),[q,z]=t.useState(!0),[w,k]=t.useState(!0),[L,E]=t.useState(!1),[R,se]=t.useState(!0),[K,O]=t.useState(!1),[G,F]=t.useState(!1),[U,le]=t.useState(!1),[J,X]=t.useState(!0),[oe,de]=t.useState(!1),[ee,x]=t.useState(!1),[g,H]=t.useState(!0),[r,N]=t.useState(""),[M,$]=t.useState("gpt-4o"),[P,ae]=t.useState(null);t.useEffect(()=>{!u&&o&&$(o)},[u,o]);const Z=async()=>{p(!0),C(""),N(g?"Researching topic on the web...":"Generating course...");try{const v=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"outline",topic:h,targetAudience:f,difficulty:m,duration:A,blockCount:S,includeVideo:D,includeQuiz:q,includeMission:w,includeImage:L,includeCode:R,includeExercise:K,includeResource:G,includeForm:U,includeAIHelp:J,includeCheckpoint:oe,includeAnimation:ee,existingGraph:i,enableWebResearch:g,model:M})});if(N("Creating course structure..."),!v.ok)throw new Error("Failed to generate course");const ce=await v.json();if(ce.error)throw new Error(ce.error);if(ce.result&&typeof ce.result=="object")ae(ce.result),d(3);else throw new Error("Invalid response format")}catch(v){C(v instanceof Error?v.message:"Generation failed")}finally{p(!1)}},ne=()=>{P&&a(P)};return e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col border border-slate-700 shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b border-slate-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"AI Course Generator"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Create a complete course with AI assistance"})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[!u&&!l?e.jsx(Ge,{}):u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Y,{className:"w-8 h-8 text-purple-500 animate-spin"})}):n===1&&e.jsxs("div",{className:"space-y-6",children:[i&&i.blocks.length>0&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-500/10 border border-blue-500/20 rounded-xl",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-blue-300 mb-1",children:"Building Upon Existing Content"}),e.jsxs("div",{className:"text-sm text-slate-400",children:["AI will see your ",i.blocks.length," existing blocks and generate content that complements what you already have."]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"What do you want to teach?"}),e.jsx("textarea",{value:h,onChange:v=>j(v.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"e.g., Introduction to Machine Learning, How to use ChatGPT effectively, Basic Python programming..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Audience"}),e.jsxs("select",{value:f,onChange:v=>y(v.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"beginners",children:"Complete Beginners"}),e.jsx("option",{value:"students",children:"Students"}),e.jsx("option",{value:"professionals",children:"Professionals"}),e.jsx("option",{value:"technical",children:"Technical Audience"}),e.jsx("option",{value:"general",children:"General Audience"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Difficulty Level"}),e.jsxs("select",{value:m,onChange:v=>I(v.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),e.jsx("button",{onClick:()=>d(2),disabled:!h.trim(),className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Continue"})]}),n===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 rounded-xl",children:[e.jsx("h3",{className:"font-medium text-white mb-1",children:"Topic"}),e.jsx("p",{className:"text-slate-400",children:h})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Duration (minutes)"}),e.jsx("input",{type:"number",value:A,onChange:v=>T(parseInt(v.target.value)||20),min:5,max:120,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Number of Steps"}),e.jsx("input",{type:"number",value:S,onChange:v=>V(parseInt(v.target.value)||6),min:3,max:20,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Content Blocks"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:v=>B(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(me,{className:"w-5 h-5 text-rose-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Video Blocks"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Add placeholder video sections"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:v=>E(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(he,{className:"w-5 h-5 text-emerald-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Image Blocks"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Add placeholder images and diagrams"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:v=>se(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(Se,{className:"w-5 h-5 text-cyan-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Code Snippets"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Syntax-highlighted code examples"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:G,onChange:v=>F(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(Oe,{className:"w-5 h-5 text-indigo-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Additional Resources"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Curated links and downloads"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Interactive Blocks"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:q,onChange:v=>z(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(fe,{className:"w-5 h-5 text-purple-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Quiz & Assessment"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Test learner understanding with questions"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:v=>k(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(Me,{className:"w-5 h-5 text-orange-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Hands-on Mission"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Practical task for learners to complete"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:K,onChange:v=>O(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(Fe,{className:"w-5 h-5 text-violet-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Practice Exercises"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Problems with hints and solutions"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:v=>le(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(be,{className:"w-5 h-5 text-amber-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Data Collection Forms"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Gather learner input and surveys"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Support Blocks"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:v=>X(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(qe,{className:"w-5 h-5 text-blue-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"AI Help / Remediation"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Personalized AI tutoring when struggling"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:oe,onChange:v=>de(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(Te,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Progress Checkpoints"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Validate understanding before continuing"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:ee,onChange:v=>x(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),e.jsx(ze,{className:"w-5 h-5 text-pink-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Animations"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Interactive visual animations"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"AI Research"}),e.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 border border-blue-500/20 rounded-xl cursor-pointer hover:border-blue-500/40 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:v=>H(v.target.checked),className:"w-5 h-5 rounded border-slate-600 text-blue-500 focus:ring-blue-500"}),e.jsx(ht,{className:"w-5 h-5 text-blue-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:"Web Research"}),e.jsx("div",{className:"text-xs text-slate-400",children:"AI will search the web for the latest information on this topic to ensure accurate, up-to-date content"})]}),e.jsx(Je,{className:"w-4 h-4 text-blue-400/50"})]})]}),b&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400",children:[e.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:b})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>d(1),className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"Back"}),e.jsx("button",{onClick:Z,disabled:c,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-all",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"text-sm",children:r})]}):e.jsxs(e.Fragment,{children:[e.jsx(Lt,{className:"w-5 h-5"}),"Generate Course"]})})]})]}),n===3&&P&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl",children:[e.jsx(Ne,{className:"w-6 h-6 text-emerald-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-emerald-400",children:"Course Generated!"}),e.jsxs("div",{className:"text-sm text-slate-400",children:[P.blocks.length," blocks created with proper flow"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-300 mb-3",children:"Generated Structure"}),e.jsx("div",{className:"space-y-2",children:P.blocks.map((v,ce)=>{const pe=v.content,Ye=P.startBlockId===v.id;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-700 flex items-center justify-center text-sm font-medium text-slate-300",children:ce+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:pe?.title||v.type}),Ye&&e.jsx("span",{className:"px-1.5 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded",children:"Start"})]}),e.jsx("div",{className:"text-xs text-slate-500 capitalize",children:v.type})]})]},v.id)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>d(2),className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"Regenerate"}),e.jsxs("button",{onClick:ne,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 transition-all",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Use This Course"]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-900/50",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:[1,2,3].map(v=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${n>=v?"bg-purple-500":"bg-slate-600"}`},v))})})]})})}const je=[{type:"read",label:"Read",icon:ie,color:"bg-blue-500"},{type:"video",label:"Video",icon:me,color:"bg-rose-500"},{type:"image",label:"Image",icon:he,color:"bg-emerald-500"},{type:"quiz",label:"Quiz",icon:fe,color:"bg-purple-500"},{type:"mission",label:"Mission",icon:Me,color:"bg-orange-500"},{type:"form",label:"Form",icon:be,color:"bg-teal-500"},{type:"ai_help",label:"AI Help",icon:qe,color:"bg-cyan-500"},{type:"checkpoint",label:"Checkpoint",icon:Te,color:"bg-amber-500"},{type:"animation",label:"Animation",icon:st,color:"bg-pink-500"},{type:"code",label:"Code",icon:Se,color:"bg-slate-600"},{type:"exercise",label:"Exercise",icon:Fe,color:"bg-violet-500"},{type:"resource",label:"Resources",icon:Oe,color:"bg-indigo-500"}];function cs({moduleId:a,journeyVersionId:s,onBack:i}){const[l,o]=t.useState({startBlockId:"",blocks:[],edges:[]}),[u,n]=t.useState(null),[d,c]=t.useState(!1),[p,b]=t.useState(!1),[C,h]=t.useState(!1),[j,f]=t.useState(null),[y,m]=t.useState(""),[I,A]=t.useState(s),[T,S]=t.useState(!1),[V,D]=t.useState(!1),[B,q]=t.useState(null),[z,w]=t.useState(new Set),[k,L]=t.useState(!1);t.useEffect(()=>{R()},[a,s]),t.useEffect(()=>{if(B){const r=setTimeout(()=>q(null),4e3);return()=>clearTimeout(r)}},[B]);const E=(r,N)=>{q({type:r,message:N})},R=async()=>{const{data:r}=await Q.from("modules").select("title").eq("id",a).single();if(r&&m(r.title),s){const{data:N}=await Q.from("journey_versions").select("graph_json").eq("id",s).single();N?.graph_json&&o(N.graph_json)}},se=async()=>{c(!0);let r=I;try{if(I){const{error:N}=await Q.from("journey_versions").update({graph_json:l}).eq("id",I);if(N)throw N}else{const{data:N,error:M}=await Q.from("journey_versions").insert({module_id:a,version:1,status:"draft",graph_json:l}).select().single();if(M)throw M;N&&(A(N.id),r=N.id)}return S(!1),E("success","Journey saved successfully"),r}catch(N){return console.error("Save error:",N),E("error","Failed to save journey"),null}finally{c(!1)}},K=async()=>{if(l.blocks.length===0){E("error","Cannot publish an empty journey. Add some blocks first.");return}b(!0);try{let r=I;if((!r||T)&&(r=await se()),!r)throw new Error("Failed to save journey before publishing");const{error:N}=await Q.from("journey_versions").update({status:"published"}).eq("id",r);if(N)throw N;const{data:M}=await Q.from("modules").select("track_id").eq("id",a).single();if(M?.track_id){const{error:$}=await Q.from("tracks").update({published_version_id:r}).eq("id",M.track_id);if($)throw $}S(!1),E("success","Journey published successfully! Learners can now access it.")}catch(r){console.error("Publish error:",r),E("error","Failed to publish journey. Please try again.")}finally{b(!1)}},O=t.useCallback(r=>{const N=`block_${Date.now()}`,M={id:N,type:r,content:ds(r)},$=[...l.blocks,M],P=l.startBlockId||N,ae=[...l.edges];if(l.blocks.length>0&&!l.edges.some(Z=>Z.to===N)){const Z=l.blocks[l.blocks.length-1];l.edges.some(ne=>ne.from===Z.id)||ae.push({from:Z.id,to:N})}o({...l,blocks:$,edges:ae,startBlockId:P}),n(N),D(!0),S(!0)},[l]),G=t.useCallback((r,N)=>{const M=l.blocks.map($=>$.id===r?{...$,...N}:$);o({...l,blocks:M}),S(!0)},[l]),F=t.useCallback(r=>{const N=l.blocks.filter(P=>P.id!==r),M=l.edges.filter(P=>P.from!==r&&P.to!==r),$=l.startBlockId===r?N[0]?.id||"":l.startBlockId;o({...l,blocks:N,edges:M,startBlockId:$}),n(null),D(!1),S(!0)},[l]),U=t.useCallback(()=>{const r=z.size,N=l.blocks.filter($=>z.has($.id)).slice(0,5).map($=>$.content?.title||"Untitled").join(", "),M=r<=5?`Delete ${r} block${r>1?"s":""} (${N})?`:`Delete ${r} blocks (${N}, and ${r-5} more)?`;if(confirm(`${M}

All connections to these blocks will also be removed. This action cannot be undone.`)){L(!0);try{const $=Array.from(z),P=l.blocks.filter(ne=>!z.has(ne.id)),ae=l.edges.filter(ne=>!z.has(ne.from)&&!z.has(ne.to));let Z=l.startBlockId;z.has(l.startBlockId)&&(Z=P[0]?.id||""),o({...l,blocks:P,edges:ae,startBlockId:Z}),w(new Set),n(null),D(!1),S(!0),E("success",`Successfully deleted ${r} block${r>1?"s":""}`)}catch($){console.error("Error bulk deleting blocks:",$),E("error","Failed to delete some blocks. Please try again.")}finally{L(!1)}}},[l,z]),le=t.useCallback(r=>{const N=new Set(z);N.has(r)?N.delete(r):N.add(r),w(N)},[z]),J=t.useCallback(()=>{w(new Set(l.blocks.map(r=>r.id)))},[l.blocks]),X=t.useCallback(()=>{w(new Set)},[]),oe=t.useCallback((r,N)=>{if(l.edges.find(P=>P.from===r&&P.to===N)||r===N)return;const $={from:r,to:N};o({...l,edges:[...l.edges,$]}),S(!0)},[l]),de=t.useCallback((r,N)=>{const M=l.edges.filter($=>!($.from===r&&$.to===N));o({...l,edges:M}),S(!0)},[l]),ee=t.useCallback(r=>{o({...l,startBlockId:r}),S(!0)},[l]),x=r=>{j?(j.fromBlockId!==r&&oe(j.fromBlockId,r),f(null)):(n(r),D(!0))},g=r=>{o(r),h(!1),S(!0),E("success","AI-generated content added to journey")};t.useCallback((r,N)=>{o({...l,blocks:r,edges:N}),S(!0)},[l]);const H=l.blocks.find(r=>r.id===u);return e.jsxs("div",{className:"h-full flex flex-col bg-slate-900",children:[B&&e.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg border ${B.type==="success"?"bg-emerald-500/20 border-emerald-500/30 text-emerald-300":B.type==="error"?"bg-red-500/20 border-red-500/30 text-red-300":"bg-blue-500/20 border-blue-500/30 text-blue-300"}`,children:[B.type==="success"?e.jsx(ge,{className:"w-5 h-5"}):B.type==="error"?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:B.message}),e.jsx("button",{onClick:()=>q(null),className:"ml-2 opacity-60 hover:opacity-100",children:e.jsx(xe,{className:"w-4 h-4"})})]}),e.jsx("header",{className:"bg-slate-800 border-b border-slate-700 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:i,className:"flex items-center gap-1 text-slate-400 hover:text-white transition-colors",children:[e.jsx(ve,{className:"w-5 h-5"}),"Back"]}),e.jsx("div",{className:"h-6 w-px bg-slate-700"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:y}),e.jsxs("p",{className:"text-xs text-slate-500",children:[l.blocks.length," blocks, ",l.edges.length," connections",T&&e.jsx("span",{className:"text-amber-400 ml-2",children:"Unsaved changes"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[z.size>0&&e.jsxs("button",{onClick:U,disabled:k,className:"flex items-center gap-2 px-3 py-1.5 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 disabled:opacity-50 transition-colors",children:[k?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"}),"Delete ",z.size]}),e.jsxs("button",{onClick:()=>h(!0),disabled:k,className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg text-sm hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"AI Generate"]}),e.jsxs("button",{onClick:se,disabled:d||!T||k,className:"flex items-center gap-2 px-3 py-1.5 bg-slate-700 text-white rounded-lg text-sm hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[d?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):e.jsx(Tt,{className:"w-4 h-4"}),d?"Saving...":"Save"]}),e.jsxs("button",{onClick:K,disabled:p||l.blocks.length===0||k,className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 disabled:opacity-50 transition-colors",children:[p?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):e.jsx(Pe,{className:"w-4 h-4"}),p?"Publishing...":"Publish"]})]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("aside",{className:"w-64 bg-slate-800 border-r border-slate-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Add Block"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:je.map(({type:r,label:N,icon:M,color:$})=>e.jsxs("button",{onClick:()=>O(r),className:"flex flex-col items-center gap-1.5 p-3 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors group",children:[e.jsx("div",{className:`w-8 h-8 ${$} rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform`,children:e.jsx(M,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:N})]},r))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-300",children:"Block Order"}),l.blocks.length>0&&e.jsx("div",{className:"flex items-center gap-1",children:z.size>0?e.jsxs("button",{onClick:X,className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:["Clear (",z.size,")"]}):e.jsx("button",{onClick:J,className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Select All"})})]}),l.blocks.length===0?e.jsx("p",{className:"text-xs text-slate-500",children:"No blocks yet. Add blocks to build your journey."}):e.jsx("div",{className:"space-y-2",children:l.blocks.map((r,N)=>{const M=je.find(Z=>Z.type===r.type),$=M?.icon||ie,P=l.startBlockId===r.id,ae=u===r.id;return e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg transition-colors ${z.has(r.id)?"bg-blue-600/20 border border-blue-500":ae?"bg-blue-600/10 border border-blue-400":"bg-slate-700/50 hover:bg-slate-700 border border-transparent"}`,children:[e.jsx("input",{type:"checkbox",checked:z.has(r.id),onChange:Z=>{Z.stopPropagation(),le(r.id)},disabled:k,className:"w-4 h-4 rounded border-slate-600 text-blue-600 focus:ring-blue-500 focus:ring-offset-slate-900"}),e.jsxs("div",{onClick:()=>x(r.id),className:"flex items-center gap-2 flex-1 cursor-pointer",children:[e.jsx("div",{className:`w-6 h-6 ${M?.color||"bg-slate-600"} rounded flex items-center justify-center`,children:e.jsx($,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-white truncate",children:r.content?.title||`${M?.label||"Block"} ${N+1}`}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[P&&e.jsx("span",{className:"text-emerald-400",children:"Start"}),!P&&e.jsx("span",{children:M?.label})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!P&&e.jsx("button",{onClick:Z=>{Z.stopPropagation(),ee(r.id)},disabled:k,className:"p-1 text-slate-500 hover:text-emerald-400 rounded disabled:opacity-50",title:"Set as start",children:e.jsx(Te,{className:"w-3 h-3"})}),e.jsx("button",{onClick:Z=>{Z.stopPropagation(),f({fromBlockId:r.id})},disabled:k,className:`p-1 rounded disabled:opacity-50 ${j?.fromBlockId===r.id?"text-blue-400 bg-blue-500/20":"text-slate-500 hover:text-blue-400"}`,title:"Connect to another block",children:e.jsx(ft,{className:"w-3 h-3"})})]})]})]},r.id)})})]}),j&&e.jsx("div",{className:"p-3 bg-blue-600/20 border-t border-blue-500/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-blue-300",children:"Click a block to connect"}),e.jsx("button",{onClick:()=>f(null),className:"text-xs text-blue-400 hover:text-blue-300",children:"Cancel"})]})})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-auto p-6 bg-slate-900/50",children:l.blocks.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center mx-auto mb-4",children:e.jsx(ue,{className:"w-8 h-8 text-slate-600"})}),e.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"Start Building Your Journey"}),e.jsx("p",{className:"text-slate-500 mb-4 max-w-md",children:"Add blocks from the sidebar to create your learning path, or use AI to generate a complete course outline."}),e.jsxs("button",{onClick:()=>h(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-colors",children:[e.jsx(W,{className:"w-5 h-5"}),"Generate with AI"]})]})}):e.jsx("div",{className:"space-y-4",children:l.blocks.map((r,N)=>{const M=je.find(v=>v.type===r.type),$=M?.icon||ie,P=l.startBlockId===r.id,ae=u===r.id,Z=l.edges.filter(v=>v.from===r.id),ne=l.edges.filter(v=>v.to===r.id);return e.jsxs("div",{className:"relative",children:[ne.length>0&&N>0&&e.jsx("div",{className:"flex items-center justify-center py-2",children:e.jsx("div",{className:"w-0.5 h-6 bg-slate-700"})}),e.jsxs("div",{className:`relative p-4 rounded-xl transition-all ${z.has(r.id)?"bg-slate-700 ring-2 ring-blue-500":ae?"bg-slate-700 ring-2 ring-blue-400":"bg-slate-800 hover:bg-slate-700/80"} ${j&&j.fromBlockId!==r.id?"ring-2 ring-blue-400/50 ring-dashed":""}`,children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:z.has(r.id),onChange:v=>{v.stopPropagation(),le(r.id)},disabled:k,className:"w-5 h-5 rounded border-slate-600 text-blue-600 focus:ring-blue-500 focus:ring-offset-slate-900"})}),e.jsxs("div",{onClick:()=>x(r.id),className:"cursor-pointer",children:[P&&e.jsx("div",{className:"absolute -top-2 left-12 px-2 py-0.5 bg-emerald-500 text-white text-xs font-medium rounded",children:"START"}),e.jsxs("div",{className:"flex items-start gap-4 pl-8",children:[e.jsx("div",{className:`w-12 h-12 ${M?.color||"bg-slate-600"} rounded-xl flex items-center justify-center flex-shrink-0`,children:e.jsx($,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:r.content?.title||`${M?.label||"Block"} Block`}),e.jsx("p",{className:"text-sm text-slate-400",children:us(r)}),Z.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Z.map(v=>{const ce=l.blocks.find(pe=>pe.id===v.to);return e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-slate-900/50 rounded text-xs text-slate-400",children:[e.jsx(lt,{className:"w-3 h-3"}),ce?.content?.title||"Next block",v.condition&&e.jsx("span",{className:"text-amber-400 ml-1",children:"(conditional)"}),e.jsx("button",{onClick:pe=>{pe.stopPropagation(),de(v.from,v.to)},className:"ml-1 text-slate-500 hover:text-red-400",children:e.jsx(Dt,{className:"w-3 h-3"})})]},`${v.from}-${v.to}`)})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),n(r.id),D(!0)},disabled:k,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-600 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(_t,{className:"w-4 h-4"})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),F(r.id)},disabled:k,className:"p-2 text-slate-400 hover:text-red-400 hover:bg-slate-600 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(re,{className:"w-4 h-4"})})]})]})]})]})]},r.id)})})})}),V&&H&&e.jsx("aside",{className:"w-96 bg-slate-800 border-l border-slate-700 overflow-y-auto",children:e.jsx(Ht,{block:H,allBlocks:l.blocks,edges:l.edges,onUpdate:r=>G(H.id,r),onAddEdge:(r,N)=>{const M={from:H.id,to:r,condition:N};o({...l,edges:[...l.edges.filter($=>!($.from===H.id&&$.to===r)),M]}),S(!0)},onRemoveEdge:r=>{o({...l,edges:l.edges.filter(N=>!(N.from===H.id&&N.to===r))}),S(!0)},onClose:()=>{D(!1),n(null)}})})]}),C&&e.jsx(os,{onGenerate:g,onClose:()=>h(!1),existingGraph:l})]})}function ds(a){switch(a){case"read":return{title:"New Reading",markdown:`# Title

Your content here...`,estimatedReadTime:3};case"video":return{title:"New Video",url:""};case"image":return{title:"New Image",url:"",caption:"",alt:""};case"quiz":return{title:"Knowledge Check",questions:[],passingScore:50};case"mission":return{title:"New Mission",steps:[]};case"form":return{title:"New Form",fields:[]};case"ai_help":return{title:"AI Help",mode:"targeted_remediation"};case"checkpoint":return{title:"Checkpoint"};case"animation":return{title:"New Animation",animationType:"lottie",url:""};case"code":return{title:"Code Example",code:"// Your code here",language:"javascript",showLineNumbers:!0};case"exercise":return{title:"Practice Exercise",problem:"",solution:"",hints:[]};case"resource":return{title:"Resources",resources:[]};default:return{title:"New Block"}}}function us(a){const s=a.content;switch(a.type){case"read":return`${s.estimatedReadTime||0} min read`;case"video":return s.url?"Video attached":"No video set";case"image":return s.url?"Image attached":"No image set";case"quiz":const i=s.questions||[];return`${i.length} question${i.length!==1?"s":""}, ${s.passingScore||50}% to pass`;case"mission":const l=s.steps||[];return`${l.length} step${l.length!==1?"s":""}`;case"form":const o=s.fields||[];return`${o.length} field${o.length!==1?"s":""}`;case"ai_help":return`Mode: ${s.mode||"remediation"}`;case"checkpoint":return"Progress checkpoint";case"animation":return s.animationType||"Animation";case"code":return s.language||"Code snippet";case"exercise":const u=s.hints||[];return`${u.length} hint${u.length!==1?"s":""}`;case"resource":const n=s.resources||[];return`${n.length} resource${n.length!==1?"s":""}`;default:return""}}function xs(){const{enabled:a,isLoading:s}=Ie(),[i,l]=t.useState("content"),[o,u]=t.useState(""),[n,d]=t.useState("beginners"),[c,p]=t.useState(""),[b,C]=t.useState(""),[h,j]=t.useState(!1),[f,y]=t.useState(!1),m=async()=>{if(o.trim()){j(!0),C("");try{const S=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:i,topic:o,targetAudience:n,existingContent:c||void 0})})).json();S.error?C(`Error: ${S.error}`):S.result&&(typeof S.result=="string"?C(S.result):C(JSON.stringify(S.result,null,2)))}catch(T){C(`Error: ${T instanceof Error?T.message:"Generation failed"}`)}finally{j(!1)}}},I=()=>{navigator.clipboard.writeText(b),y(!0),setTimeout(()=>y(!1),2e3)},A=[{id:"content",label:"Reading Content",icon:be,description:"Generate educational markdown content"},{id:"quiz",label:"Quiz Questions",icon:fe,description:"Generate assessment questions with answers"},{id:"video_script",label:"Video Script",icon:me,description:"Generate video narration scripts"}];return s?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(Y,{className:"w-8 h-8 text-purple-500 animate-spin"})}):a?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"AI Content Studio"}),e.jsx("p",{className:"text-slate-400",children:"Generate educational content with AI assistance"})]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-96 border-r border-slate-700 p-6 overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"What to Generate"}),e.jsx("div",{className:"space-y-2",children:A.map(T=>{const S=T.icon,V=i===T.id;return e.jsxs("button",{onClick:()=>l(T.id),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-colors text-left ${V?"bg-purple-600/20 border border-purple-500":"bg-slate-800 border border-slate-700 hover:bg-slate-700"}`,children:[e.jsx(S,{className:`w-5 h-5 ${V?"text-purple-400":"text-slate-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${V?"text-purple-300":"text-white"}`,children:T.label}),e.jsx("div",{className:"text-xs text-slate-500",children:T.description})]})]},T.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Topic / Subject"}),e.jsx("textarea",{value:o,onChange:T=>u(T.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"What topic should the content cover?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Audience"}),e.jsxs("select",{value:n,onChange:T=>d(T.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"beginners",children:"Complete Beginners"}),e.jsx("option",{value:"students",children:"Students"}),e.jsx("option",{value:"professionals",children:"Professionals"}),e.jsx("option",{value:"technical",children:"Technical Audience"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Existing Content (optional)"}),e.jsx("textarea",{value:c,onChange:T=>p(T.target.value),rows:4,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"Paste existing content to expand upon..."})]}),e.jsx("button",{onClick:m,disabled:!o.trim()||h,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-5 h-5"}),"Generate"]})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white",children:"Generated Output"}),b&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:m,disabled:h,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:[e.jsx(at,{className:`w-4 h-4 ${h?"animate-spin":""}`}),"Regenerate"]}),e.jsx("button",{onClick:I,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:f?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4 text-emerald-400"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"w-4 h-4"}),"Copy"]})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:h?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"w-12 h-12 text-purple-500 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Generating content..."}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"This may take a moment"})]})}):b?e.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:e.jsx("pre",{className:"text-slate-200 text-sm whitespace-pre-wrap font-mono",children:b})}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Generated content will appear here"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Fill in the form and click Generate to start"})]})})})]})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"AI Content Studio"}),e.jsx("p",{className:"text-slate-400",children:"Generate educational content with AI assistance"})]})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsx(Ge,{})})]})}function Be(a){return a.startsWith("/admin/builder")?"builder":a.startsWith("/admin/tracks")?"tracks":a.startsWith("/admin/ai-studio")?"ai-studio":a.startsWith("/admin/settings")?"settings":"dashboard"}function bs({onExit:a,onSettingsChanged:s}){const i=Re(),l=De(),[o,u]=t.useState(()=>Be(i.pathname)),[n,d]=t.useState(null);t.useEffect(()=>{const C=Be(i.pathname);C!==o&&u(C)},[i.pathname]);const c=(C,h)=>{d({moduleId:C,journeyVersionId:h}),u("builder"),l(`/admin/builder/${C}${h?`?v=${h}`:""}`)},p=()=>{d(null),u("tracks"),l("/admin/tracks")},b=()=>{if(n&&o==="builder")return e.jsx(cs,{moduleId:n.moduleId,journeyVersionId:n.journeyVersionId,onBack:p});switch(o){case"dashboard":return e.jsx(hs,{onNavigate:u});case"tracks":return e.jsx(Ot,{onEditJourney:c});case"builder":return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_e,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-400 mb-2",children:"Journey Builder"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"Select a module from Tracks to edit its journey"}),e.jsx("button",{onClick:()=>u("tracks"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Tracks"})]})});case"ai-studio":return e.jsx(xs,{});case"settings":return e.jsx(ms,{onSettingsChanged:s});default:return null}};return e.jsx(zt,{activeTab:o,onTabChange:u,onExit:a,children:b()})}function hs({onNavigate:a}){const[s,i]=t.useState({totalTracks:0,activeLearners:0,avgCompletion:0,totalHours:0}),[l,o]=t.useState(!0);t.useEffect(()=>{u()},[]);const u=async()=>{try{const{supabase:d}=await we(async()=>{const{supabase:A}=await import("./index-CYe1HlWo.js").then(T=>T.G);return{supabase:A}},__vite__mapDeps([0,1])),{count:c}=await d.from("tracks").select("*",{count:"exact",head:!0}),{data:p}=await d.from("user_journey_runs").select("user_id"),b=new Set(p?.map(A=>A.user_id)||[]),{data:C}=await d.from("user_journey_runs").select("status"),h=C?.length||0,j=C?.filter(A=>A.status==="completed").length||0,f=h>0?Math.round(j/h*100):0,{data:y}=await d.from("user_block_states").select("time_spent_seconds"),m=y?.reduce((A,T)=>A+(T.time_spent_seconds||0),0)||0,I=Math.round(m/3600);i({totalTracks:c||0,activeLearners:b.size,avgCompletion:f,totalHours:I})}catch(d){console.error("Error loading dashboard stats:",d)}finally{o(!1)}},n=[{label:"Total Tracks",value:l?"...":String(s.totalTracks),icon:ie,color:"bg-blue-500"},{label:"Active Learners",value:l?"...":String(s.activeLearners),icon:Rt,color:"bg-emerald-500"},{label:"Avg. Completion",value:l?"...":`${s.avgCompletion}%`,icon:nt,color:"bg-purple-500"},{label:"Total Hours",value:l?"...":String(s.totalHours),icon:it,color:"bg-amber-500"}];return e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Admin Dashboard"}),e.jsx("p",{className:"text-slate-400",children:"Manage your learning content and track performance"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:n.map(d=>{const c=d.icon;return e.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 ${d.color} rounded-xl flex items-center justify-center`,children:e.jsx(c,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:d.value}),e.jsx("div",{className:"text-sm text-slate-400",children:d.label})]})]})},d.label)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>a("tracks"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:"Create New Track"}),e.jsx("div",{className:"text-sm text-slate-400",children:"Start a new learning path"})]})]}),e.jsxs("button",{onClick:()=>a("ai-studio"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:"AI Content Studio"}),e.jsx("div",{className:"text-sm text-slate-400",children:"Generate content with AI"})]})]}),e.jsxs("button",{onClick:()=>a("tracks"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:"Edit Existing Journey"}),e.jsx("div",{className:"text-sm text-slate-400",children:"Modify course content"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Recent Activity"}),e.jsx("div",{className:"space-y-4",children:[{action:"Track published",item:"GenAI Fundamentals",time:"2 hours ago"},{action:"Module created",item:"Advanced Prompting",time:"5 hours ago"},{action:"Quiz updated",item:"Knowledge Check #3",time:"1 day ago"},{action:"New learner enrolled",item:"John D.",time:"2 days ago"}].map((d,c)=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700 last:border-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:d.action}),e.jsx("div",{className:"text-xs text-slate-500",children:d.item})]}),e.jsx("div",{className:"text-xs text-slate-500",children:d.time})]},c))})]})]})]})})}function ms({onSettingsChanged:a}){const[s,i]=t.useState("Learning Hub"),[l,o]=t.useState("English"),[u,n]=t.useState("gpt-4o"),[d,c]=t.useState("gpt-4o-mini"),[p,b]=t.useState(!0),[C,h]=t.useState(!0),[j,f]=t.useState(!1),[y,m]=t.useState(null);t.useEffect(()=>{I()},[]);const I=async()=>{try{const{supabase:S}=await we(async()=>{const{supabase:B}=await import("./index-CYe1HlWo.js").then(q=>q.G);return{supabase:B}},__vite__mapDeps([0,1])),{data:V,error:D}=await S.from("system_settings").select("setting_key, setting_value").in("setting_key",["ai_content_model","ai_help_model","platform_name","default_language","ai_enabled"]);if(D)throw D;V&&V.forEach(B=>{switch(B.setting_key){case"ai_content_model":n(B.setting_value);break;case"ai_help_model":c(B.setting_value);break;case"platform_name":i(B.setting_value);break;case"default_language":o(B.setting_value);break;case"ai_enabled":b(B.setting_value==="true");break}})}catch(S){console.error("Error loading settings:",S),m({type:"error",text:"Failed to load settings. Please check your connection and try again."})}finally{h(!1)}},A=async()=>{f(!0),m(null);try{const{supabase:S}=await we(async()=>{const{supabase:D}=await import("./index-CYe1HlWo.js").then(B=>B.G);return{supabase:D}},__vite__mapDeps([0,1])),V=[{setting_key:"ai_content_model",setting_value:u},{setting_key:"ai_help_model",setting_value:d},{setting_key:"platform_name",setting_value:s},{setting_key:"default_language",setting_value:l},{setting_key:"ai_enabled",setting_value:String(p)}];for(const D of V){const{error:B}=await S.from("system_settings").upsert({setting_key:D.setting_key,setting_value:D.setting_value,category:D.setting_key.startsWith("ai_")?"ai":"general",description:T(D.setting_key)},{onConflict:"setting_key"});if(B)throw console.error(`Error saving ${D.setting_key}:`,B),B}m({type:"success",text:"Settings saved successfully!"}),setTimeout(()=>m(null),3e3),a&&a()}catch(S){console.error("Error saving settings:",S),m({type:"error",text:"Failed to save settings. Please try again."})}finally{f(!1)}},T=S=>({ai_content_model:"AI model used for content generation in AI Studio",ai_help_model:"AI model used for student help and assistance",platform_name:"Platform display name",default_language:"Default content language",ai_enabled:"Whether AI content generation is enabled"})[S]||"";return C?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"text-slate-400",children:"Loading settings..."})}):e.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"Settings"}),e.jsxs("div",{className:"max-w-2xl space-y-6",children:[e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"General Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Platform Name"}),e.jsx("input",{type:"text",value:s,onChange:S=>i(S.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter platform name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Default Language"}),e.jsxs("select",{value:l,onChange:S=>o(S.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"English",children:"English"}),e.jsx("option",{value:"Arabic",children:"Arabic"}),e.jsx("option",{value:"Spanish",children:"Spanish"}),e.jsx("option",{value:"French",children:"French"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"AI Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Content Generation Model"}),e.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for AI Studio and course generation"}),e.jsxs("select",{value:u,onChange:S=>n(S.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"gpt-4o",children:"GPT-4o (Recommended)"}),e.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o-mini (Faster)"}),e.jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),e.jsx("option",{value:"gpt-5.2",children:"GPT-5.2 (Latest)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"AI Help Model"}),e.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for student assistance and tutoring"}),e.jsxs("select",{value:d,onChange:S=>c(S.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"gpt-4o",children:"GPT-4o (Recommended)"}),e.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o-mini (Faster, Cost-effective)"}),e.jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),e.jsx("option",{value:"gpt-5.2",children:"GPT-5.2 (Latest)"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-300",children:"Enable AI Content Generation"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Allow AI to generate course content"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:S=>b(S.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]}),y&&e.jsx("div",{className:`p-4 rounded-lg ${y.type==="success"?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"}`,children:y.text}),e.jsx("button",{onClick:A,disabled:j,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Saving...":"Save Settings"})]})]})}const ps={read:e.jsx(ie,{className:"w-5 h-5 text-blue-400"}),video:e.jsx(me,{className:"w-5 h-5 text-rose-400"}),quiz:e.jsx(fe,{className:"w-5 h-5 text-purple-400"}),mission:e.jsx(Me,{className:"w-5 h-5 text-orange-400"}),form:e.jsx(yt,{className:"w-5 h-5 text-cyan-400"}),checkpoint:e.jsx(Ne,{className:"w-5 h-5 text-emerald-400"}),ai_help:e.jsx(W,{className:"w-5 h-5 text-amber-400"}),animation:e.jsx(It,{className:"w-5 h-5 text-pink-400"})},$e={read:"قراءة",video:"فيديو",quiz:"اختبار",mission:"مهمة",form:"نموذج",checkpoint:"نقطة تفتيش",ai_help:"مساعد ذكي",animation:"رسوم متحركة"};function fs({blocks:a,edges:s,startBlockId:i,onReorder:l,onEditBlock:o,onDeleteBlock:u,onSetStart:n}){const[d,c]=t.useState(null),[p,b]=t.useState(null),[C,h]=t.useState(new Set),j=t.useRef(null),f=t.useCallback((w,k)=>{c(k),w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",k.toString()),j.current&&(j.current.style.opacity="0.5")},[]),y=t.useCallback((w,k)=>{w.preventDefault(),w.dataTransfer.dropEffect="move",d!==null&&d!==k&&b(k)},[d]),m=t.useCallback(()=>{b(null)},[]),I=t.useCallback((w,k)=>{if(w.preventDefault(),d===null||d===k){c(null),b(null);return}const L=[...a],[E]=L.splice(d,1);L.splice(k,0,E);const R=D(L,s);l(L,R),c(null),b(null)},[d,a,s,l]),A=t.useCallback(()=>{c(null),b(null)},[]),T=t.useCallback((w,k)=>{c(k)},[]),S=t.useCallback(w=>{if(d===null)return;const k=w.touches[0],E=document.elementsFromPoint(k.clientX,k.clientY).find(R=>R.hasAttribute("data-block-index"));if(E){const R=parseInt(E.getAttribute("data-block-index")||"-1");R!==-1&&R!==d&&b(R)}},[d]),V=t.useCallback(w=>{if(d!==null&&p!==null&&d!==p){const k=[...a],[L]=k.splice(d,1);k.splice(p,0,L);const E=D(k,s);l(k,E)}c(null),b(null)},[d,p,a,s,l]),D=(w,k)=>{const L=k.filter(R=>R.condition),E=[];for(let R=0;R<w.length-1;R++){const se=w[R],K=w[R+1];L.some(G=>G.from===se.id)||E.push({from:se.id,to:K.id})}return[...E,...L]},B=w=>{const k=new Set(C);k.has(w)?k.delete(w):k.add(w),h(k)},q=w=>s.filter(k=>k.from===w),z=(w,k)=>{const L=k==="up"?w-1:w+1;if(L<0||L>=a.length)return;const E=[...a];[E[w],E[L]]=[E[L],E[w]];const R=D(E,s);l(E,R)};return e.jsxs("div",{className:"space-y-2",children:[a.map((w,k)=>{const L=w.content,E=i===w.id,R=d===k,se=p===k,K=C.has(w.id),O=q(w.id),G=O.some(F=>F.condition);return e.jsxs("div",{ref:R?j:null,"data-block-index":k,draggable:!0,onDragStart:F=>f(F,k),onDragOver:F=>y(F,k),onDragLeave:m,onDrop:F=>I(F,k),onDragEnd:A,onTouchStart:F=>T(F,k),onTouchMove:S,onTouchEnd:V,className:`
              bg-slate-800 rounded-xl border transition-all
              ${R?"dragging border-blue-500":"border-slate-700"}
              ${se?"border-blue-500 border-dashed bg-blue-500/10":""}
            `,children:[e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("div",{className:"drag-handle p-1 text-slate-500 hover:text-slate-300 touch-manipulation",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-700 flex items-center justify-center flex-shrink-0",children:ps[w.type]||e.jsx(ie,{className:"w-5 h-5 text-slate-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white truncate",children:L?.title||$e[w.type]||w.type}),E&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded-full flex-shrink-0",children:"البداية"}),G&&e.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full flex-shrink-0 flex items-center gap-1",children:[e.jsx(xt,{className:"w-3 h-3"}),"تفرع"]})]}),e.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:$e[w.type]||w.type})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>z(k,"up"),disabled:k===0,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"نقل للأعلى",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(k,"down"),disabled:k===a.length-1,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"نقل للأسفل",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(w.id),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"تفاصيل",children:K?e.jsx(Ce,{className:"w-4 h-4"}):e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>o(w),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"تعديل",children:e.jsx(Et,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(w.id),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",title:"حذف",children:e.jsx(re,{className:"w-4 h-4"})})]})]}),K&&e.jsx("div",{className:"px-4 pb-4 border-t border-slate-700 mt-2 pt-4",children:e.jsxs("div",{className:"space-y-3",children:[!E&&e.jsx("button",{onClick:()=>n(w.id),className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",children:"تعيين كنقطة بداية"}),O.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"الاتصالات:"}),e.jsx("div",{className:"space-y-1",children:O.map((F,U)=>{const J=a.find(X=>X.id===F.to)?.content;return e.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-2",children:[e.jsx("span",{className:"text-slate-600",children:"→"}),e.jsx("span",{children:J?.title||F.to}),F.condition&&e.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded",children:"شرطي"})]},U)})})]})]})})]},w.id)}),a.length===0&&e.jsx("div",{className:"text-center py-12 text-slate-500",children:"لا توجد كتل. أضف كتلة للبدء."})]})}export{os as AIContentGenerator,xs as AIStudio,zt as AdminLayout,bs as AdminPage,Ht as BlockEditor,fs as DraggableBlockList,cs as JourneyBuilder,Ot as TrackManager};

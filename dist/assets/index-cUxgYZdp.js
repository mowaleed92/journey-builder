const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BTAm5qeQ.js","assets/index-Cz_ZwvAy.css"])))=>i.map(i=>d[i]);
import{r as rl,c as ie,a as b,u as fo,b as mo,j as n,B as He,S as we,d as ol,L as fe,C as In,e as po,s as be,f as il,X as Ct,g as xo,h as al,R as ll,A as It,P as go,i as $t,_ as xn,k as dn,T as An,l as cl,m as dl,n as ul}from"./index-BTAm5qeQ.js";import{C as ds,I as nt,U as Tn,V as ut,L as bo,a as $n,P as hl,R as fl,D as ml,u as Cs,F as Ft,A as yo,E as pl,b as Ss,H as Gt,c as _s,B as Es,d as Pn,e as vo,f as xl}from"./useAIEnabled-DjOQSQKw.js";rl();const gl=ie("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);const bl=ie("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);const yl=ie("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);const wo=ie("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const vl=ie("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);const gn=ie("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const bn=ie("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const wl=ie("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);const jl=ie("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const Ms=ie("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const Nl=ie("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);const kl=ie("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);const Cl=ie("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);const Is=ie("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const Sl=ie("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const _l=ie("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const El=ie("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);const Ml=ie("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);const Il=ie("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const Al=ie("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Tl=ie("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const $l=ie("MonitorPlay",[["path",{d:"m10 7 5 3-5 3Z",key:"29ljg6"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]);const Pl=ie("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);const Dl=ie("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);const Rl=ie("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);const et=ie("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const zl=ie("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);const Ll=ie("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);const Bl=ie("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);const jo=ie("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const Hl=ie("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);const Ol=ie("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);const No=ie("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const $e=ie("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Vl=ie("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);const Fl=ie("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);const Gl=ie("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const Ul=ie("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);function ql({children:e,activeTab:t,onTabChange:s,onExit:r}){const[o,a]=b.useState(!1),i=fo(),l=mo(),c=[{id:"dashboard",label:"Dashboard",icon:Sl,path:"/admin"},{id:"tracks",label:"Tracks",icon:He,path:"/admin/tracks"},{id:"builder",label:"Journey Builder",icon:Is,path:"/admin/builder"},{id:"ai-studio",label:"AI Studio",icon:we,path:"/admin/ai-studio"},{id:"settings",label:"Settings",icon:ol,path:"/admin/settings"}],d=u=>{i(u.path),s(u.id)},f=(()=>{const u=l.pathname;return u.startsWith("/admin/builder")?"builder":u.startsWith("/admin/tracks")?"tracks":u.startsWith("/admin/ai-studio")?"ai-studio":u.startsWith("/admin/settings")?"settings":"dashboard"})();return n.jsxs("div",{className:"min-h-screen bg-slate-900 flex",children:[n.jsxs("aside",{className:`bg-slate-800 border-r border-slate-700 flex flex-col transition-all duration-300 ${o?"w-16":"w-64"}`,children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[!o&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("img",{src:"https://res.cloudinary.com/dujh5xuoi/image/upload/v1754423073/%D8%AA%D8%B9%D9%84%D9%91%D9%85_AIFinal_edvr4e.png",alt:"Platform logo",className:"max-h-8 w-auto object-contain"}),n.jsx("span",{className:"font-bold text-white",children:"Admin"})]}),n.jsx("button",{onClick:()=>a(!o),className:"p-1.5 rounded-lg hover:bg-slate-700 text-slate-400 transition-colors",children:n.jsx(ds,{className:`w-5 h-5 transition-transform ${o?"rotate-180":""}`})})]}),n.jsx("nav",{className:"flex-1 p-2 space-y-1",role:"navigation","aria-label":"Admin navigation",children:c.map(u=>{const p=u.icon,x=f===u.id||t===u.id;return n.jsxs("button",{onClick:()=>d(u),"aria-label":u.label,"aria-current":x?"page":void 0,className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors ${x?"bg-blue-600 text-white":"text-slate-400 hover:bg-slate-700 hover:text-white"}`,children:[n.jsx(p,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),!o&&n.jsx("span",{className:"font-medium",children:u.label})]},u.id)})}),n.jsx("div",{className:"p-2 border-t border-slate-700",children:n.jsxs("button",{onClick:r,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-400 hover:bg-slate-700 hover:text-white transition-colors",children:[n.jsx(ds,{className:"w-5 h-5 flex-shrink-0"}),!o&&n.jsx("span",{className:"font-medium",children:"Back to App"})]})})]}),n.jsx("main",{className:"flex-1 overflow-hidden",children:e})]})}function Yl({selectedCount:e,totalCount:t,onSelectAll:s,onSelectNone:r,onDelete:o,isDeleting:a=!1,itemName:i="items"}){return e===0?null:n.jsxs("div",{className:"sticky top-0 z-10 bg-slate-800 border-b border-slate-700 px-4 py-3 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("span",{className:"text-sm font-medium text-white",children:[e," of ",t," ",i," selected"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[e<t?n.jsxs("button",{onClick:s,disabled:a,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[n.jsx(vl,{className:"w-4 h-4"}),"Select All"]}):null,n.jsxs("button",{onClick:r,disabled:a,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[n.jsx(No,{className:"w-4 h-4"}),"Clear Selection"]})]})]}),n.jsx("button",{onClick:o,disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",children:a?n.jsxs(n.Fragment,{children:[n.jsx(fe,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):n.jsxs(n.Fragment,{children:[n.jsx($e,{className:"w-4 h-4"}),"Delete Selected (",e,")"]})})]})}function Zl({isSelected:e,onToggleSelect:t,children:s,className:r="",disabled:o=!1}){return n.jsxs("div",{className:`relative group ${r} ${e?"ring-2 ring-blue-500":""} ${o?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:a=>{const i=a.target,l=i.closest("button"),c=i.closest("input, textarea, select");!l&&!c&&!o&&t()},children:[n.jsx("div",{className:`absolute top-3 left-3 z-10 w-6 h-6 rounded border-2 flex items-center justify-center transition-all ${e?"bg-blue-600 border-blue-600":"bg-slate-700 border-slate-600 group-hover:border-slate-500"}`,onClick:a=>{a.stopPropagation(),o||t()},children:e&&n.jsx(In,{className:"w-4 h-4 text-white"})}),s]})}const ko=["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3184325/pexels-photo-3184325.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181676/pexels-photo-1181676.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/4050315/pexels-photo-4050315.jpeg?auto=compress&cs=tinysrgb&w=800"],yn=e=>/(https?:\/\/[^\s]+)|(www\.[^\s]+)|([a-zA-Z0-9-]+\.(com|net|org|io|dev|jpg|png|jpeg|gif|webp)[^\s]*)/gi.test(e);function Xl({onEditJourney:e}){const{showToast:t}=po(),[s,r]=b.useState([]),[o,a]=b.useState(!0),[i,l]=b.useState(""),[c,d]=b.useState(!1),[h,f]=b.useState(null),[u,p]=b.useState(null),[x,g]=b.useState(null),[y,v]=b.useState(null),[k,m]=b.useState(!1),[j,E]=b.useState(!1),[w,C]=b.useState(!1),[I,T]=b.useState(new Set),[$,S]=b.useState(new Set),[P,H]=b.useState(!1);b.useEffect(()=>{N()},[]);const N=async()=>{a(!0);const{data:B}=await be.from("tracks").select(`
        *,
        modules (
          *,
          journey_versions (id, status, version)
        )
      `).order("created_at",{ascending:!1});B&&r(B),a(!1)},M=async B=>{m(!0);try{const{error:R}=await be.from("tracks").insert({title:B.title,description:B.description,level:B.level,cover_image_url:B.cover_image_url||null,tags:JSON.stringify([])});if(R)throw R;t("success","Track created successfully"),await N(),d(!1)}catch(R){console.error("Error creating track:",R),t("error","Failed to create track. Please try again.")}finally{m(!1)}},_=async(B,R)=>{E(!0);try{const W=s.find(ae=>ae.id===B)?.modules?.length||0,{data:se,error:q}=await be.from("modules").insert({track_id:B,title:R.title,description:R.description,order_index:W}).select().single();if(q)throw q;if(!se)throw new Error("Module creation failed");const{data:K,error:re}=await be.from("journey_versions").insert({module_id:se.id,version:1,status:"draft",graph_json:{startBlockId:"",blocks:[],edges:[]}}).select().single();re?(console.error("Error creating journey version:",re),t("warning","Module created but journey setup failed. Please try editing the module.")):t("success","Module created successfully"),await N(),f(null),K&&e(se.id,K.id)}catch(J){console.error("Error creating module:",J),t("error","Failed to create module. Please try again.")}finally{E(!1)}},D=async B=>{if(confirm("Are you sure you want to delete this track and all its modules?")){g(B);try{const{error:R}=await be.from("tracks").delete().eq("id",B);if(R)throw R;t("success","Track deleted successfully"),await N()}catch(R){console.error("Error deleting track:",R),t("error","Failed to delete track. Please try again.")}finally{g(null)}}},A=async B=>{if(confirm("Are you sure you want to delete this module?")){v(B);try{const{error:R}=await be.from("modules").delete().eq("id",B);if(R)throw R;t("success","Module deleted successfully"),await N()}catch(R){console.error("Error deleting module:",R),t("error","Failed to delete module. Please try again.")}finally{v(null)}}},z=async()=>{const B=I.size,R=s.filter(W=>I.has(W.id)).slice(0,5).map(W=>W.title).join(", "),J=B<=5?`Delete ${B} track${B>1?"s":""} (${R})?`:`Delete ${B} tracks (${R}, and ${B-5} more)?`;if(confirm(`${J}

This will also delete all associated modules and content. This action cannot be undone.`)){H(!0);try{const{error:W}=await be.from("tracks").delete().in("id",Array.from(I));if(W)throw W;t("success",`Successfully deleted ${B} track${B>1?"s":""}`),T(new Set),await N()}catch(W){console.error("Error bulk deleting tracks:",W),t("error","Failed to delete some tracks. Please try again.")}finally{H(!1)}}},O=async()=>{const B=$.size,R=s.flatMap(W=>W.modules||[]).filter(W=>$.has(W.id)).slice(0,5).map(W=>W.title).join(", "),J=B<=5?`Delete ${B} module${B>1?"s":""} (${R})?`:`Delete ${B} modules (${R}, and ${B-5} more)?`;if(confirm(`${J}

This will also delete all associated journeys and content. This action cannot be undone.`)){H(!0);try{const{error:W}=await be.from("modules").delete().in("id",Array.from($));if(W)throw W;t("success",`Successfully deleted ${B} module${B>1?"s":""}`),S(new Set),await N()}catch(W){console.error("Error bulk deleting modules:",W),t("error","Failed to delete some modules. Please try again.")}finally{H(!1)}}},F=B=>{const R=new Set(I);R.has(B)?R.delete(B):R.add(B),T(R)},V=B=>{const R=new Set($);R.has(B)?R.delete(B):R.add(B),S(R)},Q=()=>{T(new Set(Z.map(B=>B.id)))},X=B=>{const R=s.find(W=>W.id===B);if(!R)return;const J=(R.modules||[]).map(W=>W.id);S(new Set([...$,...J]))},te=()=>{T(new Set)},Z=s.filter(B=>B.title.toLowerCase().includes(i.toLowerCase()));return n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsxs("div",{className:"p-6 border-b border-slate-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"Track Manager"}),n.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[n.jsx(et,{className:"w-5 h-5"}),"New Track"]})]}),n.jsxs("div",{className:"relative",children:[n.jsx(jo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500"}),n.jsx("input",{type:"text",placeholder:"Search tracks...",value:i,onChange:B=>l(B.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:o?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(fe,{className:"w-8 h-8 text-primary-500 animate-spin"})}):Z.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(He,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"No tracks yet"}),n.jsx("p",{className:"text-slate-500 mb-4",children:"Create your first learning track to get started"}),n.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[n.jsx(et,{className:"w-5 h-5"}),"Create Track"]})]}):n.jsxs(n.Fragment,{children:[n.jsx(Yl,{selectedCount:I.size,totalCount:Z.length,onSelectAll:Q,onSelectNone:te,onDelete:z,isDeleting:P,itemName:"tracks"}),n.jsx("div",{className:"p-6 space-y-4",children:Z.map(B=>n.jsxs(Zl,{isSelected:I.has(B.id),onToggleSelect:()=>F(B.id),disabled:P,className:"bg-slate-800 border border-slate-700 rounded-xl overflow-hidden",children:[n.jsxs("div",{className:"p-4 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4 pl-8",children:[B.cover_image_url?n.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden flex-shrink-0",children:n.jsx("img",{src:B.cover_image_url,alt:B.title,className:"w-full h-full object-cover"})}):n.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center flex-shrink-0",children:n.jsx(He,{className:"w-8 h-8 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-white",children:B.title}),n.jsx("p",{className:"text-sm text-slate-400",children:B.description||"No description"}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${B.level==="beginner"?"bg-emerald-500/20 text-emerald-400":B.level==="intermediate"?"bg-warning/20 text-warning":"bg-rose-500/20 text-rose-400"}`,children:B.level}),n.jsxs("span",{className:"text-xs text-slate-500",children:[B.modules?.length||0," modules"]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:R=>{R.stopPropagation(),p(B)},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",disabled:x===B.id||P,children:n.jsx(Dl,{className:"w-5 h-5"})}),n.jsx("button",{onClick:R=>{R.stopPropagation(),D(B.id)},disabled:x===B.id||P,className:"p-2 text-slate-400 hover:text-error hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:x===B.id?n.jsx(fe,{className:"w-5 h-5 animate-spin"}):n.jsx($e,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"border-t border-slate-700",children:[$.size>0&&(B.modules||[]).some(R=>$.has(R.id))&&n.jsxs("div",{className:"bg-slate-900/50 px-4 py-2 border-b border-slate-700 flex items-center justify-between",children:[n.jsxs("span",{className:"text-sm text-slate-400",children:[(B.modules||[]).filter(R=>$.has(R.id)).length," module",(B.modules||[]).filter(R=>$.has(R.id)).length>1?"s":""," selected"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:R=>{R.stopPropagation(),X(B.id)},className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Select All"}),n.jsx("button",{onClick:R=>{R.stopPropagation(),O()},disabled:P,className:"text-xs px-2 py-1 bg-error text-white rounded hover:bg-error/90 disabled:opacity-50 transition-colors",children:"Delete Selected"})]})]}),B.modules?.map(R=>{const J=R.journey_versions?.find(q=>q.status==="published"),W=R.journey_versions?.find(q=>q.status==="draft"),se=J||W;return n.jsxs("div",{className:`px-4 py-3 flex items-center justify-between hover:bg-slate-700/50 transition-colors border-b border-slate-700 last:border-b-0 ${$.has(R.id)?"bg-primary-500/10":""}`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",checked:$.has(R.id),onChange:q=>{q.stopPropagation(),V(R.id)},disabled:P,className:"w-4 h-4 rounded border-slate-600 text-primary-600 focus:ring-primary-500 focus:ring-offset-slate-900"}),n.jsx("div",{className:"w-8 h-8 rounded bg-slate-700 flex items-center justify-center text-sm font-medium text-slate-300",children:R.order_index+1}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-slate-200",children:R.title}),n.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[J&&n.jsx("span",{className:"text-emerald-400",children:"Published"}),W&&!J&&n.jsx("span",{className:"text-warning",children:"Draft"}),!se&&n.jsx("span",{className:"text-slate-500",children:"No content"})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:q=>{q.stopPropagation(),e(R.id,se?.id)},className:"flex items-center gap-1 px-3 py-1.5 text-sm text-primary-400 hover:text-primary-300 hover:bg-primary-500/10 rounded-lg transition-colors",children:["Edit Journey",n.jsx(il,{className:"w-4 h-4"})]}),n.jsx("button",{onClick:q=>{q.stopPropagation(),A(R.id)},disabled:y===R.id||P,className:"p-1.5 text-slate-500 hover:text-error rounded transition-colors disabled:opacity-50",children:y===R.id?n.jsx(fe,{className:"w-4 h-4 animate-spin"}):n.jsx($e,{className:"w-4 h-4"})})]})]},R.id)}),n.jsxs("button",{onClick:R=>{R.stopPropagation(),f(B.id)},disabled:P,className:"w-full px-4 py-3 flex items-center justify-center gap-2 text-slate-400 hover:text-white hover:bg-slate-700/50 transition-colors disabled:opacity-50",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Module"]})]})]},B.id))})]})}),c&&n.jsx(Wl,{onClose:()=>d(!1),onCreate:M,isCreating:k}),h&&n.jsx(Jl,{onClose:()=>f(null),onCreate:B=>_(h,B),isCreating:j}),u&&n.jsx(Ql,{track:u,onClose:()=>p(null),isSaving:w,onSave:async B=>{C(!0);try{const{error:R}=await be.from("tracks").update(B).eq("id",u.id);if(R)throw R;t("success","Track updated successfully"),await N(),p(null)}catch(R){console.error("Error updating track:",R),t("error","Failed to update track. Please try again.")}finally{C(!1)}}})]})}function Wl({onClose:e,onCreate:t,isCreating:s}){const[r,o]=b.useState(""),[a,i]=b.useState(""),[l,c]=b.useState("beginner"),[d,h]=b.useState(""),[f,u]=b.useState(!1),[p,x]=b.useState(!1),[g,y]=b.useState(""),[v,k]=b.useState(""),m=w=>{o(w),yn(w)?y("Title cannot contain URLs. Please use the cover image field for images."):y("")},j=w=>{i(w),yn(w)?k("Description cannot contain URLs."):k("")},E=async w=>{if(w.type.startsWith("image/")){x(!0);try{const C=`${Date.now()}-${w.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,{error:I}=await be.storage.from("cover-photos").upload(C,w,{contentType:w.type});if(I)throw I;const{data:T}=be.storage.from("cover-photos").getPublicUrl(C);h(T.publicUrl),u(!1)}catch(C){console.error("Error uploading cover image:",C)}finally{x(!1)}}};return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-lg p-6 border border-slate-700 max-h-[90vh] overflow-y-auto",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Create New Track"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cover Image"}),n.jsx("div",{className:"relative",children:d?n.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-slate-900",children:[n.jsx("img",{src:d,alt:"Cover preview",className:"w-full h-full object-cover"}),n.jsx("button",{onClick:()=>h(""),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:n.jsx(Ct,{className:"w-4 h-4"})})]}):n.jsxs("button",{onClick:()=>u(!f),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-500 transition-colors",children:[n.jsx(nt,{className:"w-8 h-8 text-slate-500"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Add cover image"})]})}),f&&!d&&n.jsxs("div",{className:"mt-3 space-y-3",children:[n.jsx("div",{children:n.jsxs("label",{className:"flex items-center justify-center gap-2 w-full px-4 py-3 bg-slate-900 border border-slate-700 border-dashed rounded-lg text-slate-400 hover:text-white hover:border-slate-500 cursor-pointer transition-colors",children:[p?n.jsxs(n.Fragment,{children:[n.jsx(fe,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{children:"Uploading..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(Tn,{className:"w-5 h-5"}),n.jsx("span",{children:"Upload from device"})]}),n.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:p,onChange:w=>w.target.files?.[0]&&E(w.target.files[0])})]})}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"flex-1 h-px bg-slate-700"}),n.jsx("span",{className:"text-xs text-slate-500",children:"OR"}),n.jsx("div",{className:"flex-1 h-px bg-slate-700"})]}),n.jsx("input",{type:"url",value:d,onChange:w=>h(w.target.value),placeholder:"Paste image URL...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Or choose from gallery:"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:ko.map((w,C)=>n.jsx("button",{onClick:()=>{h(w),u(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:w,alt:"",className:"w-full h-full object-cover"})},C))})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:r,onChange:w=>m(w.target.value),placeholder:"e.g., GenAI Fundamentals",className:`w-full px-3 py-2 bg-slate-900 border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 ${g?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-blue-500"}`}),g&&n.jsx("p",{className:"mt-1 text-sm text-red-400",children:g})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:a,onChange:w=>j(w.target.value),placeholder:"What will learners gain from this track?",rows:3,className:`w-full px-3 py-2 bg-slate-900 border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 resize-none ${v?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-blue-500"}`}),v&&n.jsx("p",{className:"mt-1 text-sm text-red-400",children:v})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Level"}),n.jsxs("select",{value:l,onChange:w=>c(w.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:e,disabled:s,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>t({title:r,description:a,level:l,cover_image_url:d||void 0}),disabled:!r.trim()||!!g||!!v||s,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[s&&n.jsx(fe,{className:"w-4 h-4 animate-spin"}),s?"Creating...":"Create Track"]})]})]})})}function Jl({onClose:e,onCreate:t,isCreating:s}){const[r,o]=b.useState(""),[a,i]=b.useState("");return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-md p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Add New Module"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:r,onChange:l=>o(l.target.value),placeholder:"e.g., Introduction to AI",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:a,onChange:l=>i(l.target.value),placeholder:"What will this module cover?",rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:e,disabled:s,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>t({title:r,description:a}),disabled:!r.trim()||s,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[s&&n.jsx(fe,{className:"w-4 h-4 animate-spin"}),s?"Creating...":"Create Module"]})]})]})})}function Ql({track:e,onClose:t,onSave:s,isSaving:r}){const[o,a]=b.useState(e.title),[i,l]=b.useState(e.description||""),[c,d]=b.useState(e.level),[h,f]=b.useState(e.cover_image_url||""),[u,p]=b.useState(!1),[x,g]=b.useState(!1),[y,v]=b.useState(""),[k,m]=b.useState(""),j=C=>{a(C),yn(C)?v("Title cannot contain URLs. Please use the cover image field for images."):v("")},E=C=>{l(C),yn(C)?m("Description cannot contain URLs."):m("")},w=async C=>{if(C.type.startsWith("image/")){g(!0);try{const I=`${Date.now()}-${C.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,{error:T}=await be.storage.from("cover-photos").upload(I,C,{contentType:C.type});if(T)throw T;const{data:$}=be.storage.from("cover-photos").getPublicUrl(I);f($.publicUrl),p(!1)}catch(I){console.error("Error uploading cover image:",I)}finally{g(!1)}}};return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-lg p-6 border border-slate-700 max-h-[90vh] overflow-y-auto",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Edit Track"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cover Image"}),n.jsx("div",{className:"relative",children:h?n.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-slate-900",children:[n.jsx("img",{src:h,alt:"Cover preview",className:"w-full h-full object-cover"}),n.jsx("button",{onClick:()=>f(""),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:n.jsx(Ct,{className:"w-4 h-4"})})]}):n.jsxs("button",{onClick:()=>p(!u),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-500 transition-colors",children:[n.jsx(nt,{className:"w-8 h-8 text-slate-500"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Add cover image"})]})}),u&&!h&&n.jsxs("div",{className:"mt-3 space-y-3",children:[n.jsx("div",{children:n.jsxs("label",{className:"flex items-center justify-center gap-2 w-full px-4 py-3 bg-slate-900 border border-slate-700 border-dashed rounded-lg text-slate-400 hover:text-white hover:border-slate-500 cursor-pointer transition-colors",children:[x?n.jsxs(n.Fragment,{children:[n.jsx(fe,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{children:"Uploading..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(Tn,{className:"w-5 h-5"}),n.jsx("span",{children:"Upload from device"})]}),n.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:x,onChange:C=>C.target.files?.[0]&&w(C.target.files[0])})]})}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"flex-1 h-px bg-slate-700"}),n.jsx("span",{className:"text-xs text-slate-500",children:"OR"}),n.jsx("div",{className:"flex-1 h-px bg-slate-700"})]}),n.jsx("input",{type:"url",value:h,onChange:C=>f(C.target.value),placeholder:"Paste image URL...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Or choose from gallery:"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:ko.map((C,I)=>n.jsx("button",{onClick:()=>{f(C),p(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:C,alt:"",className:"w-full h-full object-cover"})},I))})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:o,onChange:C=>j(C.target.value),className:`w-full px-3 py-2 bg-slate-900 border rounded-lg text-white focus:outline-none focus:ring-2 ${y?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-blue-500"}`}),y&&n.jsx("p",{className:"mt-1 text-sm text-red-400",children:y})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:i,onChange:C=>E(C.target.value),rows:3,className:`w-full px-3 py-2 bg-slate-900 border rounded-lg text-white focus:outline-none focus:ring-2 resize-none ${k?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-blue-500"}`}),k&&n.jsx("p",{className:"mt-1 text-sm text-red-400",children:k})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Level"}),n.jsxs("select",{value:c,onChange:C=>d(C.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:t,disabled:r,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>s({title:o,description:i,level:c,cover_image_url:h||null}),disabled:!o.trim()||!!y||!!k||r,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[r&&n.jsx(fe,{className:"w-4 h-4 animate-spin"}),r?"Saving...":"Save Changes"]})]})]})})}function ye(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let s=0,r;s<e.length;s++)(r=ye(e[s]))!==""&&(t+=(t&&" ")+r);else for(let s in e)e[s]&&(t+=(t&&" ")+s);return t}var Kl={value:()=>{}};function Dn(){for(var e=0,t=arguments.length,s={},r;e<t;++e){if(!(r=arguments[e]+"")||r in s||/[\s.]/.test(r))throw new Error("illegal type: "+r);s[r]=[]}return new un(s)}function un(e){this._=e}function ec(e,t){return e.trim().split(/^|\s+/).map(function(s){var r="",o=s.indexOf(".");if(o>=0&&(r=s.slice(o+1),s=s.slice(0,o)),s&&!t.hasOwnProperty(s))throw new Error("unknown type: "+s);return{type:s,name:r}})}un.prototype=Dn.prototype={constructor:un,on:function(e,t){var s=this._,r=ec(e+"",s),o,a=-1,i=r.length;if(arguments.length<2){for(;++a<i;)if((o=(e=r[a]).type)&&(o=tc(s[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<i;)if(o=(e=r[a]).type)s[o]=nr(s[o],e.name,t);else if(t==null)for(o in s)s[o]=nr(s[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var s in t)e[s]=t[s].slice();return new un(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var s=new Array(o),r=0,o,a;r<o;++r)s[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],r=0,o=a.length;r<o;++r)a[r].value.apply(t,s)},apply:function(e,t,s){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,a=r.length;o<a;++o)r[o].value.apply(t,s)}};function tc(e,t){for(var s=0,r=e.length,o;s<r;++s)if((o=e[s]).name===t)return o.value}function nr(e,t,s){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=Kl,e=e.slice(0,r).concat(e.slice(r+1));break}return s!=null&&e.push({name:t,value:s}),e}var us="http://www.w3.org/1999/xhtml";const sr={svg:"http://www.w3.org/2000/svg",xhtml:us,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Rn(e){var t=e+="",s=t.indexOf(":");return s>=0&&(t=e.slice(0,s))!=="xmlns"&&(e=e.slice(s+1)),sr.hasOwnProperty(t)?{space:sr[t],local:e}:e}function nc(e){return function(){var t=this.ownerDocument,s=this.namespaceURI;return s===us&&t.documentElement.namespaceURI===us?t.createElement(e):t.createElementNS(s,e)}}function sc(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Co(e){var t=Rn(e);return(t.local?sc:nc)(t)}function rc(){}function As(e){return e==null?rc:function(){return this.querySelector(e)}}function oc(e){typeof e!="function"&&(e=As(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=new Array(i),c,d,h=0;h<i;++h)(c=a[h])&&(d=e.call(c,c.__data__,h,a))&&("__data__"in c&&(d.__data__=c.__data__),l[h]=d);return new Te(r,this._parents)}function ic(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function ac(){return[]}function So(e){return e==null?ac:function(){return this.querySelectorAll(e)}}function lc(e){return function(){return ic(e.apply(this,arguments))}}function cc(e){typeof e=="function"?e=lc(e):e=So(e);for(var t=this._groups,s=t.length,r=[],o=[],a=0;a<s;++a)for(var i=t[a],l=i.length,c,d=0;d<l;++d)(c=i[d])&&(r.push(e.call(c,c.__data__,d,i)),o.push(c));return new Te(r,o)}function _o(e){return function(){return this.matches(e)}}function Eo(e){return function(t){return t.matches(e)}}var dc=Array.prototype.find;function uc(e){return function(){return dc.call(this.children,e)}}function hc(){return this.firstElementChild}function fc(e){return this.select(e==null?hc:uc(typeof e=="function"?e:Eo(e)))}var mc=Array.prototype.filter;function pc(){return Array.from(this.children)}function xc(e){return function(){return mc.call(this.children,e)}}function gc(e){return this.selectAll(e==null?pc:xc(typeof e=="function"?e:Eo(e)))}function bc(e){typeof e!="function"&&(e=_o(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=[],c,d=0;d<i;++d)(c=a[d])&&e.call(c,c.__data__,d,a)&&l.push(c);return new Te(r,this._parents)}function Mo(e){return new Array(e.length)}function yc(){return new Te(this._enter||this._groups.map(Mo),this._parents)}function vn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}vn.prototype={constructor:vn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function vc(e){return function(){return e}}function wc(e,t,s,r,o,a){for(var i=0,l,c=t.length,d=a.length;i<d;++i)(l=t[i])?(l.__data__=a[i],r[i]=l):s[i]=new vn(e,a[i]);for(;i<c;++i)(l=t[i])&&(o[i]=l)}function jc(e,t,s,r,o,a,i){var l,c,d=new Map,h=t.length,f=a.length,u=new Array(h),p;for(l=0;l<h;++l)(c=t[l])&&(u[l]=p=i.call(c,c.__data__,l,t)+"",d.has(p)?o[l]=c:d.set(p,c));for(l=0;l<f;++l)p=i.call(e,a[l],l,a)+"",(c=d.get(p))?(r[l]=c,c.__data__=a[l],d.delete(p)):s[l]=new vn(e,a[l]);for(l=0;l<h;++l)(c=t[l])&&d.get(u[l])===c&&(o[l]=c)}function Nc(e){return e.__data__}function kc(e,t){if(!arguments.length)return Array.from(this,Nc);var s=t?jc:wc,r=this._parents,o=this._groups;typeof e!="function"&&(e=vc(e));for(var a=o.length,i=new Array(a),l=new Array(a),c=new Array(a),d=0;d<a;++d){var h=r[d],f=o[d],u=f.length,p=Cc(e.call(h,h&&h.__data__,d,r)),x=p.length,g=l[d]=new Array(x),y=i[d]=new Array(x),v=c[d]=new Array(u);s(h,f,g,y,v,p,t);for(var k=0,m=0,j,E;k<x;++k)if(j=g[k]){for(k>=m&&(m=k+1);!(E=y[m])&&++m<x;);j._next=E||null}}return i=new Te(i,r),i._enter=l,i._exit=c,i}function Cc(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Sc(){return new Te(this._exit||this._groups.map(Mo),this._parents)}function _c(e,t,s){var r=this.enter(),o=this,a=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),s==null?a.remove():s(a),r&&o?r.merge(o).order():o}function Ec(e){for(var t=e.selection?e.selection():e,s=this._groups,r=t._groups,o=s.length,a=r.length,i=Math.min(o,a),l=new Array(o),c=0;c<i;++c)for(var d=s[c],h=r[c],f=d.length,u=l[c]=new Array(f),p,x=0;x<f;++x)(p=d[x]||h[x])&&(u[x]=p);for(;c<o;++c)l[c]=s[c];return new Te(l,this._parents)}function Mc(){for(var e=this._groups,t=-1,s=e.length;++t<s;)for(var r=e[t],o=r.length-1,a=r[o],i;--o>=0;)(i=r[o])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}function Ic(e){e||(e=Ac);function t(f,u){return f&&u?e(f.__data__,u.__data__):!f-!u}for(var s=this._groups,r=s.length,o=new Array(r),a=0;a<r;++a){for(var i=s[a],l=i.length,c=o[a]=new Array(l),d,h=0;h<l;++h)(d=i[h])&&(c[h]=d);c.sort(t)}return new Te(o,this._parents).order()}function Ac(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Tc(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function $c(){return Array.from(this)}function Pc(){for(var e=this._groups,t=0,s=e.length;t<s;++t)for(var r=e[t],o=0,a=r.length;o<a;++o){var i=r[o];if(i)return i}return null}function Dc(){let e=0;for(const t of this)++e;return e}function Rc(){return!this.node()}function zc(e){for(var t=this._groups,s=0,r=t.length;s<r;++s)for(var o=t[s],a=0,i=o.length,l;a<i;++a)(l=o[a])&&e.call(l,l.__data__,a,o);return this}function Lc(e){return function(){this.removeAttribute(e)}}function Bc(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Hc(e,t){return function(){this.setAttribute(e,t)}}function Oc(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Vc(e,t){return function(){var s=t.apply(this,arguments);s==null?this.removeAttribute(e):this.setAttribute(e,s)}}function Fc(e,t){return function(){var s=t.apply(this,arguments);s==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,s)}}function Gc(e,t){var s=Rn(e);if(arguments.length<2){var r=this.node();return s.local?r.getAttributeNS(s.space,s.local):r.getAttribute(s)}return this.each((t==null?s.local?Bc:Lc:typeof t=="function"?s.local?Fc:Vc:s.local?Oc:Hc)(s,t))}function Io(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Uc(e){return function(){this.style.removeProperty(e)}}function qc(e,t,s){return function(){this.style.setProperty(e,t,s)}}function Yc(e,t,s){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,s)}}function Zc(e,t,s){return arguments.length>1?this.each((t==null?Uc:typeof t=="function"?Yc:qc)(e,t,s??"")):gt(this.node(),e)}function gt(e,t){return e.style.getPropertyValue(t)||Io(e).getComputedStyle(e,null).getPropertyValue(t)}function Xc(e){return function(){delete this[e]}}function Wc(e,t){return function(){this[e]=t}}function Jc(e,t){return function(){var s=t.apply(this,arguments);s==null?delete this[e]:this[e]=s}}function Qc(e,t){return arguments.length>1?this.each((t==null?Xc:typeof t=="function"?Jc:Wc)(e,t)):this.node()[e]}function Ao(e){return e.trim().split(/^|\s+/)}function Ts(e){return e.classList||new To(e)}function To(e){this._node=e,this._names=Ao(e.getAttribute("class")||"")}To.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function $o(e,t){for(var s=Ts(e),r=-1,o=t.length;++r<o;)s.add(t[r])}function Po(e,t){for(var s=Ts(e),r=-1,o=t.length;++r<o;)s.remove(t[r])}function Kc(e){return function(){$o(this,e)}}function ed(e){return function(){Po(this,e)}}function td(e,t){return function(){(t.apply(this,arguments)?$o:Po)(this,e)}}function nd(e,t){var s=Ao(e+"");if(arguments.length<2){for(var r=Ts(this.node()),o=-1,a=s.length;++o<a;)if(!r.contains(s[o]))return!1;return!0}return this.each((typeof t=="function"?td:t?Kc:ed)(s,t))}function sd(){this.textContent=""}function rd(e){return function(){this.textContent=e}}function od(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function id(e){return arguments.length?this.each(e==null?sd:(typeof e=="function"?od:rd)(e)):this.node().textContent}function ad(){this.innerHTML=""}function ld(e){return function(){this.innerHTML=e}}function cd(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function dd(e){return arguments.length?this.each(e==null?ad:(typeof e=="function"?cd:ld)(e)):this.node().innerHTML}function ud(){this.nextSibling&&this.parentNode.appendChild(this)}function hd(){return this.each(ud)}function fd(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function md(){return this.each(fd)}function pd(e){var t=typeof e=="function"?e:Co(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function xd(){return null}function gd(e,t){var s=typeof e=="function"?e:Co(e),r=t==null?xd:typeof t=="function"?t:As(t);return this.select(function(){return this.insertBefore(s.apply(this,arguments),r.apply(this,arguments)||null)})}function bd(){var e=this.parentNode;e&&e.removeChild(this)}function yd(){return this.each(bd)}function vd(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function wd(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function jd(e){return this.select(e?wd:vd)}function Nd(e){return arguments.length?this.property("__data__",e):this.node().__data__}function kd(e){return function(t){e.call(this,t,this.__data__)}}function Cd(e){return e.trim().split(/^|\s+/).map(function(t){var s="",r=t.indexOf(".");return r>=0&&(s=t.slice(r+1),t=t.slice(0,r)),{type:t,name:s}})}function Sd(e){return function(){var t=this.__on;if(t){for(var s=0,r=-1,o=t.length,a;s<o;++s)a=t[s],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++r]=a;++r?t.length=r:delete this.__on}}}function _d(e,t,s){return function(){var r=this.__on,o,a=kd(t);if(r){for(var i=0,l=r.length;i<l;++i)if((o=r[i]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=a,o.options=s),o.value=t;return}}this.addEventListener(e.type,a,s),o={type:e.type,name:e.name,value:t,listener:a,options:s},r?r.push(o):this.__on=[o]}}function Ed(e,t,s){var r=Cd(e+""),o,a=r.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,h;c<d;++c)for(o=0,h=l[c];o<a;++o)if((i=r[o]).type===h.type&&i.name===h.name)return h.value}return}for(l=t?_d:Sd,o=0;o<a;++o)this.each(l(r[o],t,s));return this}function Do(e,t,s){var r=Io(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,s):(o=r.document.createEvent("Event"),s?(o.initEvent(t,s.bubbles,s.cancelable),o.detail=s.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function Md(e,t){return function(){return Do(this,e,t)}}function Id(e,t){return function(){return Do(this,e,t.apply(this,arguments))}}function Ad(e,t){return this.each((typeof t=="function"?Id:Md)(e,t))}function*Td(){for(var e=this._groups,t=0,s=e.length;t<s;++t)for(var r=e[t],o=0,a=r.length,i;o<a;++o)(i=r[o])&&(yield i)}var Ro=[null];function Te(e,t){this._groups=e,this._parents=t}function Ut(){return new Te([[document.documentElement]],Ro)}function $d(){return this}Te.prototype=Ut.prototype={constructor:Te,select:oc,selectAll:cc,selectChild:fc,selectChildren:gc,filter:bc,data:kc,enter:yc,exit:Sc,join:_c,merge:Ec,selection:$d,order:Mc,sort:Ic,call:Tc,nodes:$c,node:Pc,size:Dc,empty:Rc,each:zc,attr:Gc,style:Zc,property:Qc,classed:nd,text:id,html:dd,raise:hd,lower:md,append:pd,insert:gd,remove:yd,clone:jd,datum:Nd,on:Ed,dispatch:Ad,[Symbol.iterator]:Td};function Ae(e){return typeof e=="string"?new Te([[document.querySelector(e)]],[document.documentElement]):new Te([[e]],Ro)}function Pd(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Re(e,t){if(e=Pd(e),t===void 0&&(t=e.currentTarget),t){var s=t.ownerSVGElement||t;if(s.createSVGPoint){var r=s.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Dd={passive:!1},Pt={capture:!0,passive:!1};function Xn(e){e.stopImmediatePropagation()}function pt(e){e.preventDefault(),e.stopImmediatePropagation()}function zo(e){var t=e.document.documentElement,s=Ae(e).on("dragstart.drag",pt,Pt);"onselectstart"in t?s.on("selectstart.drag",pt,Pt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Lo(e,t){var s=e.document.documentElement,r=Ae(e).on("dragstart.drag",null);t&&(r.on("click.drag",pt,Pt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in s?r.on("selectstart.drag",null):(s.style.MozUserSelect=s.__noselect,delete s.__noselect)}const en=e=>()=>e;function hs(e,{sourceEvent:t,subject:s,target:r,identifier:o,active:a,x:i,y:l,dx:c,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:s,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}hs.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Rd(e){return!e.ctrlKey&&!e.button}function zd(){return this.parentNode}function Ld(e,t){return t??{x:e.x,y:e.y}}function Bd(){return navigator.maxTouchPoints||"ontouchstart"in this}function Bo(){var e=Rd,t=zd,s=Ld,r=Bd,o={},a=Dn("start","drag","end"),i=0,l,c,d,h,f=0;function u(j){j.on("mousedown.drag",p).filter(r).on("touchstart.drag",y).on("touchmove.drag",v,Dd).on("touchend.drag touchcancel.drag",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(j,E){if(!(h||!e.call(this,j,E))){var w=m(this,t.call(this,j,E),j,E,"mouse");w&&(Ae(j.view).on("mousemove.drag",x,Pt).on("mouseup.drag",g,Pt),zo(j.view),Xn(j),d=!1,l=j.clientX,c=j.clientY,w("start",j))}}function x(j){if(pt(j),!d){var E=j.clientX-l,w=j.clientY-c;d=E*E+w*w>f}o.mouse("drag",j)}function g(j){Ae(j.view).on("mousemove.drag mouseup.drag",null),Lo(j.view,d),pt(j),o.mouse("end",j)}function y(j,E){if(e.call(this,j,E)){var w=j.changedTouches,C=t.call(this,j,E),I=w.length,T,$;for(T=0;T<I;++T)($=m(this,C,j,E,w[T].identifier,w[T]))&&(Xn(j),$("start",j,w[T]))}}function v(j){var E=j.changedTouches,w=E.length,C,I;for(C=0;C<w;++C)(I=o[E[C].identifier])&&(pt(j),I("drag",j,E[C]))}function k(j){var E=j.changedTouches,w=E.length,C,I;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),C=0;C<w;++C)(I=o[E[C].identifier])&&(Xn(j),I("end",j,E[C]))}function m(j,E,w,C,I,T){var $=a.copy(),S=Re(T||w,E),P,H,N;if((N=s.call(j,new hs("beforestart",{sourceEvent:w,target:u,identifier:I,active:i,x:S[0],y:S[1],dx:0,dy:0,dispatch:$}),C))!=null)return P=N.x-S[0]||0,H=N.y-S[1]||0,function M(_,D,A){var z=S,O;switch(_){case"start":o[I]=M,O=i++;break;case"end":delete o[I],--i;case"drag":S=Re(A||D,E),O=i;break}$.call(_,j,new hs(_,{sourceEvent:D,subject:N,target:u,identifier:I,active:O,x:S[0]+P,y:S[1]+H,dx:S[0]-z[0],dy:S[1]-z[1],dispatch:$}),C)}}return u.filter=function(j){return arguments.length?(e=typeof j=="function"?j:en(!!j),u):e},u.container=function(j){return arguments.length?(t=typeof j=="function"?j:en(j),u):t},u.subject=function(j){return arguments.length?(s=typeof j=="function"?j:en(j),u):s},u.touchable=function(j){return arguments.length?(r=typeof j=="function"?j:en(!!j),u):r},u.on=function(){var j=a.on.apply(a,arguments);return j===a?u:j},u.clickDistance=function(j){return arguments.length?(f=(j=+j)*j,u):Math.sqrt(f)},u}function $s(e,t,s){e.prototype=t.prototype=s,s.constructor=e}function Ho(e,t){var s=Object.create(e.prototype);for(var r in t)s[r]=t[r];return s}function qt(){}var Dt=.7,wn=1/Dt,xt="\\s*([+-]?\\d+)\\s*",Rt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Fe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Hd=/^#([0-9a-f]{3,8})$/,Od=new RegExp(`^rgb\\(${xt},${xt},${xt}\\)$`),Vd=new RegExp(`^rgb\\(${Fe},${Fe},${Fe}\\)$`),Fd=new RegExp(`^rgba\\(${xt},${xt},${xt},${Rt}\\)$`),Gd=new RegExp(`^rgba\\(${Fe},${Fe},${Fe},${Rt}\\)$`),Ud=new RegExp(`^hsl\\(${Rt},${Fe},${Fe}\\)$`),qd=new RegExp(`^hsla\\(${Rt},${Fe},${Fe},${Rt}\\)$`),rr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$s(qt,at,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:or,formatHex:or,formatHex8:Yd,formatHsl:Zd,formatRgb:ir,toString:ir});function or(){return this.rgb().formatHex()}function Yd(){return this.rgb().formatHex8()}function Zd(){return Oo(this).formatHsl()}function ir(){return this.rgb().formatRgb()}function at(e){var t,s;return e=(e+"").trim().toLowerCase(),(t=Hd.exec(e))?(s=t[1].length,t=parseInt(t[1],16),s===6?ar(t):s===3?new Me(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):s===8?tn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):s===4?tn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Od.exec(e))?new Me(t[1],t[2],t[3],1):(t=Vd.exec(e))?new Me(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Fd.exec(e))?tn(t[1],t[2],t[3],t[4]):(t=Gd.exec(e))?tn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Ud.exec(e))?dr(t[1],t[2]/100,t[3]/100,1):(t=qd.exec(e))?dr(t[1],t[2]/100,t[3]/100,t[4]):rr.hasOwnProperty(e)?ar(rr[e]):e==="transparent"?new Me(NaN,NaN,NaN,0):null}function ar(e){return new Me(e>>16&255,e>>8&255,e&255,1)}function tn(e,t,s,r){return r<=0&&(e=t=s=NaN),new Me(e,t,s,r)}function Xd(e){return e instanceof qt||(e=at(e)),e?(e=e.rgb(),new Me(e.r,e.g,e.b,e.opacity)):new Me}function fs(e,t,s,r){return arguments.length===1?Xd(e):new Me(e,t,s,r??1)}function Me(e,t,s,r){this.r=+e,this.g=+t,this.b=+s,this.opacity=+r}$s(Me,fs,Ho(qt,{brighter(e){return e=e==null?wn:Math.pow(wn,e),new Me(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Dt:Math.pow(Dt,e),new Me(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Me(ot(this.r),ot(this.g),ot(this.b),jn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:lr,formatHex:lr,formatHex8:Wd,formatRgb:cr,toString:cr}));function lr(){return`#${rt(this.r)}${rt(this.g)}${rt(this.b)}`}function Wd(){return`#${rt(this.r)}${rt(this.g)}${rt(this.b)}${rt((isNaN(this.opacity)?1:this.opacity)*255)}`}function cr(){const e=jn(this.opacity);return`${e===1?"rgb(":"rgba("}${ot(this.r)}, ${ot(this.g)}, ${ot(this.b)}${e===1?")":`, ${e})`}`}function jn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ot(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function rt(e){return e=ot(e),(e<16?"0":"")+e.toString(16)}function dr(e,t,s,r){return r<=0?e=t=s=NaN:s<=0||s>=1?e=t=NaN:t<=0&&(e=NaN),new ze(e,t,s,r)}function Oo(e){if(e instanceof ze)return new ze(e.h,e.s,e.l,e.opacity);if(e instanceof qt||(e=at(e)),!e)return new ze;if(e instanceof ze)return e;e=e.rgb();var t=e.r/255,s=e.g/255,r=e.b/255,o=Math.min(t,s,r),a=Math.max(t,s,r),i=NaN,l=a-o,c=(a+o)/2;return l?(t===a?i=(s-r)/l+(s<r)*6:s===a?i=(r-t)/l+2:i=(t-s)/l+4,l/=c<.5?a+o:2-a-o,i*=60):l=c>0&&c<1?0:i,new ze(i,l,c,e.opacity)}function Jd(e,t,s,r){return arguments.length===1?Oo(e):new ze(e,t,s,r??1)}function ze(e,t,s,r){this.h=+e,this.s=+t,this.l=+s,this.opacity=+r}$s(ze,Jd,Ho(qt,{brighter(e){return e=e==null?wn:Math.pow(wn,e),new ze(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Dt:Math.pow(Dt,e),new ze(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,s=this.l,r=s+(s<.5?s:1-s)*t,o=2*s-r;return new Me(Wn(e>=240?e-240:e+120,o,r),Wn(e,o,r),Wn(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new ze(ur(this.h),nn(this.s),nn(this.l),jn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=jn(this.opacity);return`${e===1?"hsl(":"hsla("}${ur(this.h)}, ${nn(this.s)*100}%, ${nn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ur(e){return e=(e||0)%360,e<0?e+360:e}function nn(e){return Math.max(0,Math.min(1,e||0))}function Wn(e,t,s){return(e<60?t+(s-t)*e/60:e<180?s:e<240?t+(s-t)*(240-e)/60:t)*255}const Ps=e=>()=>e;function Qd(e,t){return function(s){return e+s*t}}function Kd(e,t,s){return e=Math.pow(e,s),t=Math.pow(t,s)-e,s=1/s,function(r){return Math.pow(e+r*t,s)}}function eu(e){return(e=+e)==1?Vo:function(t,s){return s-t?Kd(t,s,e):Ps(isNaN(t)?s:t)}}function Vo(e,t){var s=t-e;return s?Qd(e,s):Ps(isNaN(e)?t:e)}const Nn=(function e(t){var s=eu(t);function r(o,a){var i=s((o=fs(o)).r,(a=fs(a)).r),l=s(o.g,a.g),c=s(o.b,a.b),d=Vo(o.opacity,a.opacity);return function(h){return o.r=i(h),o.g=l(h),o.b=c(h),o.opacity=d(h),o+""}}return r.gamma=e,r})(1);function tu(e,t){t||(t=[]);var s=e?Math.min(t.length,e.length):0,r=t.slice(),o;return function(a){for(o=0;o<s;++o)r[o]=e[o]*(1-a)+t[o]*a;return r}}function nu(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function su(e,t){var s=t?t.length:0,r=e?Math.min(s,e.length):0,o=new Array(r),a=new Array(s),i;for(i=0;i<r;++i)o[i]=At(e[i],t[i]);for(;i<s;++i)a[i]=t[i];return function(l){for(i=0;i<r;++i)a[i]=o[i](l);return a}}function ru(e,t){var s=new Date;return e=+e,t=+t,function(r){return s.setTime(e*(1-r)+t*r),s}}function Ve(e,t){return e=+e,t=+t,function(s){return e*(1-s)+t*s}}function ou(e,t){var s={},r={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?s[o]=At(e[o],t[o]):r[o]=t[o];return function(a){for(o in s)r[o]=s[o](a);return r}}var ms=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jn=new RegExp(ms.source,"g");function iu(e){return function(){return e}}function au(e){return function(t){return e(t)+""}}function Fo(e,t){var s=ms.lastIndex=Jn.lastIndex=0,r,o,a,i=-1,l=[],c=[];for(e=e+"",t=t+"";(r=ms.exec(e))&&(o=Jn.exec(t));)(a=o.index)>s&&(a=t.slice(s,a),l[i]?l[i]+=a:l[++i]=a),(r=r[0])===(o=o[0])?l[i]?l[i]+=o:l[++i]=o:(l[++i]=null,c.push({i,x:Ve(r,o)})),s=Jn.lastIndex;return s<t.length&&(a=t.slice(s),l[i]?l[i]+=a:l[++i]=a),l.length<2?c[0]?au(c[0].x):iu(t):(t=c.length,function(d){for(var h=0,f;h<t;++h)l[(f=c[h]).i]=f.x(d);return l.join("")})}function At(e,t){var s=typeof t,r;return t==null||s==="boolean"?Ps(t):(s==="number"?Ve:s==="string"?(r=at(t))?(t=r,Nn):Fo:t instanceof at?Nn:t instanceof Date?ru:nu(t)?tu:Array.isArray(t)?su:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?ou:Ve)(e,t)}var hr=180/Math.PI,ps={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Go(e,t,s,r,o,a){var i,l,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*s+t*r)&&(s-=e*c,r-=t*c),(l=Math.sqrt(s*s+r*r))&&(s/=l,r/=l,c/=l),e*r<t*s&&(e=-e,t=-t,c=-c,i=-i),{translateX:o,translateY:a,rotate:Math.atan2(t,e)*hr,skewX:Math.atan(c)*hr,scaleX:i,scaleY:l}}var sn;function lu(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ps:Go(t.a,t.b,t.c,t.d,t.e,t.f)}function cu(e){return e==null||(sn||(sn=document.createElementNS("http://www.w3.org/2000/svg","g")),sn.setAttribute("transform",e),!(e=sn.transform.baseVal.consolidate()))?ps:(e=e.matrix,Go(e.a,e.b,e.c,e.d,e.e,e.f))}function Uo(e,t,s,r){function o(d){return d.length?d.pop()+" ":""}function a(d,h,f,u,p,x){if(d!==f||h!==u){var g=p.push("translate(",null,t,null,s);x.push({i:g-4,x:Ve(d,f)},{i:g-2,x:Ve(h,u)})}else(f||u)&&p.push("translate("+f+t+u+s)}function i(d,h,f,u){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),u.push({i:f.push(o(f)+"rotate(",null,r)-2,x:Ve(d,h)})):h&&f.push(o(f)+"rotate("+h+r)}function l(d,h,f,u){d!==h?u.push({i:f.push(o(f)+"skewX(",null,r)-2,x:Ve(d,h)}):h&&f.push(o(f)+"skewX("+h+r)}function c(d,h,f,u,p,x){if(d!==f||h!==u){var g=p.push(o(p)+"scale(",null,",",null,")");x.push({i:g-4,x:Ve(d,f)},{i:g-2,x:Ve(h,u)})}else(f!==1||u!==1)&&p.push(o(p)+"scale("+f+","+u+")")}return function(d,h){var f=[],u=[];return d=e(d),h=e(h),a(d.translateX,d.translateY,h.translateX,h.translateY,f,u),i(d.rotate,h.rotate,f,u),l(d.skewX,h.skewX,f,u),c(d.scaleX,d.scaleY,h.scaleX,h.scaleY,f,u),d=h=null,function(p){for(var x=-1,g=u.length,y;++x<g;)f[(y=u[x]).i]=y.x(p);return f.join("")}}}var du=Uo(lu,"px, ","px)","deg)"),uu=Uo(cu,", ",")",")"),hu=1e-12;function fr(e){return((e=Math.exp(e))+1/e)/2}function fu(e){return((e=Math.exp(e))-1/e)/2}function mu(e){return((e=Math.exp(2*e))-1)/(e+1)}const hn=(function e(t,s,r){function o(a,i){var l=a[0],c=a[1],d=a[2],h=i[0],f=i[1],u=i[2],p=h-l,x=f-c,g=p*p+x*x,y,v;if(g<hu)v=Math.log(u/d)/t,y=function(C){return[l+C*p,c+C*x,d*Math.exp(t*C*v)]};else{var k=Math.sqrt(g),m=(u*u-d*d+r*g)/(2*d*s*k),j=(u*u-d*d-r*g)/(2*u*s*k),E=Math.log(Math.sqrt(m*m+1)-m),w=Math.log(Math.sqrt(j*j+1)-j);v=(w-E)/t,y=function(C){var I=C*v,T=fr(E),$=d/(s*k)*(T*mu(t*I+E)-fu(E));return[l+$*p,c+$*x,d*T/fr(t*I+E)]}}return y.duration=v*1e3*t/Math.SQRT2,y}return o.rho=function(a){var i=Math.max(.001,+a),l=i*i,c=l*l;return e(i,l,c)},o})(Math.SQRT2,2,4);var bt=0,Et=0,St=0,qo=1e3,kn,Mt,Cn=0,lt=0,zn=0,zt=typeof performance=="object"&&performance.now?performance:Date,Yo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ds(){return lt||(Yo(pu),lt=zt.now()+zn)}function pu(){lt=0}function Sn(){this._call=this._time=this._next=null}Sn.prototype=Zo.prototype={constructor:Sn,restart:function(e,t,s){if(typeof e!="function")throw new TypeError("callback is not a function");s=(s==null?Ds():+s)+(t==null?0:+t),!this._next&&Mt!==this&&(Mt?Mt._next=this:kn=this,Mt=this),this._call=e,this._time=s,xs()},stop:function(){this._call&&(this._call=null,this._time=1/0,xs())}};function Zo(e,t,s){var r=new Sn;return r.restart(e,t,s),r}function xu(){Ds(),++bt;for(var e=kn,t;e;)(t=lt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--bt}function mr(){lt=(Cn=zt.now())+zn,bt=Et=0;try{xu()}finally{bt=0,bu(),lt=0}}function gu(){var e=zt.now(),t=e-Cn;t>qo&&(zn-=t,Cn=e)}function bu(){for(var e,t=kn,s,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(s=t._next,t._next=null,t=e?e._next=s:kn=s);Mt=e,xs(r)}function xs(e){if(!bt){Et&&(Et=clearTimeout(Et));var t=e-lt;t>24?(e<1/0&&(Et=setTimeout(mr,e-zt.now()-zn)),St&&(St=clearInterval(St))):(St||(Cn=zt.now(),St=setInterval(gu,qo)),bt=1,Yo(mr))}}function pr(e,t,s){var r=new Sn;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,s),r}var yu=Dn("start","end","cancel","interrupt"),vu=[],Xo=0,xr=1,gs=2,fn=3,gr=4,bs=5,mn=6;function Ln(e,t,s,r,o,a){var i=e.__transition;if(!i)e.__transition={};else if(s in i)return;wu(e,s,{name:t,index:r,group:o,on:yu,tween:vu,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Xo})}function Rs(e,t){var s=Oe(e,t);if(s.state>Xo)throw new Error("too late; already scheduled");return s}function Ue(e,t){var s=Oe(e,t);if(s.state>fn)throw new Error("too late; already running");return s}function Oe(e,t){var s=e.__transition;if(!s||!(s=s[t]))throw new Error("transition not found");return s}function wu(e,t,s){var r=e.__transition,o;r[t]=s,s.timer=Zo(a,0,s.time);function a(d){s.state=xr,s.timer.restart(i,s.delay,s.time),s.delay<=d&&i(d-s.delay)}function i(d){var h,f,u,p;if(s.state!==xr)return c();for(h in r)if(p=r[h],p.name===s.name){if(p.state===fn)return pr(i);p.state===gr?(p.state=mn,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete r[h]):+h<t&&(p.state=mn,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete r[h])}if(pr(function(){s.state===fn&&(s.state=gr,s.timer.restart(l,s.delay,s.time),l(d))}),s.state=gs,s.on.call("start",e,e.__data__,s.index,s.group),s.state===gs){for(s.state=fn,o=new Array(u=s.tween.length),h=0,f=-1;h<u;++h)(p=s.tween[h].value.call(e,e.__data__,s.index,s.group))&&(o[++f]=p);o.length=f+1}}function l(d){for(var h=d<s.duration?s.ease.call(null,d/s.duration):(s.timer.restart(c),s.state=bs,1),f=-1,u=o.length;++f<u;)o[f].call(e,h);s.state===bs&&(s.on.call("end",e,e.__data__,s.index,s.group),c())}function c(){s.state=mn,s.timer.stop(),delete r[t];for(var d in r)return;delete e.__transition}}function pn(e,t){var s=e.__transition,r,o,a=!0,i;if(s){t=t==null?null:t+"";for(i in s){if((r=s[i]).name!==t){a=!1;continue}o=r.state>gs&&r.state<bs,r.state=mn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete s[i]}a&&delete e.__transition}}function ju(e){return this.each(function(){pn(this,e)})}function Nu(e,t){var s,r;return function(){var o=Ue(this,e),a=o.tween;if(a!==s){r=s=a;for(var i=0,l=r.length;i<l;++i)if(r[i].name===t){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function ku(e,t,s){var r,o;if(typeof s!="function")throw new Error;return function(){var a=Ue(this,e),i=a.tween;if(i!==r){o=(r=i).slice();for(var l={name:t,value:s},c=0,d=o.length;c<d;++c)if(o[c].name===t){o[c]=l;break}c===d&&o.push(l)}a.tween=o}}function Cu(e,t){var s=this._id;if(e+="",arguments.length<2){for(var r=Oe(this.node(),s).tween,o=0,a=r.length,i;o<a;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((t==null?Nu:ku)(s,e,t))}function zs(e,t,s){var r=e._id;return e.each(function(){var o=Ue(this,r);(o.value||(o.value={}))[t]=s.apply(this,arguments)}),function(o){return Oe(o,r).value[t]}}function Wo(e,t){var s;return(typeof t=="number"?Ve:t instanceof at?Nn:(s=at(t))?(t=s,Nn):Fo)(e,t)}function Su(e){return function(){this.removeAttribute(e)}}function _u(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Eu(e,t,s){var r,o=s+"",a;return function(){var i=this.getAttribute(e);return i===o?null:i===r?a:a=t(r=i,s)}}function Mu(e,t,s){var r,o=s+"",a;return function(){var i=this.getAttributeNS(e.space,e.local);return i===o?null:i===r?a:a=t(r=i,s)}}function Iu(e,t,s){var r,o,a;return function(){var i,l=s(this),c;return l==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=l+"",i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l)))}}function Au(e,t,s){var r,o,a;return function(){var i,l=s(this),c;return l==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=l+"",i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l)))}}function Tu(e,t){var s=Rn(e),r=s==="transform"?uu:Wo;return this.attrTween(e,typeof t=="function"?(s.local?Au:Iu)(s,r,zs(this,"attr."+e,t)):t==null?(s.local?_u:Su)(s):(s.local?Mu:Eu)(s,r,t))}function $u(e,t){return function(s){this.setAttribute(e,t.call(this,s))}}function Pu(e,t){return function(s){this.setAttributeNS(e.space,e.local,t.call(this,s))}}function Du(e,t){var s,r;function o(){var a=t.apply(this,arguments);return a!==r&&(s=(r=a)&&Pu(e,a)),s}return o._value=t,o}function Ru(e,t){var s,r;function o(){var a=t.apply(this,arguments);return a!==r&&(s=(r=a)&&$u(e,a)),s}return o._value=t,o}function zu(e,t){var s="attr."+e;if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;var r=Rn(e);return this.tween(s,(r.local?Du:Ru)(r,t))}function Lu(e,t){return function(){Rs(this,e).delay=+t.apply(this,arguments)}}function Bu(e,t){return t=+t,function(){Rs(this,e).delay=t}}function Hu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Lu:Bu)(t,e)):Oe(this.node(),t).delay}function Ou(e,t){return function(){Ue(this,e).duration=+t.apply(this,arguments)}}function Vu(e,t){return t=+t,function(){Ue(this,e).duration=t}}function Fu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ou:Vu)(t,e)):Oe(this.node(),t).duration}function Gu(e,t){if(typeof t!="function")throw new Error;return function(){Ue(this,e).ease=t}}function Uu(e){var t=this._id;return arguments.length?this.each(Gu(t,e)):Oe(this.node(),t).ease}function qu(e,t){return function(){var s=t.apply(this,arguments);if(typeof s!="function")throw new Error;Ue(this,e).ease=s}}function Yu(e){if(typeof e!="function")throw new Error;return this.each(qu(this._id,e))}function Zu(e){typeof e!="function"&&(e=_o(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=[],c,d=0;d<i;++d)(c=a[d])&&e.call(c,c.__data__,d,a)&&l.push(c);return new Ze(r,this._parents,this._name,this._id)}function Xu(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,s=e._groups,r=t.length,o=s.length,a=Math.min(r,o),i=new Array(r),l=0;l<a;++l)for(var c=t[l],d=s[l],h=c.length,f=i[l]=new Array(h),u,p=0;p<h;++p)(u=c[p]||d[p])&&(f[p]=u);for(;l<r;++l)i[l]=t[l];return new Ze(i,this._parents,this._name,this._id)}function Wu(e){return(e+"").trim().split(/^|\s+/).every(function(t){var s=t.indexOf(".");return s>=0&&(t=t.slice(0,s)),!t||t==="start"})}function Ju(e,t,s){var r,o,a=Wu(t)?Rs:Ue;return function(){var i=a(this,e),l=i.on;l!==r&&(o=(r=l).copy()).on(t,s),i.on=o}}function Qu(e,t){var s=this._id;return arguments.length<2?Oe(this.node(),s).on.on(e):this.each(Ju(s,e,t))}function Ku(e){return function(){var t=this.parentNode;for(var s in this.__transition)if(+s!==e)return;t&&t.removeChild(this)}}function eh(){return this.on("end.remove",Ku(this._id))}function th(e){var t=this._name,s=this._id;typeof e!="function"&&(e=As(e));for(var r=this._groups,o=r.length,a=new Array(o),i=0;i<o;++i)for(var l=r[i],c=l.length,d=a[i]=new Array(c),h,f,u=0;u<c;++u)(h=l[u])&&(f=e.call(h,h.__data__,u,l))&&("__data__"in h&&(f.__data__=h.__data__),d[u]=f,Ln(d[u],t,s,u,d,Oe(h,s)));return new Ze(a,this._parents,t,s)}function nh(e){var t=this._name,s=this._id;typeof e!="function"&&(e=So(e));for(var r=this._groups,o=r.length,a=[],i=[],l=0;l<o;++l)for(var c=r[l],d=c.length,h,f=0;f<d;++f)if(h=c[f]){for(var u=e.call(h,h.__data__,f,c),p,x=Oe(h,s),g=0,y=u.length;g<y;++g)(p=u[g])&&Ln(p,t,s,g,u,x);a.push(u),i.push(h)}return new Ze(a,i,t,s)}var sh=Ut.prototype.constructor;function rh(){return new sh(this._groups,this._parents)}function oh(e,t){var s,r,o;return function(){var a=gt(this,e),i=(this.style.removeProperty(e),gt(this,e));return a===i?null:a===s&&i===r?o:o=t(s=a,r=i)}}function Jo(e){return function(){this.style.removeProperty(e)}}function ih(e,t,s){var r,o=s+"",a;return function(){var i=gt(this,e);return i===o?null:i===r?a:a=t(r=i,s)}}function ah(e,t,s){var r,o,a;return function(){var i=gt(this,e),l=s(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(e),gt(this,e))),i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l))}}function lh(e,t){var s,r,o,a="style."+t,i="end."+a,l;return function(){var c=Ue(this,e),d=c.on,h=c.value[a]==null?l||(l=Jo(t)):void 0;(d!==s||o!==h)&&(r=(s=d).copy()).on(i,o=h),c.on=r}}function ch(e,t,s){var r=(e+="")=="transform"?du:Wo;return t==null?this.styleTween(e,oh(e,r)).on("end.style."+e,Jo(e)):typeof t=="function"?this.styleTween(e,ah(e,r,zs(this,"style."+e,t))).each(lh(this._id,e)):this.styleTween(e,ih(e,r,t),s).on("end.style."+e,null)}function dh(e,t,s){return function(r){this.style.setProperty(e,t.call(this,r),s)}}function uh(e,t,s){var r,o;function a(){var i=t.apply(this,arguments);return i!==o&&(r=(o=i)&&dh(e,i,s)),r}return a._value=t,a}function hh(e,t,s){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,uh(e,t,s??""))}function fh(e){return function(){this.textContent=e}}function mh(e){return function(){var t=e(this);this.textContent=t??""}}function ph(e){return this.tween("text",typeof e=="function"?mh(zs(this,"text",e)):fh(e==null?"":e+""))}function xh(e){return function(t){this.textContent=e.call(this,t)}}function gh(e){var t,s;function r(){var o=e.apply(this,arguments);return o!==s&&(t=(s=o)&&xh(o)),t}return r._value=e,r}function bh(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,gh(e))}function yh(){for(var e=this._name,t=this._id,s=Qo(),r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],l=i.length,c,d=0;d<l;++d)if(c=i[d]){var h=Oe(c,t);Ln(c,e,s,d,i,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Ze(r,this._parents,e,s)}function vh(){var e,t,s=this,r=s._id,o=s.size();return new Promise(function(a,i){var l={value:i},c={value:function(){--o===0&&a()}};s.each(function(){var d=Ue(this,r),h=d.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(c)),d.on=t}),o===0&&a()})}var wh=0;function Ze(e,t,s,r){this._groups=e,this._parents=t,this._name=s,this._id=r}function Qo(){return++wh}var qe=Ut.prototype;Ze.prototype={constructor:Ze,select:th,selectAll:nh,selectChild:qe.selectChild,selectChildren:qe.selectChildren,filter:Zu,merge:Xu,selection:rh,transition:yh,call:qe.call,nodes:qe.nodes,node:qe.node,size:qe.size,empty:qe.empty,each:qe.each,on:Qu,attr:Tu,attrTween:zu,style:ch,styleTween:hh,text:ph,textTween:bh,remove:eh,tween:Cu,delay:Hu,duration:Fu,ease:Uu,easeVarying:Yu,end:vh,[Symbol.iterator]:qe[Symbol.iterator]};function jh(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Nh={time:null,delay:0,duration:250,ease:jh};function kh(e,t){for(var s;!(s=e.__transition)||!(s=s[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return s}function Ch(e){var t,s;e instanceof Ze?(t=e._id,e=e._name):(t=Qo(),(s=Nh).time=Ds(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],l=i.length,c,d=0;d<l;++d)(c=i[d])&&Ln(c,e,t,d,i,s||kh(c,t));return new Ze(r,this._parents,e,t)}Ut.prototype.interrupt=ju;Ut.prototype.transition=Ch;const rn=e=>()=>e;function Sh(e,{sourceEvent:t,target:s,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function Ye(e,t,s){this.k=e,this.x=t,this.y=s}Ye.prototype={constructor:Ye,scale:function(e){return e===1?this:new Ye(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Ye(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Bn=new Ye(1,0,0);Ko.prototype=Ye.prototype;function Ko(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Bn;return e.__zoom}function Qn(e){e.stopImmediatePropagation()}function _t(e){e.preventDefault(),e.stopImmediatePropagation()}function _h(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Eh(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function br(){return this.__zoom||Bn}function Mh(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Ih(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ah(e,t,s){var r=e.invertX(t[0][0])-s[0][0],o=e.invertX(t[1][0])-s[1][0],a=e.invertY(t[0][1])-s[0][1],i=e.invertY(t[1][1])-s[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),i>a?(a+i)/2:Math.min(0,a)||Math.max(0,i))}function ei(){var e=_h,t=Eh,s=Ah,r=Mh,o=Ih,a=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,c=hn,d=Dn("start","zoom","end"),h,f,u,p=500,x=150,g=0,y=10;function v(N){N.property("__zoom",br).on("wheel.zoom",I,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",$).filter(o).on("touchstart.zoom",S).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",H).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(N,M,_,D){var A=N.selection?N.selection():N;A.property("__zoom",br),N!==A?E(N,M,_,D):A.interrupt().each(function(){w(this,arguments).event(D).start().zoom(null,typeof M=="function"?M.apply(this,arguments):M).end()})},v.scaleBy=function(N,M,_,D){v.scaleTo(N,function(){var A=this.__zoom.k,z=typeof M=="function"?M.apply(this,arguments):M;return A*z},_,D)},v.scaleTo=function(N,M,_,D){v.transform(N,function(){var A=t.apply(this,arguments),z=this.__zoom,O=_==null?j(A):typeof _=="function"?_.apply(this,arguments):_,F=z.invert(O),V=typeof M=="function"?M.apply(this,arguments):M;return s(m(k(z,V),O,F),A,i)},_,D)},v.translateBy=function(N,M,_,D){v.transform(N,function(){return s(this.__zoom.translate(typeof M=="function"?M.apply(this,arguments):M,typeof _=="function"?_.apply(this,arguments):_),t.apply(this,arguments),i)},null,D)},v.translateTo=function(N,M,_,D,A){v.transform(N,function(){var z=t.apply(this,arguments),O=this.__zoom,F=D==null?j(z):typeof D=="function"?D.apply(this,arguments):D;return s(Bn.translate(F[0],F[1]).scale(O.k).translate(typeof M=="function"?-M.apply(this,arguments):-M,typeof _=="function"?-_.apply(this,arguments):-_),z,i)},D,A)};function k(N,M){return M=Math.max(a[0],Math.min(a[1],M)),M===N.k?N:new Ye(M,N.x,N.y)}function m(N,M,_){var D=M[0]-_[0]*N.k,A=M[1]-_[1]*N.k;return D===N.x&&A===N.y?N:new Ye(N.k,D,A)}function j(N){return[(+N[0][0]+ +N[1][0])/2,(+N[0][1]+ +N[1][1])/2]}function E(N,M,_,D){N.on("start.zoom",function(){w(this,arguments).event(D).start()}).on("interrupt.zoom end.zoom",function(){w(this,arguments).event(D).end()}).tween("zoom",function(){var A=this,z=arguments,O=w(A,z).event(D),F=t.apply(A,z),V=_==null?j(F):typeof _=="function"?_.apply(A,z):_,Q=Math.max(F[1][0]-F[0][0],F[1][1]-F[0][1]),X=A.__zoom,te=typeof M=="function"?M.apply(A,z):M,Z=c(X.invert(V).concat(Q/X.k),te.invert(V).concat(Q/te.k));return function(B){if(B===1)B=te;else{var R=Z(B),J=Q/R[2];B=new Ye(J,V[0]-R[0]*J,V[1]-R[1]*J)}O.zoom(null,B)}})}function w(N,M,_){return!_&&N.__zooming||new C(N,M)}function C(N,M){this.that=N,this.args=M,this.active=0,this.sourceEvent=null,this.extent=t.apply(N,M),this.taps=0}C.prototype={event:function(N){return N&&(this.sourceEvent=N),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(N,M){return this.mouse&&N!=="mouse"&&(this.mouse[1]=M.invert(this.mouse[0])),this.touch0&&N!=="touch"&&(this.touch0[1]=M.invert(this.touch0[0])),this.touch1&&N!=="touch"&&(this.touch1[1]=M.invert(this.touch1[0])),this.that.__zoom=M,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(N){var M=Ae(this.that).datum();d.call(N,this.that,new Sh(N,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:d}),M)}};function I(N,...M){if(!e.apply(this,arguments))return;var _=w(this,M).event(N),D=this.__zoom,A=Math.max(a[0],Math.min(a[1],D.k*Math.pow(2,r.apply(this,arguments)))),z=Re(N);if(_.wheel)(_.mouse[0][0]!==z[0]||_.mouse[0][1]!==z[1])&&(_.mouse[1]=D.invert(_.mouse[0]=z)),clearTimeout(_.wheel);else{if(D.k===A)return;_.mouse=[z,D.invert(z)],pn(this),_.start()}_t(N),_.wheel=setTimeout(O,x),_.zoom("mouse",s(m(k(D,A),_.mouse[0],_.mouse[1]),_.extent,i));function O(){_.wheel=null,_.end()}}function T(N,...M){if(u||!e.apply(this,arguments))return;var _=N.currentTarget,D=w(this,M,!0).event(N),A=Ae(N.view).on("mousemove.zoom",V,!0).on("mouseup.zoom",Q,!0),z=Re(N,_),O=N.clientX,F=N.clientY;zo(N.view),Qn(N),D.mouse=[z,this.__zoom.invert(z)],pn(this),D.start();function V(X){if(_t(X),!D.moved){var te=X.clientX-O,Z=X.clientY-F;D.moved=te*te+Z*Z>g}D.event(X).zoom("mouse",s(m(D.that.__zoom,D.mouse[0]=Re(X,_),D.mouse[1]),D.extent,i))}function Q(X){A.on("mousemove.zoom mouseup.zoom",null),Lo(X.view,D.moved),_t(X),D.event(X).end()}}function $(N,...M){if(e.apply(this,arguments)){var _=this.__zoom,D=Re(N.changedTouches?N.changedTouches[0]:N,this),A=_.invert(D),z=_.k*(N.shiftKey?.5:2),O=s(m(k(_,z),D,A),t.apply(this,M),i);_t(N),l>0?Ae(this).transition().duration(l).call(E,O,D,N):Ae(this).call(v.transform,O,D,N)}}function S(N,...M){if(e.apply(this,arguments)){var _=N.touches,D=_.length,A=w(this,M,N.changedTouches.length===D).event(N),z,O,F,V;for(Qn(N),O=0;O<D;++O)F=_[O],V=Re(F,this),V=[V,this.__zoom.invert(V),F.identifier],A.touch0?!A.touch1&&A.touch0[2]!==V[2]&&(A.touch1=V,A.taps=0):(A.touch0=V,z=!0,A.taps=1+!!h);h&&(h=clearTimeout(h)),z&&(A.taps<2&&(f=V[0],h=setTimeout(function(){h=null},p)),pn(this),A.start())}}function P(N,...M){if(this.__zooming){var _=w(this,M).event(N),D=N.changedTouches,A=D.length,z,O,F,V;for(_t(N),z=0;z<A;++z)O=D[z],F=Re(O,this),_.touch0&&_.touch0[2]===O.identifier?_.touch0[0]=F:_.touch1&&_.touch1[2]===O.identifier&&(_.touch1[0]=F);if(O=_.that.__zoom,_.touch1){var Q=_.touch0[0],X=_.touch0[1],te=_.touch1[0],Z=_.touch1[1],B=(B=te[0]-Q[0])*B+(B=te[1]-Q[1])*B,R=(R=Z[0]-X[0])*R+(R=Z[1]-X[1])*R;O=k(O,Math.sqrt(B/R)),F=[(Q[0]+te[0])/2,(Q[1]+te[1])/2],V=[(X[0]+Z[0])/2,(X[1]+Z[1])/2]}else if(_.touch0)F=_.touch0[0],V=_.touch0[1];else return;_.zoom("touch",s(m(O,F,V),_.extent,i))}}function H(N,...M){if(this.__zooming){var _=w(this,M).event(N),D=N.changedTouches,A=D.length,z,O;for(Qn(N),u&&clearTimeout(u),u=setTimeout(function(){u=null},p),z=0;z<A;++z)O=D[z],_.touch0&&_.touch0[2]===O.identifier?delete _.touch0:_.touch1&&_.touch1[2]===O.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(O=Re(O,this),Math.hypot(f[0]-O[0],f[1]-O[1])<y)){var F=Ae(this).on("dblclick.zoom");F&&F.apply(this,arguments)}}}return v.wheelDelta=function(N){return arguments.length?(r=typeof N=="function"?N:rn(+N),v):r},v.filter=function(N){return arguments.length?(e=typeof N=="function"?N:rn(!!N),v):e},v.touchable=function(N){return arguments.length?(o=typeof N=="function"?N:rn(!!N),v):o},v.extent=function(N){return arguments.length?(t=typeof N=="function"?N:rn([[+N[0][0],+N[0][1]],[+N[1][0],+N[1][1]]]),v):t},v.scaleExtent=function(N){return arguments.length?(a[0]=+N[0],a[1]=+N[1],v):[a[0],a[1]]},v.translateExtent=function(N){return arguments.length?(i[0][0]=+N[0][0],i[1][0]=+N[1][0],i[0][1]=+N[0][1],i[1][1]=+N[1][1],v):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},v.constrain=function(N){return arguments.length?(s=N,v):s},v.duration=function(N){return arguments.length?(l=+N,v):l},v.interpolate=function(N){return arguments.length?(c=N,v):c},v.on=function(){var N=d.on.apply(d,arguments);return N===d?v:N},v.clickDistance=function(N){return arguments.length?(g=(N=+N)*N,v):Math.sqrt(g)},v.tapDistance=function(N){return arguments.length?(y=+N,v):y},v}const Ge={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:s,targetHandle:r})=>`Couldn't create edge for ${e} handle id: "${e==="source"?s:r}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Lt=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],ti=["Enter"," ","Escape"],ni={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:s})=>`Moved selected node ${e}. New position, x: ${t}, y: ${s}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var yt;(function(e){e.Strict="strict",e.Loose="loose"})(yt||(yt={}));var it;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(it||(it={}));var Bt;(function(e){e.Partial="partial",e.Full="full"})(Bt||(Bt={}));const si={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Qe;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Qe||(Qe={}));var vt;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(vt||(vt={}));var ne;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(ne||(ne={}));const yr={[ne.Left]:ne.Right,[ne.Right]:ne.Left,[ne.Top]:ne.Bottom,[ne.Bottom]:ne.Top};function ri(e){return e===null?null:e?"valid":"invalid"}const oi=e=>"id"in e&&"source"in e&&"target"in e,Th=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Ls=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Yt=(e,t=[0,0])=>{const{width:s,height:r}=Xe(e),o=e.origin??t,a=s*o[0],i=r*o[1];return{x:e.position.x-a,y:e.position.y-i}},$h=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const s=e.reduce((r,o)=>{const a=typeof o=="string";let i=!t.nodeLookup&&!a?o:void 0;t.nodeLookup&&(i=a?t.nodeLookup.get(o):Ls(o)?o:t.nodeLookup.get(o.id));const l=i?_n(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Hn(r,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return On(s)},Zt=(e,t={})=>{let s={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return e.forEach(o=>{(t.filter===void 0||t.filter(o))&&(s=Hn(s,_n(o)),r=!0)}),r?On(s):{x:0,y:0,width:0,height:0}},Bs=(e,t,[s,r,o]=[0,0,1],a=!1,i=!1)=>{const l={...Wt(t,[s,r,o]),width:t.width/o,height:t.height/o},c=[];for(const d of e.values()){const{measured:h,selectable:f=!0,hidden:u=!1}=d;if(i&&!f||u)continue;const p=h.width??d.width??d.initialWidth??null,x=h.height??d.height??d.initialHeight??null,g=Ht(l,jt(d)),y=(p??0)*(x??0),v=a&&g>0;(!d.internals.handleBounds||v||g>=y||d.dragging)&&c.push(d)}return c},Ph=(e,t)=>{const s=new Set;return e.forEach(r=>{s.add(r.id)}),t.filter(r=>s.has(r.source)||s.has(r.target))};function Dh(e,t){const s=new Map,r=t?.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&(t?.includeHiddenNodes||!o.hidden)&&(!r||r.has(o.id))&&s.set(o.id,o)}),s}async function Rh({nodes:e,width:t,height:s,panZoom:r,minZoom:o,maxZoom:a},i){if(e.size===0)return Promise.resolve(!0);const l=Dh(e,i),c=Zt(l),d=Hs(c,t,s,i?.minZoom??o,i?.maxZoom??a,i?.padding??.1);return await r.setViewport(d,{duration:i?.duration,ease:i?.ease,interpolate:i?.interpolate}),Promise.resolve(!0)}function ii({nodeId:e,nextPosition:t,nodeLookup:s,nodeOrigin:r=[0,0],nodeExtent:o,onError:a}){const i=s.get(e),l=i.parentId?s.get(i.parentId):void 0,{x:c,y:d}=l?l.internals.positionAbsolute:{x:0,y:0},h=i.origin??r;let f=i.extent||o;if(i.extent==="parent"&&!i.expandParent)if(!l)a?.("005",Ge.error005());else{const p=l.measured.width,x=l.measured.height;p&&x&&(f=[[c,d],[c+p,d+x]])}else l&&Nt(i.extent)&&(f=[[i.extent[0][0]+c,i.extent[0][1]+d],[i.extent[1][0]+c,i.extent[1][1]+d]]);const u=Nt(f)?ct(t,f,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&a?.("015",Ge.error015()),{position:{x:u.x-c+(i.measured.width??0)*h[0],y:u.y-d+(i.measured.height??0)*h[1]},positionAbsolute:u}}async function zh({nodesToRemove:e=[],edgesToRemove:t=[],nodes:s,edges:r,onBeforeDelete:o}){const a=new Set(e.map(u=>u.id)),i=[];for(const u of s){if(u.deletable===!1)continue;const p=a.has(u.id),x=!p&&u.parentId&&i.find(g=>g.id===u.parentId);(p||x)&&i.push(u)}const l=new Set(t.map(u=>u.id)),c=r.filter(u=>u.deletable!==!1),h=Ph(i,c);for(const u of c)l.has(u.id)&&!h.find(x=>x.id===u.id)&&h.push(u);if(!o)return{edges:h,nodes:i};const f=await o({nodes:i,edges:h});return typeof f=="boolean"?f?{edges:h,nodes:i}:{edges:[],nodes:[]}:f}const wt=(e,t=0,s=1)=>Math.min(Math.max(e,t),s),ct=(e={x:0,y:0},t,s)=>({x:wt(e.x,t[0][0],t[1][0]-(s?.width??0)),y:wt(e.y,t[0][1],t[1][1]-(s?.height??0))});function ai(e,t,s){const{width:r,height:o}=Xe(s),{x:a,y:i}=s.internals.positionAbsolute;return ct(e,[[a,i],[a+r,i+o]],t)}const vr=(e,t,s)=>e<t?wt(Math.abs(e-t),1,t)/t:e>s?-wt(Math.abs(e-s),1,t)/t:0,li=(e,t,s=15,r=40)=>{const o=vr(e.x,r,t.width-r)*s,a=vr(e.y,r,t.height-r)*s;return[o,a]},Hn=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),ys=({x:e,y:t,width:s,height:r})=>({x:e,y:t,x2:e+s,y2:t+r}),On=({x:e,y:t,x2:s,y2:r})=>({x:e,y:t,width:s-e,height:r-t}),jt=(e,t=[0,0])=>{const{x:s,y:r}=Ls(e)?e.internals.positionAbsolute:Yt(e,t);return{x:s,y:r,width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}},_n=(e,t=[0,0])=>{const{x:s,y:r}=Ls(e)?e.internals.positionAbsolute:Yt(e,t);return{x:s,y:r,x2:s+(e.measured?.width??e.width??e.initialWidth??0),y2:r+(e.measured?.height??e.height??e.initialHeight??0)}},ci=(e,t)=>On(Hn(ys(e),ys(t))),Ht=(e,t)=>{const s=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(s*r)},wr=e=>Le(e.width)&&Le(e.height)&&Le(e.x)&&Le(e.y),Le=e=>!isNaN(e)&&isFinite(e),Lh=(e,t)=>{},Xt=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Wt=({x:e,y:t},[s,r,o],a=!1,i=[1,1])=>{const l={x:(e-s)/o,y:(t-r)/o};return a?Xt(l,i):l},En=({x:e,y:t},[s,r,o])=>({x:e*o+s,y:t*o+r});function ht(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const s=parseFloat(e);if(!Number.isNaN(s))return Math.floor(s)}if(typeof e=="string"&&e.endsWith("%")){const s=parseFloat(e);if(!Number.isNaN(s))return Math.floor(t*s*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Bh(e,t,s){if(typeof e=="string"||typeof e=="number"){const r=ht(e,s),o=ht(e,t);return{top:r,right:o,bottom:r,left:o,x:o*2,y:r*2}}if(typeof e=="object"){const r=ht(e.top??e.y??0,s),o=ht(e.bottom??e.y??0,s),a=ht(e.left??e.x??0,t),i=ht(e.right??e.x??0,t);return{top:r,right:i,bottom:o,left:a,x:a+i,y:r+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Hh(e,t,s,r,o,a){const{x:i,y:l}=En(e,[t,s,r]),{x:c,y:d}=En({x:e.x+e.width,y:e.y+e.height},[t,s,r]),h=o-c,f=a-d;return{left:Math.floor(i),top:Math.floor(l),right:Math.floor(h),bottom:Math.floor(f)}}const Hs=(e,t,s,r,o,a)=>{const i=Bh(a,t,s),l=(t-i.x)/e.width,c=(s-i.y)/e.height,d=Math.min(l,c),h=wt(d,r,o),f=e.x+e.width/2,u=e.y+e.height/2,p=t/2-f*h,x=s/2-u*h,g=Hh(e,p,x,h,t,s),y={left:Math.min(g.left-i.left,0),top:Math.min(g.top-i.top,0),right:Math.min(g.right-i.right,0),bottom:Math.min(g.bottom-i.bottom,0)};return{x:p-y.left+y.right,y:x-y.top+y.bottom,zoom:h}},Ot=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function Nt(e){return e!=null&&e!=="parent"}function Xe(e){return{width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}}function di(e){return(e.measured?.width??e.width??e.initialWidth)!==void 0&&(e.measured?.height??e.height??e.initialHeight)!==void 0}function ui(e,t={width:0,height:0},s,r,o){const a={...e},i=r.get(s);if(i){const l=i.origin||o;a.x+=i.internals.positionAbsolute.x-(t.width??0)*l[0],a.y+=i.internals.positionAbsolute.y-(t.height??0)*l[1]}return a}function jr(e,t){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}function Oh(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}function Vh(e){return{...ni,...e||{}}}function Tt(e,{snapGrid:t=[0,0],snapToGrid:s=!1,transform:r,containerBounds:o}){const{x:a,y:i}=Be(e),l=Wt({x:a-(o?.left??0),y:i-(o?.top??0)},r),{x:c,y:d}=s?Xt(l,t):l;return{xSnapped:c,ySnapped:d,...l}}const Os=e=>({width:e.offsetWidth,height:e.offsetHeight}),hi=e=>e?.getRootNode?.()||window?.document,Fh=["INPUT","SELECT","TEXTAREA"];function fi(e){const t=e.composedPath?.()?.[0]||e.target;return t?.nodeType!==1?!1:Fh.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const mi=e=>"clientX"in e,Be=(e,t)=>{const s=mi(e),r=s?e.clientX:e.touches?.[0].clientX,o=s?e.clientY:e.touches?.[0].clientY;return{x:r-(t?.left??0),y:o-(t?.top??0)}},Nr=(e,t,s,r,o)=>{const a=t.querySelectorAll(`.${e}`);return!a||!a.length?null:Array.from(a).map(i=>{const l=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:o,position:i.getAttribute("data-handlepos"),x:(l.left-s.left)/r,y:(l.top-s.top)/r,...Os(i)}})};function pi({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:o,sourceControlY:a,targetControlX:i,targetControlY:l}){const c=e*.125+o*.375+i*.375+s*.125,d=t*.125+a*.375+l*.375+r*.125,h=Math.abs(c-e),f=Math.abs(d-t);return[c,d,h,f]}function on(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function kr({pos:e,x1:t,y1:s,x2:r,y2:o,c:a}){switch(e){case ne.Left:return[t-on(t-r,a),s];case ne.Right:return[t+on(r-t,a),s];case ne.Top:return[t,s-on(s-o,a)];case ne.Bottom:return[t,s+on(o-s,a)]}}function xi({sourceX:e,sourceY:t,sourcePosition:s=ne.Bottom,targetX:r,targetY:o,targetPosition:a=ne.Top,curvature:i=.25}){const[l,c]=kr({pos:s,x1:e,y1:t,x2:r,y2:o,c:i}),[d,h]=kr({pos:a,x1:r,y1:o,x2:e,y2:t,c:i}),[f,u,p,x]=pi({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:l,sourceControlY:c,targetControlX:d,targetControlY:h});return[`M${e},${t} C${l},${c} ${d},${h} ${r},${o}`,f,u,p,x]}function gi({sourceX:e,sourceY:t,targetX:s,targetY:r}){const o=Math.abs(s-e)/2,a=s<e?s+o:s-o,i=Math.abs(r-t)/2,l=r<t?r+i:r-i;return[a,l,o,i]}function Gh({sourceNode:e,targetNode:t,selected:s=!1,zIndex:r=0,elevateOnSelect:o=!1,zIndexMode:a="basic"}){if(a==="manual")return r;const i=o&&s?r+1e3:r,l=Math.max(e.parentId||o&&e.selected?e.internals.z:0,t.parentId||o&&t.selected?t.internals.z:0);return i+l}function Uh({sourceNode:e,targetNode:t,width:s,height:r,transform:o}){const a=Hn(_n(e),_n(t));a.x===a.x2&&(a.x2+=1),a.y===a.y2&&(a.y2+=1);const i={x:-o[0]/o[2],y:-o[1]/o[2],width:s/o[2],height:r/o[2]};return Ht(i,On(a))>0}const qh=({source:e,sourceHandle:t,target:s,targetHandle:r})=>`xy-edge__${e}${t||""}-${s}${r||""}`,Yh=(e,t)=>t.some(s=>s.source===e.source&&s.target===e.target&&(s.sourceHandle===e.sourceHandle||!s.sourceHandle&&!e.sourceHandle)&&(s.targetHandle===e.targetHandle||!s.targetHandle&&!e.targetHandle)),Zh=(e,t,s={})=>{if(!e.source||!e.target)return t;const r=s.getEdgeId||qh;let o;return oi(e)?o={...e}:o={...e,id:r(e)},Yh(o,t)?t:(o.sourceHandle===null&&delete o.sourceHandle,o.targetHandle===null&&delete o.targetHandle,t.concat(o))};function bi({sourceX:e,sourceY:t,targetX:s,targetY:r}){const[o,a,i,l]=gi({sourceX:e,sourceY:t,targetX:s,targetY:r});return[`M ${e},${t}L ${s},${r}`,o,a,i,l]}const Cr={[ne.Left]:{x:-1,y:0},[ne.Right]:{x:1,y:0},[ne.Top]:{x:0,y:-1},[ne.Bottom]:{x:0,y:1}},Xh=({source:e,sourcePosition:t=ne.Bottom,target:s})=>t===ne.Left||t===ne.Right?e.x<s.x?{x:1,y:0}:{x:-1,y:0}:e.y<s.y?{x:0,y:1}:{x:0,y:-1},Sr=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Wh({source:e,sourcePosition:t=ne.Bottom,target:s,targetPosition:r=ne.Top,center:o,offset:a,stepPosition:i}){const l=Cr[t],c=Cr[r],d={x:e.x+l.x*a,y:e.y+l.y*a},h={x:s.x+c.x*a,y:s.y+c.y*a},f=Xh({source:d,sourcePosition:t,target:h}),u=f.x!==0?"x":"y",p=f[u];let x=[],g,y;const v={x:0,y:0},k={x:0,y:0},[,,m,j]=gi({sourceX:e.x,sourceY:e.y,targetX:s.x,targetY:s.y});if(l[u]*c[u]===-1){u==="x"?(g=o.x??d.x+(h.x-d.x)*i,y=o.y??(d.y+h.y)/2):(g=o.x??(d.x+h.x)/2,y=o.y??d.y+(h.y-d.y)*i);const w=[{x:g,y:d.y},{x:g,y:h.y}],C=[{x:d.x,y},{x:h.x,y}];l[u]===p?x=u==="x"?w:C:x=u==="x"?C:w}else{const w=[{x:d.x,y:h.y}],C=[{x:h.x,y:d.y}];if(u==="x"?x=l.x===p?C:w:x=l.y===p?w:C,t===r){const P=Math.abs(e[u]-s[u]);if(P<=a){const H=Math.min(a-1,a-P);l[u]===p?v[u]=(d[u]>e[u]?-1:1)*H:k[u]=(h[u]>s[u]?-1:1)*H}}if(t!==r){const P=u==="x"?"y":"x",H=l[u]===c[P],N=d[P]>h[P],M=d[P]<h[P];(l[u]===1&&(!H&&N||H&&M)||l[u]!==1&&(!H&&M||H&&N))&&(x=u==="x"?w:C)}const I={x:d.x+v.x,y:d.y+v.y},T={x:h.x+k.x,y:h.y+k.y},$=Math.max(Math.abs(I.x-x[0].x),Math.abs(T.x-x[0].x)),S=Math.max(Math.abs(I.y-x[0].y),Math.abs(T.y-x[0].y));$>=S?(g=(I.x+T.x)/2,y=x[0].y):(g=x[0].x,y=(I.y+T.y)/2)}return[[e,{x:d.x+v.x,y:d.y+v.y},...x,{x:h.x+k.x,y:h.y+k.y},s],g,y,m,j]}function Jh(e,t,s,r){const o=Math.min(Sr(e,t)/2,Sr(t,s)/2,r),{x:a,y:i}=t;if(e.x===a&&a===s.x||e.y===i&&i===s.y)return`L${a} ${i}`;if(e.y===i){const d=e.x<s.x?-1:1,h=e.y<s.y?1:-1;return`L ${a+o*d},${i}Q ${a},${i} ${a},${i+o*h}`}const l=e.x<s.x?1:-1,c=e.y<s.y?-1:1;return`L ${a},${i+o*c}Q ${a},${i} ${a+o*l},${i}`}function vs({sourceX:e,sourceY:t,sourcePosition:s=ne.Bottom,targetX:r,targetY:o,targetPosition:a=ne.Top,borderRadius:i=5,centerX:l,centerY:c,offset:d=20,stepPosition:h=.5}){const[f,u,p,x,g]=Wh({source:{x:e,y:t},sourcePosition:s,target:{x:r,y:o},targetPosition:a,center:{x:l,y:c},offset:d,stepPosition:h});return[f.reduce((v,k,m)=>{let j="";return m>0&&m<f.length-1?j=Jh(f[m-1],k,f[m+1],i):j=`${m===0?"M":"L"}${k.x} ${k.y}`,v+=j,v},""),u,p,x,g]}function _r(e){return e&&!!(e.internals.handleBounds||e.handles?.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Qh(e){const{sourceNode:t,targetNode:s}=e;if(!_r(t)||!_r(s))return null;const r=t.internals.handleBounds||Er(t.handles),o=s.internals.handleBounds||Er(s.handles),a=Mr(r?.source??[],e.sourceHandle),i=Mr(e.connectionMode===yt.Strict?o?.target??[]:(o?.target??[]).concat(o?.source??[]),e.targetHandle);if(!a||!i)return e.onError?.("008",Ge.error008(a?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=a?.position||ne.Bottom,c=i?.position||ne.Top,d=dt(t,a,l),h=dt(s,i,c);return{sourceX:d.x,sourceY:d.y,targetX:h.x,targetY:h.y,sourcePosition:l,targetPosition:c}}function Er(e){if(!e)return null;const t=[],s=[];for(const r of e)r.width=r.width??1,r.height=r.height??1,r.type==="source"?t.push(r):r.type==="target"&&s.push(r);return{source:t,target:s}}function dt(e,t,s=ne.Left,r=!1){const o=(t?.x??0)+e.internals.positionAbsolute.x,a=(t?.y??0)+e.internals.positionAbsolute.y,{width:i,height:l}=t??Xe(e);if(r)return{x:o+i/2,y:a+l/2};switch(t?.position??s){case ne.Top:return{x:o+i/2,y:a};case ne.Right:return{x:o+i,y:a+l/2};case ne.Bottom:return{x:o+i/2,y:a+l};case ne.Left:return{x:o,y:a+l/2}}}function Mr(e,t){return e&&(t?e.find(s=>s.id===t):e[0])||null}function ws(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`:""}function Kh(e,{id:t,defaultColor:s,defaultMarkerStart:r,defaultMarkerEnd:o}){const a=new Set;return e.reduce((i,l)=>([l.markerStart||r,l.markerEnd||o].forEach(c=>{if(c&&typeof c=="object"){const d=ws(c,t);a.has(d)||(i.push({id:d,color:c.color||s,...c}),a.add(d))}}),i),[]).sort((i,l)=>i.id.localeCompare(l.id))}const yi=1e3,ef=10,Vs={nodeOrigin:[0,0],nodeExtent:Lt,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},tf={...Vs,checkEquality:!0};function Fs(e,t){const s={...e};for(const r in t)t[r]!==void 0&&(s[r]=t[r]);return s}function nf(e,t,s){const r=Fs(Vs,s);for(const o of e.values())if(o.parentId)Us(o,e,t,r);else{const a=Yt(o,r.nodeOrigin),i=Nt(o.extent)?o.extent:r.nodeExtent,l=ct(a,i,Xe(o));o.internals.positionAbsolute=l}}function sf(e,t){if(!e.handles)return e.measured?t?.internals.handleBounds:void 0;const s=[],r=[];for(const o of e.handles){const a={id:o.id,width:o.width??1,height:o.height??1,nodeId:e.id,x:o.x,y:o.y,position:o.position,type:o.type};o.type==="source"?s.push(a):o.type==="target"&&r.push(a)}return{source:s,target:r}}function Gs(e){return e==="manual"}function js(e,t,s,r={}){const o=Fs(tf,r),a={i:0},i=new Map(t),l=o?.elevateNodesOnSelect&&!Gs(o.zIndexMode)?yi:0;let c=e.length>0;t.clear(),s.clear();for(const d of e){let h=i.get(d.id);if(o.checkEquality&&d===h?.internals.userNode)t.set(d.id,h);else{const f=Yt(d,o.nodeOrigin),u=Nt(d.extent)?d.extent:o.nodeExtent,p=ct(f,u,Xe(d));h={...o.defaults,...d,measured:{width:d.measured?.width,height:d.measured?.height},internals:{positionAbsolute:p,handleBounds:sf(d,h),z:vi(d,l,o.zIndexMode),userNode:d}},t.set(d.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(c=!1),d.parentId&&Us(h,t,s,r,a)}return c}function rf(e,t){if(!e.parentId)return;const s=t.get(e.parentId);s?s.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Us(e,t,s,r,o){const{elevateNodesOnSelect:a,nodeOrigin:i,nodeExtent:l,zIndexMode:c}=Fs(Vs,r),d=e.parentId,h=t.get(d);if(!h){console.warn(`Parent node ${d} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}rf(e,s),o&&!h.parentId&&h.internals.rootParentIndex===void 0&&c==="auto"&&(h.internals.rootParentIndex=++o.i,h.internals.z=h.internals.z+o.i*ef),o&&h.internals.rootParentIndex!==void 0&&(o.i=h.internals.rootParentIndex);const f=a&&!Gs(c)?yi:0,{x:u,y:p,z:x}=of(e,h,i,l,f,c),{positionAbsolute:g}=e.internals,y=u!==g.x||p!==g.y;(y||x!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:y?{x:u,y:p}:g,z:x}})}function vi(e,t,s){const r=Le(e.zIndex)?e.zIndex:0;return Gs(s)?r:r+(e.selected?t:0)}function of(e,t,s,r,o,a){const{x:i,y:l}=t.internals.positionAbsolute,c=Xe(e),d=Yt(e,s),h=Nt(e.extent)?ct(d,e.extent,c):d;let f=ct({x:i+h.x,y:l+h.y},r,c);e.extent==="parent"&&(f=ai(f,c,t));const u=vi(e,o,a),p=t.internals.z??0;return{x:f.x,y:f.y,z:p>=u?p+1:u}}function qs(e,t,s,r=[0,0]){const o=[],a=new Map;for(const i of e){const l=t.get(i.parentId);if(!l)continue;const c=a.get(i.parentId)?.expandedRect??jt(l),d=ci(c,i.rect);a.set(i.parentId,{expandedRect:d,parent:l})}return a.size>0&&a.forEach(({expandedRect:i,parent:l},c)=>{const d=l.internals.positionAbsolute,h=Xe(l),f=l.origin??r,u=i.x<d.x?Math.round(Math.abs(d.x-i.x)):0,p=i.y<d.y?Math.round(Math.abs(d.y-i.y)):0,x=Math.max(h.width,Math.round(i.width)),g=Math.max(h.height,Math.round(i.height)),y=(x-h.width)*f[0],v=(g-h.height)*f[1];(u>0||p>0||y||v)&&(o.push({id:c,type:"position",position:{x:l.position.x-u+y,y:l.position.y-p+v}}),s.get(c)?.forEach(k=>{e.some(m=>m.id===k.id)||o.push({id:k.id,type:"position",position:{x:k.position.x+u,y:k.position.y+p}})})),(h.width<i.width||h.height<i.height||u||p)&&o.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:x+(u?f[0]*u-y:0),height:g+(p?f[1]*p-v:0)}})}),o}function af(e,t,s,r,o,a,i){const l=r?.querySelector(".xyflow__viewport");let c=!1;if(!l)return{changes:[],updatedInternals:c};const d=[],h=window.getComputedStyle(l),{m22:f}=new window.DOMMatrixReadOnly(h.transform),u=[];for(const p of e.values()){const x=t.get(p.id);if(!x)continue;if(x.hidden){t.set(x.id,{...x,internals:{...x.internals,handleBounds:void 0}}),c=!0;continue}const g=Os(p.nodeElement),y=x.measured.width!==g.width||x.measured.height!==g.height;if(!!(g.width&&g.height&&(y||!x.internals.handleBounds||p.force))){const k=p.nodeElement.getBoundingClientRect(),m=Nt(x.extent)?x.extent:a;let{positionAbsolute:j}=x.internals;x.parentId&&x.extent==="parent"?j=ai(j,g,t.get(x.parentId)):m&&(j=ct(j,m,g));const E={...x,measured:g,internals:{...x.internals,positionAbsolute:j,handleBounds:{source:Nr("source",p.nodeElement,k,f,x.id),target:Nr("target",p.nodeElement,k,f,x.id)}}};t.set(x.id,E),x.parentId&&Us(E,t,s,{nodeOrigin:o,zIndexMode:i}),c=!0,y&&(d.push({id:x.id,type:"dimensions",dimensions:g}),x.expandParent&&x.parentId&&u.push({id:x.id,parentId:x.parentId,rect:jt(E,o)}))}}if(u.length>0){const p=qs(u,t,s,o);d.push(...p)}return{changes:d,updatedInternals:c}}async function lf({delta:e,panZoom:t,transform:s,translateExtent:r,width:o,height:a}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:s[0]+e.x,y:s[1]+e.y,zoom:s[2]},[[0,0],[o,a]],r),l=!!i&&(i.x!==s[0]||i.y!==s[1]||i.k!==s[2]);return Promise.resolve(l)}function Ir(e,t,s,r,o,a){let i=o;const l=r.get(i)||new Map;r.set(i,l.set(s,t)),i=`${o}-${e}`;const c=r.get(i)||new Map;if(r.set(i,c.set(s,t)),a){i=`${o}-${e}-${a}`;const d=r.get(i)||new Map;r.set(i,d.set(s,t))}}function wi(e,t,s){e.clear(),t.clear();for(const r of s){const{source:o,target:a,sourceHandle:i=null,targetHandle:l=null}=r,c={edgeId:r.id,source:o,target:a,sourceHandle:i,targetHandle:l},d=`${o}-${i}--${a}-${l}`,h=`${a}-${l}--${o}-${i}`;Ir("source",c,h,e,o,i),Ir("target",c,d,e,a,l),t.set(r.id,r)}}function ji(e,t){if(!e.parentId)return!1;const s=t.get(e.parentId);return s?s.selected?!0:ji(s,t):!1}function Ar(e,t,s){let r=e;do{if(r?.matches?.(t))return!0;if(r===s)return!1;r=r?.parentElement}while(r);return!1}function cf(e,t,s,r){const o=new Map;for(const[a,i]of e)if((i.selected||i.id===r)&&(!i.parentId||!ji(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const l=e.get(a);l&&o.set(a,{id:a,position:l.position||{x:0,y:0},distance:{x:s.x-l.internals.positionAbsolute.x,y:s.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return o}function Kn({nodeId:e,dragItems:t,nodeLookup:s,dragging:r=!0}){const o=[];for(const[i,l]of t){const c=s.get(i)?.internals.userNode;c&&o.push({...c,position:l.position,dragging:r})}if(!e)return[o[0],o];const a=s.get(e)?.internals.userNode;return[a?{...a,position:t.get(e)?.position||a.position,dragging:r}:o[0],o]}function df({dragItems:e,snapGrid:t,x:s,y:r}){const o=e.values().next().value;if(!o)return null;const a={x:s-o.distance.x,y:r-o.distance.y},i=Xt(a,t);return{x:i.x-a.x,y:i.y-a.y}}function uf({onNodeMouseDown:e,getStoreItems:t,onDragStart:s,onDrag:r,onDragStop:o}){let a={x:null,y:null},i=0,l=new Map,c=!1,d={x:0,y:0},h=null,f=!1,u=null,p=!1,x=!1,g=null;function y({noDragClassName:k,handleSelector:m,domNode:j,isSelectable:E,nodeId:w,nodeClickDistance:C=0}){u=Ae(j);function I({x:P,y:H}){const{nodeLookup:N,nodeExtent:M,snapGrid:_,snapToGrid:D,nodeOrigin:A,onNodeDrag:z,onSelectionDrag:O,onError:F,updateNodePositions:V}=t();a={x:P,y:H};let Q=!1;const X=l.size>1,te=X&&M?ys(Zt(l)):null,Z=X&&D?df({dragItems:l,snapGrid:_,x:P,y:H}):null;for(const[B,R]of l){if(!N.has(B))continue;let J={x:P-R.distance.x,y:H-R.distance.y};D&&(J=Z?{x:Math.round(J.x+Z.x),y:Math.round(J.y+Z.y)}:Xt(J,_));let W=null;if(X&&M&&!R.extent&&te){const{positionAbsolute:K}=R.internals,re=K.x-te.x+M[0][0],ae=K.x+R.measured.width-te.x2+M[1][0],ce=K.y-te.y+M[0][1],de=K.y+R.measured.height-te.y2+M[1][1];W=[[re,ce],[ae,de]]}const{position:se,positionAbsolute:q}=ii({nodeId:B,nextPosition:J,nodeLookup:N,nodeExtent:W||M,nodeOrigin:A,onError:F});Q=Q||R.position.x!==se.x||R.position.y!==se.y,R.position=se,R.internals.positionAbsolute=q}if(x=x||Q,!!Q&&(V(l,!0),g&&(r||z||!w&&O))){const[B,R]=Kn({nodeId:w,dragItems:l,nodeLookup:N});r?.(g,l,B,R),z?.(g,B,R),w||O?.(g,R)}}async function T(){if(!h)return;const{transform:P,panBy:H,autoPanSpeed:N,autoPanOnNodeDrag:M}=t();if(!M){c=!1,cancelAnimationFrame(i);return}const[_,D]=li(d,h,N);(_!==0||D!==0)&&(a.x=(a.x??0)-_/P[2],a.y=(a.y??0)-D/P[2],await H({x:_,y:D})&&I(a)),i=requestAnimationFrame(T)}function $(P){const{nodeLookup:H,multiSelectionActive:N,nodesDraggable:M,transform:_,snapGrid:D,snapToGrid:A,selectNodesOnDrag:z,onNodeDragStart:O,onSelectionDragStart:F,unselectNodesAndEdges:V}=t();f=!0,(!z||!E)&&!N&&w&&(H.get(w)?.selected||V()),E&&z&&w&&e?.(w);const Q=Tt(P.sourceEvent,{transform:_,snapGrid:D,snapToGrid:A,containerBounds:h});if(a=Q,l=cf(H,M,Q,w),l.size>0&&(s||O||!w&&F)){const[X,te]=Kn({nodeId:w,dragItems:l,nodeLookup:H});s?.(P.sourceEvent,l,X,te),O?.(P.sourceEvent,X,te),w||F?.(P.sourceEvent,te)}}const S=Bo().clickDistance(C).on("start",P=>{const{domNode:H,nodeDragThreshold:N,transform:M,snapGrid:_,snapToGrid:D}=t();h=H?.getBoundingClientRect()||null,p=!1,x=!1,g=P.sourceEvent,N===0&&$(P),a=Tt(P.sourceEvent,{transform:M,snapGrid:_,snapToGrid:D,containerBounds:h}),d=Be(P.sourceEvent,h)}).on("drag",P=>{const{autoPanOnNodeDrag:H,transform:N,snapGrid:M,snapToGrid:_,nodeDragThreshold:D,nodeLookup:A}=t(),z=Tt(P.sourceEvent,{transform:N,snapGrid:M,snapToGrid:_,containerBounds:h});if(g=P.sourceEvent,(P.sourceEvent.type==="touchmove"&&P.sourceEvent.touches.length>1||w&&!A.has(w))&&(p=!0),!p){if(!c&&H&&f&&(c=!0,T()),!f){const O=Be(P.sourceEvent,h),F=O.x-d.x,V=O.y-d.y;Math.sqrt(F*F+V*V)>D&&$(P)}(a.x!==z.xSnapped||a.y!==z.ySnapped)&&l&&f&&(d=Be(P.sourceEvent,h),I(z))}}).on("end",P=>{if(!(!f||p)&&(c=!1,f=!1,cancelAnimationFrame(i),l.size>0)){const{nodeLookup:H,updateNodePositions:N,onNodeDragStop:M,onSelectionDragStop:_}=t();if(x&&(N(l,!1),x=!1),o||M||!w&&_){const[D,A]=Kn({nodeId:w,dragItems:l,nodeLookup:H,dragging:!1});o?.(P.sourceEvent,l,D,A),M?.(P.sourceEvent,D,A),w||_?.(P.sourceEvent,A)}}}).filter(P=>{const H=P.target;return!P.button&&(!k||!Ar(H,`.${k}`,j))&&(!m||Ar(H,m,j))});u.call(S)}function v(){u?.on(".drag",null)}return{update:y,destroy:v}}function hf(e,t,s){const r=[],o={x:e.x-s,y:e.y-s,width:s*2,height:s*2};for(const a of t.values())Ht(o,jt(a))>0&&r.push(a);return r}const ff=250;function mf(e,t,s,r){let o=[],a=1/0;const i=hf(e,s,t+ff);for(const l of i){const c=[...l.internals.handleBounds?.source??[],...l.internals.handleBounds?.target??[]];for(const d of c){if(r.nodeId===d.nodeId&&r.type===d.type&&r.id===d.id)continue;const{x:h,y:f}=dt(l,d,d.position,!0),u=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(f-e.y,2));u>t||(u<a?(o=[{...d,x:h,y:f}],a=u):u===a&&o.push({...d,x:h,y:f}))}}if(!o.length)return null;if(o.length>1){const l=r.type==="source"?"target":"source";return o.find(c=>c.type===l)??o[0]}return o[0]}function Ni(e,t,s,r,o,a=!1){const i=r.get(e);if(!i)return null;const l=o==="strict"?i.internals.handleBounds?.[t]:[...i.internals.handleBounds?.source??[],...i.internals.handleBounds?.target??[]],c=(s?l?.find(d=>d.id===s):l?.[0])??null;return c&&a?{...c,...dt(i,c,c.position,!0)}:c}function ki(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function pf(e,t){let s=null;return t?s=!0:e&&!t&&(s=!1),s}const Ci=()=>!0;function xf(e,{connectionMode:t,connectionRadius:s,handleId:r,nodeId:o,edgeUpdaterType:a,isTarget:i,domNode:l,nodeLookup:c,lib:d,autoPanOnConnect:h,flowId:f,panBy:u,cancelConnection:p,onConnectStart:x,onConnect:g,onConnectEnd:y,isValidConnection:v=Ci,onReconnectEnd:k,updateConnection:m,getTransform:j,getFromHandle:E,autoPanSpeed:w,dragThreshold:C=1,handleDomNode:I}){const T=hi(e.target);let $=0,S;const{x:P,y:H}=Be(e),N=ki(a,I),M=l?.getBoundingClientRect();let _=!1;if(!M||!N)return;const D=Ni(o,N,r,c,t);if(!D)return;let A=Be(e,M),z=!1,O=null,F=!1,V=null;function Q(){if(!h||!M)return;const[se,q]=li(A,M,w);u({x:se,y:q}),$=requestAnimationFrame(Q)}const X={...D,nodeId:o,type:N,position:D.position},te=c.get(o);let B={inProgress:!0,isValid:null,from:dt(te,X,ne.Left,!0),fromHandle:X,fromPosition:X.position,fromNode:te,to:A,toHandle:null,toPosition:yr[X.position],toNode:null,pointer:A};function R(){_=!0,m(B),x?.(e,{nodeId:o,handleId:r,handleType:N})}C===0&&R();function J(se){if(!_){const{x:de,y:je}=Be(se),Se=de-P,Ne=je-H;if(!(Se*Se+Ne*Ne>C*C))return;R()}if(!E()||!X){W(se);return}const q=j();A=Be(se,M),S=mf(Wt(A,q,!1,[1,1]),s,c,X),z||(Q(),z=!0);const K=Si(se,{handle:S,connectionMode:t,fromNodeId:o,fromHandleId:r,fromType:i?"target":"source",isValidConnection:v,doc:T,lib:d,flowId:f,nodeLookup:c});V=K.handleDomNode,O=K.connection,F=pf(!!S,K.isValid);const re=c.get(o),ae=re?dt(re,X,ne.Left,!0):B.from,ce={...B,from:ae,isValid:F,to:K.toHandle&&F?En({x:K.toHandle.x,y:K.toHandle.y},q):A,toHandle:K.toHandle,toPosition:F&&K.toHandle?K.toHandle.position:yr[X.position],toNode:K.toHandle?c.get(K.toHandle.nodeId):null,pointer:A};m(ce),B=ce}function W(se){if(!("touches"in se&&se.touches.length>0)){if(_){(S||V)&&O&&F&&g?.(O);const{inProgress:q,...K}=B,re={...K,toPosition:B.toHandle?B.toPosition:null};y?.(se,re),a&&k?.(se,re)}p(),cancelAnimationFrame($),z=!1,F=!1,O=null,V=null,T.removeEventListener("mousemove",J),T.removeEventListener("mouseup",W),T.removeEventListener("touchmove",J),T.removeEventListener("touchend",W)}}T.addEventListener("mousemove",J),T.addEventListener("mouseup",W),T.addEventListener("touchmove",J),T.addEventListener("touchend",W)}function Si(e,{handle:t,connectionMode:s,fromNodeId:r,fromHandleId:o,fromType:a,doc:i,lib:l,flowId:c,isValidConnection:d=Ci,nodeLookup:h}){const f=a==="target",u=t?i.querySelector(`.${l}-flow__handle[data-id="${c}-${t?.nodeId}-${t?.id}-${t?.type}"]`):null,{x:p,y:x}=Be(e),g=i.elementFromPoint(p,x),y=g?.classList.contains(`${l}-flow__handle`)?g:u,v={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const k=ki(void 0,y),m=y.getAttribute("data-nodeid"),j=y.getAttribute("data-handleid"),E=y.classList.contains("connectable"),w=y.classList.contains("connectableend");if(!m||!k)return v;const C={source:f?m:r,sourceHandle:f?j:o,target:f?r:m,targetHandle:f?o:j};v.connection=C;const T=E&&w&&(s===yt.Strict?f&&k==="source"||!f&&k==="target":m!==r||j!==o);v.isValid=T&&d(C),v.toHandle=Ni(m,k,j,h,s,!0)}return v}const Ns={onPointerDown:xf,isValid:Si};function gf({domNode:e,panZoom:t,getTransform:s,getViewScale:r}){const o=Ae(e);function a({translateExtent:l,width:c,height:d,zoomStep:h=1,pannable:f=!0,zoomable:u=!0,inversePan:p=!1}){const x=m=>{if(m.sourceEvent.type!=="wheel"||!t)return;const j=s(),E=m.sourceEvent.ctrlKey&&Ot()?10:1,w=-m.sourceEvent.deltaY*(m.sourceEvent.deltaMode===1?.05:m.sourceEvent.deltaMode?1:.002)*h,C=j[2]*Math.pow(2,w*E);t.scaleTo(C)};let g=[0,0];const y=m=>{(m.sourceEvent.type==="mousedown"||m.sourceEvent.type==="touchstart")&&(g=[m.sourceEvent.clientX??m.sourceEvent.touches[0].clientX,m.sourceEvent.clientY??m.sourceEvent.touches[0].clientY])},v=m=>{const j=s();if(m.sourceEvent.type!=="mousemove"&&m.sourceEvent.type!=="touchmove"||!t)return;const E=[m.sourceEvent.clientX??m.sourceEvent.touches[0].clientX,m.sourceEvent.clientY??m.sourceEvent.touches[0].clientY],w=[E[0]-g[0],E[1]-g[1]];g=E;const C=r()*Math.max(j[2],Math.log(j[2]))*(p?-1:1),I={x:j[0]-w[0]*C,y:j[1]-w[1]*C},T=[[0,0],[c,d]];t.setViewportConstrained({x:I.x,y:I.y,zoom:j[2]},T,l)},k=ei().on("start",y).on("zoom",f?v:null).on("zoom.wheel",u?x:null);o.call(k,{})}function i(){o.on("zoom",null)}return{update:a,destroy:i,pointer:Re}}const Vn=e=>({x:e.x,y:e.y,zoom:e.k}),es=({x:e,y:t,zoom:s})=>Bn.translate(e,t).scale(s),ft=(e,t)=>e.target.closest(`.${t}`),_i=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),bf=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,ts=(e,t=0,s=bf,r=()=>{})=>{const o=typeof t=="number"&&t>0;return o||r(),o?e.transition().duration(t).ease(s).on("end",r):e},Ei=e=>{const t=e.ctrlKey&&Ot()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function yf({zoomPanValues:e,noWheelClassName:t,d3Selection:s,d3Zoom:r,panOnScrollMode:o,panOnScrollSpeed:a,zoomOnPinch:i,onPanZoomStart:l,onPanZoom:c,onPanZoomEnd:d}){return h=>{if(ft(h,t))return h.ctrlKey&&h.preventDefault(),!1;h.preventDefault(),h.stopImmediatePropagation();const f=s.property("__zoom").k||1;if(h.ctrlKey&&i){const y=Re(h),v=Ei(h),k=f*Math.pow(2,v);r.scaleTo(s,k,y,h);return}const u=h.deltaMode===1?20:1;let p=o===it.Vertical?0:h.deltaX*u,x=o===it.Horizontal?0:h.deltaY*u;!Ot()&&h.shiftKey&&o!==it.Vertical&&(p=h.deltaY*u,x=0),r.translateBy(s,-(p/f)*a,-(x/f)*a,{internal:!0});const g=Vn(s.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(c?.(h,g),e.panScrollTimeout=setTimeout(()=>{d?.(h,g),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,l?.(h,g))}}function vf({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:s}){return function(r,o){const a=r.type==="wheel",i=!t&&a&&!r.ctrlKey,l=ft(r,e);if(r.ctrlKey&&a&&l&&r.preventDefault(),i||l)return null;r.preventDefault(),s.call(this,r,o)}}function wf({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:s}){return r=>{if(r.sourceEvent?.internal)return;const o=Vn(r.transform);e.mouseButton=r.sourceEvent?.button||0,e.isZoomingOrPanning=!0,e.prevViewport=o,r.sourceEvent?.type==="mousedown"&&t(!0),s&&s?.(r.sourceEvent,o)}}function jf({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:s,onTransformChange:r,onPanZoom:o}){return a=>{e.usedRightMouseButton=!!(s&&_i(t,e.mouseButton??0)),a.sourceEvent?.sync||r([a.transform.x,a.transform.y,a.transform.k]),o&&!a.sourceEvent?.internal&&o?.(a.sourceEvent,Vn(a.transform))}}function Nf({zoomPanValues:e,panOnDrag:t,panOnScroll:s,onDraggingChange:r,onPanZoomEnd:o,onPaneContextMenu:a}){return i=>{if(!i.sourceEvent?.internal&&(e.isZoomingOrPanning=!1,a&&_i(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&a(i.sourceEvent),e.usedRightMouseButton=!1,r(!1),o)){const l=Vn(i.transform);e.prevViewport=l,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o?.(i.sourceEvent,l)},s?150:0)}}}function kf({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:s,panOnDrag:r,panOnScroll:o,zoomOnDoubleClick:a,userSelectionActive:i,noWheelClassName:l,noPanClassName:c,lib:d,connectionInProgress:h}){return f=>{const u=e||t,p=s&&f.ctrlKey,x=f.type==="wheel";if(f.button===1&&f.type==="mousedown"&&(ft(f,`${d}-flow__node`)||ft(f,`${d}-flow__edge`)))return!0;if(!r&&!u&&!o&&!a&&!s||i||h&&!x||ft(f,l)&&x||ft(f,c)&&(!x||o&&x&&!e)||!s&&f.ctrlKey&&x)return!1;if(!s&&f.type==="touchstart"&&f.touches?.length>1)return f.preventDefault(),!1;if(!u&&!o&&!p&&x||!r&&(f.type==="mousedown"||f.type==="touchstart")||Array.isArray(r)&&!r.includes(f.button)&&f.type==="mousedown")return!1;const g=Array.isArray(r)&&r.includes(f.button)||!f.button||f.button<=1;return(!f.ctrlKey||x)&&g}}function Cf({domNode:e,minZoom:t,maxZoom:s,translateExtent:r,viewport:o,onPanZoom:a,onPanZoomStart:i,onPanZoomEnd:l,onDraggingChange:c}){const d={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},h=e.getBoundingClientRect(),f=ei().scaleExtent([t,s]).translateExtent(r),u=Ae(e).call(f);k({x:o.x,y:o.y,zoom:wt(o.zoom,t,s)},[[0,0],[h.width,h.height]],r);const p=u.on("wheel.zoom"),x=u.on("dblclick.zoom");f.wheelDelta(Ei);function g(S,P){return u?new Promise(H=>{f?.interpolate(P?.interpolate==="linear"?At:hn).transform(ts(u,P?.duration,P?.ease,()=>H(!0)),S)}):Promise.resolve(!1)}function y({noWheelClassName:S,noPanClassName:P,onPaneContextMenu:H,userSelectionActive:N,panOnScroll:M,panOnDrag:_,panOnScrollMode:D,panOnScrollSpeed:A,preventScrolling:z,zoomOnPinch:O,zoomOnScroll:F,zoomOnDoubleClick:V,zoomActivationKeyPressed:Q,lib:X,onTransformChange:te,connectionInProgress:Z,paneClickDistance:B,selectionOnDrag:R}){N&&!d.isZoomingOrPanning&&v();const J=M&&!Q&&!N;f.clickDistance(R?1/0:!Le(B)||B<0?0:B);const W=J?yf({zoomPanValues:d,noWheelClassName:S,d3Selection:u,d3Zoom:f,panOnScrollMode:D,panOnScrollSpeed:A,zoomOnPinch:O,onPanZoomStart:i,onPanZoom:a,onPanZoomEnd:l}):vf({noWheelClassName:S,preventScrolling:z,d3ZoomHandler:p});if(u.on("wheel.zoom",W,{passive:!1}),!N){const q=wf({zoomPanValues:d,onDraggingChange:c,onPanZoomStart:i});f.on("start",q);const K=jf({zoomPanValues:d,panOnDrag:_,onPaneContextMenu:!!H,onPanZoom:a,onTransformChange:te});f.on("zoom",K);const re=Nf({zoomPanValues:d,panOnDrag:_,panOnScroll:M,onPaneContextMenu:H,onPanZoomEnd:l,onDraggingChange:c});f.on("end",re)}const se=kf({zoomActivationKeyPressed:Q,panOnDrag:_,zoomOnScroll:F,panOnScroll:M,zoomOnDoubleClick:V,zoomOnPinch:O,userSelectionActive:N,noPanClassName:P,noWheelClassName:S,lib:X,connectionInProgress:Z});f.filter(se),V?u.on("dblclick.zoom",x):u.on("dblclick.zoom",null)}function v(){f.on("zoom",null)}async function k(S,P,H){const N=es(S),M=f?.constrain()(N,P,H);return M&&await g(M),new Promise(_=>_(M))}async function m(S,P){const H=es(S);return await g(H,P),new Promise(N=>N(H))}function j(S){if(u){const P=es(S),H=u.property("__zoom");(H.k!==S.zoom||H.x!==S.x||H.y!==S.y)&&f?.transform(u,P,null,{sync:!0})}}function E(){const S=u?Ko(u.node()):{x:0,y:0,k:1};return{x:S.x,y:S.y,zoom:S.k}}function w(S,P){return u?new Promise(H=>{f?.interpolate(P?.interpolate==="linear"?At:hn).scaleTo(ts(u,P?.duration,P?.ease,()=>H(!0)),S)}):Promise.resolve(!1)}function C(S,P){return u?new Promise(H=>{f?.interpolate(P?.interpolate==="linear"?At:hn).scaleBy(ts(u,P?.duration,P?.ease,()=>H(!0)),S)}):Promise.resolve(!1)}function I(S){f?.scaleExtent(S)}function T(S){f?.translateExtent(S)}function $(S){const P=!Le(S)||S<0?0:S;f?.clickDistance(P)}return{update:y,destroy:v,setViewport:m,setViewportConstrained:k,getViewport:E,scaleTo:w,scaleBy:C,setScaleExtent:I,setTranslateExtent:T,syncViewport:j,setClickDistance:$}}var kt;(function(e){e.Line="line",e.Handle="handle"})(kt||(kt={}));function Sf({width:e,prevWidth:t,height:s,prevHeight:r,affectsX:o,affectsY:a}){const i=e-t,l=s-r,c=[i>0?1:i<0?-1:0,l>0?1:l<0?-1:0];return i&&o&&(c[0]=c[0]*-1),l&&a&&(c[1]=c[1]*-1),c}function Tr(e){const t=e.includes("right")||e.includes("left"),s=e.includes("bottom")||e.includes("top"),r=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:s,affectsX:r,affectsY:o}}function We(e,t){return Math.max(0,t-e)}function Je(e,t){return Math.max(0,e-t)}function an(e,t,s){return Math.max(0,t-e,e-s)}function $r(e,t){return e?!t:t}function _f(e,t,s,r,o,a,i,l){let{affectsX:c,affectsY:d}=t;const{isHorizontal:h,isVertical:f}=t,u=h&&f,{xSnapped:p,ySnapped:x}=s,{minWidth:g,maxWidth:y,minHeight:v,maxHeight:k}=r,{x:m,y:j,width:E,height:w,aspectRatio:C}=e;let I=Math.floor(h?p-e.pointerX:0),T=Math.floor(f?x-e.pointerY:0);const $=E+(c?-I:I),S=w+(d?-T:T),P=-a[0]*E,H=-a[1]*w;let N=an($,g,y),M=an(S,v,k);if(i){let A=0,z=0;c&&I<0?A=We(m+I+P,i[0][0]):!c&&I>0&&(A=Je(m+$+P,i[1][0])),d&&T<0?z=We(j+T+H,i[0][1]):!d&&T>0&&(z=Je(j+S+H,i[1][1])),N=Math.max(N,A),M=Math.max(M,z)}if(l){let A=0,z=0;c&&I>0?A=Je(m+I,l[0][0]):!c&&I<0&&(A=We(m+$,l[1][0])),d&&T>0?z=Je(j+T,l[0][1]):!d&&T<0&&(z=We(j+S,l[1][1])),N=Math.max(N,A),M=Math.max(M,z)}if(o){if(h){const A=an($/C,v,k)*C;if(N=Math.max(N,A),i){let z=0;!c&&!d||c&&!d&&u?z=Je(j+H+$/C,i[1][1])*C:z=We(j+H+(c?I:-I)/C,i[0][1])*C,N=Math.max(N,z)}if(l){let z=0;!c&&!d||c&&!d&&u?z=We(j+$/C,l[1][1])*C:z=Je(j+(c?I:-I)/C,l[0][1])*C,N=Math.max(N,z)}}if(f){const A=an(S*C,g,y)/C;if(M=Math.max(M,A),i){let z=0;!c&&!d||d&&!c&&u?z=Je(m+S*C+P,i[1][0])/C:z=We(m+(d?T:-T)*C+P,i[0][0])/C,M=Math.max(M,z)}if(l){let z=0;!c&&!d||d&&!c&&u?z=We(m+S*C,l[1][0])/C:z=Je(m+(d?T:-T)*C,l[0][0])/C,M=Math.max(M,z)}}}T=T+(T<0?M:-M),I=I+(I<0?N:-N),o&&(u?$>S*C?T=($r(c,d)?-I:I)/C:I=($r(c,d)?-T:T)*C:h?(T=I/C,d=c):(I=T*C,c=d));const _=c?m+I:m,D=d?j+T:j;return{width:E+(c?-I:I),height:w+(d?-T:T),x:a[0]*I*(c?-1:1)+_,y:a[1]*T*(d?-1:1)+D}}const Mi={width:0,height:0,x:0,y:0},Ef={...Mi,pointerX:0,pointerY:0,aspectRatio:1};function Mf(e){return[[0,0],[e.measured.width,e.measured.height]]}function If(e,t,s){const r=t.position.x+e.position.x,o=t.position.y+e.position.y,a=e.measured.width??0,i=e.measured.height??0,l=s[0]*a,c=s[1]*i;return[[r-l,o-c],[r+a-l,o+i-c]]}function Af({domNode:e,nodeId:t,getStoreItems:s,onChange:r,onEnd:o}){const a=Ae(e);let i={controlDirection:Tr("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function l({controlPosition:d,boundaries:h,keepAspectRatio:f,resizeDirection:u,onResizeStart:p,onResize:x,onResizeEnd:g,shouldResize:y}){let v={...Mi},k={...Ef};i={boundaries:h,resizeDirection:u,keepAspectRatio:f,controlDirection:Tr(d)};let m,j=null,E=[],w,C,I,T=!1;const $=Bo().on("start",S=>{const{nodeLookup:P,transform:H,snapGrid:N,snapToGrid:M,nodeOrigin:_,paneDomNode:D}=s();if(m=P.get(t),!m)return;j=D?.getBoundingClientRect()??null;const{xSnapped:A,ySnapped:z}=Tt(S.sourceEvent,{transform:H,snapGrid:N,snapToGrid:M,containerBounds:j});v={width:m.measured.width??0,height:m.measured.height??0,x:m.position.x??0,y:m.position.y??0},k={...v,pointerX:A,pointerY:z,aspectRatio:v.width/v.height},w=void 0,m.parentId&&(m.extent==="parent"||m.expandParent)&&(w=P.get(m.parentId),C=w&&m.extent==="parent"?Mf(w):void 0),E=[],I=void 0;for(const[O,F]of P)if(F.parentId===t&&(E.push({id:O,position:{...F.position},extent:F.extent}),F.extent==="parent"||F.expandParent)){const V=If(F,m,F.origin??_);I?I=[[Math.min(V[0][0],I[0][0]),Math.min(V[0][1],I[0][1])],[Math.max(V[1][0],I[1][0]),Math.max(V[1][1],I[1][1])]]:I=V}p?.(S,{...v})}).on("drag",S=>{const{transform:P,snapGrid:H,snapToGrid:N,nodeOrigin:M}=s(),_=Tt(S.sourceEvent,{transform:P,snapGrid:H,snapToGrid:N,containerBounds:j}),D=[];if(!m)return;const{x:A,y:z,width:O,height:F}=v,V={},Q=m.origin??M,{width:X,height:te,x:Z,y:B}=_f(k,i.controlDirection,_,i.boundaries,i.keepAspectRatio,Q,C,I),R=X!==O,J=te!==F,W=Z!==A&&R,se=B!==z&&J;if(!W&&!se&&!R&&!J)return;if((W||se||Q[0]===1||Q[1]===1)&&(V.x=W?Z:v.x,V.y=se?B:v.y,v.x=V.x,v.y=V.y,E.length>0)){const ae=Z-A,ce=B-z;for(const de of E)de.position={x:de.position.x-ae+Q[0]*(X-O),y:de.position.y-ce+Q[1]*(te-F)},D.push(de)}if((R||J)&&(V.width=R&&(!i.resizeDirection||i.resizeDirection==="horizontal")?X:v.width,V.height=J&&(!i.resizeDirection||i.resizeDirection==="vertical")?te:v.height,v.width=V.width,v.height=V.height),w&&m.expandParent){const ae=Q[0]*(V.width??0);V.x&&V.x<ae&&(v.x=ae,k.x=k.x-(V.x-ae));const ce=Q[1]*(V.height??0);V.y&&V.y<ce&&(v.y=ce,k.y=k.y-(V.y-ce))}const q=Sf({width:v.width,prevWidth:O,height:v.height,prevHeight:F,affectsX:i.controlDirection.affectsX,affectsY:i.controlDirection.affectsY}),K={...v,direction:q};y?.(S,K)!==!1&&(T=!0,x?.(S,K),r(V,D))}).on("end",S=>{T&&(g?.(S,{...v}),o?.({...v}),T=!1)});a.call($)}function c(){a.on(".drag",null)}return{update:l,destroy:c}}var ns={exports:{}},ss={},rs={exports:{}},os={};var Pr;function Tf(){if(Pr)return os;Pr=1;var e=xo();function t(f,u){return f===u&&(f!==0||1/f===1/u)||f!==f&&u!==u}var s=typeof Object.is=="function"?Object.is:t,r=e.useState,o=e.useEffect,a=e.useLayoutEffect,i=e.useDebugValue;function l(f,u){var p=u(),x=r({inst:{value:p,getSnapshot:u}}),g=x[0].inst,y=x[1];return a(function(){g.value=p,g.getSnapshot=u,c(g)&&y({inst:g})},[f,p,u]),o(function(){return c(g)&&y({inst:g}),f(function(){c(g)&&y({inst:g})})},[f]),i(p),p}function c(f){var u=f.getSnapshot;f=f.value;try{var p=u();return!s(f,p)}catch{return!0}}function d(f,u){return u()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return os.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:h,os}var Dr;function $f(){return Dr||(Dr=1,rs.exports=Tf()),rs.exports}var Rr;function Pf(){if(Rr)return ss;Rr=1;var e=xo(),t=$f();function s(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var r=typeof Object.is=="function"?Object.is:s,o=t.useSyncExternalStore,a=e.useRef,i=e.useEffect,l=e.useMemo,c=e.useDebugValue;return ss.useSyncExternalStoreWithSelector=function(d,h,f,u,p){var x=a(null);if(x.current===null){var g={hasValue:!1,value:null};x.current=g}else g=x.current;x=l(function(){function v(w){if(!k){if(k=!0,m=w,w=u(w),p!==void 0&&g.hasValue){var C=g.value;if(p(C,w))return j=C}return j=w}if(C=j,r(m,w))return C;var I=u(w);return p!==void 0&&p(C,I)?(m=w,C):(m=w,j=I)}var k=!1,m,j,E=f===void 0?null:f;return[function(){return v(h())},E===null?void 0:function(){return v(E())}]},[h,f,u,p]);var y=o(d,x[0],x[1]);return i(function(){g.hasValue=!0,g.value=y},[y]),c(y),y},ss}var zr;function Df(){return zr||(zr=1,ns.exports=Pf()),ns.exports}var Rf=Df();const zf=al(Rf),Lf={},Lr=e=>{let t;const s=new Set,r=(h,f)=>{const u=typeof h=="function"?h(t):h;if(!Object.is(u,t)){const p=t;t=f??(typeof u!="object"||u===null)?u:Object.assign({},t,u),s.forEach(x=>x(t,p))}},o=()=>t,c={setState:r,getState:o,getInitialState:()=>d,subscribe:h=>(s.add(h),()=>s.delete(h)),destroy:()=>{(Lf?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},d=t=e(r,o,c);return c},Bf=e=>e?Lr(e):Lr,{useDebugValue:Hf}=ll,{useSyncExternalStoreWithSelector:Of}=zf,Vf=e=>e;function Ii(e,t=Vf,s){const r=Of(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return Hf(r),r}const Br=(e,t)=>{const s=Bf(e),r=(o,a=t)=>Ii(s,o,a);return Object.assign(r,s),r},Ff=(e,t)=>e?Br(e,t):Br;function pe(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!1;for(const r of s)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}const Fn=b.createContext(null),Gf=Fn.Provider,Ai=Ge.error001();function le(e,t){const s=b.useContext(Fn);if(s===null)throw new Error(Ai);return Ii(s,e,t)}function xe(){const e=b.useContext(Fn);if(e===null)throw new Error(Ai);return b.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Hr={display:"none"},Uf={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ti="react-flow__node-desc",$i="react-flow__edge-desc",qf="react-flow__aria-live",Yf=e=>e.ariaLiveMessage,Zf=e=>e.ariaLabelConfig;function Xf({rfId:e}){const t=le(Yf);return n.jsx("div",{id:`${qf}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Uf,children:t})}function Wf({rfId:e,disableKeyboardA11y:t}){const s=le(Zf);return n.jsxs(n.Fragment,{children:[n.jsx("div",{id:`${Ti}-${e}`,style:Hr,children:t?s["node.a11yDescription.default"]:s["node.a11yDescription.keyboardDisabled"]}),n.jsx("div",{id:`${$i}-${e}`,style:Hr,children:s["edge.a11yDescription.default"]}),!t&&n.jsx(Xf,{rfId:e})]})}const Jt=b.forwardRef(({position:e="top-left",children:t,className:s,style:r,...o},a)=>{const i=`${e}`.split("-");return n.jsx("div",{className:ye(["react-flow__panel",s,...i]),style:r,ref:a,...o,children:t})});Jt.displayName="Panel";function Jf({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:n.jsx(Jt,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:n.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Qf=e=>{const t=[],s=[];for(const[,r]of e.nodeLookup)r.selected&&t.push(r.internals.userNode);for(const[,r]of e.edgeLookup)r.selected&&s.push(r);return{selectedNodes:t,selectedEdges:s}},ln=e=>e.id;function Kf(e,t){return pe(e.selectedNodes.map(ln),t.selectedNodes.map(ln))&&pe(e.selectedEdges.map(ln),t.selectedEdges.map(ln))}function e0({onSelectionChange:e}){const t=xe(),{selectedNodes:s,selectedEdges:r}=le(Qf,Kf);return b.useEffect(()=>{const o={nodes:s,edges:r};e?.(o),t.getState().onSelectionChangeHandlers.forEach(a=>a(o))},[s,r,e]),null}const t0=e=>!!e.onSelectionChangeHandlers;function n0({onSelectionChange:e}){const t=le(t0);return e||t?n.jsx(e0,{onSelectionChange:e}):null}const Pi=[0,0],s0={x:0,y:0,zoom:1},r0=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],Or=[...r0,"rfId"],o0=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),Vr={translateExtent:Lt,nodeOrigin:Pi,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function i0(e){const{setNodes:t,setEdges:s,setMinZoom:r,setMaxZoom:o,setTranslateExtent:a,setNodeExtent:i,reset:l,setDefaultNodesAndEdges:c}=le(o0,pe),d=xe();b.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{h.current=Vr,l()}),[]);const h=b.useRef(Vr);return b.useEffect(()=>{for(const f of Or){const u=e[f],p=h.current[f];u!==p&&(typeof e[f]>"u"||(f==="nodes"?t(u):f==="edges"?s(u):f==="minZoom"?r(u):f==="maxZoom"?o(u):f==="translateExtent"?a(u):f==="nodeExtent"?i(u):f==="ariaLabelConfig"?d.setState({ariaLabelConfig:Vh(u)}):f==="fitView"?d.setState({fitViewQueued:u}):f==="fitViewOptions"?d.setState({fitViewOptions:u}):d.setState({[f]:u})))}h.current=e},Or.map(f=>e[f])),null}function Fr(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function a0(e){const[t,s]=b.useState(e==="system"?null:e);return b.useEffect(()=>{if(e!=="system"){s(e);return}const r=Fr(),o=()=>s(r?.matches?"dark":"light");return o(),r?.addEventListener("change",o),()=>{r?.removeEventListener("change",o)}},[e]),t!==null?t:Fr()?.matches?"dark":"light"}const Gr=typeof document<"u"?document:null;function Vt(e=null,t={target:Gr,actInsideInputWithModifier:!0}){const[s,r]=b.useState(!1),o=b.useRef(!1),a=b.useRef(new Set([])),[i,l]=b.useMemo(()=>{if(e!==null){const d=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),h=d.reduce((f,u)=>f.concat(...u),[]);return[d,h]}return[[],[]]},[e]);return b.useEffect(()=>{const c=t?.target??Gr,d=t?.actInsideInputWithModifier??!0;if(e!==null){const h=p=>{if(o.current=p.ctrlKey||p.metaKey||p.shiftKey||p.altKey,(!o.current||o.current&&!d)&&fi(p))return!1;const g=qr(p.code,l);if(a.current.add(p[g]),Ur(i,a.current,!1)){const y=p.composedPath?.()?.[0]||p.target,v=y?.nodeName==="BUTTON"||y?.nodeName==="A";t.preventDefault!==!1&&(o.current||!v)&&p.preventDefault(),r(!0)}},f=p=>{const x=qr(p.code,l);Ur(i,a.current,!0)?(r(!1),a.current.clear()):a.current.delete(p[x]),p.key==="Meta"&&a.current.clear(),o.current=!1},u=()=>{a.current.clear(),r(!1)};return c?.addEventListener("keydown",h),c?.addEventListener("keyup",f),window.addEventListener("blur",u),window.addEventListener("contextmenu",u),()=>{c?.removeEventListener("keydown",h),c?.removeEventListener("keyup",f),window.removeEventListener("blur",u),window.removeEventListener("contextmenu",u)}}},[e,r]),s}function Ur(e,t,s){return e.filter(r=>s||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function qr(e,t){return t.includes(e)?"code":"key"}const l0=()=>{const e=xe();return b.useMemo(()=>({zoomIn:t=>{const{panZoom:s}=e.getState();return s?s.scaleBy(1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:s}=e.getState();return s?s.scaleBy(1/1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomTo:(t,s)=>{const{panZoom:r}=e.getState();return r?r.scaleTo(t,{duration:s?.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,s)=>{const{transform:[r,o,a],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??r,y:t.y??o,zoom:t.zoom??a},s),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,s,r]=e.getState().transform;return{x:t,y:s,zoom:r}},setCenter:async(t,s,r)=>e.getState().setCenter(t,s,r),fitBounds:async(t,s)=>{const{width:r,height:o,minZoom:a,maxZoom:i,panZoom:l}=e.getState(),c=Hs(t,r,o,a,i,s?.padding??.1);return l?(await l.setViewport(c,{duration:s?.duration,ease:s?.ease,interpolate:s?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,s={})=>{const{transform:r,snapGrid:o,snapToGrid:a,domNode:i}=e.getState();if(!i)return t;const{x:l,y:c}=i.getBoundingClientRect(),d={x:t.x-l,y:t.y-c},h=s.snapGrid??o,f=s.snapToGrid??a;return Wt(d,r,f,h)},flowToScreenPosition:t=>{const{transform:s,domNode:r}=e.getState();if(!r)return t;const{x:o,y:a}=r.getBoundingClientRect(),i=En(t,s);return{x:i.x+o,y:i.y+a}}}),[])};function Di(e,t){const s=[],r=new Map,o=[];for(const a of e)if(a.type==="add"){o.push(a);continue}else if(a.type==="remove"||a.type==="replace")r.set(a.id,[a]);else{const i=r.get(a.id);i?i.push(a):r.set(a.id,[a])}for(const a of t){const i=r.get(a.id);if(!i){s.push(a);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){s.push({...i[0].item});continue}const l={...a};for(const c of i)c0(c,l);s.push(l)}return o.length&&o.forEach(a=>{a.index!==void 0?s.splice(a.index,0,{...a.item}):s.push({...a.item})}),s}function c0(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Ri(e,t){return Di(e,t)}function zi(e,t){return Di(e,t)}function st(e,t){return{id:e,type:"select",selected:t}}function mt(e,t=new Set,s=!1){const r=[];for(const[o,a]of e){const i=t.has(o);!(a.selected===void 0&&!i)&&a.selected!==i&&(s&&(a.selected=i),r.push(st(a.id,i)))}return r}function Yr({items:e=[],lookup:t}){const s=[],r=new Map(e.map(o=>[o.id,o]));for(const[o,a]of e.entries()){const i=t.get(a.id),l=i?.internals?.userNode??i;l!==void 0&&l!==a&&s.push({id:a.id,item:a,type:"replace"}),l===void 0&&s.push({item:a,type:"add",index:o})}for(const[o]of t)r.get(o)===void 0&&s.push({id:o,type:"remove"});return s}function Zr(e){return{id:e.id,type:"remove"}}const Xr=e=>Th(e),d0=e=>oi(e);function Li(e){return b.forwardRef(e)}const u0=typeof window<"u"?b.useLayoutEffect:b.useEffect;function Wr(e){const[t,s]=b.useState(BigInt(0)),[r]=b.useState(()=>h0(()=>s(o=>o+BigInt(1))));return u0(()=>{const o=r.get();o.length&&(e(o),r.reset())},[t]),r}function h0(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:s=>{t.push(s),e()}}}const Bi=b.createContext(null);function f0({children:e}){const t=xe(),s=b.useCallback(l=>{const{nodes:c=[],setNodes:d,hasDefaultNodes:h,onNodesChange:f,nodeLookup:u,fitViewQueued:p,onNodesChangeMiddlewareMap:x}=t.getState();let g=c;for(const v of l)g=typeof v=="function"?v(g):v;let y=Yr({items:g,lookup:u});for(const v of x.values())y=v(y);h&&d(g),y.length>0?f?.(y):p&&window.requestAnimationFrame(()=>{const{fitViewQueued:v,nodes:k,setNodes:m}=t.getState();v&&m(k)})},[]),r=Wr(s),o=b.useCallback(l=>{const{edges:c=[],setEdges:d,hasDefaultEdges:h,onEdgesChange:f,edgeLookup:u}=t.getState();let p=c;for(const x of l)p=typeof x=="function"?x(p):x;h?d(p):f&&f(Yr({items:p,lookup:u}))},[]),a=Wr(o),i=b.useMemo(()=>({nodeQueue:r,edgeQueue:a}),[]);return n.jsx(Bi.Provider,{value:i,children:e})}function m0(){const e=b.useContext(Bi);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const p0=e=>!!e.panZoom;function Gn(){const e=l0(),t=xe(),s=m0(),r=le(p0),o=b.useMemo(()=>{const a=f=>t.getState().nodeLookup.get(f),i=f=>{s.nodeQueue.push(f)},l=f=>{s.edgeQueue.push(f)},c=f=>{const{nodeLookup:u,nodeOrigin:p}=t.getState(),x=Xr(f)?f:u.get(f.id),g=x.parentId?ui(x.position,x.measured,x.parentId,u,p):x.position,y={...x,position:g,width:x.measured?.width??x.width,height:x.measured?.height??x.height};return jt(y)},d=(f,u,p={replace:!1})=>{i(x=>x.map(g=>{if(g.id===f){const y=typeof u=="function"?u(g):u;return p.replace&&Xr(y)?y:{...g,...y}}return g}))},h=(f,u,p={replace:!1})=>{l(x=>x.map(g=>{if(g.id===f){const y=typeof u=="function"?u(g):u;return p.replace&&d0(y)?y:{...g,...y}}return g}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>a(f)?.internals.userNode,getInternalNode:a,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(u=>({...u}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:i,setEdges:l,addNodes:f=>{const u=Array.isArray(f)?f:[f];s.nodeQueue.push(p=>[...p,...u])},addEdges:f=>{const u=Array.isArray(f)?f:[f];s.edgeQueue.push(p=>[...p,...u])},toObject:()=>{const{nodes:f=[],edges:u=[],transform:p}=t.getState(),[x,g,y]=p;return{nodes:f.map(v=>({...v})),edges:u.map(v=>({...v})),viewport:{x,y:g,zoom:y}}},deleteElements:async({nodes:f=[],edges:u=[]})=>{const{nodes:p,edges:x,onNodesDelete:g,onEdgesDelete:y,triggerNodeChanges:v,triggerEdgeChanges:k,onDelete:m,onBeforeDelete:j}=t.getState(),{nodes:E,edges:w}=await zh({nodesToRemove:f,edgesToRemove:u,nodes:p,edges:x,onBeforeDelete:j}),C=w.length>0,I=E.length>0;if(C){const T=w.map(Zr);y?.(w),k(T)}if(I){const T=E.map(Zr);g?.(E),v(T)}return(I||C)&&m?.({nodes:E,edges:w}),{deletedNodes:E,deletedEdges:w}},getIntersectingNodes:(f,u=!0,p)=>{const x=wr(f),g=x?f:c(f),y=p!==void 0;return g?(p||t.getState().nodes).filter(v=>{const k=t.getState().nodeLookup.get(v.id);if(k&&!x&&(v.id===f.id||!k.internals.positionAbsolute))return!1;const m=jt(y?v:k),j=Ht(m,g);return u&&j>0||j>=m.width*m.height||j>=g.width*g.height}):[]},isNodeIntersecting:(f,u,p=!0)=>{const g=wr(f)?f:c(f);if(!g)return!1;const y=Ht(g,u);return p&&y>0||y>=u.width*u.height||y>=g.width*g.height},updateNode:d,updateNodeData:(f,u,p={replace:!1})=>{d(f,x=>{const g=typeof u=="function"?u(x):u;return p.replace?{...x,data:g}:{...x,data:{...x.data,...g}}},p)},updateEdge:h,updateEdgeData:(f,u,p={replace:!1})=>{h(f,x=>{const g=typeof u=="function"?u(x):u;return p.replace?{...x,data:g}:{...x,data:{...x.data,...g}}},p)},getNodesBounds:f=>{const{nodeLookup:u,nodeOrigin:p}=t.getState();return $h(f,{nodeLookup:u,nodeOrigin:p})},getHandleConnections:({type:f,id:u,nodeId:p})=>Array.from(t.getState().connectionLookup.get(`${p}-${f}${u?`-${u}`:""}`)?.values()??[]),getNodeConnections:({type:f,handleId:u,nodeId:p})=>Array.from(t.getState().connectionLookup.get(`${p}${f?u?`-${f}-${u}`:`-${f}`:""}`)?.values()??[]),fitView:async f=>{const u=t.getState().fitViewResolver??Oh();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:u}),s.nodeQueue.push(p=>[...p]),u.promise}}},[]);return b.useMemo(()=>({...o,...e,viewportInitialized:r}),[r])}const Jr=e=>e.selected,x0=typeof window<"u"?window:void 0;function g0({deleteKeyCode:e,multiSelectionKeyCode:t}){const s=xe(),{deleteElements:r}=Gn(),o=Vt(e,{actInsideInputWithModifier:!1}),a=Vt(t,{target:x0});b.useEffect(()=>{if(o){const{edges:i,nodes:l}=s.getState();r({nodes:l.filter(Jr),edges:i.filter(Jr)}),s.setState({nodesSelectionActive:!1})}},[o]),b.useEffect(()=>{s.setState({multiSelectionActive:a})},[a])}function b0(e){const t=xe();b.useEffect(()=>{const s=()=>{if(!e.current||!(e.current.checkVisibility?.()??!0))return!1;const r=Os(e.current);(r.height===0||r.width===0)&&t.getState().onError?.("004",Ge.error004()),t.setState({width:r.width||500,height:r.height||500})};if(e.current){s(),window.addEventListener("resize",s);const r=new ResizeObserver(()=>s());return r.observe(e.current),()=>{window.removeEventListener("resize",s),r&&e.current&&r.unobserve(e.current)}}},[])}const Un={position:"absolute",width:"100%",height:"100%",top:0,left:0},y0=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function v0({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:s=!0,panOnScroll:r=!1,panOnScrollSpeed:o=.5,panOnScrollMode:a=it.Free,zoomOnDoubleClick:i=!0,panOnDrag:l=!0,defaultViewport:c,translateExtent:d,minZoom:h,maxZoom:f,zoomActivationKeyCode:u,preventScrolling:p=!0,children:x,noWheelClassName:g,noPanClassName:y,onViewportChange:v,isControlledViewport:k,paneClickDistance:m,selectionOnDrag:j}){const E=xe(),w=b.useRef(null),{userSelectionActive:C,lib:I,connectionInProgress:T}=le(y0,pe),$=Vt(u),S=b.useRef();b0(w);const P=b.useCallback(H=>{v?.({x:H[0],y:H[1],zoom:H[2]}),k||E.setState({transform:H})},[v,k]);return b.useEffect(()=>{if(w.current){S.current=Cf({domNode:w.current,minZoom:h,maxZoom:f,translateExtent:d,viewport:c,onDraggingChange:_=>E.setState({paneDragging:_}),onPanZoomStart:(_,D)=>{const{onViewportChangeStart:A,onMoveStart:z}=E.getState();z?.(_,D),A?.(D)},onPanZoom:(_,D)=>{const{onViewportChange:A,onMove:z}=E.getState();z?.(_,D),A?.(D)},onPanZoomEnd:(_,D)=>{const{onViewportChangeEnd:A,onMoveEnd:z}=E.getState();z?.(_,D),A?.(D)}});const{x:H,y:N,zoom:M}=S.current.getViewport();return E.setState({panZoom:S.current,transform:[H,N,M],domNode:w.current.closest(".react-flow")}),()=>{S.current?.destroy()}}},[]),b.useEffect(()=>{S.current?.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:s,panOnScroll:r,panOnScrollSpeed:o,panOnScrollMode:a,zoomOnDoubleClick:i,panOnDrag:l,zoomActivationKeyPressed:$,preventScrolling:p,noPanClassName:y,userSelectionActive:C,noWheelClassName:g,lib:I,onTransformChange:P,connectionInProgress:T,selectionOnDrag:j,paneClickDistance:m})},[e,t,s,r,o,a,i,l,$,p,y,C,g,I,P,T,j,m]),n.jsx("div",{className:"react-flow__renderer",ref:w,style:Un,children:x})}const w0=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function j0(){const{userSelectionActive:e,userSelectionRect:t}=le(w0,pe);return e&&t?n.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const is=(e,t)=>s=>{s.target===t.current&&e?.(s)},N0=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function k0({isSelecting:e,selectionKeyPressed:t,selectionMode:s=Bt.Full,panOnDrag:r,paneClickDistance:o,selectionOnDrag:a,onSelectionStart:i,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:d,onPaneScroll:h,onPaneMouseEnter:f,onPaneMouseMove:u,onPaneMouseLeave:p,children:x}){const g=xe(),{userSelectionActive:y,elementsSelectable:v,dragging:k,connectionInProgress:m}=le(N0,pe),j=v&&(e||y),E=b.useRef(null),w=b.useRef(),C=b.useRef(new Set),I=b.useRef(new Set),T=b.useRef(!1),$=A=>{if(T.current||m){T.current=!1;return}c?.(A),g.getState().resetSelectedElements(),g.setState({nodesSelectionActive:!1})},S=A=>{if(Array.isArray(r)&&r?.includes(2)){A.preventDefault();return}d?.(A)},P=h?A=>h(A):void 0,H=A=>{T.current&&(A.stopPropagation(),T.current=!1)},N=A=>{const{domNode:z}=g.getState();if(w.current=z?.getBoundingClientRect(),!w.current)return;const O=A.target===E.current;if(!O&&!!A.target.closest(".nokey")||!e||!(a&&O||t)||A.button!==0||!A.isPrimary)return;A.target?.setPointerCapture?.(A.pointerId),T.current=!1;const{x:Q,y:X}=Be(A.nativeEvent,w.current);g.setState({userSelectionRect:{width:0,height:0,startX:Q,startY:X,x:Q,y:X}}),O||(A.stopPropagation(),A.preventDefault())},M=A=>{const{userSelectionRect:z,transform:O,nodeLookup:F,edgeLookup:V,connectionLookup:Q,triggerNodeChanges:X,triggerEdgeChanges:te,defaultEdgeOptions:Z,resetSelectedElements:B}=g.getState();if(!w.current||!z)return;const{x:R,y:J}=Be(A.nativeEvent,w.current),{startX:W,startY:se}=z;if(!T.current){const ce=t?0:o;if(Math.hypot(R-W,J-se)<=ce)return;B(),i?.(A)}T.current=!0;const q={startX:W,startY:se,x:R<W?R:W,y:J<se?J:se,width:Math.abs(R-W),height:Math.abs(J-se)},K=C.current,re=I.current;C.current=new Set(Bs(F,q,O,s===Bt.Partial,!0).map(ce=>ce.id)),I.current=new Set;const ae=Z?.selectable??!0;for(const ce of C.current){const de=Q.get(ce);if(de)for(const{edgeId:je}of de.values()){const Se=V.get(je);Se&&(Se.selectable??ae)&&I.current.add(je)}}if(!jr(K,C.current)){const ce=mt(F,C.current,!0);X(ce)}if(!jr(re,I.current)){const ce=mt(V,I.current);te(ce)}g.setState({userSelectionRect:q,userSelectionActive:!0,nodesSelectionActive:!1})},_=A=>{A.button===0&&(A.target?.releasePointerCapture?.(A.pointerId),!y&&A.target===E.current&&g.getState().userSelectionRect&&$?.(A),g.setState({userSelectionActive:!1,userSelectionRect:null}),T.current&&(l?.(A),g.setState({nodesSelectionActive:C.current.size>0})))},D=r===!0||Array.isArray(r)&&r.includes(0);return n.jsxs("div",{className:ye(["react-flow__pane",{draggable:D,dragging:k,selection:e}]),onClick:j?void 0:is($,E),onContextMenu:is(S,E),onWheel:is(P,E),onPointerEnter:j?void 0:f,onPointerMove:j?M:u,onPointerUp:j?_:void 0,onPointerDownCapture:j?N:void 0,onClickCapture:j?H:void 0,onPointerLeave:p,ref:E,style:Un,children:[x,n.jsx(j0,{})]})}function ks({id:e,store:t,unselect:s=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:a,multiSelectionActive:i,nodeLookup:l,onError:c}=t.getState(),d=l.get(e);if(!d){c?.("012",Ge.error012(e));return}t.setState({nodesSelectionActive:!1}),d.selected?(s||d.selected&&i)&&(a({nodes:[d],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):o([e])}function Hi({nodeRef:e,disabled:t=!1,noDragClassName:s,handleSelector:r,nodeId:o,isSelectable:a,nodeClickDistance:i}){const l=xe(),[c,d]=b.useState(!1),h=b.useRef();return b.useEffect(()=>{h.current=uf({getStoreItems:()=>l.getState(),onNodeMouseDown:f=>{ks({id:f,store:l,nodeRef:e})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),b.useEffect(()=>{if(t)h.current?.destroy();else if(e.current)return h.current?.update({noDragClassName:s,handleSelector:r,domNode:e.current,isSelectable:a,nodeId:o,nodeClickDistance:i}),()=>{h.current?.destroy()}},[s,r,t,a,e,o]),c}const C0=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Oi(){const e=xe();return b.useCallback(s=>{const{nodeExtent:r,snapToGrid:o,snapGrid:a,nodesDraggable:i,onError:l,updateNodePositions:c,nodeLookup:d,nodeOrigin:h}=e.getState(),f=new Map,u=C0(i),p=o?a[0]:5,x=o?a[1]:5,g=s.direction.x*p*s.factor,y=s.direction.y*x*s.factor;for(const[,v]of d){if(!u(v))continue;let k={x:v.internals.positionAbsolute.x+g,y:v.internals.positionAbsolute.y+y};o&&(k=Xt(k,a));const{position:m,positionAbsolute:j}=ii({nodeId:v.id,nextPosition:k,nodeLookup:d,nodeExtent:r,nodeOrigin:h,onError:l});v.position=m,v.internals.positionAbsolute=j,f.set(v.id,v)}c(f)},[])}const Ys=b.createContext(null),S0=Ys.Provider;Ys.Consumer;const Vi=()=>b.useContext(Ys),_0=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),E0=(e,t,s)=>r=>{const{connectionClickStartHandle:o,connectionMode:a,connection:i}=r,{fromHandle:l,toHandle:c,isValid:d}=i,h=c?.nodeId===e&&c?.id===t&&c?.type===s;return{connectingFrom:l?.nodeId===e&&l?.id===t&&l?.type===s,connectingTo:h,clickConnecting:o?.nodeId===e&&o?.id===t&&o?.type===s,isPossibleEndHandle:a===yt.Strict?l?.type!==s:e!==l?.nodeId||t!==l?.id,connectionInProcess:!!l,clickConnectionInProcess:!!o,valid:h&&d}};function M0({type:e="source",position:t=ne.Top,isValidConnection:s,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:a=!0,id:i,onConnect:l,children:c,className:d,onMouseDown:h,onTouchStart:f,...u},p){const x=i||null,g=e==="target",y=xe(),v=Vi(),{connectOnClick:k,noPanClassName:m,rfId:j}=le(_0,pe),{connectingFrom:E,connectingTo:w,clickConnecting:C,isPossibleEndHandle:I,connectionInProcess:T,clickConnectionInProcess:$,valid:S}=le(E0(v,x,e),pe);v||y.getState().onError?.("010",Ge.error010());const P=M=>{const{defaultEdgeOptions:_,onConnect:D,hasDefaultEdges:A}=y.getState(),z={..._,...M};if(A){const{edges:O,setEdges:F}=y.getState();F(Zh(z,O))}D?.(z),l?.(z)},H=M=>{if(!v)return;const _=mi(M.nativeEvent);if(o&&(_&&M.button===0||!_)){const D=y.getState();Ns.onPointerDown(M.nativeEvent,{handleDomNode:M.currentTarget,autoPanOnConnect:D.autoPanOnConnect,connectionMode:D.connectionMode,connectionRadius:D.connectionRadius,domNode:D.domNode,nodeLookup:D.nodeLookup,lib:D.lib,isTarget:g,handleId:x,nodeId:v,flowId:D.rfId,panBy:D.panBy,cancelConnection:D.cancelConnection,onConnectStart:D.onConnectStart,onConnectEnd:D.onConnectEnd,updateConnection:D.updateConnection,onConnect:P,isValidConnection:s||D.isValidConnection,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,autoPanSpeed:D.autoPanSpeed,dragThreshold:D.connectionDragThreshold})}_?h?.(M):f?.(M)},N=M=>{const{onClickConnectStart:_,onClickConnectEnd:D,connectionClickStartHandle:A,connectionMode:z,isValidConnection:O,lib:F,rfId:V,nodeLookup:Q,connection:X}=y.getState();if(!v||!A&&!o)return;if(!A){_?.(M.nativeEvent,{nodeId:v,handleId:x,handleType:e}),y.setState({connectionClickStartHandle:{nodeId:v,type:e,id:x}});return}const te=hi(M.target),Z=s||O,{connection:B,isValid:R}=Ns.isValid(M.nativeEvent,{handle:{nodeId:v,id:x,type:e},connectionMode:z,fromNodeId:A.nodeId,fromHandleId:A.id||null,fromType:A.type,isValidConnection:Z,flowId:V,doc:te,lib:F,nodeLookup:Q});R&&B&&P(B);const J=structuredClone(X);delete J.inProgress,J.toPosition=J.toHandle?J.toHandle.position:null,D?.(M,J),y.setState({connectionClickStartHandle:null})};return n.jsx("div",{"data-handleid":x,"data-nodeid":v,"data-handlepos":t,"data-id":`${j}-${v}-${x}-${e}`,className:ye(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",m,d,{source:!g,target:g,connectable:r,connectablestart:o,connectableend:a,clickconnecting:C,connectingfrom:E,connectingto:w,valid:S,connectionindicator:r&&(!T||I)&&(T||$?a:o)}]),onMouseDown:H,onTouchStart:H,onClick:k?N:void 0,ref:p,...u,children:c})}const Ke=b.memo(Li(M0));function I0({data:e,isConnectable:t,sourcePosition:s=ne.Bottom}){return n.jsxs(n.Fragment,{children:[e?.label,n.jsx(Ke,{type:"source",position:s,isConnectable:t})]})}function A0({data:e,isConnectable:t,targetPosition:s=ne.Top,sourcePosition:r=ne.Bottom}){return n.jsxs(n.Fragment,{children:[n.jsx(Ke,{type:"target",position:s,isConnectable:t}),e?.label,n.jsx(Ke,{type:"source",position:r,isConnectable:t})]})}function T0(){return null}function $0({data:e,isConnectable:t,targetPosition:s=ne.Top}){return n.jsxs(n.Fragment,{children:[n.jsx(Ke,{type:"target",position:s,isConnectable:t}),e?.label]})}const Mn={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Qr={input:I0,default:A0,output:$0,group:T0};function P0(e){return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??e.style?.width,height:e.height??e.initialHeight??e.style?.height}:{width:e.width??e.style?.width,height:e.height??e.style?.height}}const D0=e=>{const{width:t,height:s,x:r,y:o}=Zt(e.nodeLookup,{filter:a=>!!a.selected});return{width:Le(t)?t:null,height:Le(s)?s:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${r}px,${o}px)`}};function R0({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:s}){const r=xe(),{width:o,height:a,transformString:i,userSelectionActive:l}=le(D0,pe),c=Oi(),d=b.useRef(null);if(b.useEffect(()=>{s||d.current?.focus({preventScroll:!0})},[s]),Hi({nodeRef:d}),l||!o||!a)return null;const h=e?u=>{const p=r.getState().nodes.filter(x=>x.selected);e(u,p)}:void 0,f=u=>{Object.prototype.hasOwnProperty.call(Mn,u.key)&&(u.preventDefault(),c({direction:Mn[u.key],factor:u.shiftKey?4:1}))};return n.jsx("div",{className:ye(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:n.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:s?void 0:-1,onKeyDown:s?void 0:f,style:{width:o,height:a}})})}const Kr=typeof window<"u"?window:void 0,z0=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Fi({children:e,onPaneClick:t,onPaneMouseEnter:s,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,paneClickDistance:l,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:h,selectionMode:f,onSelectionStart:u,onSelectionEnd:p,multiSelectionKeyCode:x,panActivationKeyCode:g,zoomActivationKeyCode:y,elementsSelectable:v,zoomOnScroll:k,zoomOnPinch:m,panOnScroll:j,panOnScrollSpeed:E,panOnScrollMode:w,zoomOnDoubleClick:C,panOnDrag:I,defaultViewport:T,translateExtent:$,minZoom:S,maxZoom:P,preventScrolling:H,onSelectionContextMenu:N,noWheelClassName:M,noPanClassName:_,disableKeyboardA11y:D,onViewportChange:A,isControlledViewport:z}){const{nodesSelectionActive:O,userSelectionActive:F}=le(z0,pe),V=Vt(d,{target:Kr}),Q=Vt(g,{target:Kr}),X=Q||I,te=Q||j,Z=h&&X!==!0,B=V||F||Z;return g0({deleteKeyCode:c,multiSelectionKeyCode:x}),n.jsx(v0,{onPaneContextMenu:a,elementsSelectable:v,zoomOnScroll:k,zoomOnPinch:m,panOnScroll:te,panOnScrollSpeed:E,panOnScrollMode:w,zoomOnDoubleClick:C,panOnDrag:!V&&X,defaultViewport:T,translateExtent:$,minZoom:S,maxZoom:P,zoomActivationKeyCode:y,preventScrolling:H,noWheelClassName:M,noPanClassName:_,onViewportChange:A,isControlledViewport:z,paneClickDistance:l,selectionOnDrag:Z,children:n.jsxs(k0,{onSelectionStart:u,onSelectionEnd:p,onPaneClick:t,onPaneMouseEnter:s,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,panOnDrag:X,isSelecting:!!B,selectionMode:f,selectionKeyPressed:V,paneClickDistance:l,selectionOnDrag:Z,children:[e,O&&n.jsx(R0,{onSelectionContextMenu:N,noPanClassName:_,disableKeyboardA11y:D})]})})}Fi.displayName="FlowRenderer";const L0=b.memo(Fi),B0=e=>t=>e?Bs(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(s=>s.id):Array.from(t.nodeLookup.keys());function H0(e){return le(b.useCallback(B0(e),[e]),pe)}const O0=e=>e.updateNodeInternals;function V0(){const e=le(O0),[t]=b.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(s=>{const r=new Map;s.forEach(o=>{const a=o.target.getAttribute("data-id");r.set(a,{id:a,nodeElement:o.target,force:!0})}),e(r)}));return b.useEffect(()=>()=>{t?.disconnect()},[t]),t}function F0({node:e,nodeType:t,hasDimensions:s,resizeObserver:r}){const o=xe(),a=b.useRef(null),i=b.useRef(null),l=b.useRef(e.sourcePosition),c=b.useRef(e.targetPosition),d=b.useRef(t),h=s&&!!e.internals.handleBounds;return b.useEffect(()=>{a.current&&!e.hidden&&(!h||i.current!==a.current)&&(i.current&&r?.unobserve(i.current),r?.observe(a.current),i.current=a.current)},[h,e.hidden]),b.useEffect(()=>()=>{i.current&&(r?.unobserve(i.current),i.current=null)},[]),b.useEffect(()=>{if(a.current){const f=d.current!==t,u=l.current!==e.sourcePosition,p=c.current!==e.targetPosition;(f||u||p)&&(d.current=t,l.current=e.sourcePosition,c.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:a.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),a}function G0({id:e,onClick:t,onMouseEnter:s,onMouseMove:r,onMouseLeave:o,onContextMenu:a,onDoubleClick:i,nodesDraggable:l,elementsSelectable:c,nodesConnectable:d,nodesFocusable:h,resizeObserver:f,noDragClassName:u,noPanClassName:p,disableKeyboardA11y:x,rfId:g,nodeTypes:y,nodeClickDistance:v,onError:k}){const{node:m,internals:j,isParent:E}=le(R=>{const J=R.nodeLookup.get(e),W=R.parentLookup.has(e);return{node:J,internals:J.internals,isParent:W}},pe);let w=m.type||"default",C=y?.[w]||Qr[w];C===void 0&&(k?.("003",Ge.error003(w)),w="default",C=y?.default||Qr.default);const I=!!(m.draggable||l&&typeof m.draggable>"u"),T=!!(m.selectable||c&&typeof m.selectable>"u"),$=!!(m.connectable||d&&typeof m.connectable>"u"),S=!!(m.focusable||h&&typeof m.focusable>"u"),P=xe(),H=di(m),N=F0({node:m,nodeType:w,hasDimensions:H,resizeObserver:f}),M=Hi({nodeRef:N,disabled:m.hidden||!I,noDragClassName:u,handleSelector:m.dragHandle,nodeId:e,isSelectable:T,nodeClickDistance:v}),_=Oi();if(m.hidden)return null;const D=Xe(m),A=P0(m),z=T||I||t||s||r||o,O=s?R=>s(R,{...j.userNode}):void 0,F=r?R=>r(R,{...j.userNode}):void 0,V=o?R=>o(R,{...j.userNode}):void 0,Q=a?R=>a(R,{...j.userNode}):void 0,X=i?R=>i(R,{...j.userNode}):void 0,te=R=>{const{selectNodesOnDrag:J,nodeDragThreshold:W}=P.getState();T&&(!J||!I||W>0)&&ks({id:e,store:P,nodeRef:N}),t&&t(R,{...j.userNode})},Z=R=>{if(!(fi(R.nativeEvent)||x)){if(ti.includes(R.key)&&T){const J=R.key==="Escape";ks({id:e,store:P,unselect:J,nodeRef:N})}else if(I&&m.selected&&Object.prototype.hasOwnProperty.call(Mn,R.key)){R.preventDefault();const{ariaLabelConfig:J}=P.getState();P.setState({ariaLiveMessage:J["node.a11yDescription.ariaLiveMessage"]({direction:R.key.replace("Arrow","").toLowerCase(),x:~~j.positionAbsolute.x,y:~~j.positionAbsolute.y})}),_({direction:Mn[R.key],factor:R.shiftKey?4:1})}}},B=()=>{if(x||!N.current?.matches(":focus-visible"))return;const{transform:R,width:J,height:W,autoPanOnNodeFocus:se,setCenter:q}=P.getState();if(!se)return;Bs(new Map([[e,m]]),{x:0,y:0,width:J,height:W},R,!0).length>0||q(m.position.x+D.width/2,m.position.y+D.height/2,{zoom:R[2]})};return n.jsx("div",{className:ye(["react-flow__node",`react-flow__node-${w}`,{[p]:I},m.className,{selected:m.selected,selectable:T,parent:E,draggable:I,dragging:M}]),ref:N,style:{zIndex:j.z,transform:`translate(${j.positionAbsolute.x}px,${j.positionAbsolute.y}px)`,pointerEvents:z?"all":"none",visibility:H?"visible":"hidden",...m.style,...A},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:O,onMouseMove:F,onMouseLeave:V,onContextMenu:Q,onClick:te,onDoubleClick:X,onKeyDown:S?Z:void 0,tabIndex:S?0:void 0,onFocus:S?B:void 0,role:m.ariaRole??(S?"group":void 0),"aria-roledescription":"node","aria-describedby":x?void 0:`${Ti}-${g}`,"aria-label":m.ariaLabel,...m.domAttributes,children:n.jsx(S0,{value:e,children:n.jsx(C,{id:e,data:m.data,type:w,positionAbsoluteX:j.positionAbsolute.x,positionAbsoluteY:j.positionAbsolute.y,selected:m.selected??!1,selectable:T,draggable:I,deletable:m.deletable??!0,isConnectable:$,sourcePosition:m.sourcePosition,targetPosition:m.targetPosition,dragging:M,dragHandle:m.dragHandle,zIndex:j.z,parentId:m.parentId,...D})})})}var U0=b.memo(G0);const q0=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Gi(e){const{nodesDraggable:t,nodesConnectable:s,nodesFocusable:r,elementsSelectable:o,onError:a}=le(q0,pe),i=H0(e.onlyRenderVisibleElements),l=V0();return n.jsx("div",{className:"react-flow__nodes",style:Un,children:i.map(c=>n.jsx(U0,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:l,nodesDraggable:t,nodesConnectable:s,nodesFocusable:r,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:a},c))})}Gi.displayName="NodeRenderer";const Y0=b.memo(Gi);function Z0(e){return le(b.useCallback(s=>{if(!e)return s.edges.map(o=>o.id);const r=[];if(s.width&&s.height)for(const o of s.edges){const a=s.nodeLookup.get(o.source),i=s.nodeLookup.get(o.target);a&&i&&Uh({sourceNode:a,targetNode:i,width:s.width,height:s.height,transform:s.transform})&&r.push(o.id)}return r},[e]),pe)}const X0=({color:e="none",strokeWidth:t=1})=>{const s={strokeWidth:t,...e&&{stroke:e}};return n.jsx("polyline",{className:"arrow",style:s,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},W0=({color:e="none",strokeWidth:t=1})=>{const s={strokeWidth:t,...e&&{stroke:e,fill:e}};return n.jsx("polyline",{className:"arrowclosed",style:s,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},eo={[vt.Arrow]:X0,[vt.ArrowClosed]:W0};function J0(e){const t=xe();return b.useMemo(()=>Object.prototype.hasOwnProperty.call(eo,e)?eo[e]:(t.getState().onError?.("009",Ge.error009(e)),null),[e])}const Q0=({id:e,type:t,color:s,width:r=12.5,height:o=12.5,markerUnits:a="strokeWidth",strokeWidth:i,orient:l="auto-start-reverse"})=>{const c=J0(t);return c?n.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:l,refX:"0",refY:"0",children:n.jsx(c,{color:s,strokeWidth:i})}):null},Ui=({defaultColor:e,rfId:t})=>{const s=le(a=>a.edges),r=le(a=>a.defaultEdgeOptions),o=b.useMemo(()=>Kh(s,{id:t,defaultColor:e,defaultMarkerStart:r?.markerStart,defaultMarkerEnd:r?.markerEnd}),[s,r,t,e]);return o.length?n.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:n.jsx("defs",{children:o.map(a=>n.jsx(Q0,{id:a.id,type:a.type,color:a.color,width:a.width,height:a.height,markerUnits:a.markerUnits,strokeWidth:a.strokeWidth,orient:a.orient},a.id))})}):null};Ui.displayName="MarkerDefinitions";var K0=b.memo(Ui);function qi({x:e,y:t,label:s,labelStyle:r,labelShowBg:o=!0,labelBgStyle:a,labelBgPadding:i=[2,4],labelBgBorderRadius:l=2,children:c,className:d,...h}){const[f,u]=b.useState({x:1,y:0,width:0,height:0}),p=ye(["react-flow__edge-textwrapper",d]),x=b.useRef(null);return b.useEffect(()=>{if(x.current){const g=x.current.getBBox();u({x:g.x,y:g.y,width:g.width,height:g.height})}},[s]),s?n.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:p,visibility:f.width?"visible":"hidden",...h,children:[o&&n.jsx("rect",{width:f.width+2*i[0],x:-i[0],y:-i[1],height:f.height+2*i[1],className:"react-flow__edge-textbg",style:a,rx:l,ry:l}),n.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:x,style:r,children:s}),c]}):null}qi.displayName="EdgeText";const em=b.memo(qi);function qn({path:e,labelX:t,labelY:s,label:r,labelStyle:o,labelShowBg:a,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,interactionWidth:d=20,...h}){return n.jsxs(n.Fragment,{children:[n.jsx("path",{...h,d:e,fill:"none",className:ye(["react-flow__edge-path",h.className])}),d?n.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:d,className:"react-flow__edge-interaction"}):null,r&&Le(t)&&Le(s)?n.jsx(em,{x:t,y:s,label:r,labelStyle:o,labelShowBg:a,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c}):null]})}function to({pos:e,x1:t,y1:s,x2:r,y2:o}){return e===ne.Left||e===ne.Right?[.5*(t+r),s]:[t,.5*(s+o)]}function Yi({sourceX:e,sourceY:t,sourcePosition:s=ne.Bottom,targetX:r,targetY:o,targetPosition:a=ne.Top}){const[i,l]=to({pos:s,x1:e,y1:t,x2:r,y2:o}),[c,d]=to({pos:a,x1:r,y1:o,x2:e,y2:t}),[h,f,u,p]=pi({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:i,sourceControlY:l,targetControlX:c,targetControlY:d});return[`M${e},${t} C${i},${l} ${c},${d} ${r},${o}`,h,f,u,p]}function Zi(e){return b.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,sourcePosition:i,targetPosition:l,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:p,style:x,markerEnd:g,markerStart:y,interactionWidth:v})=>{const[k,m,j]=Yi({sourceX:s,sourceY:r,sourcePosition:i,targetX:o,targetY:a,targetPosition:l}),E=e.isInternal?void 0:t;return n.jsx(qn,{id:E,path:k,labelX:m,labelY:j,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:p,style:x,markerEnd:g,markerStart:y,interactionWidth:v})})}const tm=Zi({isInternal:!1}),Xi=Zi({isInternal:!0});tm.displayName="SimpleBezierEdge";Xi.displayName="SimpleBezierEdgeInternal";function Wi(e){return b.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,sourcePosition:p=ne.Bottom,targetPosition:x=ne.Top,markerEnd:g,markerStart:y,pathOptions:v,interactionWidth:k})=>{const[m,j,E]=vs({sourceX:s,sourceY:r,sourcePosition:p,targetX:o,targetY:a,targetPosition:x,borderRadius:v?.borderRadius,offset:v?.offset,stepPosition:v?.stepPosition}),w=e.isInternal?void 0:t;return n.jsx(qn,{id:w,path:m,labelX:j,labelY:E,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:g,markerStart:y,interactionWidth:k})})}const Ji=Wi({isInternal:!1}),Qi=Wi({isInternal:!0});Ji.displayName="SmoothStepEdge";Qi.displayName="SmoothStepEdgeInternal";function Ki(e){return b.memo(({id:t,...s})=>{const r=e.isInternal?void 0:t;return n.jsx(Ji,{...s,id:r,pathOptions:b.useMemo(()=>({borderRadius:0,offset:s.pathOptions?.offset}),[s.pathOptions?.offset])})})}const nm=Ki({isInternal:!1}),ea=Ki({isInternal:!0});nm.displayName="StepEdge";ea.displayName="StepEdgeInternal";function ta(e){return b.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:p,markerStart:x,interactionWidth:g})=>{const[y,v,k]=bi({sourceX:s,sourceY:r,targetX:o,targetY:a}),m=e.isInternal?void 0:t;return n.jsx(qn,{id:m,path:y,labelX:v,labelY:k,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:p,markerStart:x,interactionWidth:g})})}const sm=ta({isInternal:!1}),na=ta({isInternal:!0});sm.displayName="StraightEdge";na.displayName="StraightEdgeInternal";function sa(e){return b.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,sourcePosition:i=ne.Bottom,targetPosition:l=ne.Top,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:p,style:x,markerEnd:g,markerStart:y,pathOptions:v,interactionWidth:k})=>{const[m,j,E]=xi({sourceX:s,sourceY:r,sourcePosition:i,targetX:o,targetY:a,targetPosition:l,curvature:v?.curvature}),w=e.isInternal?void 0:t;return n.jsx(qn,{id:w,path:m,labelX:j,labelY:E,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:p,style:x,markerEnd:g,markerStart:y,interactionWidth:k})})}const rm=sa({isInternal:!1}),ra=sa({isInternal:!0});rm.displayName="BezierEdge";ra.displayName="BezierEdgeInternal";const no={default:ra,straight:na,step:ea,smoothstep:Qi,simplebezier:Xi},so={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},om=(e,t,s)=>s===ne.Left?e-t:s===ne.Right?e+t:e,im=(e,t,s)=>s===ne.Top?e-t:s===ne.Bottom?e+t:e,ro="react-flow__edgeupdater";function oo({position:e,centerX:t,centerY:s,radius:r=10,onMouseDown:o,onMouseEnter:a,onMouseOut:i,type:l}){return n.jsx("circle",{onMouseDown:o,onMouseEnter:a,onMouseOut:i,className:ye([ro,`${ro}-${l}`]),cx:om(t,r,e),cy:im(s,r,e),r,stroke:"transparent",fill:"transparent"})}function am({isReconnectable:e,reconnectRadius:t,edge:s,sourceX:r,sourceY:o,targetX:a,targetY:i,sourcePosition:l,targetPosition:c,onReconnect:d,onReconnectStart:h,onReconnectEnd:f,setReconnecting:u,setUpdateHover:p}){const x=xe(),g=(j,E)=>{if(j.button!==0)return;const{autoPanOnConnect:w,domNode:C,isValidConnection:I,connectionMode:T,connectionRadius:$,lib:S,onConnectStart:P,onConnectEnd:H,cancelConnection:N,nodeLookup:M,rfId:_,panBy:D,updateConnection:A}=x.getState(),z=E.type==="target",O=(Q,X)=>{u(!1),f?.(Q,s,E.type,X)},F=Q=>d?.(s,Q),V=(Q,X)=>{u(!0),h?.(j,s,E.type),P?.(Q,X)};Ns.onPointerDown(j.nativeEvent,{autoPanOnConnect:w,connectionMode:T,connectionRadius:$,domNode:C,handleId:E.id,nodeId:E.nodeId,nodeLookup:M,isTarget:z,edgeUpdaterType:E.type,lib:S,flowId:_,cancelConnection:N,panBy:D,isValidConnection:I,onConnect:F,onConnectStart:V,onConnectEnd:H,onReconnectEnd:O,updateConnection:A,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,dragThreshold:x.getState().connectionDragThreshold,handleDomNode:j.currentTarget})},y=j=>g(j,{nodeId:s.target,id:s.targetHandle??null,type:"target"}),v=j=>g(j,{nodeId:s.source,id:s.sourceHandle??null,type:"source"}),k=()=>p(!0),m=()=>p(!1);return n.jsxs(n.Fragment,{children:[(e===!0||e==="source")&&n.jsx(oo,{position:l,centerX:r,centerY:o,radius:t,onMouseDown:y,onMouseEnter:k,onMouseOut:m,type:"source"}),(e===!0||e==="target")&&n.jsx(oo,{position:c,centerX:a,centerY:i,radius:t,onMouseDown:v,onMouseEnter:k,onMouseOut:m,type:"target"})]})}function lm({id:e,edgesFocusable:t,edgesReconnectable:s,elementsSelectable:r,onClick:o,onDoubleClick:a,onContextMenu:i,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,reconnectRadius:h,onReconnect:f,onReconnectStart:u,onReconnectEnd:p,rfId:x,edgeTypes:g,noPanClassName:y,onError:v,disableKeyboardA11y:k}){let m=le(q=>q.edgeLookup.get(e));const j=le(q=>q.defaultEdgeOptions);m=j?{...j,...m}:m;let E=m.type||"default",w=g?.[E]||no[E];w===void 0&&(v?.("011",Ge.error011(E)),E="default",w=g?.default||no.default);const C=!!(m.focusable||t&&typeof m.focusable>"u"),I=typeof f<"u"&&(m.reconnectable||s&&typeof m.reconnectable>"u"),T=!!(m.selectable||r&&typeof m.selectable>"u"),$=b.useRef(null),[S,P]=b.useState(!1),[H,N]=b.useState(!1),M=xe(),{zIndex:_,sourceX:D,sourceY:A,targetX:z,targetY:O,sourcePosition:F,targetPosition:V}=le(b.useCallback(q=>{const K=q.nodeLookup.get(m.source),re=q.nodeLookup.get(m.target);if(!K||!re)return{zIndex:m.zIndex,...so};const ae=Qh({id:e,sourceNode:K,targetNode:re,sourceHandle:m.sourceHandle||null,targetHandle:m.targetHandle||null,connectionMode:q.connectionMode,onError:v});return{zIndex:Gh({selected:m.selected,zIndex:m.zIndex,sourceNode:K,targetNode:re,elevateOnSelect:q.elevateEdgesOnSelect,zIndexMode:q.zIndexMode}),...ae||so}},[m.source,m.target,m.sourceHandle,m.targetHandle,m.selected,m.zIndex]),pe),Q=b.useMemo(()=>m.markerStart?`url('#${ws(m.markerStart,x)}')`:void 0,[m.markerStart,x]),X=b.useMemo(()=>m.markerEnd?`url('#${ws(m.markerEnd,x)}')`:void 0,[m.markerEnd,x]);if(m.hidden||D===null||A===null||z===null||O===null)return null;const te=q=>{const{addSelectedEdges:K,unselectNodesAndEdges:re,multiSelectionActive:ae}=M.getState();T&&(M.setState({nodesSelectionActive:!1}),m.selected&&ae?(re({nodes:[],edges:[m]}),$.current?.blur()):K([e])),o&&o(q,m)},Z=a?q=>{a(q,{...m})}:void 0,B=i?q=>{i(q,{...m})}:void 0,R=l?q=>{l(q,{...m})}:void 0,J=c?q=>{c(q,{...m})}:void 0,W=d?q=>{d(q,{...m})}:void 0,se=q=>{if(!k&&ti.includes(q.key)&&T){const{unselectNodesAndEdges:K,addSelectedEdges:re}=M.getState();q.key==="Escape"?($.current?.blur(),K({edges:[m]})):re([e])}};return n.jsx("svg",{style:{zIndex:_},children:n.jsxs("g",{className:ye(["react-flow__edge",`react-flow__edge-${E}`,m.className,y,{selected:m.selected,animated:m.animated,inactive:!T&&!o,updating:S,selectable:T}]),onClick:te,onDoubleClick:Z,onContextMenu:B,onMouseEnter:R,onMouseMove:J,onMouseLeave:W,onKeyDown:C?se:void 0,tabIndex:C?0:void 0,role:m.ariaRole??(C?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":m.ariaLabel===null?void 0:m.ariaLabel||`Edge from ${m.source} to ${m.target}`,"aria-describedby":C?`${$i}-${x}`:void 0,ref:$,...m.domAttributes,children:[!H&&n.jsx(w,{id:e,source:m.source,target:m.target,type:m.type,selected:m.selected,animated:m.animated,selectable:T,deletable:m.deletable??!0,label:m.label,labelStyle:m.labelStyle,labelShowBg:m.labelShowBg,labelBgStyle:m.labelBgStyle,labelBgPadding:m.labelBgPadding,labelBgBorderRadius:m.labelBgBorderRadius,sourceX:D,sourceY:A,targetX:z,targetY:O,sourcePosition:F,targetPosition:V,data:m.data,style:m.style,sourceHandleId:m.sourceHandle,targetHandleId:m.targetHandle,markerStart:Q,markerEnd:X,pathOptions:"pathOptions"in m?m.pathOptions:void 0,interactionWidth:m.interactionWidth}),I&&n.jsx(am,{edge:m,isReconnectable:I,reconnectRadius:h,onReconnect:f,onReconnectStart:u,onReconnectEnd:p,sourceX:D,sourceY:A,targetX:z,targetY:O,sourcePosition:F,targetPosition:V,setUpdateHover:P,setReconnecting:N})]})})}var cm=b.memo(lm);const dm=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function oa({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:s,edgeTypes:r,noPanClassName:o,onReconnect:a,onEdgeContextMenu:i,onEdgeMouseEnter:l,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:h,reconnectRadius:f,onEdgeDoubleClick:u,onReconnectStart:p,onReconnectEnd:x,disableKeyboardA11y:g}){const{edgesFocusable:y,edgesReconnectable:v,elementsSelectable:k,onError:m}=le(dm,pe),j=Z0(t);return n.jsxs("div",{className:"react-flow__edges",children:[n.jsx(K0,{defaultColor:e,rfId:s}),j.map(E=>n.jsx(cm,{id:E,edgesFocusable:y,edgesReconnectable:v,elementsSelectable:k,noPanClassName:o,onReconnect:a,onContextMenu:i,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,onClick:h,reconnectRadius:f,onDoubleClick:u,onReconnectStart:p,onReconnectEnd:x,rfId:s,onError:m,edgeTypes:r,disableKeyboardA11y:g},E))]})}oa.displayName="EdgeRenderer";const um=b.memo(oa),hm=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function fm({children:e}){const t=le(hm);return n.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function mm(e){const t=Gn(),s=b.useRef(!1);b.useEffect(()=>{!s.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),s.current=!0)},[e,t.viewportInitialized])}const pm=e=>e.panZoom?.syncViewport;function xm(e){const t=le(pm),s=xe();return b.useEffect(()=>{e&&(t?.(e),s.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function gm(e){return e.connection.inProgress?{...e.connection,to:Wt(e.connection.to,e.transform)}:{...e.connection}}function bm(e){return gm}function ym(e){const t=bm();return le(t,pe)}const vm=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function wm({containerStyle:e,style:t,type:s,component:r}){const{nodesConnectable:o,width:a,height:i,isValid:l,inProgress:c}=le(vm,pe);return!(a&&o&&c)?null:n.jsx("svg",{style:e,width:a,height:i,className:"react-flow__connectionline react-flow__container",children:n.jsx("g",{className:ye(["react-flow__connection",ri(l)]),children:n.jsx(ia,{style:t,type:s,CustomComponent:r,isValid:l})})})}const ia=({style:e,type:t=Qe.Bezier,CustomComponent:s,isValid:r})=>{const{inProgress:o,from:a,fromNode:i,fromHandle:l,fromPosition:c,to:d,toNode:h,toHandle:f,toPosition:u,pointer:p}=ym();if(!o)return;if(s)return n.jsx(s,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:l,fromX:a.x,fromY:a.y,toX:d.x,toY:d.y,fromPosition:c,toPosition:u,connectionStatus:ri(r),toNode:h,toHandle:f,pointer:p});let x="";const g={sourceX:a.x,sourceY:a.y,sourcePosition:c,targetX:d.x,targetY:d.y,targetPosition:u};switch(t){case Qe.Bezier:[x]=xi(g);break;case Qe.SimpleBezier:[x]=Yi(g);break;case Qe.Step:[x]=vs({...g,borderRadius:0});break;case Qe.SmoothStep:[x]=vs(g);break;default:[x]=bi(g)}return n.jsx("path",{d:x,fill:"none",className:"react-flow__connection-path",style:e})};ia.displayName="ConnectionLine";const jm={};function io(e=jm){b.useRef(e),xe(),b.useEffect(()=>{},[e])}function Nm(){xe(),b.useRef(!1),b.useEffect(()=>{},[])}function aa({nodeTypes:e,edgeTypes:t,onInit:s,onNodeClick:r,onEdgeClick:o,onNodeDoubleClick:a,onEdgeDoubleClick:i,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:h,onSelectionContextMenu:f,onSelectionStart:u,onSelectionEnd:p,connectionLineType:x,connectionLineStyle:g,connectionLineComponent:y,connectionLineContainerStyle:v,selectionKeyCode:k,selectionOnDrag:m,selectionMode:j,multiSelectionKeyCode:E,panActivationKeyCode:w,zoomActivationKeyCode:C,deleteKeyCode:I,onlyRenderVisibleElements:T,elementsSelectable:$,defaultViewport:S,translateExtent:P,minZoom:H,maxZoom:N,preventScrolling:M,defaultMarkerColor:_,zoomOnScroll:D,zoomOnPinch:A,panOnScroll:z,panOnScrollSpeed:O,panOnScrollMode:F,zoomOnDoubleClick:V,panOnDrag:Q,onPaneClick:X,onPaneMouseEnter:te,onPaneMouseMove:Z,onPaneMouseLeave:B,onPaneScroll:R,onPaneContextMenu:J,paneClickDistance:W,nodeClickDistance:se,onEdgeContextMenu:q,onEdgeMouseEnter:K,onEdgeMouseMove:re,onEdgeMouseLeave:ae,reconnectRadius:ce,onReconnect:de,onReconnectStart:je,onReconnectEnd:Se,noDragClassName:Ne,noWheelClassName:Pe,noPanClassName:De,disableKeyboardA11y:_e,nodeExtent:ee,rfId:me,viewport:ve,onViewportChange:ke}){return io(e),io(t),Nm(),mm(s),xm(ve),n.jsx(L0,{onPaneClick:X,onPaneMouseEnter:te,onPaneMouseMove:Z,onPaneMouseLeave:B,onPaneContextMenu:J,onPaneScroll:R,paneClickDistance:W,deleteKeyCode:I,selectionKeyCode:k,selectionOnDrag:m,selectionMode:j,onSelectionStart:u,onSelectionEnd:p,multiSelectionKeyCode:E,panActivationKeyCode:w,zoomActivationKeyCode:C,elementsSelectable:$,zoomOnScroll:D,zoomOnPinch:A,zoomOnDoubleClick:V,panOnScroll:z,panOnScrollSpeed:O,panOnScrollMode:F,panOnDrag:Q,defaultViewport:S,translateExtent:P,minZoom:H,maxZoom:N,onSelectionContextMenu:f,preventScrolling:M,noDragClassName:Ne,noWheelClassName:Pe,noPanClassName:De,disableKeyboardA11y:_e,onViewportChange:ke,isControlledViewport:!!ve,children:n.jsxs(fm,{children:[n.jsx(um,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:i,onReconnect:de,onReconnectStart:je,onReconnectEnd:Se,onlyRenderVisibleElements:T,onEdgeContextMenu:q,onEdgeMouseEnter:K,onEdgeMouseMove:re,onEdgeMouseLeave:ae,reconnectRadius:ce,defaultMarkerColor:_,noPanClassName:De,disableKeyboardA11y:_e,rfId:me}),n.jsx(wm,{style:g,type:x,component:y,containerStyle:v}),n.jsx("div",{className:"react-flow__edgelabel-renderer"}),n.jsx(Y0,{nodeTypes:e,onNodeClick:r,onNodeDoubleClick:a,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:h,nodeClickDistance:se,onlyRenderVisibleElements:T,noPanClassName:De,noDragClassName:Ne,disableKeyboardA11y:_e,nodeExtent:ee,rfId:me}),n.jsx("div",{className:"react-flow__viewport-portal"})]})})}aa.displayName="GraphView";const km=b.memo(aa),ao=({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c=.5,maxZoom:d=2,nodeOrigin:h,nodeExtent:f,zIndexMode:u="basic"}={})=>{const p=new Map,x=new Map,g=new Map,y=new Map,v=r??t??[],k=s??e??[],m=h??[0,0],j=f??Lt;wi(g,y,v);const E=js(k,p,x,{nodeOrigin:m,nodeExtent:j,zIndexMode:u});let w=[0,0,1];if(i&&o&&a){const C=Zt(p,{filter:S=>!!((S.width||S.initialWidth)&&(S.height||S.initialHeight))}),{x:I,y:T,zoom:$}=Hs(C,o,a,c,d,l?.padding??.1);w=[I,T,$]}return{rfId:"1",width:o??0,height:a??0,transform:w,nodes:k,nodesInitialized:E,nodeLookup:p,parentLookup:x,edges:v,edgeLookup:y,connectionLookup:g,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:s!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:c,maxZoom:d,translateExtent:Lt,nodeExtent:j,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:yt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:m,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:l,fitViewResolver:null,connection:{...si},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Lh,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:ni,zIndexMode:u,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},Cm=({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c,maxZoom:d,nodeOrigin:h,nodeExtent:f,zIndexMode:u})=>Ff((p,x)=>{async function g(){const{nodeLookup:y,panZoom:v,fitViewOptions:k,fitViewResolver:m,width:j,height:E,minZoom:w,maxZoom:C}=x();v&&(await Rh({nodes:y,width:j,height:E,panZoom:v,minZoom:w,maxZoom:C},k),m?.resolve(!0),p({fitViewResolver:null}))}return{...ao({nodes:e,edges:t,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c,maxZoom:d,nodeOrigin:h,nodeExtent:f,defaultNodes:s,defaultEdges:r,zIndexMode:u}),setNodes:y=>{const{nodeLookup:v,parentLookup:k,nodeOrigin:m,elevateNodesOnSelect:j,fitViewQueued:E,zIndexMode:w}=x(),C=js(y,v,k,{nodeOrigin:m,nodeExtent:f,elevateNodesOnSelect:j,checkEquality:!0,zIndexMode:w});E&&C?(g(),p({nodes:y,nodesInitialized:C,fitViewQueued:!1,fitViewOptions:void 0})):p({nodes:y,nodesInitialized:C})},setEdges:y=>{const{connectionLookup:v,edgeLookup:k}=x();wi(v,k,y),p({edges:y})},setDefaultNodesAndEdges:(y,v)=>{if(y){const{setNodes:k}=x();k(y),p({hasDefaultNodes:!0})}if(v){const{setEdges:k}=x();k(v),p({hasDefaultEdges:!0})}},updateNodeInternals:y=>{const{triggerNodeChanges:v,nodeLookup:k,parentLookup:m,domNode:j,nodeOrigin:E,nodeExtent:w,debug:C,fitViewQueued:I,zIndexMode:T}=x(),{changes:$,updatedInternals:S}=af(y,k,m,j,E,w,T);S&&(nf(k,m,{nodeOrigin:E,nodeExtent:w,zIndexMode:T}),I?(g(),p({fitViewQueued:!1,fitViewOptions:void 0})):p({}),$?.length>0&&(C&&console.log("React Flow: trigger node changes",$),v?.($)))},updateNodePositions:(y,v=!1)=>{const k=[];let m=[];const{nodeLookup:j,triggerNodeChanges:E,connection:w,updateConnection:C,onNodesChangeMiddlewareMap:I}=x();for(const[T,$]of y){const S=j.get(T),P=!!(S?.expandParent&&S?.parentId&&$?.position),H={id:T,type:"position",position:P?{x:Math.max(0,$.position.x),y:Math.max(0,$.position.y)}:$.position,dragging:v};if(S&&w.inProgress&&w.fromNode.id===S.id){const N=dt(S,w.fromHandle,ne.Left,!0);C({...w,from:N})}P&&S.parentId&&k.push({id:T,parentId:S.parentId,rect:{...$.internals.positionAbsolute,width:$.measured.width??0,height:$.measured.height??0}}),m.push(H)}if(k.length>0){const{parentLookup:T,nodeOrigin:$}=x(),S=qs(k,j,T,$);m.push(...S)}for(const T of I.values())m=T(m);E(m)},triggerNodeChanges:y=>{const{onNodesChange:v,setNodes:k,nodes:m,hasDefaultNodes:j,debug:E}=x();if(y?.length){if(j){const w=Ri(y,m);k(w)}E&&console.log("React Flow: trigger node changes",y),v?.(y)}},triggerEdgeChanges:y=>{const{onEdgesChange:v,setEdges:k,edges:m,hasDefaultEdges:j,debug:E}=x();if(y?.length){if(j){const w=zi(y,m);k(w)}E&&console.log("React Flow: trigger edge changes",y),v?.(y)}},addSelectedNodes:y=>{const{multiSelectionActive:v,edgeLookup:k,nodeLookup:m,triggerNodeChanges:j,triggerEdgeChanges:E}=x();if(v){const w=y.map(C=>st(C,!0));j(w);return}j(mt(m,new Set([...y]),!0)),E(mt(k))},addSelectedEdges:y=>{const{multiSelectionActive:v,edgeLookup:k,nodeLookup:m,triggerNodeChanges:j,triggerEdgeChanges:E}=x();if(v){const w=y.map(C=>st(C,!0));E(w);return}E(mt(k,new Set([...y]))),j(mt(m,new Set,!0))},unselectNodesAndEdges:({nodes:y,edges:v}={})=>{const{edges:k,nodes:m,nodeLookup:j,triggerNodeChanges:E,triggerEdgeChanges:w}=x(),C=y||m,I=v||k,T=C.map(S=>{const P=j.get(S.id);return P&&(P.selected=!1),st(S.id,!1)}),$=I.map(S=>st(S.id,!1));E(T),w($)},setMinZoom:y=>{const{panZoom:v,maxZoom:k}=x();v?.setScaleExtent([y,k]),p({minZoom:y})},setMaxZoom:y=>{const{panZoom:v,minZoom:k}=x();v?.setScaleExtent([k,y]),p({maxZoom:y})},setTranslateExtent:y=>{x().panZoom?.setTranslateExtent(y),p({translateExtent:y})},resetSelectedElements:()=>{const{edges:y,nodes:v,triggerNodeChanges:k,triggerEdgeChanges:m,elementsSelectable:j}=x();if(!j)return;const E=v.reduce((C,I)=>I.selected?[...C,st(I.id,!1)]:C,[]),w=y.reduce((C,I)=>I.selected?[...C,st(I.id,!1)]:C,[]);k(E),m(w)},setNodeExtent:y=>{const{nodes:v,nodeLookup:k,parentLookup:m,nodeOrigin:j,elevateNodesOnSelect:E,nodeExtent:w,zIndexMode:C}=x();y[0][0]===w[0][0]&&y[0][1]===w[0][1]&&y[1][0]===w[1][0]&&y[1][1]===w[1][1]||(js(v,k,m,{nodeOrigin:j,nodeExtent:y,elevateNodesOnSelect:E,checkEquality:!1,zIndexMode:C}),p({nodeExtent:y}))},panBy:y=>{const{transform:v,width:k,height:m,panZoom:j,translateExtent:E}=x();return lf({delta:y,panZoom:j,transform:v,translateExtent:E,width:k,height:m})},setCenter:async(y,v,k)=>{const{width:m,height:j,maxZoom:E,panZoom:w}=x();if(!w)return Promise.resolve(!1);const C=typeof k?.zoom<"u"?k.zoom:E;return await w.setViewport({x:m/2-y*C,y:j/2-v*C,zoom:C},{duration:k?.duration,ease:k?.ease,interpolate:k?.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{p({connection:{...si}})},updateConnection:y=>{p({connection:y})},reset:()=>p({...ao()})}},Object.is);function la({initialNodes:e,initialEdges:t,defaultNodes:s,defaultEdges:r,initialWidth:o,initialHeight:a,initialMinZoom:i,initialMaxZoom:l,initialFitViewOptions:c,fitView:d,nodeOrigin:h,nodeExtent:f,zIndexMode:u,children:p}){const[x]=b.useState(()=>Cm({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:d,minZoom:i,maxZoom:l,fitViewOptions:c,nodeOrigin:h,nodeExtent:f,zIndexMode:u}));return n.jsx(Gf,{value:x,children:n.jsx(f0,{children:p})})}function Sm({children:e,nodes:t,edges:s,defaultNodes:r,defaultEdges:o,width:a,height:i,fitView:l,fitViewOptions:c,minZoom:d,maxZoom:h,nodeOrigin:f,nodeExtent:u,zIndexMode:p}){return b.useContext(Fn)?n.jsx(n.Fragment,{children:e}):n.jsx(la,{initialNodes:t,initialEdges:s,defaultNodes:r,defaultEdges:o,initialWidth:a,initialHeight:i,fitView:l,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:h,nodeOrigin:f,nodeExtent:u,zIndexMode:p,children:e})}const _m={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Em({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,className:o,nodeTypes:a,edgeTypes:i,onNodeClick:l,onEdgeClick:c,onInit:d,onMove:h,onMoveStart:f,onMoveEnd:u,onConnect:p,onConnectStart:x,onConnectEnd:g,onClickConnectStart:y,onClickConnectEnd:v,onNodeMouseEnter:k,onNodeMouseMove:m,onNodeMouseLeave:j,onNodeContextMenu:E,onNodeDoubleClick:w,onNodeDragStart:C,onNodeDrag:I,onNodeDragStop:T,onNodesDelete:$,onEdgesDelete:S,onDelete:P,onSelectionChange:H,onSelectionDragStart:N,onSelectionDrag:M,onSelectionDragStop:_,onSelectionContextMenu:D,onSelectionStart:A,onSelectionEnd:z,onBeforeDelete:O,connectionMode:F,connectionLineType:V=Qe.Bezier,connectionLineStyle:Q,connectionLineComponent:X,connectionLineContainerStyle:te,deleteKeyCode:Z="Backspace",selectionKeyCode:B="Shift",selectionOnDrag:R=!1,selectionMode:J=Bt.Full,panActivationKeyCode:W="Space",multiSelectionKeyCode:se=Ot()?"Meta":"Control",zoomActivationKeyCode:q=Ot()?"Meta":"Control",snapToGrid:K,snapGrid:re,onlyRenderVisibleElements:ae=!1,selectNodesOnDrag:ce,nodesDraggable:de,autoPanOnNodeFocus:je,nodesConnectable:Se,nodesFocusable:Ne,nodeOrigin:Pe=Pi,edgesFocusable:De,edgesReconnectable:_e,elementsSelectable:ee=!0,defaultViewport:me=s0,minZoom:ve=.5,maxZoom:ke=2,translateExtent:Ce=Lt,preventScrolling:L=!0,nodeExtent:G,defaultMarkerColor:Y="#b1b1b7",zoomOnScroll:U=!0,zoomOnPinch:oe=!0,panOnScroll:ue=!1,panOnScrollSpeed:he=.5,panOnScrollMode:Ie=it.Free,zoomOnDoubleClick:ge=!0,panOnDrag:Qt=!0,onPaneClick:Kt,onPaneMouseEnter:Yn,onPaneMouseMove:ha,onPaneMouseLeave:fa,onPaneScroll:ma,onPaneContextMenu:pa,paneClickDistance:xa=1,nodeClickDistance:ga=0,children:ba,onReconnect:ya,onReconnectStart:va,onReconnectEnd:wa,onEdgeContextMenu:ja,onEdgeDoubleClick:Na,onEdgeMouseEnter:ka,onEdgeMouseMove:Ca,onEdgeMouseLeave:Sa,reconnectRadius:_a=10,onNodesChange:Ea,onEdgesChange:Ma,noDragClassName:Ia="nodrag",noWheelClassName:Aa="nowheel",noPanClassName:Zs="nopan",fitView:Xs,fitViewOptions:Ws,connectOnClick:Ta,attributionPosition:$a,proOptions:Pa,defaultEdgeOptions:Da,elevateNodesOnSelect:Ra=!0,elevateEdgesOnSelect:za=!1,disableKeyboardA11y:Js=!1,autoPanOnConnect:La,autoPanOnNodeDrag:Ba,autoPanSpeed:Ha,connectionRadius:Oa,isValidConnection:Va,onError:Fa,style:Ga,id:Qs,nodeDragThreshold:Ua,connectionDragThreshold:qa,viewport:Ya,onViewportChange:Za,width:Xa,height:Wa,colorMode:Ja="light",debug:Qa,onScroll:Ks,ariaLabelConfig:Ka,zIndexMode:er="basic",...el},tl){const Zn=Qs||"1",nl=a0(Ja),sl=b.useCallback(tr=>{tr.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Ks?.(tr)},[Ks]);return n.jsx("div",{"data-testid":"rf__wrapper",...el,onScroll:sl,style:{...Ga,..._m},ref:tl,className:ye(["react-flow",o,nl]),id:Qs,role:"application",children:n.jsxs(Sm,{nodes:e,edges:t,width:Xa,height:Wa,fitView:Xs,fitViewOptions:Ws,minZoom:ve,maxZoom:ke,nodeOrigin:Pe,nodeExtent:G,zIndexMode:er,children:[n.jsx(km,{onInit:d,onNodeClick:l,onEdgeClick:c,onNodeMouseEnter:k,onNodeMouseMove:m,onNodeMouseLeave:j,onNodeContextMenu:E,onNodeDoubleClick:w,nodeTypes:a,edgeTypes:i,connectionLineType:V,connectionLineStyle:Q,connectionLineComponent:X,connectionLineContainerStyle:te,selectionKeyCode:B,selectionOnDrag:R,selectionMode:J,deleteKeyCode:Z,multiSelectionKeyCode:se,panActivationKeyCode:W,zoomActivationKeyCode:q,onlyRenderVisibleElements:ae,defaultViewport:me,translateExtent:Ce,minZoom:ve,maxZoom:ke,preventScrolling:L,zoomOnScroll:U,zoomOnPinch:oe,zoomOnDoubleClick:ge,panOnScroll:ue,panOnScrollSpeed:he,panOnScrollMode:Ie,panOnDrag:Qt,onPaneClick:Kt,onPaneMouseEnter:Yn,onPaneMouseMove:ha,onPaneMouseLeave:fa,onPaneScroll:ma,onPaneContextMenu:pa,paneClickDistance:xa,nodeClickDistance:ga,onSelectionContextMenu:D,onSelectionStart:A,onSelectionEnd:z,onReconnect:ya,onReconnectStart:va,onReconnectEnd:wa,onEdgeContextMenu:ja,onEdgeDoubleClick:Na,onEdgeMouseEnter:ka,onEdgeMouseMove:Ca,onEdgeMouseLeave:Sa,reconnectRadius:_a,defaultMarkerColor:Y,noDragClassName:Ia,noWheelClassName:Aa,noPanClassName:Zs,rfId:Zn,disableKeyboardA11y:Js,nodeExtent:G,viewport:Ya,onViewportChange:Za}),n.jsx(i0,{nodes:e,edges:t,defaultNodes:s,defaultEdges:r,onConnect:p,onConnectStart:x,onConnectEnd:g,onClickConnectStart:y,onClickConnectEnd:v,nodesDraggable:de,autoPanOnNodeFocus:je,nodesConnectable:Se,nodesFocusable:Ne,edgesFocusable:De,edgesReconnectable:_e,elementsSelectable:ee,elevateNodesOnSelect:Ra,elevateEdgesOnSelect:za,minZoom:ve,maxZoom:ke,nodeExtent:G,onNodesChange:Ea,onEdgesChange:Ma,snapToGrid:K,snapGrid:re,connectionMode:F,translateExtent:Ce,connectOnClick:Ta,defaultEdgeOptions:Da,fitView:Xs,fitViewOptions:Ws,onNodesDelete:$,onEdgesDelete:S,onDelete:P,onNodeDragStart:C,onNodeDrag:I,onNodeDragStop:T,onSelectionDrag:M,onSelectionDragStart:N,onSelectionDragStop:_,onMove:h,onMoveStart:f,onMoveEnd:u,noPanClassName:Zs,nodeOrigin:Pe,rfId:Zn,autoPanOnConnect:La,autoPanOnNodeDrag:Ba,autoPanSpeed:Ha,onError:Fa,connectionRadius:Oa,isValidConnection:Va,selectNodesOnDrag:ce,nodeDragThreshold:Ua,connectionDragThreshold:qa,onBeforeDelete:O,debug:Qa,ariaLabelConfig:Ka,zIndexMode:er}),n.jsx(n0,{onSelectionChange:H}),ba,n.jsx(Jf,{proOptions:Pa,position:$a}),n.jsx(Wf,{rfId:Zn,disableKeyboardA11y:Js})]})})}var Mm=Li(Em);function Im(e){const[t,s]=b.useState(e),r=b.useCallback(o=>s(a=>Ri(o,a)),[]);return[t,s,r]}function Am(e){const[t,s]=b.useState(e),r=b.useCallback(o=>s(a=>zi(o,a)),[]);return[t,s,r]}function Tm({dimensions:e,lineWidth:t,variant:s,className:r}){return n.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:ye(["react-flow__background-pattern",s,r])})}function $m({radius:e,className:t}){return n.jsx("circle",{cx:e,cy:e,r:e,className:ye(["react-flow__background-pattern","dots",t])})}var tt;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(tt||(tt={}));const Pm={[tt.Dots]:1,[tt.Lines]:1,[tt.Cross]:6},Dm=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ca({id:e,variant:t=tt.Dots,gap:s=20,size:r,lineWidth:o=1,offset:a=0,color:i,bgColor:l,style:c,className:d,patternClassName:h}){const f=b.useRef(null),{transform:u,patternId:p}=le(Dm,pe),x=r||Pm[t],g=t===tt.Dots,y=t===tt.Cross,v=Array.isArray(s)?s:[s,s],k=[v[0]*u[2]||1,v[1]*u[2]||1],m=x*u[2],j=Array.isArray(a)?a:[a,a],E=y?[m,m]:k,w=[j[0]*u[2]||1+E[0]/2,j[1]*u[2]||1+E[1]/2],C=`${p}${e||""}`;return n.jsxs("svg",{className:ye(["react-flow__background",d]),style:{...c,...Un,"--xy-background-color-props":l,"--xy-background-pattern-color-props":i},ref:f,"data-testid":"rf__background",children:[n.jsx("pattern",{id:C,x:u[0]%k[0],y:u[1]%k[1],width:k[0],height:k[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${w[0]},-${w[1]})`,children:g?n.jsx($m,{radius:m/2,className:h}):n.jsx(Tm,{dimensions:E,lineWidth:o,variant:t,className:h})}),n.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${C})`})]})}ca.displayName="Background";const Rm=b.memo(ca);function zm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:n.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Lm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:n.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Bm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:n.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Hm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:n.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Om(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:n.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function cn({children:e,className:t,...s}){return n.jsx("button",{type:"button",className:ye(["react-flow__controls-button",t]),...s,children:e})}const Vm=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function da({style:e,showZoom:t=!0,showFitView:s=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:a,onZoomOut:i,onFitView:l,onInteractiveChange:c,className:d,children:h,position:f="bottom-left",orientation:u="vertical","aria-label":p}){const x=xe(),{isInteractive:g,minZoomReached:y,maxZoomReached:v,ariaLabelConfig:k}=le(Vm,pe),{zoomIn:m,zoomOut:j,fitView:E}=Gn(),w=()=>{m(),a?.()},C=()=>{j(),i?.()},I=()=>{E(o),l?.()},T=()=>{x.setState({nodesDraggable:!g,nodesConnectable:!g,elementsSelectable:!g}),c?.(!g)},$=u==="horizontal"?"horizontal":"vertical";return n.jsxs(Jt,{className:ye(["react-flow__controls",$,d]),position:f,style:e,"data-testid":"rf__controls","aria-label":p??k["controls.ariaLabel"],children:[t&&n.jsxs(n.Fragment,{children:[n.jsx(cn,{onClick:w,className:"react-flow__controls-zoomin",title:k["controls.zoomIn.ariaLabel"],"aria-label":k["controls.zoomIn.ariaLabel"],disabled:v,children:n.jsx(zm,{})}),n.jsx(cn,{onClick:C,className:"react-flow__controls-zoomout",title:k["controls.zoomOut.ariaLabel"],"aria-label":k["controls.zoomOut.ariaLabel"],disabled:y,children:n.jsx(Lm,{})})]}),s&&n.jsx(cn,{className:"react-flow__controls-fitview",onClick:I,title:k["controls.fitView.ariaLabel"],"aria-label":k["controls.fitView.ariaLabel"],children:n.jsx(Bm,{})}),r&&n.jsx(cn,{className:"react-flow__controls-interactive",onClick:T,title:k["controls.interactive.ariaLabel"],"aria-label":k["controls.interactive.ariaLabel"],children:g?n.jsx(Om,{}):n.jsx(Hm,{})}),h]})}da.displayName="Controls";const Fm=b.memo(da);function Gm({id:e,x:t,y:s,width:r,height:o,style:a,color:i,strokeColor:l,strokeWidth:c,className:d,borderRadius:h,shapeRendering:f,selected:u,onClick:p}){const{background:x,backgroundColor:g}=a||{},y=i||x||g;return n.jsx("rect",{className:ye(["react-flow__minimap-node",{selected:u},d]),x:t,y:s,rx:h,ry:h,width:r,height:o,style:{fill:y,stroke:l,strokeWidth:c},shapeRendering:f,onClick:p?v=>p(v,e):void 0})}const Um=b.memo(Gm),qm=e=>e.nodes.map(t=>t.id),as=e=>e instanceof Function?e:()=>e;function Ym({nodeStrokeColor:e,nodeColor:t,nodeClassName:s="",nodeBorderRadius:r=5,nodeStrokeWidth:o,nodeComponent:a=Um,onClick:i}){const l=le(qm,pe),c=as(t),d=as(e),h=as(s),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return n.jsx(n.Fragment,{children:l.map(u=>n.jsx(Xm,{id:u,nodeColorFunc:c,nodeStrokeColorFunc:d,nodeClassNameFunc:h,nodeBorderRadius:r,nodeStrokeWidth:o,NodeComponent:a,onClick:i,shapeRendering:f},u))})}function Zm({id:e,nodeColorFunc:t,nodeStrokeColorFunc:s,nodeClassNameFunc:r,nodeBorderRadius:o,nodeStrokeWidth:a,shapeRendering:i,NodeComponent:l,onClick:c}){const{node:d,x:h,y:f,width:u,height:p}=le(x=>{const{internals:g}=x.nodeLookup.get(e),y=g.userNode,{x:v,y:k}=g.positionAbsolute,{width:m,height:j}=Xe(y);return{node:y,x:v,y:k,width:m,height:j}},pe);return!d||d.hidden||!di(d)?null:n.jsx(l,{x:h,y:f,width:u,height:p,style:d.style,selected:!!d.selected,className:r(d),color:t(d),borderRadius:o,strokeColor:s(d),strokeWidth:a,shapeRendering:i,onClick:c,id:d.id})}const Xm=b.memo(Zm);var Wm=b.memo(Ym);const Jm=200,Qm=150,Km=e=>!e.hidden,ep=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ci(Zt(e.nodeLookup,{filter:Km}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},tp="react-flow__minimap-desc";function ua({style:e,className:t,nodeStrokeColor:s,nodeColor:r,nodeClassName:o="",nodeBorderRadius:a=5,nodeStrokeWidth:i,nodeComponent:l,bgColor:c,maskColor:d,maskStrokeColor:h,maskStrokeWidth:f,position:u="bottom-right",onClick:p,onNodeClick:x,pannable:g=!1,zoomable:y=!1,ariaLabel:v,inversePan:k,zoomStep:m=1,offsetScale:j=5}){const E=xe(),w=b.useRef(null),{boundingRect:C,viewBB:I,rfId:T,panZoom:$,translateExtent:S,flowWidth:P,flowHeight:H,ariaLabelConfig:N}=le(ep,pe),M=e?.width??Jm,_=e?.height??Qm,D=C.width/M,A=C.height/_,z=Math.max(D,A),O=z*M,F=z*_,V=j*z,Q=C.x-(O-C.width)/2-V,X=C.y-(F-C.height)/2-V,te=O+V*2,Z=F+V*2,B=`${tp}-${T}`,R=b.useRef(0),J=b.useRef();R.current=z,b.useEffect(()=>{if(w.current&&$)return J.current=gf({domNode:w.current,panZoom:$,getTransform:()=>E.getState().transform,getViewScale:()=>R.current}),()=>{J.current?.destroy()}},[$]),b.useEffect(()=>{J.current?.update({translateExtent:S,width:P,height:H,inversePan:k,pannable:g,zoomStep:m,zoomable:y})},[g,y,k,m,S,P,H]);const W=p?K=>{const[re,ae]=J.current?.pointer(K)||[0,0];p(K,{x:re,y:ae})}:void 0,se=x?b.useCallback((K,re)=>{const ae=E.getState().nodeLookup.get(re).internals.userNode;x(K,ae)},[]):void 0,q=v??N["minimap.ariaLabel"];return n.jsx(Jt,{position:u,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-color-props":typeof h=="string"?h:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*z:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:ye(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:n.jsxs("svg",{width:M,height:_,viewBox:`${Q} ${X} ${te} ${Z}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":B,ref:w,onClick:W,children:[q&&n.jsx("title",{id:B,children:q}),n.jsx(Wm,{onClick:se,nodeColor:r,nodeStrokeColor:s,nodeBorderRadius:a,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:l}),n.jsx("path",{className:"react-flow__minimap-mask",d:`M${Q-V},${X-V}h${te+V*2}v${Z+V*2}h${-te-V*2}z
        M${I.x},${I.y}h${I.width}v${I.height}h${-I.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}ua.displayName="MiniMap";const np=b.memo(ua),sp=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,rp={[kt.Line]:"right",[kt.Handle]:"bottom-right"};function op({nodeId:e,position:t,variant:s=kt.Handle,className:r,style:o=void 0,children:a,color:i,minWidth:l=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:h=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:u,autoScale:p=!0,shouldResize:x,onResizeStart:g,onResize:y,onResizeEnd:v}){const k=Vi(),m=typeof e=="string"?e:k,j=xe(),E=b.useRef(null),w=s===kt.Handle,C=le(b.useCallback(sp(w&&p),[w,p]),pe),I=b.useRef(null),T=t??rp[s];b.useEffect(()=>{if(!(!E.current||!m))return I.current||(I.current=Af({domNode:E.current,nodeId:m,getStoreItems:()=>{const{nodeLookup:S,transform:P,snapGrid:H,snapToGrid:N,nodeOrigin:M,domNode:_}=j.getState();return{nodeLookup:S,transform:P,snapGrid:H,snapToGrid:N,nodeOrigin:M,paneDomNode:_}},onChange:(S,P)=>{const{triggerNodeChanges:H,nodeLookup:N,parentLookup:M,nodeOrigin:_}=j.getState(),D=[],A={x:S.x,y:S.y},z=N.get(m);if(z&&z.expandParent&&z.parentId){const O=z.origin??_,F=S.width??z.measured.width??0,V=S.height??z.measured.height??0,Q={id:z.id,parentId:z.parentId,rect:{width:F,height:V,...ui({x:S.x??z.position.x,y:S.y??z.position.y},{width:F,height:V},z.parentId,N,O)}},X=qs([Q],N,M,_);D.push(...X),A.x=S.x?Math.max(O[0]*F,S.x):void 0,A.y=S.y?Math.max(O[1]*V,S.y):void 0}if(A.x!==void 0&&A.y!==void 0){const O={id:m,type:"position",position:{...A}};D.push(O)}if(S.width!==void 0&&S.height!==void 0){const F={id:m,type:"dimensions",resizing:!0,setAttributes:u?u==="horizontal"?"width":"height":!0,dimensions:{width:S.width,height:S.height}};D.push(F)}for(const O of P){const F={...O,type:"position"};D.push(F)}H(D)},onEnd:({width:S,height:P})=>{const H={id:m,type:"dimensions",resizing:!1,dimensions:{width:S,height:P}};j.getState().triggerNodeChanges([H])}})),I.current.update({controlPosition:T,boundaries:{minWidth:l,minHeight:c,maxWidth:d,maxHeight:h},keepAspectRatio:f,resizeDirection:u,onResizeStart:g,onResize:y,onResizeEnd:v,shouldResize:x}),()=>{I.current?.destroy()}},[T,l,c,d,h,f,g,y,v,x]);const $=T.split("-");return n.jsx("div",{className:ye(["react-flow__resize-control","nodrag",...$,s,r]),ref:E,style:{...o,scale:C,...i&&{[w?"backgroundColor":"borderColor"]:i}},children:a})}b.memo(op);function Ee({icon:e,onClick:t,active:s,title:r}){return n.jsx("button",{type:"button",onClick:t,title:r,className:`p-2 rounded-lg transition-colors ${s?"bg-blue-500 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,children:e})}function ip({value:e,onChange:t,direction:s="rtl",placeholder:r=" ...",className:o=""}){const a=b.useRef(null),[i,l]=b.useState(null),[c,d]=b.useState(""),[h,f]=b.useState(""),u=b.useCallback((y,v)=>{document.execCommand(y,!1,v),a.current?.focus(),p()},[]),p=b.useCallback(()=>{a.current&&t(a.current.innerHTML)},[t]),x=b.useCallback(y=>{if(!c)return;let v="";if(y==="image")v=`<img src="${c}" alt="${h}" class="inline-media rounded-lg max-w-full my-2" />`;else if(c.includes("youtube.com")||c.includes("youtu.be")){const k=c.match(/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/\s]{11})/)?.[1];k&&(v=`<iframe src="https://www.youtube.com/embed/${k}" class="inline-media rounded-lg w-full aspect-video my-2" frameborder="0" allowfullscreen></iframe>`)}else v=`<video src="${c}" controls class="inline-media rounded-lg max-w-full my-2"></video>`;v&&(document.execCommand("insertHTML",!1,v),p()),l(null),d(""),f("")},[c,h,p]),g=b.useCallback(()=>{const y=prompt(" :");y&&u("createLink",y)},[u]);return n.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 overflow-hidden ${o}`,children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 border-b border-slate-700 bg-slate-900/50",children:[n.jsx(Ee,{icon:n.jsx(yl,{className:"w-4 h-4"}),onClick:()=>u("bold"),title:""}),n.jsx(Ee,{icon:n.jsx(Cl,{className:"w-4 h-4"}),onClick:()=>u("italic"),title:""}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(Ee,{icon:n.jsx(Nl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","h1"),title:" "}),n.jsx(Ee,{icon:n.jsx(kl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","h2"),title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(Ee,{icon:n.jsx(Ml,{className:"w-4 h-4"}),onClick:()=>u("insertUnorderedList"),title:" "}),n.jsx(Ee,{icon:n.jsx(El,{className:"w-4 h-4"}),onClick:()=>u("insertOrderedList"),title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(Ee,{icon:n.jsx(nt,{className:"w-4 h-4"}),onClick:()=>l("image"),title:" "}),n.jsx(Ee,{icon:n.jsx(ut,{className:"w-4 h-4"}),onClick:()=>l("video"),title:" "}),n.jsx(Ee,{icon:n.jsx(bo,{className:"w-4 h-4"}),onClick:g,title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(Ee,{icon:n.jsx(zl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","blockquote"),title:""}),n.jsx(Ee,{icon:n.jsx($n,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","pre"),title:""}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(Ee,{icon:s==="rtl"?n.jsx(bl,{className:"w-4 h-4"}):n.jsx(gl,{className:"w-4 h-4"}),onClick:()=>{a.current&&(a.current.dir=a.current.dir==="rtl"?"ltr":"rtl")},title:" "}),n.jsx("div",{className:"flex-1"}),n.jsx(Ee,{icon:n.jsx(Fl,{className:"w-4 h-4"}),onClick:()=>u("undo"),title:""}),n.jsx(Ee,{icon:n.jsx(Ll,{className:"w-4 h-4"}),onClick:()=>u("redo"),title:""})]}),n.jsx("div",{ref:a,contentEditable:!0,dir:s,className:`min-h-[200px] p-4 outline-none rich-text-content ${s==="rtl"?"rtl":""}`,onInput:p,dangerouslySetInnerHTML:{__html:e},"data-placeholder":r,style:{minHeight:"200px"}}),i&&n.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:i==="image"?" ":" "}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:i==="image"?" ":" "}),n.jsx("input",{type:"url",value:c,onChange:y=>d(y.target.value),placeholder:i==="image"?"https://example.com/image.jpg":"https://youtube.com/watch?v=...",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",dir:"ltr"})]}),i==="image"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"  ()"}),n.jsx("input",{type:"text",value:h,onChange:y=>f(y.target.value),placeholder:" ",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),i==="video"&&n.jsx("p",{className:"text-sm text-slate-400",children:"   YouTube    "})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:()=>{l(null),d(""),f("")},className:"flex-1 px-4 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:""}),n.jsx("button",{onClick:()=>x(i),disabled:!c,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:""})]})]})})]})}function ap(){const e=["video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm","video/mp4"];for(const t of e)if(MediaRecorder.isTypeSupported(t))return t;return""}function lp(e){if(e instanceof Error)switch(e.name){case"NotAllowedError":return"      .          .";case"NotFoundError":return"      .      .";case"NotSupportedError":return"    .    Chrome  Firefox.";case"NotReadableError":return"       .      .";case"OverconstrainedError":return"    .    .";case"AbortError":return"  .    .";case"SecurityError":return" .      HTTPS .";default:return e.message.includes("Permission denied")?"   .      .":`   : ${e.message}`}return"   .     ."}function cp({onRecordingComplete:e,onClose:t,showLibrarySave:s=!0}){const[r,o]=b.useState(null),[a,i]=b.useState("idle"),[l,c]=b.useState(0),[d,h]=b.useState(null),[f,u]=b.useState(null),[p,x]=b.useState(!0),[g,y]=b.useState(null),[v,k]=b.useState(!1),m=b.useRef(null),j=b.useRef(null),E=b.useRef(null),w=b.useRef(null),C=b.useRef([]),I=b.useRef(null),T=b.useRef(null),$=b.useRef(null),S=b.useRef(null),P=b.useRef(!1),H=b.useRef(null);b.useRef(null);const N=b.useRef(0),M=b.useRef(null),_=b.useRef(null);b.useEffect(()=>{if(d){const Z=URL.createObjectURL(d);return y(Z),()=>{URL.revokeObjectURL(Z),y(null)}}},[d]),b.useEffect(()=>()=>{D(),$.current&&clearInterval($.current),S.current&&cancelAnimationFrame(S.current),_.current&&(_.current.postMessage({type:"stop"}),_.current.terminate(),_.current=null),M.current!==null&&m.current&&("cancelVideoFrameCallback"in m.current&&m.current.cancelVideoFrameCallback(M.current),M.current=null)},[]);const D=b.useCallback(()=>{_.current&&(_.current.postMessage({type:"stop"}),_.current.terminate(),_.current=null),S.current&&(cancelAnimationFrame(S.current),S.current=null),M.current!==null&&m.current&&("cancelVideoFrameCallback"in m.current&&m.current.cancelVideoFrameCallback(M.current),M.current=null),I.current&&(I.current.getTracks().forEach(Z=>Z.stop()),I.current=null),T.current&&(T.current.getTracks().forEach(Z=>Z.stop()),T.current=null)},[]),A=b.useCallback(async Z=>{u(null),i("preparing"),o(Z),C.current=[];try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("NotSupportedError");if(typeof MediaRecorder>"u")throw new Error("NotSupportedError");if(Z==="camera_screen"&&!HTMLCanvasElement.prototype.captureStream)throw new Error("NotSupportedError");let B;if(Z==="camera"){if(B=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:p}),I.current=B,m.current){m.current.srcObject=B;try{await m.current.play()}catch(q){console.warn("Video autoplay failed:",q)}}}else if(Z==="screen"){const q=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080}},audio:!0}),K=q.getVideoTracks()[0];if(K&&K.addEventListener("ended",()=>{console.log("Screen share ended by user"),w.current&&w.current.state!=="inactive"&&(w.current.stop(),$.current&&clearInterval($.current))}),p)try{const ae=(await navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0];ae&&q.addTrack(ae)}catch{console.log("Could not add microphone audio")}if(B=q,I.current=B,m.current){m.current.srcObject=B;try{await m.current.play()}catch(re){console.warn("Video autoplay failed:",re)}}}else{console.log("Getting camera stream first...");const q=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:320},height:{ideal:240},facingMode:"user"},audio:p});T.current=q,console.log("Camera stream ready"),await new Promise(L=>requestAnimationFrame(L));const K=E.current;if(!K)throw q.getTracks().forEach(L=>L.stop()),new Error("Canvas element not available");const re=K.getContext("2d",{willReadFrequently:!0});if(!re)throw q.getTracks().forEach(L=>L.stop()),new Error("Canvas 2D context not available");if(H.current=re,K.width=1920,K.height=1080,j.current){j.current.srcObject=q;try{await j.current.play()}catch(L){console.warn("Camera video autoplay failed:",L)}}console.log("Requesting screen share...");const ae=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080}},audio:!1});console.log("Screen stream obtained, starting recording immediately!");const ce=ae.getVideoTracks()[0];if(ce&&ce.addEventListener("ended",()=>{console.log("Screen share ended by user (camera_screen mode)"),P.current=!1,w.current&&w.current.state!=="inactive"&&(w.current.stop(),$.current&&clearInterval($.current))}),I.current=ae,m.current&&(m.current.srcObject=ae,m.current.play().catch(L=>{console.warn("Screen video autoplay failed:",L)})),!m.current||!j.current)throw new Error("   .    .");let de=0,je=0;const Se=()=>{if(!P.current)return;N.current++;const L=H.current,G=E.current,Y=m.current,U=j.current;if(!L||!G||!Y||!U){je++;return}if(Y.readyState<2||U.readyState<2){je++,je%30===0&&console.log(`Skipping draw - readyState: screen=${Y.readyState}, camera=${U.readyState}`);return}de++,(de===1||de%60===0)&&console.log(`Video states - Screen: playing=${!Y.paused}, time=${Y.currentTime.toFixed(2)}s, dims=${Y.videoWidth}x${Y.videoHeight}, Camera: playing=${!U.paused}, time=${U.currentTime.toFixed(2)}s, dims=${U.videoWidth}x${U.videoHeight}`),L.drawImage(Y,0,0,G.width,G.height);const oe=320,ue=240,he=20;if(L.save(),L.beginPath(),L.arc(G.width-he-oe/2,G.height-he-ue/2,Math.min(oe,ue)/2,0,Math.PI*2),L.clip(),L.drawImage(U,G.width-he-oe,G.height-he-ue,oe,ue),L.restore(),de%30===0){const ge=L.getImageData(960,540,1,1).data;console.log(`Canvas pixel sample at draw ${de}: RGB(${ge[0]}, ${ge[1]}, ${ge[2]})`)}de%60===0&&console.log(`Actually drew ${de} frames (skipped ${je}), loop iterations: ${N.current}`)};await new Promise(L=>{const G=()=>{const Y=m.current?.readyState>=2,U=j.current?.readyState>=2;Y&&U?(console.log("Video streams ready, starting capture"),L()):requestAnimationFrame(G)};G()}),P.current=!0;const Pe=m.current,De=j.current;re.drawImage(Pe,0,0,K.width,K.height);const _e=320,ee=240,me=20;re.save(),re.beginPath(),re.arc(K.width-me-_e/2,K.height-me-ee/2,Math.min(_e,ee)/2,0,Math.PI*2),re.clip(),re.drawImage(De,K.width-me-_e,K.height-me-ee,_e,ee),re.restore(),console.log("First frame drawn manually"),N.current=0;const ve=K.captureStream(30);console.log("Canvas stream capture started (automatic 30fps mode)");const ke=new Worker(new URL("/assets/drawTimer.worker-CwGJl4f8.js",import.meta.url),{type:"module"});_.current=ke,ke.onmessage=L=>{L.data.type==="draw"?Se():L.data.type==="started"?console.log(`Draw worker started at ${L.data.fps}fps (${L.data.interval}ms interval)`):L.data.type==="stopped"&&console.log("Draw worker stopped")},ke.onerror=L=>{console.error("Draw worker error:",L)},ke.postMessage({type:"start",fps:30}),console.log("Using Web Worker for background-safe drawing");const Ce=q.getAudioTracks();p&&Ce.length>0&&ve.addTrack(Ce[0]),B=ve}const R=ap(),J=R?{mimeType:R}:{},W=new MediaRecorder(B,J);let se=0;W.ondataavailable=q=>{se++,q.data.size>0?(C.current.push(q.data),console.log(`MediaRecorder data chunk ${se}: ${q.data.size} bytes`)):console.warn(`MediaRecorder data chunk ${se}: EMPTY (0 bytes)`)},W.onstop=()=>{const q=R||"video/webm",K=new Blob(C.current,{type:q});if(console.log("Recording stopped. Blob size:",K.size,"Chunks:",C.current.length),K.size===0){console.error("Empty recording - no data captured"),u("   .     .    ."),i("idle"),o(null),D(),S.current&&cancelAnimationFrame(S.current),M.current!==null&&m.current&&"cancelVideoFrameCallback"in m.current&&(m.current.cancelVideoFrameCallback(M.current),M.current=null);return}h(K),i("stopped"),D(),S.current&&cancelAnimationFrame(S.current),M.current!==null&&m.current&&"cancelVideoFrameCallback"in m.current&&(m.current.cancelVideoFrameCallback(M.current),M.current=null)},W.onerror=q=>{console.error("MediaRecorder error:",q),u("   .    ."),P.current=!1,i("idle"),o(null),D(),$.current&&(clearInterval($.current),$.current=null),S.current&&(cancelAnimationFrame(S.current),S.current=null),M.current!==null&&m.current&&"cancelVideoFrameCallback"in m.current&&(m.current.cancelVideoFrameCallback(M.current),M.current=null)},w.current=W,W.start(1e3),Z!=="camera_screen"&&(P.current=!0),i("recording"),c(0),$.current=window.setInterval(()=>{c(q=>q+1)},1e3)}catch(B){console.error("Recording error:",B),u(lp(B)),i("idle"),o(null),$.current&&(clearInterval($.current),$.current=null),D()}},[p,D]),z=b.useCallback(()=>{w.current&&a==="recording"&&(w.current.pause(),i("paused"),$.current&&clearInterval($.current))},[a]),O=b.useCallback(()=>{w.current&&a==="paused"&&(w.current.resume(),i("recording"),$.current=window.setInterval(()=>{c(Z=>Z+1)},1e3))},[a]),F=b.useCallback(()=>{w.current&&(P.current=!1,w.current.stop(),$.current&&clearInterval($.current))},[]),V=b.useCallback(()=>{P.current=!1,h(null),y(null),i("idle"),o(null),c(0),u(null),k(!1),D()},[D]),Q=b.useCallback(async()=>{if(d&&r&&e){k(!0);try{await e(d,r,l)}catch(Z){console.error("Save error:",Z),u("   .    .")}finally{k(!1)}}},[d,r,l,e]),X=b.useCallback(()=>{if(d){const Z=URL.createObjectURL(d),B=document.createElement("a");B.href=Z,B.download=`recording-${Date.now()}.webm`,B.click(),URL.revokeObjectURL(Z)}},[d]),te=Z=>{const B=Math.floor(Z/60),R=Z%60;return`${B.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}`};return n.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden",children:[n.jsx("canvas",{ref:E,className:"fixed -left-[9999px] -top-[9999px] pointer-events-none","aria-hidden":"true"}),n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h3",{className:"text-lg font-bold text-white",children:" "}),t&&n.jsx("button",{onClick:t,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-4",children:[a==="idle"&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{className:"text-slate-300 text-center mb-6",children:"  "}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[n.jsxs("button",{onClick:()=>A("camera"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-500/20 flex items-center justify-center group-hover:bg-blue-500/30 transition-colors",children:n.jsx(wo,{className:"w-7 h-7 text-blue-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:""}),n.jsx("div",{className:"text-xs text-slate-400",children:"   "})]})]}),n.jsxs("button",{onClick:()=>A("screen"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-emerald-500/20 flex items-center justify-center group-hover:bg-emerald-500/30 transition-colors",children:n.jsx(Pl,{className:"w-7 h-7 text-emerald-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:""}),n.jsx("div",{className:"text-xs text-slate-400",children:"  "})]})]}),n.jsxs("button",{onClick:()=>A("camera_screen"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-amber-500/20 flex items-center justify-center group-hover:bg-amber-500/30 transition-colors",children:n.jsx($l,{className:"w-7 h-7 text-amber-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:" + "}),n.jsx("div",{className:"text-xs text-slate-400",children:" Loom"})]})]})]}),n.jsx("div",{className:"flex items-center justify-center gap-2 pt-4",children:n.jsxs("button",{onClick:()=>x(!p),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${p?"bg-blue-500/20 text-blue-400":"bg-slate-700 text-slate-400"}`,children:[p?n.jsx(Tl,{className:"w-4 h-4"}):n.jsx(Al,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:p?" ":" "})]})}),f&&n.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-sm",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(It,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"flex-1 text-right",children:[n.jsx("p",{children:f}),n.jsx("button",{onClick:()=>u(null),className:"mt-2 text-xs text-red-300 hover:text-red-200 underline",children:" "})]})]})})]}),(a==="preparing"||a==="recording"||a==="paused")&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative aspect-video bg-black rounded-xl overflow-hidden",children:[n.jsx("video",{ref:m,className:"w-full h-full object-contain",muted:!0,playsInline:!0}),r==="camera_screen"&&n.jsx("video",{ref:j,className:"absolute bottom-4 right-4 w-32 h-24 rounded-full object-cover border-2 border-white shadow-lg",muted:!0,playsInline:!0}),(a==="recording"||a==="paused")&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute top-4 left-4",children:n.jsx("div",{className:`recording-indicator ${a==="paused"?"opacity-50":""}`,children:n.jsx("span",{className:"text-sm font-medium",children:a==="paused"?" ":" "})})}),n.jsx("div",{className:"absolute top-4 right-4 bg-black/50 px-3 py-1 rounded-full",children:n.jsx("span",{className:"text-white font-mono text-sm",children:te(l)})})]}),a==="preparing"&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:n.jsxs("div",{className:"flex flex-col items-center gap-2",children:[n.jsx(fe,{className:"w-8 h-8 text-blue-400 animate-spin"}),n.jsx("span",{className:"text-white text-sm",children:" ..."})]})})]}),(a==="recording"||a==="paused")&&n.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a==="recording"?n.jsx("button",{onClick:z,className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors",title:" ",children:n.jsx(hl,{className:"w-6 h-6 text-white"})}):n.jsx("button",{onClick:O,className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors",title:"",children:n.jsx(go,{className:"w-6 h-6 text-white"})}),n.jsx("button",{onClick:F,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full transition-colors",title:" ",children:n.jsx(No,{className:"w-6 h-6 text-white fill-current"})})]})]}),a==="stopped"&&d&&g&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"aspect-video bg-black rounded-xl overflow-hidden",children:n.jsx("video",{src:g,controls:!0,className:"w-full h-full object-contain"})}),n.jsxs("div",{className:"text-slate-400 text-sm text-center",children:[": ",te(l)]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("button",{onClick:V,disabled:v,className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:[n.jsx(fl,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{className:"truncate",children:""})]}),n.jsxs("button",{onClick:X,disabled:v,className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:[n.jsx(ml,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{className:"truncate",children:""})]})]}),s&&n.jsx("button",{onClick:Q,disabled:v,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:v?n.jsxs(n.Fragment,{children:[n.jsx(fe,{className:"w-5 h-5 animate-spin flex-shrink-0"}),n.jsx("span",{children:" ..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(In,{className:"w-5 h-5 flex-shrink-0"}),n.jsx("span",{children:"  "})]})})]})]})]})]})}function dp({block:e,allBlocks:t,edges:s,onUpdate:r,onAddEdge:o,onRemoveEdge:a,onClose:i}){const{enabled:l,isLoading:c}=Cs(),[d,h]=b.useState("content"),f=(g,y)=>{r({content:{...e.content,[g]:y}})},u=g=>{r({content:{...e.content,...g}})},p=s.filter(g=>g.from===e.id),x=t.filter(g=>g.id!==e.id&&!p.some(y=>y.to===g.id));return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit Block"}),n.jsx("button",{onClick:i,className:"p-1.5 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:n.jsxs("div",{className:"p-4 space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:e.content.title||"",onChange:g=>f("title",g.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Block title"})]}),n.jsx(lo,{title:"Content",isOpen:d==="content",onToggle:()=>h(d==="content"?"":"content"),children:up(e,f,u,l,c)}),n.jsx(lo,{title:"Connections",isOpen:d==="connections",onToggle:()=>h(d==="connections"?"":"connections"),children:n.jsxs("div",{className:"space-y-3",children:[n.jsx("p",{className:"text-xs text-slate-500",children:"Define what happens after this block."}),p.length>0&&n.jsx("div",{className:"space-y-2",children:p.map(g=>{const y=t.find(v=>v.id===g.to);return n.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-900 rounded-lg group",children:[n.jsx("span",{className:"text-sm text-slate-300 flex-1",children:y?.content?.title||"Unknown block"}),g.condition&&n.jsx("span",{className:"text-xs text-warning mr-2",children:"Conditional"}),n.jsx("button",{onClick:()=>a(g.to),className:"p-1 text-slate-500 hover:text-error hover:bg-error/10 rounded transition-colors",title:"Remove connection",children:n.jsx($e,{className:"w-4 h-4"})})]},`${g.from}-${g.to}`)})}),x.length>0&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Connect to:"}),n.jsxs("select",{onChange:g=>{g.target.value&&(o(g.target.value),g.target.value="")},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"",children:"Select a block..."}),x.map(g=>n.jsx("option",{value:g.id,children:g.content?.title||g.type},g.id))]})]}),e.type==="quiz"&&n.jsxs("div",{className:"mt-4 p-3 bg-slate-900/50 rounded-lg",children:[n.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Conditional Routing"}),n.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Add connections with conditions based on quiz score."}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("button",{onClick:()=>{const g=x[0];g&&o(g.id,{all:[{fact:"quiz.scorePercent",op:"gte",value:50}]})},disabled:x.length===0,className:"w-full px-3 py-2 text-sm bg-emerald-600/20 text-emerald-400 rounded-lg hover:bg-emerald-600/30 disabled:opacity-50 transition-colors",children:'Add "Pass" connection (score >= 50%)'}),n.jsx("button",{onClick:()=>{const g=x[0];g&&o(g.id,{all:[{fact:"quiz.scorePercent",op:"lt",value:50}]})},disabled:x.length===0,className:"w-full px-3 py-2 text-sm bg-red-600/20 text-red-400 rounded-lg hover:bg-red-600/30 disabled:opacity-50 transition-colors",children:'Add "Fail" connection (score < 50%)'})]})]})]})})]})})]})}function lo({title:e,isOpen:t,onToggle:s,children:r}){return n.jsxs("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:[n.jsxs("button",{onClick:s,className:"w-full flex items-center justify-between px-4 py-3 bg-slate-800 text-white hover:bg-slate-700 transition-colors",children:[n.jsx("span",{className:"font-medium",children:e}),t?n.jsx(bn,{className:"w-4 h-4"}):n.jsx(gn,{className:"w-4 h-4"})]}),t&&n.jsx("div",{className:"p-4 bg-slate-800/50",children:r})]})}function up(e,t,s,r,o){const a=e.content;switch(e.type){case"read":return n.jsx(hp,{content:a,updateContent:t,aiEnabled:r,aiSettingsLoading:o});case"video":return n.jsx(fp,{content:a,updateContent:t,updateContentMultiple:s,aiEnabled:r,aiSettingsLoading:o});case"image":return n.jsx(mp,{content:a,updateContent:t,aiEnabled:r,aiSettingsLoading:o});case"quiz":return n.jsx(pp,{content:a,updateContent:t,aiEnabled:r,aiSettingsLoading:o});case"mission":return n.jsx(xp,{content:a,updateContent:t});case"form":return n.jsx(gp,{content:a,updateContent:t});case"ai_help":return n.jsx(bp,{content:a,updateContent:t});case"checkpoint":return n.jsx(yp,{content:a,updateContent:t});case"animation":return n.jsx(vp,{content:a,updateContent:t});case"code":return n.jsx(jp,{content:a,updateContent:t});case"exercise":return n.jsx(Np,{content:a,updateContent:t});case"resource":return n.jsx(kp,{content:a,updateContent:t});default:return n.jsx("p",{className:"text-slate-500",children:"No editor available for this block type."})}}function hp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const[o,a]=b.useState(!1),[i,l]=b.useState(""),[c,d]=b.useState(!1),[h,f]=b.useState("markdown"),u=async()=>{if(!(!i.trim()||!s)){a(!0);try{const v=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"content",topic:i,existingContent:e.markdown||""})})).json();v.result&&(t("markdown",v.result),d(!1),l(""))}catch(y){console.error("AI generation failed:",y)}finally{a(!1)}}},p=y=>y?y.replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>").replace(/^- (.*$)/gm,"<li>$1</li>").replace(/\n/g,"<br>"):"",x=y=>y?y.replace(/<h1>(.*?)<\/h1>/g,`# $1
`).replace(/<h2>(.*?)<\/h2>/g,`## $1
`).replace(/<h3>(.*?)<\/h3>/g,`### $1
`).replace(/<strong>(.*?)<\/strong>/g,"**$1**").replace(/<b>(.*?)<\/b>/g,"**$1**").replace(/<em>(.*?)<\/em>/g,"*$1*").replace(/<i>(.*?)<\/i>/g,"*$1*").replace(/<code>(.*?)<\/code>/g,"`$1`").replace(/<blockquote>(.*?)<\/blockquote>/g,`> $1
`).replace(/<li>(.*?)<\/li>/g,`- $1
`).replace(/<br\s*\/?>/g,`
`).replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").trim():"",g=y=>{const v=x(y);t("markdown",v)};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm text-slate-400",children:"Editor Mode:"}),n.jsxs("div",{className:"flex bg-slate-900 rounded-lg p-1",children:[n.jsxs("button",{onClick:()=>f("markdown"),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm transition-colors ${h==="markdown"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:[n.jsx(Ft,{className:"w-4 h-4"}),"Markdown"]}),n.jsxs("button",{onClick:()=>f("richtext"),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm transition-colors ${h==="richtext"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:[n.jsx(Vl,{className:"w-4 h-4"}),"Rich Text"]})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:["Content (",h==="markdown"?"Markdown":"Rich Text",")"]}),h==="markdown"?n.jsx("textarea",{value:e.markdown||"",onChange:y=>t("markdown",y.target.value),rows:12,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:`# Heading

Your content here...`}):n.jsx(ip,{value:p(e.markdown||""),onChange:g,direction:"ltr",placeholder:"Start writing your content...",className:"min-h-[300px]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Est. Read Time (minutes)"}),n.jsx("input",{type:"number",value:e.estimatedReadTime||3,onChange:y=>t("estimatedReadTime",parseInt(y.target.value)||3),min:1,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),!s&&!r?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx($t,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI content generation is disabled by the administrator."})]}):c?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:i,onChange:y=>l(y.target.value),placeholder:"What topic should this content cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>d(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:u,disabled:o||!i.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[o?n.jsx(fe,{className:"w-4 h-4 animate-spin"}):n.jsx(we,{className:"w-4 h-4"}),o?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>d(!0),disabled:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(we,{className:"w-4 h-4"}),"Generate Content with AI"]})]})}function fp({content:e,updateContent:t,updateContentMultiple:s,aiEnabled:r,aiSettingsLoading:o}){const{showToast:a}=po(),[i,l]=b.useState("url"),[c,d]=b.useState(!1),[h,f]=b.useState(""),[u,p]=b.useState(!1),[x,g]=b.useState(!1),y=async()=>{if(!(!h.trim()||!r)){d(!0);try{const C=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"video_script",topic:h,duration:5})})).json();C.result&&(t("transcript",C.result),t("description",`Video script: ${h}`),p(!1),f(""))}catch(w){console.error("AI generation failed:",w)}finally{d(!1)}}},[v,k]=b.useState(!1),[m,j]=b.useState(null),E=async(w,C)=>{k(!0),j(null);try{const{supabase:I}=await xn(async()=>{const{supabase:N}=await import("./index-BTAm5qeQ.js").then(M=>M.v);return{supabase:N}},__vite__mapDeps([0,1])),{data:{user:T}}=await I.auth.getUser();if(!T)throw new Error("    ");if(w.size===0)throw new Error(" .         .");console.log("Uploading video blob:",{size:w.size,type:w.type});const $=Date.now(),S=`${T.id}/blocks/${$}.webm`,{error:P}=await I.storage.from("videos").upload(S,w,{contentType:"video/webm",cacheControl:"3600"});if(P)throw console.error("Upload error:",P),new Error("   .    .");const{data:H}=I.storage.from("videos").getPublicUrl(S);console.log("Video uploaded successfully:",{filename:S,publicUrl:H.publicUrl,recordingMode:C}),s({url:H.publicUrl,recordingMode:C}),console.log("Block content updated with:",{url:H.publicUrl,recordingMode:C}),g(!1),l("url"),a("success","   ")}catch(I){console.error("Error saving video:",I);const T=I instanceof Error?I.message:"   ";throw j(T),I}finally{k(!1)}};return x?n.jsxs("div",{className:"space-y-4",children:[n.jsx(cp,{onRecordingComplete:E,onClose:()=>{g(!1),l("url"),j(null)},showLibrarySave:!0}),m&&n.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm text-center",children:m}),v&&n.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-400 text-sm",children:[n.jsx(fe,{className:"w-4 h-4 animate-spin"}),n.jsx("span",{children:"  ..."})]})]}):n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>l("url"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${i==="url"?"bg-primary-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(bo,{className:"w-4 h-4"}),"URL"]}),n.jsxs("button",{onClick:()=>l("upload"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${i==="upload"?"bg-primary-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(Tn,{className:"w-4 h-4"}),"Upload"]}),n.jsxs("button",{onClick:()=>{l("record"),g(!0)},className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${i==="record"?"bg-error text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(wo,{className:"w-4 h-4"}),"Record"]})]}),i==="url"?n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Video URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:w=>t("url",w.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://youtube.com/watch?v=... or video URL"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Supports YouTube, Vimeo, and direct video URLs"})]}):i==="upload"?n.jsxs("div",{className:"border-2 border-dashed border-slate-700 rounded-lg p-6 text-center",children:[n.jsx(ut,{className:"w-10 h-10 text-slate-600 mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Drag and drop or click to upload"}),n.jsx("input",{type:"file",accept:"video/*",className:"hidden"}),n.jsx("button",{className:"px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Choose File"})]}):null,e.url&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:" "}),n.jsx("div",{className:"relative aspect-video bg-slate-900 rounded-lg overflow-hidden",children:n.jsx("video",{src:e.url,controls:!0,className:"w-full h-full object-contain",onError:w=>{console.error("Video load error:",w,"URL:",e.url)}})}),n.jsx("p",{className:"text-xs text-slate-500 truncate",title:e.url,children:e.url}),e.recordingMode&&n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[n.jsx("span",{children:" :"}),n.jsx("span",{className:"px-2 py-0.5 bg-slate-700 rounded",children:e.recordingMode==="camera"?"":e.recordingMode==="screen"?"":" + "})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Transcript / Script"}),n.jsx("textarea",{value:e.transcript||"",onChange:w=>t("transcript",w.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Video transcript or script..."})]}),!r&&!o?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx($t,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI script generation is disabled by the administrator."})]}):u?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:h,onChange:w=>f(w.target.value),placeholder:"What should the video script cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>p(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:y,disabled:c||!h.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[c?n.jsx(fe,{className:"w-4 h-4 animate-spin"}):n.jsx(we,{className:"w-4 h-4"}),c?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>p(!0),disabled:o,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(we,{className:"w-4 h-4"}),"Generate Script with AI"]})]})}function mp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const o=["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=800"],[a,i]=b.useState(!1),[l,c]=b.useState(!1),[d,h]=b.useState(""),[f,u]=b.useState(!1);return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Image URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:p=>t("url",p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/image.jpg"})]}),e.url?n.jsx("div",{className:"relative aspect-video bg-slate-900 rounded-lg overflow-hidden",children:n.jsx("img",{src:e.url,alt:"Preview",className:"w-full h-full object-contain"})}):n.jsxs("button",{onClick:()=>i(!a),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-600 transition-colors",children:[n.jsx(nt,{className:"w-8 h-8 text-slate-600"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Choose from gallery or paste URL above"})]}),a&&!e.url&&n.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.map((p,x)=>n.jsx("button",{onClick:()=>{t("url",p),i(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:p,alt:"",className:"w-full h-full object-cover"})},x))}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Caption (optional)"}),n.jsx("input",{type:"text",value:e.caption||"",onChange:p=>t("caption",p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Image caption..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Alt Text"}),n.jsx("input",{type:"text",value:e.alt||"",onChange:p=>t("alt",p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe the image for accessibility..."})]}),!r&&s&&n.jsxs("div",{className:"pt-4 border-t border-slate-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Generate with AI"}),!f&&n.jsx("button",{onClick:()=>u(!0),className:"text-xs text-primary-400 hover:text-primary-300",children:"Show"})]}),f&&n.jsxs("div",{className:"space-y-3",children:[n.jsx("textarea",{value:d,onChange:p=>h(p.target.value),placeholder:`Describe the image you want... (e.g., "A diagram showing how neural networks work" or "${e.caption||e.title||"educational illustration"}")`,rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-sm"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:async()=>{if(d.trim()){c(!0);try{const x=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/image-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({prompt:d,contextTitle:e.title})})).json();x.url?(t("url",x.url),u(!1),h("")):console.error("No URL in response:",x)}catch(p){console.error("AI image generation failed:",p)}finally{c(!1)}}},disabled:l||!d.trim(),className:"flex-1 px-3 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-lg text-sm font-medium hover:from-emerald-700 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:l?n.jsxs(n.Fragment,{children:[n.jsx(fe,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(we,{className:"w-4 h-4"}),"Generate Image"]})}),n.jsx("button",{onClick:()=>{u(!1),h("")},disabled:l,className:"px-3 py-2 bg-slate-700 text-white rounded-lg text-sm hover:bg-slate-600 disabled:opacity-50 transition-colors",children:"Cancel"})]}),n.jsx("div",{className:"text-xs text-slate-500",children:"Powered by GPT-Image-1.5  Images are generated and hosted by OpenAI"})]})]}),!s&&!r&&n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(AlertCircle,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI image generation is disabled by the administrator."})]})]})}function pp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const o=e.questions||[],[a,i]=b.useState(!1),[l,c]=b.useState(""),[d,h]=b.useState(!1),f=()=>{const g={id:`q_${Date.now()}`,prompt:"",choices:["","","",""],correctIndex:0,tags:[]};t("questions",[...o,g])},u=(g,y)=>{const v=o.map((k,m)=>m===g?{...k,...y}:k);t("questions",v)},p=g=>{t("questions",o.filter((y,v)=>v!==g))},x=async()=>{if(!(!l.trim()||!s)){i(!0);try{const y=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"quiz",topic:l})})).json();if(y.result&&Array.isArray(y.result)){const v=y.result.map((k,m)=>({...k,id:`q_${Date.now()}_${m}`}));t("questions",[...o,...v]),h(!1),c("")}}catch(g){console.error("AI generation failed:",g)}finally{i(!1)}}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{children:n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Passing Score (%)"})}),n.jsx("input",{type:"number",value:e.passingScore||50,onChange:g=>t("passingScore",parseInt(g.target.value)||50),min:0,max:100,className:"w-20 px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsx("div",{className:"space-y-4",children:o.map((g,y)=>n.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg space-y-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ms,{className:"w-4 h-4 text-slate-600"}),n.jsxs("span",{className:"text-sm font-medium text-slate-400",children:["Q",y+1]})]}),n.jsx("button",{onClick:()=>p(y),className:"p-1 text-slate-500 hover:text-error",children:n.jsx($e,{className:"w-4 h-4"})})]}),n.jsx("input",{type:"text",value:g.prompt,onChange:v=>u(y,{prompt:v.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Question..."}),n.jsx("div",{className:"space-y-2",children:g.choices.map((v,k)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"radio",checked:g.correctIndex===k,onChange:()=>u(y,{correctIndex:k}),className:"w-4 h-4 text-emerald-500"}),n.jsx("input",{type:"text",value:v,onChange:m=>{const j=[...g.choices];j[k]=m.target.value,u(y,{choices:j})},className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Option ${k+1}`})]},k))}),n.jsx("input",{type:"text",value:g.explanation||"",onChange:v=>u(y,{explanation:v.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Explanation (shown after answer)..."}),n.jsx("input",{type:"text",value:g.tags.join(", "),onChange:v=>u(y,{tags:v.target.value.split(",").map(k=>k.trim()).filter(Boolean)}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tags (comma-separated)..."})]},g.id))}),n.jsxs("button",{onClick:f,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Question"]}),!s&&!r?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx($t,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI question generation is disabled by the administrator."})]}):d?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:l,onChange:g=>c(g.target.value),placeholder:"What topic should the questions cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:x,disabled:a||!l.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[a?n.jsx(fe,{className:"w-4 h-4 animate-spin"}):n.jsx(we,{className:"w-4 h-4"}),a?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>h(!0),disabled:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(we,{className:"w-4 h-4"}),"Generate Questions with AI"]})]})}function xp({content:e,updateContent:t}){const s=e.steps||[],[r,o]=b.useState(null),a=()=>{const c={id:`step_${Date.now()}`,instruction:"",verificationMethod:"self_report"};t("steps",[...s,c])},i=(c,d)=>{const h=s.map((f,u)=>u===c?{...f,...d}:f);t("steps",h)},l=c=>{t("steps",s.filter((d,h)=>h!==c))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:c=>t("description",c.target.value),rows:2,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"What is this mission about?"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"External URL (optional)"}),n.jsx("input",{type:"url",value:e.externalUrl||"",onChange:c=>t("externalUrl",c.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Steps"}),s.map((c,d)=>n.jsx("div",{className:"p-3 bg-slate-900 rounded-lg space-y-2",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded bg-slate-700 flex items-center justify-center text-xs text-slate-400 mt-1",children:d+1}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("input",{type:"text",value:c.instruction,onChange:h=>i(d,{instruction:h.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Step instruction / question..."}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("select",{value:c.verificationMethod||"self_report",onChange:h=>i(d,{verificationMethod:h.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"self_report",children:"Self Report"}),n.jsx("option",{value:"screenshot",children:"Screenshot"}),n.jsx("option",{value:"url_check",children:"URL Check"}),n.jsx("option",{value:"ai_validate",children:"AI Validation"})]}),c.verificationMethod==="ai_validate"&&n.jsx("button",{onClick:()=>o(r===c.id?null:c.id),className:"px-2 py-1 text-xs bg-primary-600/20 text-primary-400 rounded hover:bg-primary-600/30 transition-colors",children:r===c.id?"Hide Options":"AI Options"})]}),c.verificationMethod==="ai_validate"&&r===c.id&&n.jsxs("div",{className:"space-y-2 p-2 bg-slate-800 rounded border border-slate-700",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Expected Criteria"}),n.jsx("textarea",{value:c.expectedCriteria||"",onChange:h=>i(d,{expectedCriteria:h.target.value}),rows:2,className:"w-full px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white placeholder-slate-500 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Describe what makes a correct answer (e.g., 'Must mention key concept X and demonstrate understanding of Y')"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Input Type"}),n.jsxs("select",{value:c.inputType||"text",onChange:h=>i(d,{inputType:h.target.value}),className:"w-full px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"text",children:"Single Line (short answer)"}),n.jsx("option",{value:"textarea",children:"Multi Line (long answer)"})]})]})]})]}),n.jsx("button",{onClick:()=>l(d),className:"p-1 text-slate-500 hover:text-error",children:n.jsx($e,{className:"w-4 h-4"})})]})},c.id))]}),n.jsxs("button",{onClick:a,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Step"]}),n.jsx("div",{className:"p-3 bg-primary-900/20 border border-primary-700/30 rounded-lg",children:n.jsxs("p",{className:"text-xs text-primary-300",children:[n.jsx("strong",{children:"AI Validation:"})," When selected, learners must provide an answer that will be evaluated by AI against your criteria. The AI will provide feedback and mark the step as complete if correct."]})})]})}function gp({content:e,updateContent:t}){const s=e.fields||[],r=i=>{const l={id:`field_${Date.now()}`,type:i,label:"",required:!1};t("fields",[...s,l])},o=(i,l)=>{const c=s.map((d,h)=>h===i?{...d,...l}:d);t("fields",c)},a=i=>{t("fields",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:i=>t("description",i.target.value),rows:2,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Fields"}),s.map((i,l)=>n.jsx("div",{className:"p-2 bg-slate-900 rounded-lg space-y-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("select",{value:i.type,onChange:c=>o(l,{type:c.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"text",children:"Text"}),n.jsx("option",{value:"textarea",children:"Textarea"}),n.jsx("option",{value:"select",children:"Select"}),n.jsx("option",{value:"checkbox",children:"Checkbox"}),n.jsx("option",{value:"radio",children:"Radio"})]}),n.jsx("input",{type:"text",value:i.label,onChange:c=>o(l,{label:c.target.value}),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Label..."}),n.jsxs("label",{className:"flex items-center gap-1 text-xs text-slate-400",children:[n.jsx("input",{type:"checkbox",checked:i.required,onChange:c=>o(l,{required:c.target.checked})}),"Required"]}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx($e,{className:"w-4 h-4"})})]})},i.id))]}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:["text","textarea","select","checkbox","radio"].map(i=>n.jsxs("button",{onClick:()=>r(i),className:"px-3 py-1 bg-slate-700 text-white text-sm rounded hover:bg-slate-600 transition-colors",children:["+ ",i]},i))})]})}function bp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Mode"}),n.jsxs("select",{value:e.mode||"targeted_remediation",onChange:s=>t("mode",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"targeted_remediation",children:"Targeted Remediation"}),n.jsx("option",{value:"open_chat",children:"Open Chat"}),n.jsx("option",{value:"guided_explanation",children:"Guided Explanation"})]}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:e.mode==="targeted_remediation"?"AI focuses on topics the learner struggled with":e.mode==="open_chat"?"Open-ended conversation about the material":"Step-by-step guided explanation"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Max Turns"}),n.jsx("input",{type:"number",value:e.maxTurns||5,onChange:s=>t("maxTurns",parseInt(s.target.value)||5),min:1,max:20,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}function yp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:s=>t("description",s.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"What does this checkpoint evaluate?"})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Checkpoints evaluate learner progress and can branch to different paths based on performance. Use the Connections section to set up conditional routing."})]})}function vp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Animation Type"}),n.jsxs("select",{value:e.animationType||"lottie",onChange:s=>t("animationType",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"lottie",children:"Lottie"}),n.jsx("option",{value:"video",children:"Video"}),n.jsx("option",{value:"interactive",children:"Interactive"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Animation URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:s=>t("url",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.autoplay??!0,onChange:s=>t("autoplay",s.target.checked)}),"Autoplay"]}),n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.loop??!1,onChange:s=>t("loop",s.target.checked)}),"Loop"]})]})]})}const wp=["javascript","typescript","python","java","csharp","cpp","c","ruby","go","rust","php","swift","kotlin","sql","html","css","json","bash","shell","markdown","yaml","xml"];function jp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Language"}),n.jsx("select",{value:e.language||"javascript",onChange:s=>t("language",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:wp.map(s=>n.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Code"}),n.jsx("textarea",{value:e.code||"",onChange:s=>t("code",s.target.value),rows:12,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:"// Your code here..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description (optional)"}),n.jsx("input",{type:"text",value:e.description||"",onChange:s=>t("description",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the code..."})]}),n.jsx("div",{className:"flex items-center gap-4",children:n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.showLineNumbers??!0,onChange:s=>t("showLineNumbers",s.target.checked)}),"Show Line Numbers"]})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Highlight Lines (comma-separated)"}),n.jsx("input",{type:"text",value:(e.highlightLines||[]).join(", "),onChange:s=>{const r=s.target.value.split(",").map(o=>parseInt(o.trim())).filter(o=>!isNaN(o)&&o>0);t("highlightLines",r)},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 1, 3, 5-7"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Lines to highlight (e.g., 1, 3, 5)"})]})]})}function Np({content:e,updateContent:t}){const s=e.hints||[],r=()=>{t("hints",[...s,""])},o=(i,l)=>{const c=s.map((d,h)=>h===i?l:d);t("hints",c)},a=i=>{t("hints",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:e.description||"",onChange:i=>t("description",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Problem"}),n.jsx("textarea",{value:e.problem||"",onChange:i=>t("problem",i.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Describe the problem or exercise..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Hints (optional)"}),n.jsx("div",{className:"space-y-2",children:s.map((i,l)=>n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded bg-slate-700 flex items-center justify-center text-xs text-slate-400 mt-1",children:l+1}),n.jsx("input",{type:"text",value:i,onChange:c=>o(l,c.target.value),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Hint..."}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx($e,{className:"w-4 h-4"})})]},l))}),n.jsxs("button",{onClick:r,className:"mt-2 flex items-center gap-2 px-3 py-1 bg-slate-700 text-white text-sm rounded hover:bg-slate-600 transition-colors",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Hint"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Solution"}),n.jsx("textarea",{value:e.solution||"",onChange:i=>t("solution",i.target.value),rows:6,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:"The solution..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Solution Explanation (optional)"}),n.jsx("textarea",{value:e.solutionExplanation||"",onChange:i=>t("solutionExplanation",i.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Explain why this solution works..."})]})]})}function kp({content:e,updateContent:t}){const s=e.resources||[],r=()=>{const i={id:`res_${Date.now()}`,title:"",url:"",type:"link"};t("resources",[...s,i])},o=(i,l)=>{const c=s.map((d,h)=>h===i?{...d,...l}:d);t("resources",c)},a=i=>{t("resources",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:e.description||"",onChange:i=>t("description",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of resources..."})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Resources"}),s.map((i,l)=>n.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:i.title,onChange:c=>o(l,{title:c.target.value}),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Resource title..."}),n.jsxs("select",{value:i.type,onChange:c=>o(l,{type:c.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"link",children:"Link"}),n.jsx("option",{value:"download",children:"Download"}),n.jsx("option",{value:"video",children:"Video"}),n.jsx("option",{value:"document",children:"Document"})]}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx($e,{className:"w-4 h-4"})})]}),n.jsx("input",{type:"url",value:i.url,onChange:c=>o(l,{url:c.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."}),n.jsx("input",{type:"text",value:i.description||"",onChange:c=>o(l,{description:c.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Description (optional)..."})]},i.id))]}),n.jsxs("button",{onClick:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Resource"]})]})}function co(e){const t=e.find(a=>a.isCurrent),s=e.filter(a=>!a.isCurrent&&a.orderIndex<(t?.orderIndex??999)&&a.graph?.blocks?.length);if(s.length===0)return"No previous module content available.";let r="";const o=e.length;return s.forEach(a=>{r+=`
${"".repeat(60)}
`,r+=`MODULE ${a.orderIndex+1} of ${o}: "${a.title}"
`,a.description&&(r+=`Description: ${a.description}
`),r+=`${"".repeat(60)}

`,a.graph&&a.graph.blocks&&a.graph.blocks.length>0&&a.graph.blocks.forEach((i,l)=>{const c=i.content;if(r+=`Block ${l+1} [${i.type.toUpperCase()}] "${c.title||"Untitled"}"
`,r+=`---
`,i.type==="read"&&c.markdown){const d=c.markdown;r+=d.length>500?`${d.substring(0,500)}...
`:`${d}
`}else i.type==="quiz"&&Array.isArray(c.questions)?(r+=`Quiz with ${c.questions.length} questions
`,c.questions.slice(0,2).forEach((d,h)=>{r+=`  ${h+1}. ${d.prompt}
`}),c.questions.length>2&&(r+=`  ... and ${c.questions.length-2} more questions
`)):i.type==="code"&&c.code?r+=`Language: ${c.language}
Code snippet (${c.code.split(`
`).length} lines)
`:i.type==="mission"&&Array.isArray(c.steps)?r+=`Mission with ${c.steps.length} steps
`:c.description&&(r+=`${c.description}
`);r+=`---

`})}),r.trim()}function Cp({onGenerate:e,onClose:t,existingGraph:s,trackModulesContext:r=[],currentModuleId:o}){const{enabled:a,contentModel:i,isLoading:l}=Cs(),[c,d]=b.useState(1),[h,f]=b.useState(!1),[u,p]=b.useState(""),[x,g]=b.useState(!1),[y,v]=b.useState(""),[k,m]=b.useState("beginners"),[j,E]=b.useState("beginner"),[w,C]=b.useState(20),[I,T]=b.useState(6),[$,S]=b.useState(!0),[P,H]=b.useState(!0),[N,M]=b.useState(!0),[_,D]=b.useState(!1),[A,z]=b.useState(!0),[O,F]=b.useState(!1),[V,Q]=b.useState(!1),[X,te]=b.useState(!1),[Z,B]=b.useState(!0),[R,J]=b.useState(!1),[W,se]=b.useState(!1),[q,K]=b.useState(!0),[re,ae]=b.useState(!1),[ce,de]=b.useState(""),[je,Se]=b.useState("gpt-4o"),[Ne,Pe]=b.useState(null);b.useEffect(()=>{!l&&i&&Se(i)},[l,i]);const De=async()=>{f(!0),p(""),de(q?"Researching topic on the web...":"Generating course...");try{const ee=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"outline",topic:y,targetAudience:k,difficulty:j,duration:w,blockCount:I,includeVideo:$,includeQuiz:P,includeMission:N,includeImage:_,includeCode:A,includeExercise:O,includeResource:V,includeForm:X,includeAIHelp:Z,includeCheckpoint:R,includeAnimation:W,existingGraph:s,enableWebResearch:q,model:je,trackModulesContext:r,generateImages:re&&_})});if(de("Creating course structure..."),!ee.ok)throw new Error("Failed to generate course");const me=await ee.json();if(me.error)throw new Error(me.error);if(me.result&&typeof me.result=="object")Pe(me.result),d(3);else throw new Error("Invalid response format")}catch(ee){p(ee instanceof Error?ee.message:"Generation failed")}finally{f(!1)}},_e=()=>{Ne&&e(Ne)};return n.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col border border-slate-700 shadow-2xl",children:[n.jsxs("div",{className:"p-6 border-b border-slate-700 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(we,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-white",children:"AI Course Generator"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Create a complete course with AI assistance"})]})]}),n.jsx("button",{onClick:t,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[!l&&!a?n.jsx(yo,{}):l?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(fe,{className:"w-8 h-8 text-purple-500 animate-spin"})}):c===1&&n.jsxs("div",{className:"space-y-6",children:[r.length>1&&(()=>{const ee=r.find(L=>L.isCurrent),me=r.filter(L=>!L.isCurrent&&L.orderIndex<(ee?.orderIndex??999)),ve=me.filter(L=>L.graph?.blocks?.length),ke=me.filter(L=>!L.graph?.blocks?.length),Ce=ke.length>0&&me.length>0;return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:`flex items-start gap-3 p-4 border rounded-xl ${Ce?"bg-amber-500/10 border-amber-500/20":"bg-purple-500/10 border-purple-500/20"}`,children:[Ce?n.jsx($t,{className:"w-5 h-5 text-amber-400 mt-0.5 flex-shrink-0"}):n.jsx(we,{className:"w-5 h-5 text-purple-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:`font-medium mb-1 ${Ce?"text-amber-300":"text-purple-300"}`,children:"Track-Aware Generation"}),ve.length>0?n.jsxs("div",{className:"text-sm text-slate-400 mb-2",children:["AI will reference FULL content from ",ve.length," previous module",ve.length!==1?"s":""," to ensure progressive learning."]}):me.length>0?n.jsx("div",{className:"text-sm text-amber-400/80 mb-2",children:"Warning: No content found in previous modules. AI will generate standalone content."}):n.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"This is the first module in the track."}),n.jsx("div",{className:"space-y-1",children:r.map(L=>{const G=!L.isCurrent&&L.orderIndex<(ee?.orderIndex??999),Y=L.graph?.blocks?.length,U=L.graph?.blocks?.length||0;return n.jsxs("div",{className:`text-xs flex items-center gap-2 ${L.isCurrent?"text-purple-300 font-medium":G&&Y?"text-emerald-400":G&&!Y?"text-amber-400":"text-slate-500"}`,children:[G&&Y&&n.jsx(dn,{className:"w-3 h-3"}),G&&!Y&&n.jsx($t,{className:"w-3 h-3"}),!G&&n.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current ml-0.5"}),n.jsxs("span",{children:["Module ",L.orderIndex+1,": ",L.title]}),Y&&n.jsxs("span",{className:"text-slate-500",children:["(",U," blocks)"]}),G&&!Y&&n.jsx("span",{className:"text-amber-400/70",children:"(empty)"}),L.isCurrent&&n.jsx("span",{className:"text-purple-400",children:"(generating)"})]},L.moduleId)})}),ve.length>0&&n.jsxs("button",{onClick:()=>g(!x),className:"mt-3 flex items-center gap-1.5 text-xs text-purple-400 hover:text-purple-300 transition-colors",children:[n.jsx(pl,{className:"w-3.5 h-3.5"}),x?"Hide":"Preview"," AI Context",x?n.jsx(bn,{className:"w-3 h-3"}):n.jsx(gn,{className:"w-3 h-3"})]})]})]}),x&&ve.length>0&&n.jsxs("div",{className:"p-4 bg-slate-900/80 border border-slate-700 rounded-xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Context Preview"}),n.jsxs("span",{className:"text-xs text-slate-500",children:[co(r).length.toLocaleString()," characters"]})]}),n.jsx("pre",{className:"text-xs text-slate-400 whitespace-pre-wrap max-h-64 overflow-y-auto font-mono bg-slate-950/50 p-3 rounded-lg",children:co(r)})]}),Ce&&n.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-500/5 border border-amber-500/10 rounded-lg",children:[n.jsx(It,{className:"w-4 h-4 text-amber-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"text-xs text-amber-300/80",children:[n.jsx("span",{className:"font-medium",children:"Tip:"})," For best results, generate or add content to ",ke.map(L=>`Module ${L.orderIndex+1}`).join(", ")," first. This ensures the AI can build upon previous concepts."]})]})]})})(),s&&s.blocks.length>0&&n.jsxs("div",{className:"flex items-start gap-3 p-4 bg-primary-500/10 border border-primary-500/20 rounded-xl",children:[n.jsx(It,{className:"w-5 h-5 text-primary-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-medium text-primary-300 mb-1",children:"Building Upon Existing Content"}),n.jsxs("div",{className:"text-sm text-slate-400",children:["AI will see your ",s.blocks.length," existing blocks and generate content that complements what you already have."]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"What do you want to teach?"}),n.jsx("textarea",{value:y,onChange:ee=>v(ee.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"e.g., Introduction to Machine Learning, How to use ChatGPT effectively, Basic Python programming..."})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Audience"}),n.jsxs("select",{value:k,onChange:ee=>m(ee.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginners",children:"Complete Beginners"}),n.jsx("option",{value:"students",children:"Students"}),n.jsx("option",{value:"professionals",children:"Professionals"}),n.jsx("option",{value:"technical",children:"Technical Audience"}),n.jsx("option",{value:"general",children:"General Audience"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Difficulty Level"}),n.jsxs("select",{value:j,onChange:ee=>E(ee.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsx("button",{onClick:()=>d(2),disabled:!y.trim(),className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Continue"})]}),c===2&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"p-4 bg-slate-900/50 rounded-xl",children:[n.jsx("h3",{className:"font-medium text-white mb-1",children:"Topic"}),n.jsx("p",{className:"text-slate-400",children:y})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Duration (minutes)"}),n.jsx("input",{type:"number",value:w,onChange:ee=>C(parseInt(ee.target.value)||20),min:5,max:120,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Number of Steps"}),n.jsx("input",{type:"number",value:I,onChange:ee=>T(parseInt(ee.target.value)||6),min:3,max:20,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Content Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:$,onChange:ee=>S(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(ut,{className:"w-5 h-5 text-rose-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Video Blocks"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Add placeholder video sections"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:_,onChange:ee=>D(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(nt,{className:"w-5 h-5 text-emerald-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Image Blocks"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Add placeholder images and diagrams"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:A,onChange:ee=>z(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx($n,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Code Snippets"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Syntax-highlighted code examples"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:V,onChange:ee=>Q(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Ss,{className:"w-5 h-5 text-indigo-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Additional Resources"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Curated links and downloads"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Interactive Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:P,onChange:ee=>H(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Gt,{className:"w-5 h-5 text-purple-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Quiz & Assessment"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Test learner understanding with questions"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:N,onChange:ee=>M(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(An,{className:"w-5 h-5 text-orange-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Hands-on Mission"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Practical task for learners to complete"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:O,onChange:ee=>F(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(_s,{className:"w-5 h-5 text-violet-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Practice Exercises"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Problems with hints and solutions"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:X,onChange:ee=>te(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Ft,{className:"w-5 h-5 text-warning"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Data Collection Forms"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Gather learner input and surveys"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Support Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:Z,onChange:ee=>B(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Es,{className:"w-5 h-5 text-primary-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"AI Help / Remediation"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Personalized AI tutoring when struggling"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:R,onChange:ee=>J(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Pn,{className:"w-5 h-5 text-accent"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Progress Checkpoints"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Validate understanding before continuing"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:W,onChange:ee=>se(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(go,{className:"w-5 h-5 text-pink-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Animations"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Interactive visual animations"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"AI Research & Generation"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-primary-500/10 to-accent/10 border border-primary-500/20 rounded-xl cursor-pointer hover:border-primary-500/40 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:q,onChange:ee=>K(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-blue-500 focus:ring-blue-500"}),n.jsx(jl,{className:"w-5 h-5 text-blue-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Web Research"}),n.jsx("div",{className:"text-xs text-slate-400",children:"AI will search the web for the latest information on this topic to ensure accurate, up-to-date content"})]}),n.jsx(jo,{className:"w-4 h-4 text-blue-400/50"})]}),_&&n.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-emerald-500/10 to-teal-500/10 border border-emerald-500/20 rounded-xl cursor-pointer hover:border-emerald-500/40 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:re,onChange:ee=>ae(ee.target.checked),className:"w-5 h-5 rounded border-slate-600 text-emerald-500 focus:ring-emerald-500"}),n.jsx(nt,{className:"w-5 h-5 text-emerald-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Generate AI Images"}),n.jsx("div",{className:"text-xs text-slate-400",children:"Automatically generate educational images/diagrams for image blocks using GPT-Image-1.5"})]}),n.jsx(we,{className:"w-4 h-4 text-emerald-400/50"})]})]})]}),u&&n.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400",children:[n.jsx(It,{className:"w-5 h-5 flex-shrink-0"}),n.jsx("span",{children:u})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>d(1),className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"Back"}),n.jsx("button",{onClick:De,disabled:h,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-all",children:h?n.jsxs(n.Fragment,{children:[n.jsx(fe,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{className:"text-sm",children:ce})]}):n.jsxs(n.Fragment,{children:[n.jsx(Ul,{className:"w-5 h-5"}),"Generate Course"]})})]})]}),c===3&&Ne&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center gap-3 p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl",children:[n.jsx(dn,{className:"w-6 h-6 text-emerald-400"}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-emerald-400",children:"Course Generated!"}),n.jsxs("div",{className:"text-sm text-slate-400",children:[Ne.blocks.length," blocks created with proper flow"]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-medium text-slate-300 mb-3",children:"Generated Structure"}),n.jsx("div",{className:"space-y-2",children:Ne.blocks.map((ee,me)=>{const ve=ee.content,ke=Ne.startBlockId===ee.id;return n.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-700 flex items-center justify-center text-sm font-medium text-slate-300",children:me+1}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-white font-medium",children:ve?.title||ee.type}),ke&&n.jsx("span",{className:"px-1.5 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded",children:"Start"})]}),n.jsx("div",{className:"text-xs text-slate-500 capitalize",children:ee.type})]})]},ee.id)})})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>d(2),className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"Regenerate"}),n.jsxs("button",{onClick:_e,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 transition-all",children:[n.jsx(dn,{className:"w-5 h-5"}),"Use This Course"]})]})]})]}),n.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-900/50",children:n.jsx("div",{className:"flex items-center justify-center gap-2",children:[1,2,3].map(ee=>n.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${c>=ee?"bg-purple-500":"bg-slate-600"}`},ee))})})]})})}const Sp={read:{icon:He,color:"bg-primary-500",label:"Read"},video:{icon:ut,color:"bg-rose-500",label:"Video"},image:{icon:nt,color:"bg-emerald-500",label:"Image"},quiz:{icon:Gt,color:"bg-purple-500",label:"Quiz"},mission:{icon:An,color:"bg-orange-500",label:"Mission"},form:{icon:Ft,color:"bg-teal-500",label:"Form"},ai_help:{icon:Es,color:"bg-cyan-500",label:"AI Help"},checkpoint:{icon:Pn,color:"bg-yellow-500",label:"Checkpoint"},animation:{icon:vo,color:"bg-pink-500",label:"Animation"},code:{icon:$n,color:"bg-slate-600",label:"Code"},exercise:{icon:_s,color:"bg-violet-500",label:"Exercise"},resource:{icon:Ss,color:"bg-indigo-500",label:"Resources"}};function _p(e){const t=e.content;switch(e.type){case"read":return`${t.estimatedReadTime||0} min read`;case"video":return t.url?"Video attached":"No video set";case"image":return t.url?"Image attached":"No image set";case"quiz":const s=t.questions||[];return`${s.length} question${s.length!==1?"s":""}`;case"mission":const r=t.steps||[];return`${r.length} step${r.length!==1?"s":""}`;case"form":const o=t.fields||[];return`${o.length} field${o.length!==1?"s":""}`;case"ai_help":return`Mode: ${t.mode||"remediation"}`;case"checkpoint":return"Progress checkpoint";case"animation":return t.animationType||"Animation";case"code":return t.language||"Code snippet";case"exercise":const a=t.hints||[];return`${a.length} hint${a.length!==1?"s":""}`;case"resource":const i=t.resources||[];return`${i.length} resource${i.length!==1?"s":""}`;default:return""}}function Ep({data:e,selected:t}){const{block:s,isStart:r,isMultiSelected:o,isConnectionTarget:a,hasPassEdge:i,hasFailEdge:l,onEdit:c,onDelete:d,onStartConnection:h}=e,f=Sp[s.type]||{icon:He,color:"bg-slate-600",label:"Block"},u=f.icon,p=s.content?.title||`${f.label} Block`,x=_p(s),g=s.type==="quiz";return n.jsxs("div",{className:`
        relative min-w-[240px] max-w-[300px] bg-slate-800 rounded-xl border-2 transition-all shadow-lg
        ${o?"border-blue-500 bg-slate-700":t?"border-primary-500":"border-slate-700 hover:border-slate-600"}
        ${a?"ring-2 ring-primary-400 ring-dashed ring-offset-2 ring-offset-slate-900":""}
      `,children:[n.jsx(Ke,{type:"target",position:ne.Top,className:"!w-3 !h-3 !bg-slate-500 !border-2 !border-slate-400 hover:!bg-primary-500 hover:!border-primary-400 transition-colors"}),r&&n.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-emerald-500 text-white text-xs font-semibold rounded shadow",children:"START"}),n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:`w-10 h-10 ${f.color} rounded-lg flex items-center justify-center flex-shrink-0 shadow-md`,children:n.jsx(u,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:p}),n.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:f.label}),x&&n.jsx("p",{className:"text-xs text-slate-500 mt-1 truncate",children:x})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-1 mt-3 pt-3 border-t border-slate-700",children:[n.jsx("button",{onClick:y=>{y.stopPropagation(),h()},className:"p-1.5 text-slate-400 hover:text-primary-400 hover:bg-slate-700 rounded transition-colors",title:"Connect to another block",children:n.jsx(_l,{className:"w-4 h-4"})}),n.jsx("button",{onClick:y=>{y.stopPropagation(),c()},className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors",title:"Edit block",children:n.jsx(Hl,{className:"w-4 h-4"})}),n.jsx("button",{onClick:y=>{y.stopPropagation(),d()},className:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded transition-colors",title:"Delete block",children:n.jsx($e,{className:"w-4 h-4"})})]})]}),g?n.jsxs(n.Fragment,{children:[n.jsx(Ke,{type:"source",position:ne.Bottom,id:"pass",className:`!w-3 !h-3 !border-2 transition-colors ${i?"!bg-emerald-500 !border-emerald-400":"!bg-emerald-500/50 !border-emerald-400/50 hover:!bg-emerald-500 hover:!border-emerald-400"}`,style:{left:"30%"}}),n.jsx(Ke,{type:"source",position:ne.Bottom,id:"fail",className:`!w-3 !h-3 !border-2 transition-colors ${l?"!bg-red-500 !border-red-400":"!bg-red-500/50 !border-red-400/50 hover:!bg-red-500 hover:!border-red-400"}`,style:{left:"70%"}}),n.jsxs("div",{className:"absolute -bottom-5 left-0 right-0 flex justify-between px-6 pointer-events-none",children:[n.jsx("span",{className:"text-[10px] font-semibold text-emerald-400",children:"Pass"}),n.jsx("span",{className:"text-[10px] font-semibold text-red-400",children:"Fail"})]})]}):n.jsx(Ke,{type:"source",position:ne.Bottom,className:"!w-3 !h-3 !bg-slate-500 !border-2 !border-slate-400 hover:!bg-primary-500 hover:!border-primary-400 transition-colors"})]})}const Mp=b.memo(Ep);function ls(e){if(!e?.all?.[0])return"normal";const t=e.all[0];return t.fact==="quiz.scorePercent"?t.op==="gte"||t.op==="gt"?"pass":"fail":"normal"}const cs=[{type:"read",label:"Read",icon:He,color:"bg-primary-500"},{type:"video",label:"Video",icon:ut,color:"bg-rose-500"},{type:"image",label:"Image",icon:nt,color:"bg-emerald-500"},{type:"quiz",label:"Quiz",icon:Gt,color:"bg-purple-500"},{type:"mission",label:"Mission",icon:An,color:"bg-orange-500"},{type:"form",label:"Form",icon:Ft,color:"bg-teal-500"},{type:"ai_help",label:"AI Help",icon:Es,color:"bg-cyan-500"},{type:"checkpoint",label:"Checkpoint",icon:Pn,color:"bg-yellow-500"},{type:"animation",label:"Animation",icon:vo,color:"bg-pink-500"},{type:"code",label:"Code",icon:$n,color:"bg-slate-600"},{type:"exercise",label:"Exercise",icon:_s,color:"bg-violet-500"},{type:"resource",label:"Resources",icon:Ss,color:"bg-indigo-500"}],Ip={blockNode:Mp},Ap={type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:2},markerEnd:{type:vt.ArrowClosed,color:"#6366f1"}};function Tp({moduleId:e,journeyVersionId:t,onBack:s}){const r=b.useRef(null),{screenToFlowPosition:o,fitView:a}=Gn(),[i,l]=b.useState({startBlockId:"",blocks:[],edges:[]}),[c,d,h]=Im([]),[f,u,p]=Am([]),[x,g]=b.useState(null),[y,v]=b.useState(!1),[k,m]=b.useState(!1),[j,E]=b.useState(!1),[w,C]=b.useState(null),[I,T]=b.useState(""),[$,S]=b.useState(t),[P,H]=b.useState(!1),[N,M]=b.useState(!1),[_,D]=b.useState(null),[A,z]=b.useState(new Set),[O,F]=b.useState(!1),[V,Q]=b.useState([]),X=b.useCallback((L,G)=>L.map((Y,U)=>{const oe=Y.ui?.position||{x:400,y:100+U*200},ue=i.edges.filter(ge=>ge.from===Y.id),he=ue.some(ge=>ls(ge.condition)==="pass"),Ie=ue.some(ge=>ls(ge.condition)==="fail");return{id:Y.id,type:"blockNode",position:oe,data:{block:Y,isStart:G===Y.id,isSelected:x===Y.id,isMultiSelected:A.has(Y.id),isConnectionTarget:w!==null&&w.fromBlockId!==Y.id,outgoingEdgesCount:ue.length,hasPassEdge:he,hasFailEdge:Ie,onEdit:()=>{g(Y.id),M(!0)},onDelete:()=>q(Y.id),onStartConnection:()=>C({fromBlockId:Y.id})}}}),[x,A,w,i.edges]),te=b.useCallback(L=>{const G={pass:"#10b981",fail:"#ef4444",normal:"#6366f1"},Y={pass:"Pass",fail:"Fail",normal:void 0};return L.map((U,oe)=>{const ue=ls(U.condition),he=G[ue],Ie=Y[ue];return{id:U.id||`edge-${U.from}-${U.to}-${oe}`,source:U.from,target:U.to,sourceHandle:ue!=="normal"?ue:void 0,type:"smoothstep",animated:!0,style:{stroke:he,strokeWidth:2},markerEnd:{type:vt.ArrowClosed,color:he},label:Ie,labelStyle:{fill:he,fontWeight:600,fontSize:12},labelBgStyle:{fill:"#1e293b",fillOpacity:.9},labelBgPadding:[4,8],labelBgBorderRadius:4}})},[]);b.useEffect(()=>{const L=X(i.blocks,i.startBlockId),G=te(i.edges);d(L),u(G)},[i,X,te,d,u]),b.useEffect(()=>{B()},[e,t]),b.useEffect(()=>{if(_){const L=setTimeout(()=>D(null),4e3);return()=>clearTimeout(L)}},[_]);const Z=(L,G)=>{D({type:L,message:G})},B=async()=>{const{data:L}=await be.from("modules").select("title, track_id").eq("id",e).single();if(L&&(T(L.title),L.track_id)){const{data:G}=await be.from("modules").select(`
            id,
            title,
            description,
            order_index,
            journey_versions (
              id,
              graph_json,
              status,
              updated_at
            )
          `).eq("track_id",L.track_id).order("order_index");if(G&&G.length>0){const Y=G.map(U=>{const oe=U.journey_versions||[];let ue=null;if(oe.length>0){const he=oe.find(Ie=>Ie.status==="published");he?ue=he:ue=oe.sort((Ie,ge)=>new Date(ge.updated_at).getTime()-new Date(Ie.updated_at).getTime())[0]}return{moduleId:U.id,title:U.title,description:U.description,orderIndex:U.order_index,isCurrent:U.id===e,graph:ue?.graph_json||null}});Q(Y)}}if(t){const{data:G}=await be.from("journey_versions").select("graph_json").eq("id",t).single();if(G?.graph_json){const Y=G.graph_json,U=Y.blocks.map((oe,ue)=>oe.ui?.position?oe:{...oe,ui:{...oe.ui,position:{x:400,y:100+ue*200}}});l({...Y,blocks:U}),setTimeout(()=>a({padding:.2}),100)}}},R=async()=>{v(!0);let L=$;const G=i.blocks.map(U=>{const oe=c.find(ue=>ue.id===U.id);return oe?{...U,ui:{...U.ui,position:oe.position}}:U}),Y={...i,blocks:G};try{if($){const{error:U}=await be.from("journey_versions").update({graph_json:Y}).eq("id",$);if(U)throw U}else{const{data:U,error:oe}=await be.from("journey_versions").insert({module_id:e,version:1,status:"draft",graph_json:Y}).select().single();if(oe)throw oe;U&&(S(U.id),L=U.id)}return l(Y),H(!1),Z("success","Journey saved successfully"),L}catch(U){return console.error("Save error:",U),Z("error","Failed to save journey"),null}finally{v(!1)}},J=async()=>{if(i.blocks.length===0){Z("error","Cannot publish an empty journey. Add some blocks first.");return}m(!0);try{let L=$;if((!L||P)&&(L=await R()),!L)throw new Error("Failed to save journey before publishing");const{error:G}=await be.from("journey_versions").update({status:"published"}).eq("id",L);if(G)throw G;const{data:Y}=await be.from("modules").select("track_id").eq("id",e).single();if(Y?.track_id){const{error:U}=await be.from("tracks").update({published_version_id:L}).eq("id",Y.track_id);if(U)throw U}H(!1),Z("success","Journey published successfully! Learners can now access it.")}catch(L){console.error("Publish error:",L),Z("error","Failed to publish journey. Please try again.")}finally{m(!1)}},W=b.useCallback((L,G)=>{const Y=`block_${Date.now()}`;let U=G;if(!U)if(i.blocks.length===0)U={x:400,y:100};else{const ge=i.blocks[i.blocks.length-1],Kt=c.find(Yn=>Yn.id===ge.id)?.position||ge.ui?.position||{x:400,y:0};U={x:Kt.x,y:Kt.y+200}}const oe={id:Y,type:L,content:Pp(L),ui:{position:U}},ue=[...i.blocks,oe],he=i.startBlockId||Y,Ie=[...i.edges];if(i.blocks.length>0&&!i.edges.some(ge=>ge.to===Y)){const ge=i.blocks[i.blocks.length-1];i.edges.some(Qt=>Qt.from===ge.id)||Ie.push({from:ge.id,to:Y})}l({...i,blocks:ue,edges:Ie,startBlockId:he}),g(Y),M(!0),H(!0)},[i,c]),se=b.useCallback((L,G)=>{const Y=i.blocks.map(U=>U.id===L?{...U,...G}:U);l({...i,blocks:Y}),H(!0)},[i]),q=b.useCallback(L=>{const G=i.blocks.filter(oe=>oe.id!==L),Y=i.edges.filter(oe=>oe.from!==L&&oe.to!==L),U=i.startBlockId===L?G[0]?.id||"":i.startBlockId;l({...i,blocks:G,edges:Y,startBlockId:U}),g(null),M(!1),H(!0)},[i]),K=b.useCallback(()=>{const L=A.size,G=i.blocks.filter(U=>A.has(U.id)).slice(0,5).map(U=>U.content?.title||"Untitled").join(", "),Y=L<=5?`Delete ${L} block${L>1?"s":""} (${G})?`:`Delete ${L} blocks (${G}, and ${L-5} more)?`;if(confirm(`${Y}

All connections to these blocks will also be removed. This action cannot be undone.`)){F(!0);try{const U=i.blocks.filter(he=>!A.has(he.id)),oe=i.edges.filter(he=>!A.has(he.from)&&!A.has(he.to));let ue=i.startBlockId;A.has(i.startBlockId)&&(ue=U[0]?.id||""),l({...i,blocks:U,edges:oe,startBlockId:ue}),z(new Set),g(null),M(!1),H(!0),Z("success",`Successfully deleted ${L} block${L>1?"s":""}`)}catch(U){console.error("Error bulk deleting blocks:",U),Z("error","Failed to delete some blocks. Please try again.")}finally{F(!1)}}},[i,A]),re=b.useCallback(L=>{const G=new Set(A);G.has(L)?G.delete(L):G.add(L),z(G)},[A]),ae=b.useCallback(()=>{z(new Set(i.blocks.map(L=>L.id)))},[i.blocks]),ce=b.useCallback(()=>{z(new Set)},[]),de=b.useCallback((L,G)=>{if(i.edges.find(oe=>oe.from===L&&oe.to===G)||L===G)return;const U={from:L,to:G};l({...i,edges:[...i.edges,U]}),H(!0)},[i]),je=b.useCallback((L,G)=>{const Y=i.edges.filter(U=>!(U.from===L&&U.to===G));l({...i,edges:Y}),H(!0)},[i]),Se=b.useCallback(L=>{l({...i,startBlockId:L}),H(!0)},[i]),Ne=b.useCallback(L=>{L.source&&L.target&&de(L.source,L.target)},[de]),Pe=b.useCallback((L,G)=>{w?(w.fromBlockId!==G.id&&de(w.fromBlockId,G.id),C(null)):(g(G.id),M(!0))},[w,de]),De=b.useCallback((L,G)=>{const Y=i.blocks.map(U=>U.id===G.id?{...U,ui:{...U.ui,position:G.position}}:U);l(U=>({...U,blocks:Y})),H(!0)},[i.blocks]),_e=b.useCallback(L=>{L.forEach(G=>{je(G.source,G.target)})},[je]),ee=b.useCallback(L=>{L.preventDefault(),L.dataTransfer.dropEffect="move"},[]),me=b.useCallback(L=>{L.preventDefault();const G=L.dataTransfer.getData("application/reactflow-type");if(!G)return;const Y=o({x:L.clientX,y:L.clientY});W(G,Y)},[o,W]),ve=b.useCallback((L,G)=>{L.dataTransfer.setData("application/reactflow-type",G),L.dataTransfer.effectAllowed="move"},[]),ke=L=>{const G=L.blocks.map((Y,U)=>({...Y,ui:{...Y.ui,position:Y.ui?.position||{x:400,y:100+U*200}}}));l({...L,blocks:G}),E(!1),H(!0),Z("success","AI-generated content added to journey"),setTimeout(()=>a({padding:.2}),100)},Ce=i.blocks.find(L=>L.id===x);return n.jsxs("div",{className:"h-full flex flex-col bg-slate-900",children:[_&&n.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg border ${_.type==="success"?"bg-emerald-500/20 border-emerald-500/30 text-emerald-300":_.type==="error"?"bg-error/20 border-error/30 text-error":"bg-primary-500/20 border-primary-500/30 text-primary-300"}`,children:[_.type==="success"?n.jsx(In,{className:"w-5 h-5"}):_.type==="error"?n.jsx(It,{className:"w-5 h-5"}):n.jsx(fe,{className:"w-5 h-5"}),n.jsx("span",{className:"font-medium",children:_.message}),n.jsx("button",{onClick:()=>D(null),className:"ml-2 opacity-60 hover:opacity-100",children:n.jsx(Ct,{className:"w-4 h-4"})})]}),n.jsx("header",{className:"bg-slate-800 border-b border-slate-700 px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-1 text-slate-400 hover:text-white transition-colors",children:[n.jsx(ds,{className:"w-5 h-5"}),"Back"]}),n.jsx("div",{className:"h-6 w-px bg-slate-700"}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-semibold text-white",children:I}),n.jsxs("p",{className:"text-xs text-slate-500",children:[i.blocks.length," blocks, ",i.edges.length," connections",P&&n.jsx("span",{className:"text-warning ml-2",children:"Unsaved changes"})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[A.size>0&&n.jsxs("button",{onClick:K,disabled:O,className:"flex items-center gap-2 px-3 py-1.5 bg-error text-white rounded-lg text-sm hover:bg-error/90 disabled:opacity-50 transition-colors",children:[O?n.jsx(fe,{className:"w-4 h-4 animate-spin"}):n.jsx($e,{className:"w-4 h-4"}),"Delete ",A.size]}),n.jsxs("button",{onClick:()=>E(!0),disabled:O,className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg text-sm hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(we,{className:"w-4 h-4"}),"AI Generate"]}),n.jsxs("button",{onClick:R,disabled:y||!P||O,className:"flex items-center gap-2 px-3 py-1.5 bg-slate-700 text-white rounded-lg text-sm hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[y?n.jsx(fe,{className:"w-4 h-4 animate-spin"}):n.jsx(Bl,{className:"w-4 h-4"}),y?"Saving...":"Save"]}),n.jsxs("button",{onClick:J,disabled:k||i.blocks.length===0||O,className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 disabled:opacity-50 transition-colors",children:[k?n.jsx(fe,{className:"w-4 h-4 animate-spin"}):n.jsx(Tn,{className:"w-4 h-4"}),k?"Publishing...":"Publish"]})]})]})}),n.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[n.jsxs("aside",{className:"w-64 bg-slate-800 border-r border-slate-700 flex flex-col",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Drag blocks to canvas"}),n.jsx("div",{className:"grid grid-cols-2 gap-2",children:cs.map(({type:L,label:G,icon:Y,color:U})=>n.jsxs("div",{draggable:!0,onDragStart:oe=>ve(oe,L),className:"flex flex-col items-center gap-1.5 p-3 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors group cursor-grab active:cursor-grabbing",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Ms,{className:"w-3 h-3 text-slate-500 opacity-0 group-hover:opacity-100 transition-opacity"}),n.jsx("div",{className:`w-8 h-8 ${U} rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform`,children:n.jsx(Y,{className:"w-4 h-4 text-white"})})]}),n.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:G})]},L))})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-300",children:"Blocks List"}),i.blocks.length>0&&n.jsx("div",{className:"flex items-center gap-1",children:A.size>0?n.jsxs("button",{onClick:ce,className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:["Clear (",A.size,")"]}):n.jsx("button",{onClick:ae,className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Select All"})})]}),i.blocks.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"No blocks yet. Drag blocks to the canvas or use AI generate."}):n.jsx("div",{className:"space-y-2",children:i.blocks.map((L,G)=>{const Y=cs.find(he=>he.type===L.type),U=Y?.icon||He,oe=i.startBlockId===L.id,ue=x===L.id;return n.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg transition-colors cursor-pointer ${A.has(L.id)?"bg-primary-600/20 border border-primary-500":ue?"bg-primary-600/10 border border-primary-400":"bg-slate-700/50 hover:bg-slate-700 border border-transparent"}`,onClick:()=>{g(L.id),M(!0)},children:[n.jsx("input",{type:"checkbox",checked:A.has(L.id),onChange:he=>{he.stopPropagation(),re(L.id)},disabled:O,className:"w-4 h-4 rounded border-slate-600 text-primary-600 focus:ring-primary-500 focus:ring-offset-slate-900"}),n.jsx("div",{className:`w-6 h-6 ${Y?.color||"bg-slate-600"} rounded flex items-center justify-center`,children:n.jsx(U,{className:"w-3 h-3 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-white truncate",children:L.content?.title||`${Y?.label||"Block"} ${G+1}`}),n.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[oe&&n.jsx("span",{className:"text-emerald-400",children:"Start"}),!oe&&n.jsx("span",{children:Y?.label})]})]}),!oe&&n.jsx("button",{onClick:he=>{he.stopPropagation(),Se(L.id)},disabled:O,className:"p-1 text-slate-500 hover:text-emerald-400 rounded disabled:opacity-50",title:"Set as start",children:n.jsx(Pn,{className:"w-3 h-3"})})]},L.id)})})]}),w&&n.jsx("div",{className:"p-3 bg-primary-600/20 border-t border-primary-500/30",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-primary-300",children:"Click a block to connect"}),n.jsx("button",{onClick:()=>C(null),className:"text-xs text-primary-400 hover:text-primary-300",children:"Cancel"})]})})]}),n.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",ref:r,children:n.jsxs(Mm,{nodes:c,edges:f,onNodesChange:h,onEdgesChange:p,onConnect:Ne,onNodeClick:Pe,onNodeDragStop:De,onEdgesDelete:_e,onDragOver:ee,onDrop:me,nodeTypes:Ip,defaultEdgeOptions:Ap,fitView:!0,fitViewOptions:{padding:.2},className:"bg-slate-900",proOptions:{hideAttribution:!0},deleteKeyCode:["Backspace","Delete"],panOnDrag:!0,selectionOnDrag:!1,panOnScroll:!1,zoomOnScroll:!0,children:[n.jsx(Rm,{color:"#334155",gap:20,size:1}),n.jsx(Fm,{className:"bg-slate-800 border border-slate-700 rounded-lg"}),n.jsx(np,{nodeColor:L=>{const G=i.blocks.find(Y=>Y.id===L.id);if(!G)return"#475569";switch(cs.find(Y=>Y.type===G.type),G.type){case"read":return"#6366f1";case"video":return"#f43f5e";case"image":return"#10b981";case"quiz":return"#a855f7";case"mission":return"#f97316";case"form":return"#14b8a6";case"ai_help":return"#06b6d4";case"checkpoint":return"#eab308";case"animation":return"#ec4899";case"code":return"#475569";case"exercise":return"#8b5cf6";case"resource":return"#6366f1";default:return"#475569"}},maskColor:"rgba(15, 23, 42, 0.8)",className:"bg-slate-800 border border-slate-700 rounded-lg"}),i.blocks.length===0&&n.jsx(Jt,{position:"center",className:"pointer-events-none",children:n.jsxs("div",{className:"text-center pointer-events-auto",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center mx-auto mb-4",children:n.jsx(et,{className:"w-8 h-8 text-slate-600"})}),n.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"Start Building Your Journey"}),n.jsx("p",{className:"text-slate-500 mb-4 max-w-md",children:"Drag blocks from the sidebar to create your learning path, or use AI to generate a complete course outline."}),n.jsxs("button",{onClick:()=>E(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-colors",children:[n.jsx(we,{className:"w-5 h-5"}),"Generate with AI"]})]})})]})}),N&&Ce&&n.jsx("aside",{className:"w-96 bg-slate-800 border-l border-slate-700 overflow-y-auto",children:n.jsx(dp,{block:Ce,allBlocks:i.blocks,edges:i.edges,onUpdate:L=>se(Ce.id,L),onAddEdge:(L,G)=>{const Y={from:Ce.id,to:L,condition:G};l({...i,edges:[...i.edges.filter(U=>!(U.from===Ce.id&&U.to===L)),Y]}),H(!0)},onRemoveEdge:L=>{l({...i,edges:i.edges.filter(G=>!(G.from===Ce.id&&G.to===L))}),H(!0)},onClose:()=>{M(!1),g(null)}})})]}),j&&n.jsx(Cp,{onGenerate:ke,onClose:()=>E(!1),existingGraph:i,trackModulesContext:V,currentModuleId:e})]})}function $p(e){return n.jsx(la,{children:n.jsx(Tp,{...e})})}function Pp(e){switch(e){case"read":return{title:"New Reading",markdown:`# Title

Your content here...`,estimatedReadTime:3};case"video":return{title:"New Video",url:""};case"image":return{title:"New Image",url:"",caption:"",alt:""};case"quiz":return{title:"Knowledge Check",questions:[],passingScore:50};case"mission":return{title:"New Mission",steps:[]};case"form":return{title:"New Form",fields:[]};case"ai_help":return{title:"AI Help",mode:"targeted_remediation"};case"checkpoint":return{title:"Checkpoint"};case"animation":return{title:"New Animation",animationType:"lottie",url:""};case"code":return{title:"Code Example",code:"// Your code here",language:"javascript",showLineNumbers:!0};case"exercise":return{title:"Practice Exercise",problem:"",solution:"",hints:[]};case"resource":return{title:"Resources",resources:[]};default:return{title:"New Block"}}}function Dp(){const{enabled:e,isLoading:t}=Cs(),[s,r]=b.useState("content"),[o,a]=b.useState(""),[i,l]=b.useState("beginners"),[c,d]=b.useState(""),[h,f]=b.useState(""),[u,p]=b.useState(!1),[x,g]=b.useState(!1),y=async()=>{if(o.trim()){p(!0),f("");try{const j=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:s,topic:o,targetAudience:i,existingContent:c||void 0})})).json();j.error?f(`Error: ${j.error}`):j.result&&(typeof j.result=="string"?f(j.result):f(JSON.stringify(j.result,null,2)))}catch(m){f(`Error: ${m instanceof Error?m.message:"Generation failed"}`)}finally{p(!1)}}},v=()=>{navigator.clipboard.writeText(h),g(!0),setTimeout(()=>g(!1),2e3)},k=[{id:"content",label:"Reading Content",icon:Ft,description:"Generate educational markdown content"},{id:"quiz",label:"Quiz Questions",icon:Gt,description:"Generate assessment questions with answers"},{id:"video_script",label:"Video Script",icon:ut,description:"Generate video narration scripts"}];return t?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsx(fe,{className:"w-8 h-8 text-purple-500 animate-spin"})}):e?n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"p-6 border-b border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(we,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"AI Content Studio"}),n.jsx("p",{className:"text-slate-400",children:"Generate educational content with AI assistance"})]})]})}),n.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[n.jsx("div",{className:"w-96 border-r border-slate-700 p-6 overflow-y-auto",children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"What to Generate"}),n.jsx("div",{className:"space-y-2",children:k.map(m=>{const j=m.icon,E=s===m.id;return n.jsxs("button",{onClick:()=>r(m.id),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-colors text-left ${E?"bg-purple-600/20 border border-purple-500":"bg-slate-800 border border-slate-700 hover:bg-slate-700"}`,children:[n.jsx(j,{className:`w-5 h-5 ${E?"text-purple-400":"text-slate-400"}`}),n.jsxs("div",{children:[n.jsx("div",{className:`font-medium ${E?"text-purple-300":"text-white"}`,children:m.label}),n.jsx("div",{className:"text-xs text-slate-500",children:m.description})]})]},m.id)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Topic / Subject"}),n.jsx("textarea",{value:o,onChange:m=>a(m.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"What topic should the content cover?"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Audience"}),n.jsxs("select",{value:i,onChange:m=>l(m.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginners",children:"Complete Beginners"}),n.jsx("option",{value:"students",children:"Students"}),n.jsx("option",{value:"professionals",children:"Professionals"}),n.jsx("option",{value:"technical",children:"Technical Audience"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Existing Content (optional)"}),n.jsx("textarea",{value:c,onChange:m=>d(m.target.value),rows:4,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"Paste existing content to expand upon..."})]}),n.jsx("button",{onClick:y,disabled:!o.trim()||u,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:u?n.jsxs(n.Fragment,{children:[n.jsx(fe,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(we,{className:"w-5 h-5"}),"Generate"]})})]})}),n.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h2",{className:"font-semibold text-white",children:"Generated Output"}),h&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:y,disabled:u,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:[n.jsx(cl,{className:`w-4 h-4 ${u?"animate-spin":""}`}),"Regenerate"]}),n.jsx("button",{onClick:v,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:x?n.jsxs(n.Fragment,{children:[n.jsx(In,{className:"w-4 h-4 text-emerald-400"}),"Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx(xl,{className:"w-4 h-4"}),"Copy"]})})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:u?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(fe,{className:"w-12 h-12 text-purple-500 animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-400",children:"Generating content..."}),n.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"This may take a moment"})]})}):h?n.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:n.jsx("pre",{className:"text-slate-200 text-sm whitespace-pre-wrap font-mono",children:h})}):n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(we,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),n.jsx("p",{className:"text-slate-400",children:"Generated content will appear here"}),n.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Fill in the form and click Generate to start"})]})})})]})]})]}):n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"p-6 border-b border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(we,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"AI Content Studio"}),n.jsx("p",{className:"text-slate-400",children:"Generate educational content with AI assistance"})]})]})}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:n.jsx(yo,{})})]})}function uo(e){return e.startsWith("/admin/builder")?"builder":e.startsWith("/admin/tracks")?"tracks":e.startsWith("/admin/ai-studio")?"ai-studio":e.startsWith("/admin/settings")?"settings":"dashboard"}function Op({onExit:e,onSettingsChanged:t}){const s=mo(),r=fo(),[o,a]=b.useState(()=>uo(s.pathname)),[i,l]=b.useState(null);b.useEffect(()=>{const f=uo(s.pathname);f!==o&&a(f)},[s.pathname]);const c=(f,u)=>{l({moduleId:f,journeyVersionId:u}),a("builder"),r(`/admin/builder/${f}${u?`?v=${u}`:""}`)},d=()=>{l(null),a("tracks"),r("/admin/tracks")},h=()=>{if(i&&o==="builder")return n.jsx($p,{moduleId:i.moduleId,journeyVersionId:i.journeyVersionId,onBack:d});switch(o){case"dashboard":return n.jsx(Rp,{onNavigate:a});case"tracks":return n.jsx(Xl,{onEditJourney:c});case"builder":return n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Is,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),n.jsx("h2",{className:"text-xl font-semibold text-slate-400 mb-2",children:"Journey Builder"}),n.jsx("p",{className:"text-slate-500 mb-4",children:"Select a module from Tracks to edit its journey"}),n.jsx("button",{onClick:()=>a("tracks"),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Go to Tracks"})]})});case"ai-studio":return n.jsx(Dp,{});case"settings":return n.jsx(zp,{onSettingsChanged:t});default:return null}};return n.jsx(ql,{activeTab:o,onTabChange:a,onExit:e,children:h()})}function Rp({onNavigate:e}){const[t,s]=b.useState({totalTracks:0,activeLearners:0,avgCompletion:0,totalHours:0}),[r,o]=b.useState(!0);b.useEffect(()=>{a()},[]);const a=async()=>{try{const{supabase:l}=await xn(async()=>{const{supabase:k}=await import("./index-BTAm5qeQ.js").then(m=>m.v);return{supabase:k}},__vite__mapDeps([0,1])),{count:c}=await l.from("tracks").select("*",{count:"exact",head:!0}),{data:d}=await l.from("user_journey_runs").select("user_id"),h=new Set(d?.map(k=>k.user_id)||[]),{data:f}=await l.from("user_journey_runs").select("status"),u=f?.length||0,p=f?.filter(k=>k.status==="completed").length||0,x=u>0?Math.round(p/u*100):0,{data:g}=await l.from("user_block_states").select("time_spent_seconds"),y=g?.reduce((k,m)=>k+(m.time_spent_seconds||0),0)||0,v=Math.round(y/3600);s({totalTracks:c||0,activeLearners:h.size,avgCompletion:x,totalHours:v})}catch(l){console.error("Error loading dashboard stats:",l)}finally{o(!1)}},i=[{label:"Total Tracks",value:r?"...":String(t.totalTracks),icon:He,color:"bg-primary-500"},{label:"Active Learners",value:r?"...":String(t.activeLearners),icon:Gl,color:"bg-emerald-500"},{label:"Avg. Completion",value:r?"...":`${t.avgCompletion}%`,icon:dl,color:"bg-purple-500"},{label:"Total Hours",value:r?"...":String(t.totalHours),icon:ul,color:"bg-warning"}];return n.jsx("div",{className:"h-full overflow-y-auto",children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Admin Dashboard"}),n.jsx("p",{className:"text-slate-400",children:"Manage your learning content and track performance"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:i.map(l=>{const c=l.icon;return n.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:`w-12 h-12 ${l.color} rounded-xl flex items-center justify-center`,children:n.jsx(c,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-2xl font-bold text-white",children:l.value}),n.jsx("div",{className:"text-sm text-slate-400",children:l.label})]})]})},l.label)})}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Quick Actions"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{onClick:()=>e("tracks"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center",children:n.jsx(He,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"Create New Track"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Start a new learning path"})]})]}),n.jsxs("button",{onClick:()=>e("ai-studio"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:n.jsx(we,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"AI Content Studio"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Generate content with AI"})]})]}),n.jsxs("button",{onClick:()=>e("tracks"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center",children:n.jsx(Is,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"Edit Existing Journey"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Modify course content"})]})]})]})]}),n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Recent Activity"}),n.jsx("div",{className:"space-y-4",children:[{action:"Track published",item:"GenAI Fundamentals",time:"2 hours ago"},{action:"Module created",item:"Advanced Prompting",time:"5 hours ago"},{action:"Quiz updated",item:"Knowledge Check #3",time:"1 day ago"},{action:"New learner enrolled",item:"John D.",time:"2 days ago"}].map((l,c)=>n.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700 last:border-0",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-white",children:l.action}),n.jsx("div",{className:"text-xs text-slate-500",children:l.item})]}),n.jsx("div",{className:"text-xs text-slate-500",children:l.time})]},c))})]})]})]})})}function zp({onSettingsChanged:e}){const[t,s]=b.useState("Learning Hub"),[r,o]=b.useState("English"),[a,i]=b.useState("gpt-4o"),[l,c]=b.useState("gpt-4o-mini"),[d,h]=b.useState("gpt-image-1.5"),[f,u]=b.useState(!0),[p,x]=b.useState(!0),[g,y]=b.useState(!1),[v,k]=b.useState(null);b.useEffect(()=>{m()},[]);const m=async()=>{try{const{supabase:w}=await xn(async()=>{const{supabase:T}=await import("./index-BTAm5qeQ.js").then($=>$.v);return{supabase:T}},__vite__mapDeps([0,1])),{data:C,error:I}=await w.from("system_settings").select("setting_key, setting_value").in("setting_key",["ai_content_model","ai_help_model","ai_image_model","platform_name","default_language","ai_enabled"]);if(I)throw I;C&&C.forEach(T=>{switch(T.setting_key){case"ai_content_model":i(T.setting_value);break;case"ai_help_model":c(T.setting_value);break;case"ai_image_model":h(T.setting_value);break;case"platform_name":s(T.setting_value);break;case"default_language":o(T.setting_value);break;case"ai_enabled":u(T.setting_value==="true");break}})}catch(w){console.error("Error loading settings:",w),k({type:"error",text:"Failed to load settings. Please check your connection and try again."})}finally{x(!1)}},j=async()=>{y(!0),k(null);try{const{supabase:w}=await xn(async()=>{const{supabase:I}=await import("./index-BTAm5qeQ.js").then(T=>T.v);return{supabase:I}},__vite__mapDeps([0,1])),C=[{setting_key:"ai_content_model",setting_value:a},{setting_key:"ai_help_model",setting_value:l},{setting_key:"ai_image_model",setting_value:d},{setting_key:"platform_name",setting_value:t},{setting_key:"default_language",setting_value:r},{setting_key:"ai_enabled",setting_value:String(f)}];for(const I of C){const{error:T}=await w.from("system_settings").upsert({setting_key:I.setting_key,setting_value:I.setting_value,category:I.setting_key.startsWith("ai_")?"ai":"general",description:E(I.setting_key)},{onConflict:"setting_key"});if(T)throw console.error(`Error saving ${I.setting_key}:`,T),T}k({type:"success",text:"Settings saved successfully!"}),setTimeout(()=>k(null),3e3),e&&e()}catch(w){console.error("Error saving settings:",w),k({type:"error",text:"Failed to save settings. Please try again."})}finally{y(!1)}},E=w=>({ai_content_model:"AI model used for content generation in AI Studio",ai_help_model:"AI model used for student help and assistance",ai_image_model:"AI model used for generating educational images and diagrams",platform_name:"Platform display name",default_language:"Default content language",ai_enabled:"Whether AI content generation is enabled"})[w]||"";return p?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsx("div",{className:"text-slate-400",children:"Loading settings..."})}):n.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[n.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"Settings"}),n.jsxs("div",{className:"max-w-2xl space-y-6",children:[n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"General Settings"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Platform Name"}),n.jsx("input",{type:"text",value:t,onChange:w=>s(w.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter platform name"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Default Language"}),n.jsxs("select",{value:r,onChange:w=>o(w.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"English",children:"English"}),n.jsx("option",{value:"Arabic",children:"Arabic"}),n.jsx("option",{value:"Spanish",children:"Spanish"}),n.jsx("option",{value:"French",children:"French"})]})]})]})]}),n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"AI Settings"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Content Generation Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for AI Studio and course generation"}),n.jsxs("select",{value:a,onChange:w=>i(w.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-4o",children:"GPT-4o (Recommended)"}),n.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o-mini (Faster)"}),n.jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),n.jsx("option",{value:"gpt-5.2",children:"GPT-5.2 (Latest)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"AI Help Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for student assistance and tutoring"}),n.jsxs("select",{value:l,onChange:w=>c(w.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-4o",children:"GPT-4o (Recommended)"}),n.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o-mini (Faster, Cost-effective)"}),n.jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),n.jsx("option",{value:"gpt-5.2",children:"GPT-5.2 (Latest)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Image Generation Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for generating educational images and diagrams"}),n.jsxs("select",{value:d,onChange:w=>h(w.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-image-1.5",children:"GPT Image 1.5 (Latest)"}),n.jsx("option",{value:"gpt-image-1",children:"GPT Image 1"}),n.jsx("option",{value:"dall-e-3",children:"DALL-E 3 (High Quality)"}),n.jsx("option",{value:"dall-e-2",children:"DALL-E 2 (Faster)"})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-slate-300",children:"Enable AI Content Generation"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Allow AI to generate course content"})]}),n.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:f,onChange:w=>u(w.target.checked),className:"sr-only peer"}),n.jsx("div",{className:"w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]})]})]}),v&&n.jsx("div",{className:`p-4 rounded-lg ${v.type==="success"?"bg-success/10 text-success border border-success/20":"bg-error/10 text-error border border-error/20"}`,children:v.text}),n.jsx("button",{onClick:j,disabled:g,className:"w-full px-6 py-3 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Saving...":"Save Settings"})]})]})}const Lp={read:n.jsx(He,{className:"w-5 h-5 text-blue-400"}),video:n.jsx(ut,{className:"w-5 h-5 text-rose-400"}),quiz:n.jsx(Gt,{className:"w-5 h-5 text-purple-400"}),mission:n.jsx(An,{className:"w-5 h-5 text-orange-400"}),form:n.jsx(Il,{className:"w-5 h-5 text-cyan-400"}),checkpoint:n.jsx(dn,{className:"w-5 h-5 text-emerald-400"}),ai_help:n.jsx(we,{className:"w-5 h-5 text-amber-400"}),animation:n.jsx(Rl,{className:"w-5 h-5 text-pink-400"})},ho={read:"",video:"",quiz:"",mission:"",form:"",checkpoint:" ",ai_help:" ",animation:" "};function Vp({blocks:e,edges:t,startBlockId:s,onReorder:r,onEditBlock:o,onDeleteBlock:a,onSetStart:i}){const[l,c]=b.useState(null),[d,h]=b.useState(null),[f,u]=b.useState(new Set),p=b.useRef(null),x=b.useCallback(($,S)=>{c(S),$.dataTransfer.effectAllowed="move",$.dataTransfer.setData("text/plain",S.toString()),p.current&&(p.current.style.opacity="0.5")},[]),g=b.useCallback(($,S)=>{$.preventDefault(),$.dataTransfer.dropEffect="move",l!==null&&l!==S&&h(S)},[l]),y=b.useCallback(()=>{h(null)},[]),v=b.useCallback(($,S)=>{if($.preventDefault(),l===null||l===S){c(null),h(null);return}const P=[...e],[H]=P.splice(l,1);P.splice(S,0,H);const N=w(P,t);r(P,N),c(null),h(null)},[l,e,t,r]),k=b.useCallback(()=>{c(null),h(null)},[]),m=b.useCallback(($,S)=>{c(S)},[]),j=b.useCallback($=>{if(l===null)return;const S=$.touches[0],H=document.elementsFromPoint(S.clientX,S.clientY).find(N=>N.hasAttribute("data-block-index"));if(H){const N=parseInt(H.getAttribute("data-block-index")||"-1");N!==-1&&N!==l&&h(N)}},[l]),E=b.useCallback($=>{if(l!==null&&d!==null&&l!==d){const S=[...e],[P]=S.splice(l,1);S.splice(d,0,P);const H=w(S,t);r(S,H)}c(null),h(null)},[l,d,e,t,r]),w=($,S)=>{const P=S.filter(N=>N.condition),H=[];for(let N=0;N<$.length-1;N++){const M=$[N],_=$[N+1];P.some(A=>A.from===M.id)||H.push({from:M.id,to:_.id})}return[...H,...P]},C=$=>{const S=new Set(f);S.has($)?S.delete($):S.add($),u(S)},I=$=>t.filter(S=>S.from===$),T=($,S)=>{const P=S==="up"?$-1:$+1;if(P<0||P>=e.length)return;const H=[...e];[H[$],H[P]]=[H[P],H[$]];const N=w(H,t);r(H,N)};return n.jsxs("div",{className:"space-y-2",children:[e.map(($,S)=>{const P=$.content,H=s===$.id,N=l===S,M=d===S,_=f.has($.id),D=I($.id),A=D.some(z=>z.condition);return n.jsxs("div",{ref:N?p:null,"data-block-index":S,draggable:!0,onDragStart:z=>x(z,S),onDragOver:z=>g(z,S),onDragLeave:y,onDrop:z=>v(z,S),onDragEnd:k,onTouchStart:z=>m(z,S),onTouchMove:j,onTouchEnd:E,className:`
              bg-slate-800 rounded-xl border transition-all
              ${N?"dragging border-blue-500":"border-slate-700"}
              ${M?"border-blue-500 border-dashed bg-blue-500/10":""}
            `,children:[n.jsxs("div",{className:"flex items-center gap-3 p-4",children:[n.jsx("div",{className:"drag-handle p-1 text-slate-500 hover:text-slate-300 touch-manipulation",children:n.jsx(Ms,{className:"w-5 h-5"})}),n.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-700 flex items-center justify-center flex-shrink-0",children:Lp[$.type]||n.jsx(He,{className:"w-5 h-5 text-slate-400"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"font-medium text-white truncate",children:P?.title||ho[$.type]||$.type}),H&&n.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded-full flex-shrink-0",children:""}),A&&n.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full flex-shrink-0 flex items-center gap-1",children:[n.jsx(wl,{className:"w-3 h-3"}),""]})]}),n.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:ho[$.type]||$.type})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>T(S,"up"),disabled:S===0,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:" ",children:n.jsx(bn,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>T(S,"down"),disabled:S===e.length-1,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:" ",children:n.jsx(gn,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>C($.id),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"",children:_?n.jsx(bn,{className:"w-4 h-4"}):n.jsx(gn,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>o($),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"",children:n.jsx(Ol,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>a($.id),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",title:"",children:n.jsx($e,{className:"w-4 h-4"})})]})]}),_&&n.jsx("div",{className:"px-4 pb-4 border-t border-slate-700 mt-2 pt-4",children:n.jsxs("div",{className:"space-y-3",children:[!H&&n.jsx("button",{onClick:()=>i($.id),className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",children:"  "}),D.length>0&&n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:":"}),n.jsx("div",{className:"space-y-1",children:D.map((z,O)=>{const V=e.find(Q=>Q.id===z.to)?.content;return n.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-2",children:[n.jsx("span",{className:"text-slate-600",children:""}),n.jsx("span",{children:V?.title||z.to}),z.condition&&n.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded",children:""})]},O)})})]})]})})]},$.id)}),e.length===0&&n.jsx("div",{className:"text-center py-12 text-slate-500",children:"  .   ."})]})}export{Cp as AIContentGenerator,Dp as AIStudio,ql as AdminLayout,Op as AdminPage,dp as BlockEditor,Mp as BlockNode,Vp as DraggableBlockList,$p as JourneyBuilder,Xl as TrackManager};

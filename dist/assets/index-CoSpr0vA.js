const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-vT5yFsa4.js","assets/index-7Sufvy0s.css"])))=>i.map(i=>d[i]);
import{r as tl,c as re,a as y,u as co,b as uo,j as n,B as $e,S as ge,d as nl,L as me,C as jn,e as sl,s as ye,f as rl,X as Ct,g as ho,h as ol,R as il,P as fo,A as js,i as ns,T as Nn,k as ss,l as al,_ as rs,m as ll,n as cl}from"./index-vT5yFsa4.js";import{C as os,I as et,V as ut,L as mo,a as kn,P as dl,R as ul,D as hl,u as Ns,U as po,F as Ot,A as xo,b as ks,H as Vt,c as Cs,B as Ss,d as Cn,e as go,f as fl}from"./useAIEnabled-12KJL6FL.js";tl();const ml=re("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);const pl=re("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);const xl=re("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);const bo=re("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const gl=re("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);const is=re("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const as=re("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const bl=re("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);const yl=re("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const _s=re("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const vl=re("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);const wl=re("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);const jl=re("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);const Es=re("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const Nl=re("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const kl=re("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const Cl=re("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);const Sl=re("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);const _l=re("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const El=re("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Il=re("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Ml=re("MonitorPlay",[["path",{d:"m10 7 5 3-5 3Z",key:"29ljg6"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]);const Al=re("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);const Tl=re("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);const $l=re("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);const Qe=re("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Pl=re("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);const Dl=re("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);const zl=re("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);const yo=re("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const Rl=re("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);const Ll=re("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);const vo=re("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const _e=re("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Bl=re("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);const Hl=re("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);const Ol=re("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const Vl=re("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);function Fl({children:e,activeTab:t,onTabChange:s,onExit:r}){const[o,a]=y.useState(!1),i=co(),l=uo(),c=[{id:"dashboard",label:"Dashboard",icon:Nl,path:"/admin"},{id:"tracks",label:"Tracks",icon:$e,path:"/admin/tracks"},{id:"builder",label:"Journey Builder",icon:Es,path:"/admin/builder"},{id:"ai-studio",label:"AI Studio",icon:ge,path:"/admin/ai-studio"},{id:"settings",label:"Settings",icon:nl,path:"/admin/settings"}],d=u=>{i(u.path),s(u.id)},f=(()=>{const u=l.pathname;return u.startsWith("/admin/builder")?"builder":u.startsWith("/admin/tracks")?"tracks":u.startsWith("/admin/ai-studio")?"ai-studio":u.startsWith("/admin/settings")?"settings":"dashboard"})();return n.jsxs("div",{className:"min-h-screen bg-slate-900 flex",children:[n.jsxs("aside",{className:`bg-slate-800 border-r border-slate-700 flex flex-col transition-all duration-300 ${o?"w-16":"w-64"}`,children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[!o&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("img",{src:"https://res.cloudinary.com/dujh5xuoi/image/upload/v1754423073/%D8%AA%D8%B9%D9%84%D9%91%D9%85_AIFinal_edvr4e.png",alt:"Platform logo",className:"max-h-8 w-auto object-contain"}),n.jsx("span",{className:"font-bold text-white",children:"Admin"})]}),n.jsx("button",{onClick:()=>a(!o),className:"p-1.5 rounded-lg hover:bg-slate-700 text-slate-400 transition-colors",children:n.jsx(os,{className:`w-5 h-5 transition-transform ${o?"rotate-180":""}`})})]}),n.jsx("nav",{className:"flex-1 p-2 space-y-1",role:"navigation","aria-label":"Admin navigation",children:c.map(u=>{const m=u.icon,p=f===u.id||t===u.id;return n.jsxs("button",{onClick:()=>d(u),"aria-label":u.label,"aria-current":p?"page":void 0,className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors ${p?"bg-blue-600 text-white":"text-slate-400 hover:bg-slate-700 hover:text-white"}`,children:[n.jsx(m,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),!o&&n.jsx("span",{className:"font-medium",children:u.label})]},u.id)})}),n.jsx("div",{className:"p-2 border-t border-slate-700",children:n.jsxs("button",{onClick:r,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-400 hover:bg-slate-700 hover:text-white transition-colors",children:[n.jsx(os,{className:"w-5 h-5 flex-shrink-0"}),!o&&n.jsx("span",{className:"font-medium",children:"Back to App"})]})})]}),n.jsx("main",{className:"flex-1 overflow-hidden",children:e})]})}function Gl({selectedCount:e,totalCount:t,onSelectAll:s,onSelectNone:r,onDelete:o,isDeleting:a=!1,itemName:i="items"}){return e===0?null:n.jsxs("div",{className:"sticky top-0 z-10 bg-slate-800 border-b border-slate-700 px-4 py-3 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("span",{className:"text-sm font-medium text-white",children:[e," of ",t," ",i," selected"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[e<t?n.jsxs("button",{onClick:s,disabled:a,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[n.jsx(gl,{className:"w-4 h-4"}),"Select All"]}):null,n.jsxs("button",{onClick:r,disabled:a,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[n.jsx(vo,{className:"w-4 h-4"}),"Clear Selection"]})]})]}),n.jsx("button",{onClick:o,disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",children:a?n.jsxs(n.Fragment,{children:[n.jsx(me,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):n.jsxs(n.Fragment,{children:[n.jsx(_e,{className:"w-4 h-4"}),"Delete Selected (",e,")"]})})]})}function Yl({isSelected:e,onToggleSelect:t,children:s,className:r="",disabled:o=!1}){return n.jsxs("div",{className:`relative group ${r} ${e?"ring-2 ring-blue-500":""} ${o?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:a=>{const i=a.target,l=i.closest("button"),c=i.closest("input, textarea, select");!l&&!c&&!o&&t()},children:[n.jsx("div",{className:`absolute top-3 left-3 z-10 w-6 h-6 rounded border-2 flex items-center justify-center transition-all ${e?"bg-blue-600 border-blue-600":"bg-slate-700 border-slate-600 group-hover:border-slate-500"}`,onClick:a=>{a.stopPropagation(),o||t()},children:e&&n.jsx(jn,{className:"w-4 h-4 text-white"})}),s]})}const wo=["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3184325/pexels-photo-3184325.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181676/pexels-photo-1181676.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/4050315/pexels-photo-4050315.jpeg?auto=compress&cs=tinysrgb&w=800"];function ql({onEditJourney:e}){const{showToast:t}=sl(),[s,r]=y.useState([]),[o,a]=y.useState(!0),[i,l]=y.useState(""),[c,d]=y.useState(!1),[h,f]=y.useState(null),[u,m]=y.useState(null),[p,b]=y.useState(null),[g,v]=y.useState(null),[N,x]=y.useState(!1),[w,E]=y.useState(!1),[k,I]=y.useState(!1),[T,P]=y.useState(new Set),[R,C]=y.useState(new Set),[z,L]=y.useState(!1);y.useEffect(()=>{j()},[]);const j=async()=>{a(!0);const{data:B}=await ye.from("tracks").select(`
        *,
        modules (
          *,
          journey_versions (id, status, version)
        )
      `).order("created_at",{ascending:!1});B&&r(B),a(!1)},M=async B=>{x(!0);try{const{error:D}=await ye.from("tracks").insert({title:B.title,description:B.description,level:B.level,cover_image_url:B.cover_image_url||null,tags:JSON.stringify([])});if(D)throw D;t("success","Track created successfully"),await j(),d(!1)}catch(D){console.error("Error creating track:",D),t("error","Failed to create track. Please try again.")}finally{x(!1)}},_=async(B,D)=>{E(!0);try{const W=s.find(le=>le.id===B)?.modules?.length||0,{data:se,error:J}=await ye.from("modules").insert({track_id:B,title:D.title,description:D.description,order_index:W}).select().single();if(J)throw J;if(!se)throw new Error("Module creation failed");const{data:ne,error:oe}=await ye.from("journey_versions").insert({module_id:se.id,version:1,status:"draft",graph_json:{startBlockId:"",blocks:[],edges:[]}}).select().single();oe?(console.error("Error creating journey version:",oe),t("warning","Module created but journey setup failed. Please try editing the module.")):t("success","Module created successfully"),await j(),f(null),ne&&e(se.id,ne.id)}catch(X){console.error("Error creating module:",X),t("error","Failed to create module. Please try again.")}finally{E(!1)}},A=async B=>{if(confirm("Are you sure you want to delete this track and all its modules?")){b(B);try{const{error:D}=await ye.from("tracks").delete().eq("id",B);if(D)throw D;t("success","Track deleted successfully"),await j()}catch(D){console.error("Error deleting track:",D),t("error","Failed to delete track. Please try again.")}finally{b(null)}}},S=async B=>{if(confirm("Are you sure you want to delete this module?")){v(B);try{const{error:D}=await ye.from("modules").delete().eq("id",B);if(D)throw D;t("success","Module deleted successfully"),await j()}catch(D){console.error("Error deleting module:",D),t("error","Failed to delete module. Please try again.")}finally{v(null)}}},$=async()=>{const B=T.size,D=s.filter(W=>T.has(W.id)).slice(0,5).map(W=>W.title).join(", "),X=B<=5?`Delete ${B} track${B>1?"s":""} (${D})?`:`Delete ${B} tracks (${D}, and ${B-5} more)?`;if(confirm(`${X}

This will also delete all associated modules and content. This action cannot be undone.`)){L(!0);try{const{error:W}=await ye.from("tracks").delete().in("id",Array.from(T));if(W)throw W;t("success",`Successfully deleted ${B} track${B>1?"s":""}`),P(new Set),await j()}catch(W){console.error("Error bulk deleting tracks:",W),t("error","Failed to delete some tracks. Please try again.")}finally{L(!1)}}},H=async()=>{const B=R.size,D=s.flatMap(W=>W.modules||[]).filter(W=>R.has(W.id)).slice(0,5).map(W=>W.title).join(", "),X=B<=5?`Delete ${B} module${B>1?"s":""} (${D})?`:`Delete ${B} modules (${D}, and ${B-5} more)?`;if(confirm(`${X}

This will also delete all associated journeys and content. This action cannot be undone.`)){L(!0);try{const{error:W}=await ye.from("modules").delete().in("id",Array.from(R));if(W)throw W;t("success",`Successfully deleted ${B} module${B>1?"s":""}`),C(new Set),await j()}catch(W){console.error("Error bulk deleting modules:",W),t("error","Failed to delete some modules. Please try again.")}finally{L(!1)}}},F=B=>{const D=new Set(T);D.has(B)?D.delete(B):D.add(B),P(D)},O=B=>{const D=new Set(R);D.has(B)?D.delete(B):D.add(B),C(D)},G=()=>{P(new Set(K.map(B=>B.id)))},Y=B=>{const D=s.find(W=>W.id===B);if(!D)return;const X=(D.modules||[]).map(W=>W.id);C(new Set([...R,...X]))},ee=()=>{P(new Set)},K=s.filter(B=>B.title.toLowerCase().includes(i.toLowerCase()));return n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsxs("div",{className:"p-6 border-b border-slate-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"Track Manager"}),n.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[n.jsx(Qe,{className:"w-5 h-5"}),"New Track"]})]}),n.jsxs("div",{className:"relative",children:[n.jsx(yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500"}),n.jsx("input",{type:"text",placeholder:"Search tracks...",value:i,onChange:B=>l(B.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:o?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(me,{className:"w-8 h-8 text-primary-500 animate-spin"})}):K.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx($e,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"No tracks yet"}),n.jsx("p",{className:"text-slate-500 mb-4",children:"Create your first learning track to get started"}),n.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[n.jsx(Qe,{className:"w-5 h-5"}),"Create Track"]})]}):n.jsxs(n.Fragment,{children:[n.jsx(Gl,{selectedCount:T.size,totalCount:K.length,onSelectAll:G,onSelectNone:ee,onDelete:$,isDeleting:z,itemName:"tracks"}),n.jsx("div",{className:"p-6 space-y-4",children:K.map(B=>n.jsxs(Yl,{isSelected:T.has(B.id),onToggleSelect:()=>F(B.id),disabled:z,className:"bg-slate-800 border border-slate-700 rounded-xl overflow-hidden",children:[n.jsxs("div",{className:"p-4 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4 pl-8",children:[B.cover_image_url?n.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden flex-shrink-0",children:n.jsx("img",{src:B.cover_image_url,alt:B.title,className:"w-full h-full object-cover"})}):n.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center flex-shrink-0",children:n.jsx($e,{className:"w-8 h-8 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-white",children:B.title}),n.jsx("p",{className:"text-sm text-slate-400",children:B.description||"No description"}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${B.level==="beginner"?"bg-emerald-500/20 text-emerald-400":B.level==="intermediate"?"bg-warning/20 text-warning":"bg-rose-500/20 text-rose-400"}`,children:B.level}),n.jsxs("span",{className:"text-xs text-slate-500",children:[B.modules?.length||0," modules"]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:D=>{D.stopPropagation(),m(B)},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",disabled:p===B.id||z,children:n.jsx(Tl,{className:"w-5 h-5"})}),n.jsx("button",{onClick:D=>{D.stopPropagation(),A(B.id)},disabled:p===B.id||z,className:"p-2 text-slate-400 hover:text-error hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:p===B.id?n.jsx(me,{className:"w-5 h-5 animate-spin"}):n.jsx(_e,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"border-t border-slate-700",children:[R.size>0&&(B.modules||[]).some(D=>R.has(D.id))&&n.jsxs("div",{className:"bg-slate-900/50 px-4 py-2 border-b border-slate-700 flex items-center justify-between",children:[n.jsxs("span",{className:"text-sm text-slate-400",children:[(B.modules||[]).filter(D=>R.has(D.id)).length," module",(B.modules||[]).filter(D=>R.has(D.id)).length>1?"s":""," selected"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:D=>{D.stopPropagation(),Y(B.id)},className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Select All"}),n.jsx("button",{onClick:D=>{D.stopPropagation(),H()},disabled:z,className:"text-xs px-2 py-1 bg-error text-white rounded hover:bg-error/90 disabled:opacity-50 transition-colors",children:"Delete Selected"})]})]}),B.modules?.map(D=>{const X=D.journey_versions?.find(J=>J.status==="published"),W=D.journey_versions?.find(J=>J.status==="draft"),se=X||W;return n.jsxs("div",{className:`px-4 py-3 flex items-center justify-between hover:bg-slate-700/50 transition-colors border-b border-slate-700 last:border-b-0 ${R.has(D.id)?"bg-primary-500/10":""}`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",checked:R.has(D.id),onChange:J=>{J.stopPropagation(),O(D.id)},disabled:z,className:"w-4 h-4 rounded border-slate-600 text-primary-600 focus:ring-primary-500 focus:ring-offset-slate-900"}),n.jsx("div",{className:"w-8 h-8 rounded bg-slate-700 flex items-center justify-center text-sm font-medium text-slate-300",children:D.order_index+1}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-slate-200",children:D.title}),n.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[X&&n.jsx("span",{className:"text-emerald-400",children:"Published"}),W&&!X&&n.jsx("span",{className:"text-warning",children:"Draft"}),!se&&n.jsx("span",{className:"text-slate-500",children:"No content"})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:J=>{J.stopPropagation(),e(D.id,se?.id)},className:"flex items-center gap-1 px-3 py-1.5 text-sm text-primary-400 hover:text-primary-300 hover:bg-primary-500/10 rounded-lg transition-colors",children:["Edit Journey",n.jsx(rl,{className:"w-4 h-4"})]}),n.jsx("button",{onClick:J=>{J.stopPropagation(),S(D.id)},disabled:g===D.id||z,className:"p-1.5 text-slate-500 hover:text-error rounded transition-colors disabled:opacity-50",children:g===D.id?n.jsx(me,{className:"w-4 h-4 animate-spin"}):n.jsx(_e,{className:"w-4 h-4"})})]})]},D.id)}),n.jsxs("button",{onClick:D=>{D.stopPropagation(),f(B.id)},disabled:z,className:"w-full px-4 py-3 flex items-center justify-center gap-2 text-slate-400 hover:text-white hover:bg-slate-700/50 transition-colors disabled:opacity-50",children:[n.jsx(Qe,{className:"w-4 h-4"}),"Add Module"]})]})]},B.id))})]})}),c&&n.jsx(Zl,{onClose:()=>d(!1),onCreate:M,isCreating:N}),h&&n.jsx(Xl,{onClose:()=>f(null),onCreate:B=>_(h,B),isCreating:w}),u&&n.jsx(Wl,{track:u,onClose:()=>m(null),isSaving:k,onSave:async B=>{I(!0);try{const{error:D}=await ye.from("tracks").update(B).eq("id",u.id);if(D)throw D;t("success","Track updated successfully"),await j(),m(null)}catch(D){console.error("Error updating track:",D),t("error","Failed to update track. Please try again.")}finally{I(!1)}}})]})}function Zl({onClose:e,onCreate:t,isCreating:s}){const[r,o]=y.useState(""),[a,i]=y.useState(""),[l,c]=y.useState("beginner"),[d,h]=y.useState(""),[f,u]=y.useState(!1);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-lg p-6 border border-slate-700 max-h-[90vh] overflow-y-auto",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Create New Track"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cover Image"}),n.jsx("div",{className:"relative",children:d?n.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-slate-900",children:[n.jsx("img",{src:d,alt:"Cover preview",className:"w-full h-full object-cover"}),n.jsx("button",{onClick:()=>h(""),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:n.jsx(Ct,{className:"w-4 h-4"})})]}):n.jsxs("button",{onClick:()=>u(!f),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-500 transition-colors",children:[n.jsx(et,{className:"w-8 h-8 text-slate-500"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Add cover image"})]})}),f&&!d&&n.jsxs("div",{className:"mt-3 space-y-3",children:[n.jsx("input",{type:"url",value:d,onChange:m=>h(m.target.value),placeholder:"Paste image URL...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Or choose from gallery:"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:wo.map((m,p)=>n.jsx("button",{onClick:()=>{h(m),u(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:m,alt:"",className:"w-full h-full object-cover"})},p))})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:r,onChange:m=>o(m.target.value),placeholder:"e.g., GenAI Fundamentals",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:a,onChange:m=>i(m.target.value),placeholder:"What will learners gain from this track?",rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Level"}),n.jsxs("select",{value:l,onChange:m=>c(m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:e,disabled:s,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>t({title:r,description:a,level:l,cover_image_url:d||void 0}),disabled:!r.trim()||s,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[s&&n.jsx(me,{className:"w-4 h-4 animate-spin"}),s?"Creating...":"Create Track"]})]})]})})}function Xl({onClose:e,onCreate:t,isCreating:s}){const[r,o]=y.useState(""),[a,i]=y.useState("");return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-md p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Add New Module"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:r,onChange:l=>o(l.target.value),placeholder:"e.g., Introduction to AI",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:a,onChange:l=>i(l.target.value),placeholder:"What will this module cover?",rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:e,disabled:s,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>t({title:r,description:a}),disabled:!r.trim()||s,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[s&&n.jsx(me,{className:"w-4 h-4 animate-spin"}),s?"Creating...":"Create Module"]})]})]})})}function Wl({track:e,onClose:t,onSave:s,isSaving:r}){const[o,a]=y.useState(e.title),[i,l]=y.useState(e.description||""),[c,d]=y.useState(e.level),[h,f]=y.useState(e.cover_image_url||""),[u,m]=y.useState(!1);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-lg p-6 border border-slate-700 max-h-[90vh] overflow-y-auto",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Edit Track"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cover Image"}),n.jsx("div",{className:"relative",children:h?n.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-slate-900",children:[n.jsx("img",{src:h,alt:"Cover preview",className:"w-full h-full object-cover"}),n.jsx("button",{onClick:()=>f(""),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:n.jsx(Ct,{className:"w-4 h-4"})})]}):n.jsxs("button",{onClick:()=>m(!u),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-500 transition-colors",children:[n.jsx(et,{className:"w-8 h-8 text-slate-500"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Add cover image"})]})}),u&&!h&&n.jsxs("div",{className:"mt-3 space-y-3",children:[n.jsx("input",{type:"url",value:h,onChange:p=>f(p.target.value),placeholder:"Paste image URL...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Or choose from gallery:"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:wo.map((p,b)=>n.jsx("button",{onClick:()=>{f(p),m(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:p,alt:"",className:"w-full h-full object-cover"})},b))})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:o,onChange:p=>a(p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:i,onChange:p=>l(p.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Level"}),n.jsxs("select",{value:c,onChange:p=>d(p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:t,disabled:r,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>s({title:o,description:i,level:c,cover_image_url:h||null}),disabled:!o.trim()||r,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[r&&n.jsx(me,{className:"w-4 h-4 animate-spin"}),r?"Saving...":"Save Changes"]})]})]})})}function xe(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let s=0,r;s<e.length;s++)(r=xe(e[s]))!==""&&(t+=(t&&" ")+r);else for(let s in e)e[s]&&(t+=(t&&" ")+s);return t}var Ul={value:()=>{}};function Sn(){for(var e=0,t=arguments.length,s={},r;e<t;++e){if(!(r=arguments[e]+"")||r in s||/[\s.]/.test(r))throw new Error("illegal type: "+r);s[r]=[]}return new an(s)}function an(e){this._=e}function Jl(e,t){return e.trim().split(/^|\s+/).map(function(s){var r="",o=s.indexOf(".");if(o>=0&&(r=s.slice(o+1),s=s.slice(0,o)),s&&!t.hasOwnProperty(s))throw new Error("unknown type: "+s);return{type:s,name:r}})}an.prototype=Sn.prototype={constructor:an,on:function(e,t){var s=this._,r=Jl(e+"",s),o,a=-1,i=r.length;if(arguments.length<2){for(;++a<i;)if((o=(e=r[a]).type)&&(o=Ql(s[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<i;)if(o=(e=r[a]).type)s[o]=er(s[o],e.name,t);else if(t==null)for(o in s)s[o]=er(s[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var s in t)e[s]=t[s].slice();return new an(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var s=new Array(o),r=0,o,a;r<o;++r)s[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],r=0,o=a.length;r<o;++r)a[r].value.apply(t,s)},apply:function(e,t,s){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,a=r.length;o<a;++o)r[o].value.apply(t,s)}};function Ql(e,t){for(var s=0,r=e.length,o;s<r;++s)if((o=e[s]).name===t)return o.value}function er(e,t,s){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=Ul,e=e.slice(0,r).concat(e.slice(r+1));break}return s!=null&&e.push({name:t,value:s}),e}var ls="http://www.w3.org/1999/xhtml";const tr={svg:"http://www.w3.org/2000/svg",xhtml:ls,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function _n(e){var t=e+="",s=t.indexOf(":");return s>=0&&(t=e.slice(0,s))!=="xmlns"&&(e=e.slice(s+1)),tr.hasOwnProperty(t)?{space:tr[t],local:e}:e}function Kl(e){return function(){var t=this.ownerDocument,s=this.namespaceURI;return s===ls&&t.documentElement.namespaceURI===ls?t.createElement(e):t.createElementNS(s,e)}}function ec(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function jo(e){var t=_n(e);return(t.local?ec:Kl)(t)}function tc(){}function Is(e){return e==null?tc:function(){return this.querySelector(e)}}function nc(e){typeof e!="function"&&(e=Is(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=new Array(i),c,d,h=0;h<i;++h)(c=a[h])&&(d=e.call(c,c.__data__,h,a))&&("__data__"in c&&(d.__data__=c.__data__),l[h]=d);return new Se(r,this._parents)}function sc(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function rc(){return[]}function No(e){return e==null?rc:function(){return this.querySelectorAll(e)}}function oc(e){return function(){return sc(e.apply(this,arguments))}}function ic(e){typeof e=="function"?e=oc(e):e=No(e);for(var t=this._groups,s=t.length,r=[],o=[],a=0;a<s;++a)for(var i=t[a],l=i.length,c,d=0;d<l;++d)(c=i[d])&&(r.push(e.call(c,c.__data__,d,i)),o.push(c));return new Se(r,o)}function ko(e){return function(){return this.matches(e)}}function Co(e){return function(t){return t.matches(e)}}var ac=Array.prototype.find;function lc(e){return function(){return ac.call(this.children,e)}}function cc(){return this.firstElementChild}function dc(e){return this.select(e==null?cc:lc(typeof e=="function"?e:Co(e)))}var uc=Array.prototype.filter;function hc(){return Array.from(this.children)}function fc(e){return function(){return uc.call(this.children,e)}}function mc(e){return this.selectAll(e==null?hc:fc(typeof e=="function"?e:Co(e)))}function pc(e){typeof e!="function"&&(e=ko(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=[],c,d=0;d<i;++d)(c=a[d])&&e.call(c,c.__data__,d,a)&&l.push(c);return new Se(r,this._parents)}function So(e){return new Array(e.length)}function xc(){return new Se(this._enter||this._groups.map(So),this._parents)}function hn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}hn.prototype={constructor:hn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function gc(e){return function(){return e}}function bc(e,t,s,r,o,a){for(var i=0,l,c=t.length,d=a.length;i<d;++i)(l=t[i])?(l.__data__=a[i],r[i]=l):s[i]=new hn(e,a[i]);for(;i<c;++i)(l=t[i])&&(o[i]=l)}function yc(e,t,s,r,o,a,i){var l,c,d=new Map,h=t.length,f=a.length,u=new Array(h),m;for(l=0;l<h;++l)(c=t[l])&&(u[l]=m=i.call(c,c.__data__,l,t)+"",d.has(m)?o[l]=c:d.set(m,c));for(l=0;l<f;++l)m=i.call(e,a[l],l,a)+"",(c=d.get(m))?(r[l]=c,c.__data__=a[l],d.delete(m)):s[l]=new hn(e,a[l]);for(l=0;l<h;++l)(c=t[l])&&d.get(u[l])===c&&(o[l]=c)}function vc(e){return e.__data__}function wc(e,t){if(!arguments.length)return Array.from(this,vc);var s=t?yc:bc,r=this._parents,o=this._groups;typeof e!="function"&&(e=gc(e));for(var a=o.length,i=new Array(a),l=new Array(a),c=new Array(a),d=0;d<a;++d){var h=r[d],f=o[d],u=f.length,m=jc(e.call(h,h&&h.__data__,d,r)),p=m.length,b=l[d]=new Array(p),g=i[d]=new Array(p),v=c[d]=new Array(u);s(h,f,b,g,v,m,t);for(var N=0,x=0,w,E;N<p;++N)if(w=b[N]){for(N>=x&&(x=N+1);!(E=g[x])&&++x<p;);w._next=E||null}}return i=new Se(i,r),i._enter=l,i._exit=c,i}function jc(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Nc(){return new Se(this._exit||this._groups.map(So),this._parents)}function kc(e,t,s){var r=this.enter(),o=this,a=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),s==null?a.remove():s(a),r&&o?r.merge(o).order():o}function Cc(e){for(var t=e.selection?e.selection():e,s=this._groups,r=t._groups,o=s.length,a=r.length,i=Math.min(o,a),l=new Array(o),c=0;c<i;++c)for(var d=s[c],h=r[c],f=d.length,u=l[c]=new Array(f),m,p=0;p<f;++p)(m=d[p]||h[p])&&(u[p]=m);for(;c<o;++c)l[c]=s[c];return new Se(l,this._parents)}function Sc(){for(var e=this._groups,t=-1,s=e.length;++t<s;)for(var r=e[t],o=r.length-1,a=r[o],i;--o>=0;)(i=r[o])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}function _c(e){e||(e=Ec);function t(f,u){return f&&u?e(f.__data__,u.__data__):!f-!u}for(var s=this._groups,r=s.length,o=new Array(r),a=0;a<r;++a){for(var i=s[a],l=i.length,c=o[a]=new Array(l),d,h=0;h<l;++h)(d=i[h])&&(c[h]=d);c.sort(t)}return new Se(o,this._parents).order()}function Ec(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ic(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Mc(){return Array.from(this)}function Ac(){for(var e=this._groups,t=0,s=e.length;t<s;++t)for(var r=e[t],o=0,a=r.length;o<a;++o){var i=r[o];if(i)return i}return null}function Tc(){let e=0;for(const t of this)++e;return e}function $c(){return!this.node()}function Pc(e){for(var t=this._groups,s=0,r=t.length;s<r;++s)for(var o=t[s],a=0,i=o.length,l;a<i;++a)(l=o[a])&&e.call(l,l.__data__,a,o);return this}function Dc(e){return function(){this.removeAttribute(e)}}function zc(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Rc(e,t){return function(){this.setAttribute(e,t)}}function Lc(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Bc(e,t){return function(){var s=t.apply(this,arguments);s==null?this.removeAttribute(e):this.setAttribute(e,s)}}function Hc(e,t){return function(){var s=t.apply(this,arguments);s==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,s)}}function Oc(e,t){var s=_n(e);if(arguments.length<2){var r=this.node();return s.local?r.getAttributeNS(s.space,s.local):r.getAttribute(s)}return this.each((t==null?s.local?zc:Dc:typeof t=="function"?s.local?Hc:Bc:s.local?Lc:Rc)(s,t))}function _o(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Vc(e){return function(){this.style.removeProperty(e)}}function Fc(e,t,s){return function(){this.style.setProperty(e,t,s)}}function Gc(e,t,s){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,s)}}function Yc(e,t,s){return arguments.length>1?this.each((t==null?Vc:typeof t=="function"?Gc:Fc)(e,t,s??"")):gt(this.node(),e)}function gt(e,t){return e.style.getPropertyValue(t)||_o(e).getComputedStyle(e,null).getPropertyValue(t)}function qc(e){return function(){delete this[e]}}function Zc(e,t){return function(){this[e]=t}}function Xc(e,t){return function(){var s=t.apply(this,arguments);s==null?delete this[e]:this[e]=s}}function Wc(e,t){return arguments.length>1?this.each((t==null?qc:typeof t=="function"?Xc:Zc)(e,t)):this.node()[e]}function Eo(e){return e.trim().split(/^|\s+/)}function Ms(e){return e.classList||new Io(e)}function Io(e){this._node=e,this._names=Eo(e.getAttribute("class")||"")}Io.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Mo(e,t){for(var s=Ms(e),r=-1,o=t.length;++r<o;)s.add(t[r])}function Ao(e,t){for(var s=Ms(e),r=-1,o=t.length;++r<o;)s.remove(t[r])}function Uc(e){return function(){Mo(this,e)}}function Jc(e){return function(){Ao(this,e)}}function Qc(e,t){return function(){(t.apply(this,arguments)?Mo:Ao)(this,e)}}function Kc(e,t){var s=Eo(e+"");if(arguments.length<2){for(var r=Ms(this.node()),o=-1,a=s.length;++o<a;)if(!r.contains(s[o]))return!1;return!0}return this.each((typeof t=="function"?Qc:t?Uc:Jc)(s,t))}function ed(){this.textContent=""}function td(e){return function(){this.textContent=e}}function nd(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function sd(e){return arguments.length?this.each(e==null?ed:(typeof e=="function"?nd:td)(e)):this.node().textContent}function rd(){this.innerHTML=""}function od(e){return function(){this.innerHTML=e}}function id(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function ad(e){return arguments.length?this.each(e==null?rd:(typeof e=="function"?id:od)(e)):this.node().innerHTML}function ld(){this.nextSibling&&this.parentNode.appendChild(this)}function cd(){return this.each(ld)}function dd(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ud(){return this.each(dd)}function hd(e){var t=typeof e=="function"?e:jo(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function fd(){return null}function md(e,t){var s=typeof e=="function"?e:jo(e),r=t==null?fd:typeof t=="function"?t:Is(t);return this.select(function(){return this.insertBefore(s.apply(this,arguments),r.apply(this,arguments)||null)})}function pd(){var e=this.parentNode;e&&e.removeChild(this)}function xd(){return this.each(pd)}function gd(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function bd(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function yd(e){return this.select(e?bd:gd)}function vd(e){return arguments.length?this.property("__data__",e):this.node().__data__}function wd(e){return function(t){e.call(this,t,this.__data__)}}function jd(e){return e.trim().split(/^|\s+/).map(function(t){var s="",r=t.indexOf(".");return r>=0&&(s=t.slice(r+1),t=t.slice(0,r)),{type:t,name:s}})}function Nd(e){return function(){var t=this.__on;if(t){for(var s=0,r=-1,o=t.length,a;s<o;++s)a=t[s],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++r]=a;++r?t.length=r:delete this.__on}}}function kd(e,t,s){return function(){var r=this.__on,o,a=wd(t);if(r){for(var i=0,l=r.length;i<l;++i)if((o=r[i]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=a,o.options=s),o.value=t;return}}this.addEventListener(e.type,a,s),o={type:e.type,name:e.name,value:t,listener:a,options:s},r?r.push(o):this.__on=[o]}}function Cd(e,t,s){var r=jd(e+""),o,a=r.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,h;c<d;++c)for(o=0,h=l[c];o<a;++o)if((i=r[o]).type===h.type&&i.name===h.name)return h.value}return}for(l=t?kd:Nd,o=0;o<a;++o)this.each(l(r[o],t,s));return this}function To(e,t,s){var r=_o(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,s):(o=r.document.createEvent("Event"),s?(o.initEvent(t,s.bubbles,s.cancelable),o.detail=s.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function Sd(e,t){return function(){return To(this,e,t)}}function _d(e,t){return function(){return To(this,e,t.apply(this,arguments))}}function Ed(e,t){return this.each((typeof t=="function"?_d:Sd)(e,t))}function*Id(){for(var e=this._groups,t=0,s=e.length;t<s;++t)for(var r=e[t],o=0,a=r.length,i;o<a;++o)(i=r[o])&&(yield i)}var $o=[null];function Se(e,t){this._groups=e,this._parents=t}function Ft(){return new Se([[document.documentElement]],$o)}function Md(){return this}Se.prototype=Ft.prototype={constructor:Se,select:nc,selectAll:ic,selectChild:dc,selectChildren:mc,filter:pc,data:wc,enter:xc,exit:Nc,join:kc,merge:Cc,selection:Md,order:Sc,sort:_c,call:Ic,nodes:Mc,node:Ac,size:Tc,empty:$c,each:Pc,attr:Oc,style:Yc,property:Wc,classed:Kc,text:sd,html:ad,raise:cd,lower:ud,append:hd,insert:md,remove:xd,clone:yd,datum:vd,on:Cd,dispatch:Ed,[Symbol.iterator]:Id};function Ce(e){return typeof e=="string"?new Se([[document.querySelector(e)]],[document.documentElement]):new Se([[e]],$o)}function Ad(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Ie(e,t){if(e=Ad(e),t===void 0&&(t=e.currentTarget),t){var s=t.ownerSVGElement||t;if(s.createSVGPoint){var r=s.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Td={passive:!1},Tt={capture:!0,passive:!1};function On(e){e.stopImmediatePropagation()}function pt(e){e.preventDefault(),e.stopImmediatePropagation()}function Po(e){var t=e.document.documentElement,s=Ce(e).on("dragstart.drag",pt,Tt);"onselectstart"in t?s.on("selectstart.drag",pt,Tt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Do(e,t){var s=e.document.documentElement,r=Ce(e).on("dragstart.drag",null);t&&(r.on("click.drag",pt,Tt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in s?r.on("selectstart.drag",null):(s.style.MozUserSelect=s.__noselect,delete s.__noselect)}const Jt=e=>()=>e;function cs(e,{sourceEvent:t,subject:s,target:r,identifier:o,active:a,x:i,y:l,dx:c,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:s,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}cs.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function $d(e){return!e.ctrlKey&&!e.button}function Pd(){return this.parentNode}function Dd(e,t){return t??{x:e.x,y:e.y}}function zd(){return navigator.maxTouchPoints||"ontouchstart"in this}function zo(){var e=$d,t=Pd,s=Dd,r=zd,o={},a=Sn("start","drag","end"),i=0,l,c,d,h,f=0;function u(w){w.on("mousedown.drag",m).filter(r).on("touchstart.drag",g).on("touchmove.drag",v,Td).on("touchend.drag touchcancel.drag",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(w,E){if(!(h||!e.call(this,w,E))){var k=x(this,t.call(this,w,E),w,E,"mouse");k&&(Ce(w.view).on("mousemove.drag",p,Tt).on("mouseup.drag",b,Tt),Po(w.view),On(w),d=!1,l=w.clientX,c=w.clientY,k("start",w))}}function p(w){if(pt(w),!d){var E=w.clientX-l,k=w.clientY-c;d=E*E+k*k>f}o.mouse("drag",w)}function b(w){Ce(w.view).on("mousemove.drag mouseup.drag",null),Do(w.view,d),pt(w),o.mouse("end",w)}function g(w,E){if(e.call(this,w,E)){var k=w.changedTouches,I=t.call(this,w,E),T=k.length,P,R;for(P=0;P<T;++P)(R=x(this,I,w,E,k[P].identifier,k[P]))&&(On(w),R("start",w,k[P]))}}function v(w){var E=w.changedTouches,k=E.length,I,T;for(I=0;I<k;++I)(T=o[E[I].identifier])&&(pt(w),T("drag",w,E[I]))}function N(w){var E=w.changedTouches,k=E.length,I,T;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),I=0;I<k;++I)(T=o[E[I].identifier])&&(On(w),T("end",w,E[I]))}function x(w,E,k,I,T,P){var R=a.copy(),C=Ie(P||k,E),z,L,j;if((j=s.call(w,new cs("beforestart",{sourceEvent:k,target:u,identifier:T,active:i,x:C[0],y:C[1],dx:0,dy:0,dispatch:R}),I))!=null)return z=j.x-C[0]||0,L=j.y-C[1]||0,function M(_,A,S){var $=C,H;switch(_){case"start":o[T]=M,H=i++;break;case"end":delete o[T],--i;case"drag":C=Ie(S||A,E),H=i;break}R.call(_,w,new cs(_,{sourceEvent:A,subject:j,target:u,identifier:T,active:H,x:C[0]+z,y:C[1]+L,dx:C[0]-$[0],dy:C[1]-$[1],dispatch:R}),I)}}return u.filter=function(w){return arguments.length?(e=typeof w=="function"?w:Jt(!!w),u):e},u.container=function(w){return arguments.length?(t=typeof w=="function"?w:Jt(w),u):t},u.subject=function(w){return arguments.length?(s=typeof w=="function"?w:Jt(w),u):s},u.touchable=function(w){return arguments.length?(r=typeof w=="function"?w:Jt(!!w),u):r},u.on=function(){var w=a.on.apply(a,arguments);return w===a?u:w},u.clickDistance=function(w){return arguments.length?(f=(w=+w)*w,u):Math.sqrt(f)},u}function As(e,t,s){e.prototype=t.prototype=s,s.constructor=e}function Ro(e,t){var s=Object.create(e.prototype);for(var r in t)s[r]=t[r];return s}function Gt(){}var $t=.7,fn=1/$t,xt="\\s*([+-]?\\d+)\\s*",Pt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ze="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Rd=/^#([0-9a-f]{3,8})$/,Ld=new RegExp(`^rgb\\(${xt},${xt},${xt}\\)$`),Bd=new RegExp(`^rgb\\(${ze},${ze},${ze}\\)$`),Hd=new RegExp(`^rgba\\(${xt},${xt},${xt},${Pt}\\)$`),Od=new RegExp(`^rgba\\(${ze},${ze},${ze},${Pt}\\)$`),Vd=new RegExp(`^hsl\\(${Pt},${ze},${ze}\\)$`),Fd=new RegExp(`^hsla\\(${Pt},${ze},${ze},${Pt}\\)$`),nr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};As(Gt,at,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:sr,formatHex:sr,formatHex8:Gd,formatHsl:Yd,formatRgb:rr,toString:rr});function sr(){return this.rgb().formatHex()}function Gd(){return this.rgb().formatHex8()}function Yd(){return Lo(this).formatHsl()}function rr(){return this.rgb().formatRgb()}function at(e){var t,s;return e=(e+"").trim().toLowerCase(),(t=Rd.exec(e))?(s=t[1].length,t=parseInt(t[1],16),s===6?or(t):s===3?new Ne(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):s===8?Qt(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):s===4?Qt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ld.exec(e))?new Ne(t[1],t[2],t[3],1):(t=Bd.exec(e))?new Ne(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Hd.exec(e))?Qt(t[1],t[2],t[3],t[4]):(t=Od.exec(e))?Qt(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Vd.exec(e))?lr(t[1],t[2]/100,t[3]/100,1):(t=Fd.exec(e))?lr(t[1],t[2]/100,t[3]/100,t[4]):nr.hasOwnProperty(e)?or(nr[e]):e==="transparent"?new Ne(NaN,NaN,NaN,0):null}function or(e){return new Ne(e>>16&255,e>>8&255,e&255,1)}function Qt(e,t,s,r){return r<=0&&(e=t=s=NaN),new Ne(e,t,s,r)}function qd(e){return e instanceof Gt||(e=at(e)),e?(e=e.rgb(),new Ne(e.r,e.g,e.b,e.opacity)):new Ne}function ds(e,t,s,r){return arguments.length===1?qd(e):new Ne(e,t,s,r??1)}function Ne(e,t,s,r){this.r=+e,this.g=+t,this.b=+s,this.opacity=+r}As(Ne,ds,Ro(Gt,{brighter(e){return e=e==null?fn:Math.pow(fn,e),new Ne(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?$t:Math.pow($t,e),new Ne(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ne(ot(this.r),ot(this.g),ot(this.b),mn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ir,formatHex:ir,formatHex8:Zd,formatRgb:ar,toString:ar}));function ir(){return`#${rt(this.r)}${rt(this.g)}${rt(this.b)}`}function Zd(){return`#${rt(this.r)}${rt(this.g)}${rt(this.b)}${rt((isNaN(this.opacity)?1:this.opacity)*255)}`}function ar(){const e=mn(this.opacity);return`${e===1?"rgb(":"rgba("}${ot(this.r)}, ${ot(this.g)}, ${ot(this.b)}${e===1?")":`, ${e})`}`}function mn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ot(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function rt(e){return e=ot(e),(e<16?"0":"")+e.toString(16)}function lr(e,t,s,r){return r<=0?e=t=s=NaN:s<=0||s>=1?e=t=NaN:t<=0&&(e=NaN),new Me(e,t,s,r)}function Lo(e){if(e instanceof Me)return new Me(e.h,e.s,e.l,e.opacity);if(e instanceof Gt||(e=at(e)),!e)return new Me;if(e instanceof Me)return e;e=e.rgb();var t=e.r/255,s=e.g/255,r=e.b/255,o=Math.min(t,s,r),a=Math.max(t,s,r),i=NaN,l=a-o,c=(a+o)/2;return l?(t===a?i=(s-r)/l+(s<r)*6:s===a?i=(r-t)/l+2:i=(t-s)/l+4,l/=c<.5?a+o:2-a-o,i*=60):l=c>0&&c<1?0:i,new Me(i,l,c,e.opacity)}function Xd(e,t,s,r){return arguments.length===1?Lo(e):new Me(e,t,s,r??1)}function Me(e,t,s,r){this.h=+e,this.s=+t,this.l=+s,this.opacity=+r}As(Me,Xd,Ro(Gt,{brighter(e){return e=e==null?fn:Math.pow(fn,e),new Me(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?$t:Math.pow($t,e),new Me(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,s=this.l,r=s+(s<.5?s:1-s)*t,o=2*s-r;return new Ne(Vn(e>=240?e-240:e+120,o,r),Vn(e,o,r),Vn(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new Me(cr(this.h),Kt(this.s),Kt(this.l),mn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=mn(this.opacity);return`${e===1?"hsl(":"hsla("}${cr(this.h)}, ${Kt(this.s)*100}%, ${Kt(this.l)*100}%${e===1?")":`, ${e})`}`}}));function cr(e){return e=(e||0)%360,e<0?e+360:e}function Kt(e){return Math.max(0,Math.min(1,e||0))}function Vn(e,t,s){return(e<60?t+(s-t)*e/60:e<180?s:e<240?t+(s-t)*(240-e)/60:t)*255}const Ts=e=>()=>e;function Wd(e,t){return function(s){return e+s*t}}function Ud(e,t,s){return e=Math.pow(e,s),t=Math.pow(t,s)-e,s=1/s,function(r){return Math.pow(e+r*t,s)}}function Jd(e){return(e=+e)==1?Bo:function(t,s){return s-t?Ud(t,s,e):Ts(isNaN(t)?s:t)}}function Bo(e,t){var s=t-e;return s?Wd(e,s):Ts(isNaN(e)?t:e)}const pn=(function e(t){var s=Jd(t);function r(o,a){var i=s((o=ds(o)).r,(a=ds(a)).r),l=s(o.g,a.g),c=s(o.b,a.b),d=Bo(o.opacity,a.opacity);return function(h){return o.r=i(h),o.g=l(h),o.b=c(h),o.opacity=d(h),o+""}}return r.gamma=e,r})(1);function Qd(e,t){t||(t=[]);var s=e?Math.min(t.length,e.length):0,r=t.slice(),o;return function(a){for(o=0;o<s;++o)r[o]=e[o]*(1-a)+t[o]*a;return r}}function Kd(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function eu(e,t){var s=t?t.length:0,r=e?Math.min(s,e.length):0,o=new Array(r),a=new Array(s),i;for(i=0;i<r;++i)o[i]=Mt(e[i],t[i]);for(;i<s;++i)a[i]=t[i];return function(l){for(i=0;i<r;++i)a[i]=o[i](l);return a}}function tu(e,t){var s=new Date;return e=+e,t=+t,function(r){return s.setTime(e*(1-r)+t*r),s}}function De(e,t){return e=+e,t=+t,function(s){return e*(1-s)+t*s}}function nu(e,t){var s={},r={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?s[o]=Mt(e[o],t[o]):r[o]=t[o];return function(a){for(o in s)r[o]=s[o](a);return r}}var us=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Fn=new RegExp(us.source,"g");function su(e){return function(){return e}}function ru(e){return function(t){return e(t)+""}}function Ho(e,t){var s=us.lastIndex=Fn.lastIndex=0,r,o,a,i=-1,l=[],c=[];for(e=e+"",t=t+"";(r=us.exec(e))&&(o=Fn.exec(t));)(a=o.index)>s&&(a=t.slice(s,a),l[i]?l[i]+=a:l[++i]=a),(r=r[0])===(o=o[0])?l[i]?l[i]+=o:l[++i]=o:(l[++i]=null,c.push({i,x:De(r,o)})),s=Fn.lastIndex;return s<t.length&&(a=t.slice(s),l[i]?l[i]+=a:l[++i]=a),l.length<2?c[0]?ru(c[0].x):su(t):(t=c.length,function(d){for(var h=0,f;h<t;++h)l[(f=c[h]).i]=f.x(d);return l.join("")})}function Mt(e,t){var s=typeof t,r;return t==null||s==="boolean"?Ts(t):(s==="number"?De:s==="string"?(r=at(t))?(t=r,pn):Ho:t instanceof at?pn:t instanceof Date?tu:Kd(t)?Qd:Array.isArray(t)?eu:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?nu:De)(e,t)}var dr=180/Math.PI,hs={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Oo(e,t,s,r,o,a){var i,l,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*s+t*r)&&(s-=e*c,r-=t*c),(l=Math.sqrt(s*s+r*r))&&(s/=l,r/=l,c/=l),e*r<t*s&&(e=-e,t=-t,c=-c,i=-i),{translateX:o,translateY:a,rotate:Math.atan2(t,e)*dr,skewX:Math.atan(c)*dr,scaleX:i,scaleY:l}}var en;function ou(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?hs:Oo(t.a,t.b,t.c,t.d,t.e,t.f)}function iu(e){return e==null||(en||(en=document.createElementNS("http://www.w3.org/2000/svg","g")),en.setAttribute("transform",e),!(e=en.transform.baseVal.consolidate()))?hs:(e=e.matrix,Oo(e.a,e.b,e.c,e.d,e.e,e.f))}function Vo(e,t,s,r){function o(d){return d.length?d.pop()+" ":""}function a(d,h,f,u,m,p){if(d!==f||h!==u){var b=m.push("translate(",null,t,null,s);p.push({i:b-4,x:De(d,f)},{i:b-2,x:De(h,u)})}else(f||u)&&m.push("translate("+f+t+u+s)}function i(d,h,f,u){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),u.push({i:f.push(o(f)+"rotate(",null,r)-2,x:De(d,h)})):h&&f.push(o(f)+"rotate("+h+r)}function l(d,h,f,u){d!==h?u.push({i:f.push(o(f)+"skewX(",null,r)-2,x:De(d,h)}):h&&f.push(o(f)+"skewX("+h+r)}function c(d,h,f,u,m,p){if(d!==f||h!==u){var b=m.push(o(m)+"scale(",null,",",null,")");p.push({i:b-4,x:De(d,f)},{i:b-2,x:De(h,u)})}else(f!==1||u!==1)&&m.push(o(m)+"scale("+f+","+u+")")}return function(d,h){var f=[],u=[];return d=e(d),h=e(h),a(d.translateX,d.translateY,h.translateX,h.translateY,f,u),i(d.rotate,h.rotate,f,u),l(d.skewX,h.skewX,f,u),c(d.scaleX,d.scaleY,h.scaleX,h.scaleY,f,u),d=h=null,function(m){for(var p=-1,b=u.length,g;++p<b;)f[(g=u[p]).i]=g.x(m);return f.join("")}}}var au=Vo(ou,"px, ","px)","deg)"),lu=Vo(iu,", ",")",")"),cu=1e-12;function ur(e){return((e=Math.exp(e))+1/e)/2}function du(e){return((e=Math.exp(e))-1/e)/2}function uu(e){return((e=Math.exp(2*e))-1)/(e+1)}const ln=(function e(t,s,r){function o(a,i){var l=a[0],c=a[1],d=a[2],h=i[0],f=i[1],u=i[2],m=h-l,p=f-c,b=m*m+p*p,g,v;if(b<cu)v=Math.log(u/d)/t,g=function(I){return[l+I*m,c+I*p,d*Math.exp(t*I*v)]};else{var N=Math.sqrt(b),x=(u*u-d*d+r*b)/(2*d*s*N),w=(u*u-d*d-r*b)/(2*u*s*N),E=Math.log(Math.sqrt(x*x+1)-x),k=Math.log(Math.sqrt(w*w+1)-w);v=(k-E)/t,g=function(I){var T=I*v,P=ur(E),R=d/(s*N)*(P*uu(t*T+E)-du(E));return[l+R*m,c+R*p,d*P/ur(t*T+E)]}}return g.duration=v*1e3*t/Math.SQRT2,g}return o.rho=function(a){var i=Math.max(.001,+a),l=i*i,c=l*l;return e(i,l,c)},o})(Math.SQRT2,2,4);var bt=0,Et=0,St=0,Fo=1e3,xn,It,gn=0,lt=0,En=0,Dt=typeof performance=="object"&&performance.now?performance:Date,Go=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function $s(){return lt||(Go(hu),lt=Dt.now()+En)}function hu(){lt=0}function bn(){this._call=this._time=this._next=null}bn.prototype=Yo.prototype={constructor:bn,restart:function(e,t,s){if(typeof e!="function")throw new TypeError("callback is not a function");s=(s==null?$s():+s)+(t==null?0:+t),!this._next&&It!==this&&(It?It._next=this:xn=this,It=this),this._call=e,this._time=s,fs()},stop:function(){this._call&&(this._call=null,this._time=1/0,fs())}};function Yo(e,t,s){var r=new bn;return r.restart(e,t,s),r}function fu(){$s(),++bt;for(var e=xn,t;e;)(t=lt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--bt}function hr(){lt=(gn=Dt.now())+En,bt=Et=0;try{fu()}finally{bt=0,pu(),lt=0}}function mu(){var e=Dt.now(),t=e-gn;t>Fo&&(En-=t,gn=e)}function pu(){for(var e,t=xn,s,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(s=t._next,t._next=null,t=e?e._next=s:xn=s);It=e,fs(r)}function fs(e){if(!bt){Et&&(Et=clearTimeout(Et));var t=e-lt;t>24?(e<1/0&&(Et=setTimeout(hr,e-Dt.now()-En)),St&&(St=clearInterval(St))):(St||(gn=Dt.now(),St=setInterval(mu,Fo)),bt=1,Go(hr))}}function fr(e,t,s){var r=new bn;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,s),r}var xu=Sn("start","end","cancel","interrupt"),gu=[],qo=0,mr=1,ms=2,cn=3,pr=4,ps=5,dn=6;function In(e,t,s,r,o,a){var i=e.__transition;if(!i)e.__transition={};else if(s in i)return;bu(e,s,{name:t,index:r,group:o,on:xu,tween:gu,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:qo})}function Ps(e,t){var s=Pe(e,t);if(s.state>qo)throw new Error("too late; already scheduled");return s}function Le(e,t){var s=Pe(e,t);if(s.state>cn)throw new Error("too late; already running");return s}function Pe(e,t){var s=e.__transition;if(!s||!(s=s[t]))throw new Error("transition not found");return s}function bu(e,t,s){var r=e.__transition,o;r[t]=s,s.timer=Yo(a,0,s.time);function a(d){s.state=mr,s.timer.restart(i,s.delay,s.time),s.delay<=d&&i(d-s.delay)}function i(d){var h,f,u,m;if(s.state!==mr)return c();for(h in r)if(m=r[h],m.name===s.name){if(m.state===cn)return fr(i);m.state===pr?(m.state=dn,m.timer.stop(),m.on.call("interrupt",e,e.__data__,m.index,m.group),delete r[h]):+h<t&&(m.state=dn,m.timer.stop(),m.on.call("cancel",e,e.__data__,m.index,m.group),delete r[h])}if(fr(function(){s.state===cn&&(s.state=pr,s.timer.restart(l,s.delay,s.time),l(d))}),s.state=ms,s.on.call("start",e,e.__data__,s.index,s.group),s.state===ms){for(s.state=cn,o=new Array(u=s.tween.length),h=0,f=-1;h<u;++h)(m=s.tween[h].value.call(e,e.__data__,s.index,s.group))&&(o[++f]=m);o.length=f+1}}function l(d){for(var h=d<s.duration?s.ease.call(null,d/s.duration):(s.timer.restart(c),s.state=ps,1),f=-1,u=o.length;++f<u;)o[f].call(e,h);s.state===ps&&(s.on.call("end",e,e.__data__,s.index,s.group),c())}function c(){s.state=dn,s.timer.stop(),delete r[t];for(var d in r)return;delete e.__transition}}function un(e,t){var s=e.__transition,r,o,a=!0,i;if(s){t=t==null?null:t+"";for(i in s){if((r=s[i]).name!==t){a=!1;continue}o=r.state>ms&&r.state<ps,r.state=dn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete s[i]}a&&delete e.__transition}}function yu(e){return this.each(function(){un(this,e)})}function vu(e,t){var s,r;return function(){var o=Le(this,e),a=o.tween;if(a!==s){r=s=a;for(var i=0,l=r.length;i<l;++i)if(r[i].name===t){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function wu(e,t,s){var r,o;if(typeof s!="function")throw new Error;return function(){var a=Le(this,e),i=a.tween;if(i!==r){o=(r=i).slice();for(var l={name:t,value:s},c=0,d=o.length;c<d;++c)if(o[c].name===t){o[c]=l;break}c===d&&o.push(l)}a.tween=o}}function ju(e,t){var s=this._id;if(e+="",arguments.length<2){for(var r=Pe(this.node(),s).tween,o=0,a=r.length,i;o<a;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((t==null?vu:wu)(s,e,t))}function Ds(e,t,s){var r=e._id;return e.each(function(){var o=Le(this,r);(o.value||(o.value={}))[t]=s.apply(this,arguments)}),function(o){return Pe(o,r).value[t]}}function Zo(e,t){var s;return(typeof t=="number"?De:t instanceof at?pn:(s=at(t))?(t=s,pn):Ho)(e,t)}function Nu(e){return function(){this.removeAttribute(e)}}function ku(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Cu(e,t,s){var r,o=s+"",a;return function(){var i=this.getAttribute(e);return i===o?null:i===r?a:a=t(r=i,s)}}function Su(e,t,s){var r,o=s+"",a;return function(){var i=this.getAttributeNS(e.space,e.local);return i===o?null:i===r?a:a=t(r=i,s)}}function _u(e,t,s){var r,o,a;return function(){var i,l=s(this),c;return l==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=l+"",i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l)))}}function Eu(e,t,s){var r,o,a;return function(){var i,l=s(this),c;return l==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=l+"",i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l)))}}function Iu(e,t){var s=_n(e),r=s==="transform"?lu:Zo;return this.attrTween(e,typeof t=="function"?(s.local?Eu:_u)(s,r,Ds(this,"attr."+e,t)):t==null?(s.local?ku:Nu)(s):(s.local?Su:Cu)(s,r,t))}function Mu(e,t){return function(s){this.setAttribute(e,t.call(this,s))}}function Au(e,t){return function(s){this.setAttributeNS(e.space,e.local,t.call(this,s))}}function Tu(e,t){var s,r;function o(){var a=t.apply(this,arguments);return a!==r&&(s=(r=a)&&Au(e,a)),s}return o._value=t,o}function $u(e,t){var s,r;function o(){var a=t.apply(this,arguments);return a!==r&&(s=(r=a)&&Mu(e,a)),s}return o._value=t,o}function Pu(e,t){var s="attr."+e;if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;var r=_n(e);return this.tween(s,(r.local?Tu:$u)(r,t))}function Du(e,t){return function(){Ps(this,e).delay=+t.apply(this,arguments)}}function zu(e,t){return t=+t,function(){Ps(this,e).delay=t}}function Ru(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Du:zu)(t,e)):Pe(this.node(),t).delay}function Lu(e,t){return function(){Le(this,e).duration=+t.apply(this,arguments)}}function Bu(e,t){return t=+t,function(){Le(this,e).duration=t}}function Hu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Lu:Bu)(t,e)):Pe(this.node(),t).duration}function Ou(e,t){if(typeof t!="function")throw new Error;return function(){Le(this,e).ease=t}}function Vu(e){var t=this._id;return arguments.length?this.each(Ou(t,e)):Pe(this.node(),t).ease}function Fu(e,t){return function(){var s=t.apply(this,arguments);if(typeof s!="function")throw new Error;Le(this,e).ease=s}}function Gu(e){if(typeof e!="function")throw new Error;return this.each(Fu(this._id,e))}function Yu(e){typeof e!="function"&&(e=ko(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=[],c,d=0;d<i;++d)(c=a[d])&&e.call(c,c.__data__,d,a)&&l.push(c);return new Fe(r,this._parents,this._name,this._id)}function qu(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,s=e._groups,r=t.length,o=s.length,a=Math.min(r,o),i=new Array(r),l=0;l<a;++l)for(var c=t[l],d=s[l],h=c.length,f=i[l]=new Array(h),u,m=0;m<h;++m)(u=c[m]||d[m])&&(f[m]=u);for(;l<r;++l)i[l]=t[l];return new Fe(i,this._parents,this._name,this._id)}function Zu(e){return(e+"").trim().split(/^|\s+/).every(function(t){var s=t.indexOf(".");return s>=0&&(t=t.slice(0,s)),!t||t==="start"})}function Xu(e,t,s){var r,o,a=Zu(t)?Ps:Le;return function(){var i=a(this,e),l=i.on;l!==r&&(o=(r=l).copy()).on(t,s),i.on=o}}function Wu(e,t){var s=this._id;return arguments.length<2?Pe(this.node(),s).on.on(e):this.each(Xu(s,e,t))}function Uu(e){return function(){var t=this.parentNode;for(var s in this.__transition)if(+s!==e)return;t&&t.removeChild(this)}}function Ju(){return this.on("end.remove",Uu(this._id))}function Qu(e){var t=this._name,s=this._id;typeof e!="function"&&(e=Is(e));for(var r=this._groups,o=r.length,a=new Array(o),i=0;i<o;++i)for(var l=r[i],c=l.length,d=a[i]=new Array(c),h,f,u=0;u<c;++u)(h=l[u])&&(f=e.call(h,h.__data__,u,l))&&("__data__"in h&&(f.__data__=h.__data__),d[u]=f,In(d[u],t,s,u,d,Pe(h,s)));return new Fe(a,this._parents,t,s)}function Ku(e){var t=this._name,s=this._id;typeof e!="function"&&(e=No(e));for(var r=this._groups,o=r.length,a=[],i=[],l=0;l<o;++l)for(var c=r[l],d=c.length,h,f=0;f<d;++f)if(h=c[f]){for(var u=e.call(h,h.__data__,f,c),m,p=Pe(h,s),b=0,g=u.length;b<g;++b)(m=u[b])&&In(m,t,s,b,u,p);a.push(u),i.push(h)}return new Fe(a,i,t,s)}var eh=Ft.prototype.constructor;function th(){return new eh(this._groups,this._parents)}function nh(e,t){var s,r,o;return function(){var a=gt(this,e),i=(this.style.removeProperty(e),gt(this,e));return a===i?null:a===s&&i===r?o:o=t(s=a,r=i)}}function Xo(e){return function(){this.style.removeProperty(e)}}function sh(e,t,s){var r,o=s+"",a;return function(){var i=gt(this,e);return i===o?null:i===r?a:a=t(r=i,s)}}function rh(e,t,s){var r,o,a;return function(){var i=gt(this,e),l=s(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(e),gt(this,e))),i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l))}}function oh(e,t){var s,r,o,a="style."+t,i="end."+a,l;return function(){var c=Le(this,e),d=c.on,h=c.value[a]==null?l||(l=Xo(t)):void 0;(d!==s||o!==h)&&(r=(s=d).copy()).on(i,o=h),c.on=r}}function ih(e,t,s){var r=(e+="")=="transform"?au:Zo;return t==null?this.styleTween(e,nh(e,r)).on("end.style."+e,Xo(e)):typeof t=="function"?this.styleTween(e,rh(e,r,Ds(this,"style."+e,t))).each(oh(this._id,e)):this.styleTween(e,sh(e,r,t),s).on("end.style."+e,null)}function ah(e,t,s){return function(r){this.style.setProperty(e,t.call(this,r),s)}}function lh(e,t,s){var r,o;function a(){var i=t.apply(this,arguments);return i!==o&&(r=(o=i)&&ah(e,i,s)),r}return a._value=t,a}function ch(e,t,s){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,lh(e,t,s??""))}function dh(e){return function(){this.textContent=e}}function uh(e){return function(){var t=e(this);this.textContent=t??""}}function hh(e){return this.tween("text",typeof e=="function"?uh(Ds(this,"text",e)):dh(e==null?"":e+""))}function fh(e){return function(t){this.textContent=e.call(this,t)}}function mh(e){var t,s;function r(){var o=e.apply(this,arguments);return o!==s&&(t=(s=o)&&fh(o)),t}return r._value=e,r}function ph(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,mh(e))}function xh(){for(var e=this._name,t=this._id,s=Wo(),r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],l=i.length,c,d=0;d<l;++d)if(c=i[d]){var h=Pe(c,t);In(c,e,s,d,i,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Fe(r,this._parents,e,s)}function gh(){var e,t,s=this,r=s._id,o=s.size();return new Promise(function(a,i){var l={value:i},c={value:function(){--o===0&&a()}};s.each(function(){var d=Le(this,r),h=d.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(c)),d.on=t}),o===0&&a()})}var bh=0;function Fe(e,t,s,r){this._groups=e,this._parents=t,this._name=s,this._id=r}function Wo(){return++bh}var Oe=Ft.prototype;Fe.prototype={constructor:Fe,select:Qu,selectAll:Ku,selectChild:Oe.selectChild,selectChildren:Oe.selectChildren,filter:Yu,merge:qu,selection:th,transition:xh,call:Oe.call,nodes:Oe.nodes,node:Oe.node,size:Oe.size,empty:Oe.empty,each:Oe.each,on:Wu,attr:Iu,attrTween:Pu,style:ih,styleTween:ch,text:hh,textTween:ph,remove:Ju,tween:ju,delay:Ru,duration:Hu,ease:Vu,easeVarying:Gu,end:gh,[Symbol.iterator]:Oe[Symbol.iterator]};function yh(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var vh={time:null,delay:0,duration:250,ease:yh};function wh(e,t){for(var s;!(s=e.__transition)||!(s=s[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return s}function jh(e){var t,s;e instanceof Fe?(t=e._id,e=e._name):(t=Wo(),(s=vh).time=$s(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],l=i.length,c,d=0;d<l;++d)(c=i[d])&&In(c,e,t,d,i,s||wh(c,t));return new Fe(r,this._parents,e,t)}Ft.prototype.interrupt=yu;Ft.prototype.transition=jh;const tn=e=>()=>e;function Nh(e,{sourceEvent:t,target:s,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function Ve(e,t,s){this.k=e,this.x=t,this.y=s}Ve.prototype={constructor:Ve,scale:function(e){return e===1?this:new Ve(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Ve(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Mn=new Ve(1,0,0);Uo.prototype=Ve.prototype;function Uo(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Mn;return e.__zoom}function Gn(e){e.stopImmediatePropagation()}function _t(e){e.preventDefault(),e.stopImmediatePropagation()}function kh(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Ch(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function xr(){return this.__zoom||Mn}function Sh(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function _h(){return navigator.maxTouchPoints||"ontouchstart"in this}function Eh(e,t,s){var r=e.invertX(t[0][0])-s[0][0],o=e.invertX(t[1][0])-s[1][0],a=e.invertY(t[0][1])-s[0][1],i=e.invertY(t[1][1])-s[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),i>a?(a+i)/2:Math.min(0,a)||Math.max(0,i))}function Jo(){var e=kh,t=Ch,s=Eh,r=Sh,o=_h,a=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,c=ln,d=Sn("start","zoom","end"),h,f,u,m=500,p=150,b=0,g=10;function v(j){j.property("__zoom",xr).on("wheel.zoom",T,{passive:!1}).on("mousedown.zoom",P).on("dblclick.zoom",R).filter(o).on("touchstart.zoom",C).on("touchmove.zoom",z).on("touchend.zoom touchcancel.zoom",L).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(j,M,_,A){var S=j.selection?j.selection():j;S.property("__zoom",xr),j!==S?E(j,M,_,A):S.interrupt().each(function(){k(this,arguments).event(A).start().zoom(null,typeof M=="function"?M.apply(this,arguments):M).end()})},v.scaleBy=function(j,M,_,A){v.scaleTo(j,function(){var S=this.__zoom.k,$=typeof M=="function"?M.apply(this,arguments):M;return S*$},_,A)},v.scaleTo=function(j,M,_,A){v.transform(j,function(){var S=t.apply(this,arguments),$=this.__zoom,H=_==null?w(S):typeof _=="function"?_.apply(this,arguments):_,F=$.invert(H),O=typeof M=="function"?M.apply(this,arguments):M;return s(x(N($,O),H,F),S,i)},_,A)},v.translateBy=function(j,M,_,A){v.transform(j,function(){return s(this.__zoom.translate(typeof M=="function"?M.apply(this,arguments):M,typeof _=="function"?_.apply(this,arguments):_),t.apply(this,arguments),i)},null,A)},v.translateTo=function(j,M,_,A,S){v.transform(j,function(){var $=t.apply(this,arguments),H=this.__zoom,F=A==null?w($):typeof A=="function"?A.apply(this,arguments):A;return s(Mn.translate(F[0],F[1]).scale(H.k).translate(typeof M=="function"?-M.apply(this,arguments):-M,typeof _=="function"?-_.apply(this,arguments):-_),$,i)},A,S)};function N(j,M){return M=Math.max(a[0],Math.min(a[1],M)),M===j.k?j:new Ve(M,j.x,j.y)}function x(j,M,_){var A=M[0]-_[0]*j.k,S=M[1]-_[1]*j.k;return A===j.x&&S===j.y?j:new Ve(j.k,A,S)}function w(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function E(j,M,_,A){j.on("start.zoom",function(){k(this,arguments).event(A).start()}).on("interrupt.zoom end.zoom",function(){k(this,arguments).event(A).end()}).tween("zoom",function(){var S=this,$=arguments,H=k(S,$).event(A),F=t.apply(S,$),O=_==null?w(F):typeof _=="function"?_.apply(S,$):_,G=Math.max(F[1][0]-F[0][0],F[1][1]-F[0][1]),Y=S.__zoom,ee=typeof M=="function"?M.apply(S,$):M,K=c(Y.invert(O).concat(G/Y.k),ee.invert(O).concat(G/ee.k));return function(B){if(B===1)B=ee;else{var D=K(B),X=G/D[2];B=new Ve(X,O[0]-D[0]*X,O[1]-D[1]*X)}H.zoom(null,B)}})}function k(j,M,_){return!_&&j.__zooming||new I(j,M)}function I(j,M){this.that=j,this.args=M,this.active=0,this.sourceEvent=null,this.extent=t.apply(j,M),this.taps=0}I.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,M){return this.mouse&&j!=="mouse"&&(this.mouse[1]=M.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=M.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=M.invert(this.touch1[0])),this.that.__zoom=M,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var M=Ce(this.that).datum();d.call(j,this.that,new Nh(j,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:d}),M)}};function T(j,...M){if(!e.apply(this,arguments))return;var _=k(this,M).event(j),A=this.__zoom,S=Math.max(a[0],Math.min(a[1],A.k*Math.pow(2,r.apply(this,arguments)))),$=Ie(j);if(_.wheel)(_.mouse[0][0]!==$[0]||_.mouse[0][1]!==$[1])&&(_.mouse[1]=A.invert(_.mouse[0]=$)),clearTimeout(_.wheel);else{if(A.k===S)return;_.mouse=[$,A.invert($)],un(this),_.start()}_t(j),_.wheel=setTimeout(H,p),_.zoom("mouse",s(x(N(A,S),_.mouse[0],_.mouse[1]),_.extent,i));function H(){_.wheel=null,_.end()}}function P(j,...M){if(u||!e.apply(this,arguments))return;var _=j.currentTarget,A=k(this,M,!0).event(j),S=Ce(j.view).on("mousemove.zoom",O,!0).on("mouseup.zoom",G,!0),$=Ie(j,_),H=j.clientX,F=j.clientY;Po(j.view),Gn(j),A.mouse=[$,this.__zoom.invert($)],un(this),A.start();function O(Y){if(_t(Y),!A.moved){var ee=Y.clientX-H,K=Y.clientY-F;A.moved=ee*ee+K*K>b}A.event(Y).zoom("mouse",s(x(A.that.__zoom,A.mouse[0]=Ie(Y,_),A.mouse[1]),A.extent,i))}function G(Y){S.on("mousemove.zoom mouseup.zoom",null),Do(Y.view,A.moved),_t(Y),A.event(Y).end()}}function R(j,...M){if(e.apply(this,arguments)){var _=this.__zoom,A=Ie(j.changedTouches?j.changedTouches[0]:j,this),S=_.invert(A),$=_.k*(j.shiftKey?.5:2),H=s(x(N(_,$),A,S),t.apply(this,M),i);_t(j),l>0?Ce(this).transition().duration(l).call(E,H,A,j):Ce(this).call(v.transform,H,A,j)}}function C(j,...M){if(e.apply(this,arguments)){var _=j.touches,A=_.length,S=k(this,M,j.changedTouches.length===A).event(j),$,H,F,O;for(Gn(j),H=0;H<A;++H)F=_[H],O=Ie(F,this),O=[O,this.__zoom.invert(O),F.identifier],S.touch0?!S.touch1&&S.touch0[2]!==O[2]&&(S.touch1=O,S.taps=0):(S.touch0=O,$=!0,S.taps=1+!!h);h&&(h=clearTimeout(h)),$&&(S.taps<2&&(f=O[0],h=setTimeout(function(){h=null},m)),un(this),S.start())}}function z(j,...M){if(this.__zooming){var _=k(this,M).event(j),A=j.changedTouches,S=A.length,$,H,F,O;for(_t(j),$=0;$<S;++$)H=A[$],F=Ie(H,this),_.touch0&&_.touch0[2]===H.identifier?_.touch0[0]=F:_.touch1&&_.touch1[2]===H.identifier&&(_.touch1[0]=F);if(H=_.that.__zoom,_.touch1){var G=_.touch0[0],Y=_.touch0[1],ee=_.touch1[0],K=_.touch1[1],B=(B=ee[0]-G[0])*B+(B=ee[1]-G[1])*B,D=(D=K[0]-Y[0])*D+(D=K[1]-Y[1])*D;H=N(H,Math.sqrt(B/D)),F=[(G[0]+ee[0])/2,(G[1]+ee[1])/2],O=[(Y[0]+K[0])/2,(Y[1]+K[1])/2]}else if(_.touch0)F=_.touch0[0],O=_.touch0[1];else return;_.zoom("touch",s(x(H,F,O),_.extent,i))}}function L(j,...M){if(this.__zooming){var _=k(this,M).event(j),A=j.changedTouches,S=A.length,$,H;for(Gn(j),u&&clearTimeout(u),u=setTimeout(function(){u=null},m),$=0;$<S;++$)H=A[$],_.touch0&&_.touch0[2]===H.identifier?delete _.touch0:_.touch1&&_.touch1[2]===H.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(H=Ie(H,this),Math.hypot(f[0]-H[0],f[1]-H[1])<g)){var F=Ce(this).on("dblclick.zoom");F&&F.apply(this,arguments)}}}return v.wheelDelta=function(j){return arguments.length?(r=typeof j=="function"?j:tn(+j),v):r},v.filter=function(j){return arguments.length?(e=typeof j=="function"?j:tn(!!j),v):e},v.touchable=function(j){return arguments.length?(o=typeof j=="function"?j:tn(!!j),v):o},v.extent=function(j){return arguments.length?(t=typeof j=="function"?j:tn([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),v):t},v.scaleExtent=function(j){return arguments.length?(a[0]=+j[0],a[1]=+j[1],v):[a[0],a[1]]},v.translateExtent=function(j){return arguments.length?(i[0][0]=+j[0][0],i[1][0]=+j[1][0],i[0][1]=+j[0][1],i[1][1]=+j[1][1],v):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},v.constrain=function(j){return arguments.length?(s=j,v):s},v.duration=function(j){return arguments.length?(l=+j,v):l},v.interpolate=function(j){return arguments.length?(c=j,v):c},v.on=function(){var j=d.on.apply(d,arguments);return j===d?v:j},v.clickDistance=function(j){return arguments.length?(b=(j=+j)*j,v):Math.sqrt(b)},v.tapDistance=function(j){return arguments.length?(g=+j,v):g},v}const Re={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:s,targetHandle:r})=>`Couldn't create edge for ${e} handle id: "${e==="source"?s:r}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},zt=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Qo=["Enter"," ","Escape"],Ko={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:s})=>`Moved selected node ${e}. New position, x: ${t}, y: ${s}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var yt;(function(e){e.Strict="strict",e.Loose="loose"})(yt||(yt={}));var it;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(it||(it={}));var Rt;(function(e){e.Partial="partial",e.Full="full"})(Rt||(Rt={}));const ei={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ue;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ue||(Ue={}));var vt;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(vt||(vt={}));var te;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(te||(te={}));const gr={[te.Left]:te.Right,[te.Right]:te.Left,[te.Top]:te.Bottom,[te.Bottom]:te.Top};function ti(e){return e===null?null:e?"valid":"invalid"}const ni=e=>"id"in e&&"source"in e&&"target"in e,Ih=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),zs=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Yt=(e,t=[0,0])=>{const{width:s,height:r}=Ge(e),o=e.origin??t,a=s*o[0],i=r*o[1];return{x:e.position.x-a,y:e.position.y-i}},Mh=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const s=e.reduce((r,o)=>{const a=typeof o=="string";let i=!t.nodeLookup&&!a?o:void 0;t.nodeLookup&&(i=a?t.nodeLookup.get(o):zs(o)?o:t.nodeLookup.get(o.id));const l=i?yn(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return An(r,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Tn(s)},qt=(e,t={})=>{let s={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return e.forEach(o=>{(t.filter===void 0||t.filter(o))&&(s=An(s,yn(o)),r=!0)}),r?Tn(s):{x:0,y:0,width:0,height:0}},Rs=(e,t,[s,r,o]=[0,0,1],a=!1,i=!1)=>{const l={...Xt(t,[s,r,o]),width:t.width/o,height:t.height/o},c=[];for(const d of e.values()){const{measured:h,selectable:f=!0,hidden:u=!1}=d;if(i&&!f||u)continue;const m=h.width??d.width??d.initialWidth??null,p=h.height??d.height??d.initialHeight??null,b=Lt(l,jt(d)),g=(m??0)*(p??0),v=a&&b>0;(!d.internals.handleBounds||v||b>=g||d.dragging)&&c.push(d)}return c},Ah=(e,t)=>{const s=new Set;return e.forEach(r=>{s.add(r.id)}),t.filter(r=>s.has(r.source)||s.has(r.target))};function Th(e,t){const s=new Map,r=t?.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&(t?.includeHiddenNodes||!o.hidden)&&(!r||r.has(o.id))&&s.set(o.id,o)}),s}async function $h({nodes:e,width:t,height:s,panZoom:r,minZoom:o,maxZoom:a},i){if(e.size===0)return Promise.resolve(!0);const l=Th(e,i),c=qt(l),d=Ls(c,t,s,i?.minZoom??o,i?.maxZoom??a,i?.padding??.1);return await r.setViewport(d,{duration:i?.duration,ease:i?.ease,interpolate:i?.interpolate}),Promise.resolve(!0)}function si({nodeId:e,nextPosition:t,nodeLookup:s,nodeOrigin:r=[0,0],nodeExtent:o,onError:a}){const i=s.get(e),l=i.parentId?s.get(i.parentId):void 0,{x:c,y:d}=l?l.internals.positionAbsolute:{x:0,y:0},h=i.origin??r;let f=i.extent||o;if(i.extent==="parent"&&!i.expandParent)if(!l)a?.("005",Re.error005());else{const m=l.measured.width,p=l.measured.height;m&&p&&(f=[[c,d],[c+m,d+p]])}else l&&Nt(i.extent)&&(f=[[i.extent[0][0]+c,i.extent[0][1]+d],[i.extent[1][0]+c,i.extent[1][1]+d]]);const u=Nt(f)?ct(t,f,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&a?.("015",Re.error015()),{position:{x:u.x-c+(i.measured.width??0)*h[0],y:u.y-d+(i.measured.height??0)*h[1]},positionAbsolute:u}}async function Ph({nodesToRemove:e=[],edgesToRemove:t=[],nodes:s,edges:r,onBeforeDelete:o}){const a=new Set(e.map(u=>u.id)),i=[];for(const u of s){if(u.deletable===!1)continue;const m=a.has(u.id),p=!m&&u.parentId&&i.find(b=>b.id===u.parentId);(m||p)&&i.push(u)}const l=new Set(t.map(u=>u.id)),c=r.filter(u=>u.deletable!==!1),h=Ah(i,c);for(const u of c)l.has(u.id)&&!h.find(p=>p.id===u.id)&&h.push(u);if(!o)return{edges:h,nodes:i};const f=await o({nodes:i,edges:h});return typeof f=="boolean"?f?{edges:h,nodes:i}:{edges:[],nodes:[]}:f}const wt=(e,t=0,s=1)=>Math.min(Math.max(e,t),s),ct=(e={x:0,y:0},t,s)=>({x:wt(e.x,t[0][0],t[1][0]-(s?.width??0)),y:wt(e.y,t[0][1],t[1][1]-(s?.height??0))});function ri(e,t,s){const{width:r,height:o}=Ge(s),{x:a,y:i}=s.internals.positionAbsolute;return ct(e,[[a,i],[a+r,i+o]],t)}const br=(e,t,s)=>e<t?wt(Math.abs(e-t),1,t)/t:e>s?-wt(Math.abs(e-s),1,t)/t:0,oi=(e,t,s=15,r=40)=>{const o=br(e.x,r,t.width-r)*s,a=br(e.y,r,t.height-r)*s;return[o,a]},An=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),xs=({x:e,y:t,width:s,height:r})=>({x:e,y:t,x2:e+s,y2:t+r}),Tn=({x:e,y:t,x2:s,y2:r})=>({x:e,y:t,width:s-e,height:r-t}),jt=(e,t=[0,0])=>{const{x:s,y:r}=zs(e)?e.internals.positionAbsolute:Yt(e,t);return{x:s,y:r,width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}},yn=(e,t=[0,0])=>{const{x:s,y:r}=zs(e)?e.internals.positionAbsolute:Yt(e,t);return{x:s,y:r,x2:s+(e.measured?.width??e.width??e.initialWidth??0),y2:r+(e.measured?.height??e.height??e.initialHeight??0)}},ii=(e,t)=>Tn(An(xs(e),xs(t))),Lt=(e,t)=>{const s=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(s*r)},yr=e=>Ae(e.width)&&Ae(e.height)&&Ae(e.x)&&Ae(e.y),Ae=e=>!isNaN(e)&&isFinite(e),Dh=(e,t)=>{},Zt=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Xt=({x:e,y:t},[s,r,o],a=!1,i=[1,1])=>{const l={x:(e-s)/o,y:(t-r)/o};return a?Zt(l,i):l},vn=({x:e,y:t},[s,r,o])=>({x:e*o+s,y:t*o+r});function ht(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const s=parseFloat(e);if(!Number.isNaN(s))return Math.floor(s)}if(typeof e=="string"&&e.endsWith("%")){const s=parseFloat(e);if(!Number.isNaN(s))return Math.floor(t*s*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function zh(e,t,s){if(typeof e=="string"||typeof e=="number"){const r=ht(e,s),o=ht(e,t);return{top:r,right:o,bottom:r,left:o,x:o*2,y:r*2}}if(typeof e=="object"){const r=ht(e.top??e.y??0,s),o=ht(e.bottom??e.y??0,s),a=ht(e.left??e.x??0,t),i=ht(e.right??e.x??0,t);return{top:r,right:i,bottom:o,left:a,x:a+i,y:r+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Rh(e,t,s,r,o,a){const{x:i,y:l}=vn(e,[t,s,r]),{x:c,y:d}=vn({x:e.x+e.width,y:e.y+e.height},[t,s,r]),h=o-c,f=a-d;return{left:Math.floor(i),top:Math.floor(l),right:Math.floor(h),bottom:Math.floor(f)}}const Ls=(e,t,s,r,o,a)=>{const i=zh(a,t,s),l=(t-i.x)/e.width,c=(s-i.y)/e.height,d=Math.min(l,c),h=wt(d,r,o),f=e.x+e.width/2,u=e.y+e.height/2,m=t/2-f*h,p=s/2-u*h,b=Rh(e,m,p,h,t,s),g={left:Math.min(b.left-i.left,0),top:Math.min(b.top-i.top,0),right:Math.min(b.right-i.right,0),bottom:Math.min(b.bottom-i.bottom,0)};return{x:m-g.left+g.right,y:p-g.top+g.bottom,zoom:h}},Bt=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function Nt(e){return e!=null&&e!=="parent"}function Ge(e){return{width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}}function ai(e){return(e.measured?.width??e.width??e.initialWidth)!==void 0&&(e.measured?.height??e.height??e.initialHeight)!==void 0}function li(e,t={width:0,height:0},s,r,o){const a={...e},i=r.get(s);if(i){const l=i.origin||o;a.x+=i.internals.positionAbsolute.x-(t.width??0)*l[0],a.y+=i.internals.positionAbsolute.y-(t.height??0)*l[1]}return a}function vr(e,t){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}function Lh(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}function Bh(e){return{...Ko,...e||{}}}function At(e,{snapGrid:t=[0,0],snapToGrid:s=!1,transform:r,containerBounds:o}){const{x:a,y:i}=Te(e),l=Xt({x:a-(o?.left??0),y:i-(o?.top??0)},r),{x:c,y:d}=s?Zt(l,t):l;return{xSnapped:c,ySnapped:d,...l}}const Bs=e=>({width:e.offsetWidth,height:e.offsetHeight}),ci=e=>e?.getRootNode?.()||window?.document,Hh=["INPUT","SELECT","TEXTAREA"];function di(e){const t=e.composedPath?.()?.[0]||e.target;return t?.nodeType!==1?!1:Hh.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const ui=e=>"clientX"in e,Te=(e,t)=>{const s=ui(e),r=s?e.clientX:e.touches?.[0].clientX,o=s?e.clientY:e.touches?.[0].clientY;return{x:r-(t?.left??0),y:o-(t?.top??0)}},wr=(e,t,s,r,o)=>{const a=t.querySelectorAll(`.${e}`);return!a||!a.length?null:Array.from(a).map(i=>{const l=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:o,position:i.getAttribute("data-handlepos"),x:(l.left-s.left)/r,y:(l.top-s.top)/r,...Bs(i)}})};function hi({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:o,sourceControlY:a,targetControlX:i,targetControlY:l}){const c=e*.125+o*.375+i*.375+s*.125,d=t*.125+a*.375+l*.375+r*.125,h=Math.abs(c-e),f=Math.abs(d-t);return[c,d,h,f]}function nn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function jr({pos:e,x1:t,y1:s,x2:r,y2:o,c:a}){switch(e){case te.Left:return[t-nn(t-r,a),s];case te.Right:return[t+nn(r-t,a),s];case te.Top:return[t,s-nn(s-o,a)];case te.Bottom:return[t,s+nn(o-s,a)]}}function fi({sourceX:e,sourceY:t,sourcePosition:s=te.Bottom,targetX:r,targetY:o,targetPosition:a=te.Top,curvature:i=.25}){const[l,c]=jr({pos:s,x1:e,y1:t,x2:r,y2:o,c:i}),[d,h]=jr({pos:a,x1:r,y1:o,x2:e,y2:t,c:i}),[f,u,m,p]=hi({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:l,sourceControlY:c,targetControlX:d,targetControlY:h});return[`M${e},${t} C${l},${c} ${d},${h} ${r},${o}`,f,u,m,p]}function mi({sourceX:e,sourceY:t,targetX:s,targetY:r}){const o=Math.abs(s-e)/2,a=s<e?s+o:s-o,i=Math.abs(r-t)/2,l=r<t?r+i:r-i;return[a,l,o,i]}function Oh({sourceNode:e,targetNode:t,selected:s=!1,zIndex:r=0,elevateOnSelect:o=!1,zIndexMode:a="basic"}){if(a==="manual")return r;const i=o&&s?r+1e3:r,l=Math.max(e.parentId||o&&e.selected?e.internals.z:0,t.parentId||o&&t.selected?t.internals.z:0);return i+l}function Vh({sourceNode:e,targetNode:t,width:s,height:r,transform:o}){const a=An(yn(e),yn(t));a.x===a.x2&&(a.x2+=1),a.y===a.y2&&(a.y2+=1);const i={x:-o[0]/o[2],y:-o[1]/o[2],width:s/o[2],height:r/o[2]};return Lt(i,Tn(a))>0}const Fh=({source:e,sourceHandle:t,target:s,targetHandle:r})=>`xy-edge__${e}${t||""}-${s}${r||""}`,Gh=(e,t)=>t.some(s=>s.source===e.source&&s.target===e.target&&(s.sourceHandle===e.sourceHandle||!s.sourceHandle&&!e.sourceHandle)&&(s.targetHandle===e.targetHandle||!s.targetHandle&&!e.targetHandle)),Yh=(e,t,s={})=>{if(!e.source||!e.target)return t;const r=s.getEdgeId||Fh;let o;return ni(e)?o={...e}:o={...e,id:r(e)},Gh(o,t)?t:(o.sourceHandle===null&&delete o.sourceHandle,o.targetHandle===null&&delete o.targetHandle,t.concat(o))};function pi({sourceX:e,sourceY:t,targetX:s,targetY:r}){const[o,a,i,l]=mi({sourceX:e,sourceY:t,targetX:s,targetY:r});return[`M ${e},${t}L ${s},${r}`,o,a,i,l]}const Nr={[te.Left]:{x:-1,y:0},[te.Right]:{x:1,y:0},[te.Top]:{x:0,y:-1},[te.Bottom]:{x:0,y:1}},qh=({source:e,sourcePosition:t=te.Bottom,target:s})=>t===te.Left||t===te.Right?e.x<s.x?{x:1,y:0}:{x:-1,y:0}:e.y<s.y?{x:0,y:1}:{x:0,y:-1},kr=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Zh({source:e,sourcePosition:t=te.Bottom,target:s,targetPosition:r=te.Top,center:o,offset:a,stepPosition:i}){const l=Nr[t],c=Nr[r],d={x:e.x+l.x*a,y:e.y+l.y*a},h={x:s.x+c.x*a,y:s.y+c.y*a},f=qh({source:d,sourcePosition:t,target:h}),u=f.x!==0?"x":"y",m=f[u];let p=[],b,g;const v={x:0,y:0},N={x:0,y:0},[,,x,w]=mi({sourceX:e.x,sourceY:e.y,targetX:s.x,targetY:s.y});if(l[u]*c[u]===-1){u==="x"?(b=o.x??d.x+(h.x-d.x)*i,g=o.y??(d.y+h.y)/2):(b=o.x??(d.x+h.x)/2,g=o.y??d.y+(h.y-d.y)*i);const k=[{x:b,y:d.y},{x:b,y:h.y}],I=[{x:d.x,y:g},{x:h.x,y:g}];l[u]===m?p=u==="x"?k:I:p=u==="x"?I:k}else{const k=[{x:d.x,y:h.y}],I=[{x:h.x,y:d.y}];if(u==="x"?p=l.x===m?I:k:p=l.y===m?k:I,t===r){const z=Math.abs(e[u]-s[u]);if(z<=a){const L=Math.min(a-1,a-z);l[u]===m?v[u]=(d[u]>e[u]?-1:1)*L:N[u]=(h[u]>s[u]?-1:1)*L}}if(t!==r){const z=u==="x"?"y":"x",L=l[u]===c[z],j=d[z]>h[z],M=d[z]<h[z];(l[u]===1&&(!L&&j||L&&M)||l[u]!==1&&(!L&&M||L&&j))&&(p=u==="x"?k:I)}const T={x:d.x+v.x,y:d.y+v.y},P={x:h.x+N.x,y:h.y+N.y},R=Math.max(Math.abs(T.x-p[0].x),Math.abs(P.x-p[0].x)),C=Math.max(Math.abs(T.y-p[0].y),Math.abs(P.y-p[0].y));R>=C?(b=(T.x+P.x)/2,g=p[0].y):(b=p[0].x,g=(T.y+P.y)/2)}return[[e,{x:d.x+v.x,y:d.y+v.y},...p,{x:h.x+N.x,y:h.y+N.y},s],b,g,x,w]}function Xh(e,t,s,r){const o=Math.min(kr(e,t)/2,kr(t,s)/2,r),{x:a,y:i}=t;if(e.x===a&&a===s.x||e.y===i&&i===s.y)return`L${a} ${i}`;if(e.y===i){const d=e.x<s.x?-1:1,h=e.y<s.y?1:-1;return`L ${a+o*d},${i}Q ${a},${i} ${a},${i+o*h}`}const l=e.x<s.x?1:-1,c=e.y<s.y?-1:1;return`L ${a},${i+o*c}Q ${a},${i} ${a+o*l},${i}`}function gs({sourceX:e,sourceY:t,sourcePosition:s=te.Bottom,targetX:r,targetY:o,targetPosition:a=te.Top,borderRadius:i=5,centerX:l,centerY:c,offset:d=20,stepPosition:h=.5}){const[f,u,m,p,b]=Zh({source:{x:e,y:t},sourcePosition:s,target:{x:r,y:o},targetPosition:a,center:{x:l,y:c},offset:d,stepPosition:h});return[f.reduce((v,N,x)=>{let w="";return x>0&&x<f.length-1?w=Xh(f[x-1],N,f[x+1],i):w=`${x===0?"M":"L"}${N.x} ${N.y}`,v+=w,v},""),u,m,p,b]}function Cr(e){return e&&!!(e.internals.handleBounds||e.handles?.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Wh(e){const{sourceNode:t,targetNode:s}=e;if(!Cr(t)||!Cr(s))return null;const r=t.internals.handleBounds||Sr(t.handles),o=s.internals.handleBounds||Sr(s.handles),a=_r(r?.source??[],e.sourceHandle),i=_r(e.connectionMode===yt.Strict?o?.target??[]:(o?.target??[]).concat(o?.source??[]),e.targetHandle);if(!a||!i)return e.onError?.("008",Re.error008(a?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=a?.position||te.Bottom,c=i?.position||te.Top,d=dt(t,a,l),h=dt(s,i,c);return{sourceX:d.x,sourceY:d.y,targetX:h.x,targetY:h.y,sourcePosition:l,targetPosition:c}}function Sr(e){if(!e)return null;const t=[],s=[];for(const r of e)r.width=r.width??1,r.height=r.height??1,r.type==="source"?t.push(r):r.type==="target"&&s.push(r);return{source:t,target:s}}function dt(e,t,s=te.Left,r=!1){const o=(t?.x??0)+e.internals.positionAbsolute.x,a=(t?.y??0)+e.internals.positionAbsolute.y,{width:i,height:l}=t??Ge(e);if(r)return{x:o+i/2,y:a+l/2};switch(t?.position??s){case te.Top:return{x:o+i/2,y:a};case te.Right:return{x:o+i,y:a+l/2};case te.Bottom:return{x:o+i/2,y:a+l};case te.Left:return{x:o,y:a+l/2}}}function _r(e,t){return e&&(t?e.find(s=>s.id===t):e[0])||null}function bs(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`:""}function Uh(e,{id:t,defaultColor:s,defaultMarkerStart:r,defaultMarkerEnd:o}){const a=new Set;return e.reduce((i,l)=>([l.markerStart||r,l.markerEnd||o].forEach(c=>{if(c&&typeof c=="object"){const d=bs(c,t);a.has(d)||(i.push({id:d,color:c.color||s,...c}),a.add(d))}}),i),[]).sort((i,l)=>i.id.localeCompare(l.id))}const xi=1e3,Jh=10,Hs={nodeOrigin:[0,0],nodeExtent:zt,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},Qh={...Hs,checkEquality:!0};function Os(e,t){const s={...e};for(const r in t)t[r]!==void 0&&(s[r]=t[r]);return s}function Kh(e,t,s){const r=Os(Hs,s);for(const o of e.values())if(o.parentId)Fs(o,e,t,r);else{const a=Yt(o,r.nodeOrigin),i=Nt(o.extent)?o.extent:r.nodeExtent,l=ct(a,i,Ge(o));o.internals.positionAbsolute=l}}function ef(e,t){if(!e.handles)return e.measured?t?.internals.handleBounds:void 0;const s=[],r=[];for(const o of e.handles){const a={id:o.id,width:o.width??1,height:o.height??1,nodeId:e.id,x:o.x,y:o.y,position:o.position,type:o.type};o.type==="source"?s.push(a):o.type==="target"&&r.push(a)}return{source:s,target:r}}function Vs(e){return e==="manual"}function ys(e,t,s,r={}){const o=Os(Qh,r),a={i:0},i=new Map(t),l=o?.elevateNodesOnSelect&&!Vs(o.zIndexMode)?xi:0;let c=e.length>0;t.clear(),s.clear();for(const d of e){let h=i.get(d.id);if(o.checkEquality&&d===h?.internals.userNode)t.set(d.id,h);else{const f=Yt(d,o.nodeOrigin),u=Nt(d.extent)?d.extent:o.nodeExtent,m=ct(f,u,Ge(d));h={...o.defaults,...d,measured:{width:d.measured?.width,height:d.measured?.height},internals:{positionAbsolute:m,handleBounds:ef(d,h),z:gi(d,l,o.zIndexMode),userNode:d}},t.set(d.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(c=!1),d.parentId&&Fs(h,t,s,r,a)}return c}function tf(e,t){if(!e.parentId)return;const s=t.get(e.parentId);s?s.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Fs(e,t,s,r,o){const{elevateNodesOnSelect:a,nodeOrigin:i,nodeExtent:l,zIndexMode:c}=Os(Hs,r),d=e.parentId,h=t.get(d);if(!h){console.warn(`Parent node ${d} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}tf(e,s),o&&!h.parentId&&h.internals.rootParentIndex===void 0&&c==="auto"&&(h.internals.rootParentIndex=++o.i,h.internals.z=h.internals.z+o.i*Jh),o&&h.internals.rootParentIndex!==void 0&&(o.i=h.internals.rootParentIndex);const f=a&&!Vs(c)?xi:0,{x:u,y:m,z:p}=nf(e,h,i,l,f,c),{positionAbsolute:b}=e.internals,g=u!==b.x||m!==b.y;(g||p!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:g?{x:u,y:m}:b,z:p}})}function gi(e,t,s){const r=Ae(e.zIndex)?e.zIndex:0;return Vs(s)?r:r+(e.selected?t:0)}function nf(e,t,s,r,o,a){const{x:i,y:l}=t.internals.positionAbsolute,c=Ge(e),d=Yt(e,s),h=Nt(e.extent)?ct(d,e.extent,c):d;let f=ct({x:i+h.x,y:l+h.y},r,c);e.extent==="parent"&&(f=ri(f,c,t));const u=gi(e,o,a),m=t.internals.z??0;return{x:f.x,y:f.y,z:m>=u?m+1:u}}function Gs(e,t,s,r=[0,0]){const o=[],a=new Map;for(const i of e){const l=t.get(i.parentId);if(!l)continue;const c=a.get(i.parentId)?.expandedRect??jt(l),d=ii(c,i.rect);a.set(i.parentId,{expandedRect:d,parent:l})}return a.size>0&&a.forEach(({expandedRect:i,parent:l},c)=>{const d=l.internals.positionAbsolute,h=Ge(l),f=l.origin??r,u=i.x<d.x?Math.round(Math.abs(d.x-i.x)):0,m=i.y<d.y?Math.round(Math.abs(d.y-i.y)):0,p=Math.max(h.width,Math.round(i.width)),b=Math.max(h.height,Math.round(i.height)),g=(p-h.width)*f[0],v=(b-h.height)*f[1];(u>0||m>0||g||v)&&(o.push({id:c,type:"position",position:{x:l.position.x-u+g,y:l.position.y-m+v}}),s.get(c)?.forEach(N=>{e.some(x=>x.id===N.id)||o.push({id:N.id,type:"position",position:{x:N.position.x+u,y:N.position.y+m}})})),(h.width<i.width||h.height<i.height||u||m)&&o.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:p+(u?f[0]*u-g:0),height:b+(m?f[1]*m-v:0)}})}),o}function sf(e,t,s,r,o,a,i){const l=r?.querySelector(".xyflow__viewport");let c=!1;if(!l)return{changes:[],updatedInternals:c};const d=[],h=window.getComputedStyle(l),{m22:f}=new window.DOMMatrixReadOnly(h.transform),u=[];for(const m of e.values()){const p=t.get(m.id);if(!p)continue;if(p.hidden){t.set(p.id,{...p,internals:{...p.internals,handleBounds:void 0}}),c=!0;continue}const b=Bs(m.nodeElement),g=p.measured.width!==b.width||p.measured.height!==b.height;if(!!(b.width&&b.height&&(g||!p.internals.handleBounds||m.force))){const N=m.nodeElement.getBoundingClientRect(),x=Nt(p.extent)?p.extent:a;let{positionAbsolute:w}=p.internals;p.parentId&&p.extent==="parent"?w=ri(w,b,t.get(p.parentId)):x&&(w=ct(w,x,b));const E={...p,measured:b,internals:{...p.internals,positionAbsolute:w,handleBounds:{source:wr("source",m.nodeElement,N,f,p.id),target:wr("target",m.nodeElement,N,f,p.id)}}};t.set(p.id,E),p.parentId&&Fs(E,t,s,{nodeOrigin:o,zIndexMode:i}),c=!0,g&&(d.push({id:p.id,type:"dimensions",dimensions:b}),p.expandParent&&p.parentId&&u.push({id:p.id,parentId:p.parentId,rect:jt(E,o)}))}}if(u.length>0){const m=Gs(u,t,s,o);d.push(...m)}return{changes:d,updatedInternals:c}}async function rf({delta:e,panZoom:t,transform:s,translateExtent:r,width:o,height:a}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:s[0]+e.x,y:s[1]+e.y,zoom:s[2]},[[0,0],[o,a]],r),l=!!i&&(i.x!==s[0]||i.y!==s[1]||i.k!==s[2]);return Promise.resolve(l)}function Er(e,t,s,r,o,a){let i=o;const l=r.get(i)||new Map;r.set(i,l.set(s,t)),i=`${o}-${e}`;const c=r.get(i)||new Map;if(r.set(i,c.set(s,t)),a){i=`${o}-${e}-${a}`;const d=r.get(i)||new Map;r.set(i,d.set(s,t))}}function bi(e,t,s){e.clear(),t.clear();for(const r of s){const{source:o,target:a,sourceHandle:i=null,targetHandle:l=null}=r,c={edgeId:r.id,source:o,target:a,sourceHandle:i,targetHandle:l},d=`${o}-${i}--${a}-${l}`,h=`${a}-${l}--${o}-${i}`;Er("source",c,h,e,o,i),Er("target",c,d,e,a,l),t.set(r.id,r)}}function yi(e,t){if(!e.parentId)return!1;const s=t.get(e.parentId);return s?s.selected?!0:yi(s,t):!1}function Ir(e,t,s){let r=e;do{if(r?.matches?.(t))return!0;if(r===s)return!1;r=r?.parentElement}while(r);return!1}function of(e,t,s,r){const o=new Map;for(const[a,i]of e)if((i.selected||i.id===r)&&(!i.parentId||!yi(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const l=e.get(a);l&&o.set(a,{id:a,position:l.position||{x:0,y:0},distance:{x:s.x-l.internals.positionAbsolute.x,y:s.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return o}function Yn({nodeId:e,dragItems:t,nodeLookup:s,dragging:r=!0}){const o=[];for(const[i,l]of t){const c=s.get(i)?.internals.userNode;c&&o.push({...c,position:l.position,dragging:r})}if(!e)return[o[0],o];const a=s.get(e)?.internals.userNode;return[a?{...a,position:t.get(e)?.position||a.position,dragging:r}:o[0],o]}function af({dragItems:e,snapGrid:t,x:s,y:r}){const o=e.values().next().value;if(!o)return null;const a={x:s-o.distance.x,y:r-o.distance.y},i=Zt(a,t);return{x:i.x-a.x,y:i.y-a.y}}function lf({onNodeMouseDown:e,getStoreItems:t,onDragStart:s,onDrag:r,onDragStop:o}){let a={x:null,y:null},i=0,l=new Map,c=!1,d={x:0,y:0},h=null,f=!1,u=null,m=!1,p=!1,b=null;function g({noDragClassName:N,handleSelector:x,domNode:w,isSelectable:E,nodeId:k,nodeClickDistance:I=0}){u=Ce(w);function T({x:z,y:L}){const{nodeLookup:j,nodeExtent:M,snapGrid:_,snapToGrid:A,nodeOrigin:S,onNodeDrag:$,onSelectionDrag:H,onError:F,updateNodePositions:O}=t();a={x:z,y:L};let G=!1;const Y=l.size>1,ee=Y&&M?xs(qt(l)):null,K=Y&&A?af({dragItems:l,snapGrid:_,x:z,y:L}):null;for(const[B,D]of l){if(!j.has(B))continue;let X={x:z-D.distance.x,y:L-D.distance.y};A&&(X=K?{x:Math.round(X.x+K.x),y:Math.round(X.y+K.y)}:Zt(X,_));let W=null;if(Y&&M&&!D.extent&&ee){const{positionAbsolute:ne}=D.internals,oe=ne.x-ee.x+M[0][0],le=ne.x+D.measured.width-ee.x2+M[1][0],ce=ne.y-ee.y+M[0][1],he=ne.y+D.measured.height-ee.y2+M[1][1];W=[[oe,ce],[le,he]]}const{position:se,positionAbsolute:J}=si({nodeId:B,nextPosition:X,nodeLookup:j,nodeExtent:W||M,nodeOrigin:S,onError:F});G=G||D.position.x!==se.x||D.position.y!==se.y,D.position=se,D.internals.positionAbsolute=J}if(p=p||G,!!G&&(O(l,!0),b&&(r||$||!k&&H))){const[B,D]=Yn({nodeId:k,dragItems:l,nodeLookup:j});r?.(b,l,B,D),$?.(b,B,D),k||H?.(b,D)}}async function P(){if(!h)return;const{transform:z,panBy:L,autoPanSpeed:j,autoPanOnNodeDrag:M}=t();if(!M){c=!1,cancelAnimationFrame(i);return}const[_,A]=oi(d,h,j);(_!==0||A!==0)&&(a.x=(a.x??0)-_/z[2],a.y=(a.y??0)-A/z[2],await L({x:_,y:A})&&T(a)),i=requestAnimationFrame(P)}function R(z){const{nodeLookup:L,multiSelectionActive:j,nodesDraggable:M,transform:_,snapGrid:A,snapToGrid:S,selectNodesOnDrag:$,onNodeDragStart:H,onSelectionDragStart:F,unselectNodesAndEdges:O}=t();f=!0,(!$||!E)&&!j&&k&&(L.get(k)?.selected||O()),E&&$&&k&&e?.(k);const G=At(z.sourceEvent,{transform:_,snapGrid:A,snapToGrid:S,containerBounds:h});if(a=G,l=of(L,M,G,k),l.size>0&&(s||H||!k&&F)){const[Y,ee]=Yn({nodeId:k,dragItems:l,nodeLookup:L});s?.(z.sourceEvent,l,Y,ee),H?.(z.sourceEvent,Y,ee),k||F?.(z.sourceEvent,ee)}}const C=zo().clickDistance(I).on("start",z=>{const{domNode:L,nodeDragThreshold:j,transform:M,snapGrid:_,snapToGrid:A}=t();h=L?.getBoundingClientRect()||null,m=!1,p=!1,b=z.sourceEvent,j===0&&R(z),a=At(z.sourceEvent,{transform:M,snapGrid:_,snapToGrid:A,containerBounds:h}),d=Te(z.sourceEvent,h)}).on("drag",z=>{const{autoPanOnNodeDrag:L,transform:j,snapGrid:M,snapToGrid:_,nodeDragThreshold:A,nodeLookup:S}=t(),$=At(z.sourceEvent,{transform:j,snapGrid:M,snapToGrid:_,containerBounds:h});if(b=z.sourceEvent,(z.sourceEvent.type==="touchmove"&&z.sourceEvent.touches.length>1||k&&!S.has(k))&&(m=!0),!m){if(!c&&L&&f&&(c=!0,P()),!f){const H=Te(z.sourceEvent,h),F=H.x-d.x,O=H.y-d.y;Math.sqrt(F*F+O*O)>A&&R(z)}(a.x!==$.xSnapped||a.y!==$.ySnapped)&&l&&f&&(d=Te(z.sourceEvent,h),T($))}}).on("end",z=>{if(!(!f||m)&&(c=!1,f=!1,cancelAnimationFrame(i),l.size>0)){const{nodeLookup:L,updateNodePositions:j,onNodeDragStop:M,onSelectionDragStop:_}=t();if(p&&(j(l,!1),p=!1),o||M||!k&&_){const[A,S]=Yn({nodeId:k,dragItems:l,nodeLookup:L,dragging:!1});o?.(z.sourceEvent,l,A,S),M?.(z.sourceEvent,A,S),k||_?.(z.sourceEvent,S)}}}).filter(z=>{const L=z.target;return!z.button&&(!N||!Ir(L,`.${N}`,w))&&(!x||Ir(L,x,w))});u.call(C)}function v(){u?.on(".drag",null)}return{update:g,destroy:v}}function cf(e,t,s){const r=[],o={x:e.x-s,y:e.y-s,width:s*2,height:s*2};for(const a of t.values())Lt(o,jt(a))>0&&r.push(a);return r}const df=250;function uf(e,t,s,r){let o=[],a=1/0;const i=cf(e,s,t+df);for(const l of i){const c=[...l.internals.handleBounds?.source??[],...l.internals.handleBounds?.target??[]];for(const d of c){if(r.nodeId===d.nodeId&&r.type===d.type&&r.id===d.id)continue;const{x:h,y:f}=dt(l,d,d.position,!0),u=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(f-e.y,2));u>t||(u<a?(o=[{...d,x:h,y:f}],a=u):u===a&&o.push({...d,x:h,y:f}))}}if(!o.length)return null;if(o.length>1){const l=r.type==="source"?"target":"source";return o.find(c=>c.type===l)??o[0]}return o[0]}function vi(e,t,s,r,o,a=!1){const i=r.get(e);if(!i)return null;const l=o==="strict"?i.internals.handleBounds?.[t]:[...i.internals.handleBounds?.source??[],...i.internals.handleBounds?.target??[]],c=(s?l?.find(d=>d.id===s):l?.[0])??null;return c&&a?{...c,...dt(i,c,c.position,!0)}:c}function wi(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function hf(e,t){let s=null;return t?s=!0:e&&!t&&(s=!1),s}const ji=()=>!0;function ff(e,{connectionMode:t,connectionRadius:s,handleId:r,nodeId:o,edgeUpdaterType:a,isTarget:i,domNode:l,nodeLookup:c,lib:d,autoPanOnConnect:h,flowId:f,panBy:u,cancelConnection:m,onConnectStart:p,onConnect:b,onConnectEnd:g,isValidConnection:v=ji,onReconnectEnd:N,updateConnection:x,getTransform:w,getFromHandle:E,autoPanSpeed:k,dragThreshold:I=1,handleDomNode:T}){const P=ci(e.target);let R=0,C;const{x:z,y:L}=Te(e),j=wi(a,T),M=l?.getBoundingClientRect();let _=!1;if(!M||!j)return;const A=vi(o,j,r,c,t);if(!A)return;let S=Te(e,M),$=!1,H=null,F=!1,O=null;function G(){if(!h||!M)return;const[se,J]=oi(S,M,k);u({x:se,y:J}),R=requestAnimationFrame(G)}const Y={...A,nodeId:o,type:j,position:A.position},ee=c.get(o);let B={inProgress:!0,isValid:null,from:dt(ee,Y,te.Left,!0),fromHandle:Y,fromPosition:Y.position,fromNode:ee,to:S,toHandle:null,toPosition:gr[Y.position],toNode:null,pointer:S};function D(){_=!0,x(B),p?.(e,{nodeId:o,handleId:r,handleType:j})}I===0&&D();function X(se){if(!_){const{x:he,y:be}=Te(se),ke=he-z,Ee=be-L;if(!(ke*ke+Ee*Ee>I*I))return;D()}if(!E()||!Y){W(se);return}const J=w();S=Te(se,M),C=uf(Xt(S,J,!1,[1,1]),s,c,Y),$||(G(),$=!0);const ne=Ni(se,{handle:C,connectionMode:t,fromNodeId:o,fromHandleId:r,fromType:i?"target":"source",isValidConnection:v,doc:P,lib:d,flowId:f,nodeLookup:c});O=ne.handleDomNode,H=ne.connection,F=hf(!!C,ne.isValid);const oe=c.get(o),le=oe?dt(oe,Y,te.Left,!0):B.from,ce={...B,from:le,isValid:F,to:ne.toHandle&&F?vn({x:ne.toHandle.x,y:ne.toHandle.y},J):S,toHandle:ne.toHandle,toPosition:F&&ne.toHandle?ne.toHandle.position:gr[Y.position],toNode:ne.toHandle?c.get(ne.toHandle.nodeId):null,pointer:S};x(ce),B=ce}function W(se){if(!("touches"in se&&se.touches.length>0)){if(_){(C||O)&&H&&F&&b?.(H);const{inProgress:J,...ne}=B,oe={...ne,toPosition:B.toHandle?B.toPosition:null};g?.(se,oe),a&&N?.(se,oe)}m(),cancelAnimationFrame(R),$=!1,F=!1,H=null,O=null,P.removeEventListener("mousemove",X),P.removeEventListener("mouseup",W),P.removeEventListener("touchmove",X),P.removeEventListener("touchend",W)}}P.addEventListener("mousemove",X),P.addEventListener("mouseup",W),P.addEventListener("touchmove",X),P.addEventListener("touchend",W)}function Ni(e,{handle:t,connectionMode:s,fromNodeId:r,fromHandleId:o,fromType:a,doc:i,lib:l,flowId:c,isValidConnection:d=ji,nodeLookup:h}){const f=a==="target",u=t?i.querySelector(`.${l}-flow__handle[data-id="${c}-${t?.nodeId}-${t?.id}-${t?.type}"]`):null,{x:m,y:p}=Te(e),b=i.elementFromPoint(m,p),g=b?.classList.contains(`${l}-flow__handle`)?b:u,v={handleDomNode:g,isValid:!1,connection:null,toHandle:null};if(g){const N=wi(void 0,g),x=g.getAttribute("data-nodeid"),w=g.getAttribute("data-handleid"),E=g.classList.contains("connectable"),k=g.classList.contains("connectableend");if(!x||!N)return v;const I={source:f?x:r,sourceHandle:f?w:o,target:f?r:x,targetHandle:f?o:w};v.connection=I;const P=E&&k&&(s===yt.Strict?f&&N==="source"||!f&&N==="target":x!==r||w!==o);v.isValid=P&&d(I),v.toHandle=vi(x,N,w,h,s,!0)}return v}const vs={onPointerDown:ff,isValid:Ni};function mf({domNode:e,panZoom:t,getTransform:s,getViewScale:r}){const o=Ce(e);function a({translateExtent:l,width:c,height:d,zoomStep:h=1,pannable:f=!0,zoomable:u=!0,inversePan:m=!1}){const p=x=>{if(x.sourceEvent.type!=="wheel"||!t)return;const w=s(),E=x.sourceEvent.ctrlKey&&Bt()?10:1,k=-x.sourceEvent.deltaY*(x.sourceEvent.deltaMode===1?.05:x.sourceEvent.deltaMode?1:.002)*h,I=w[2]*Math.pow(2,k*E);t.scaleTo(I)};let b=[0,0];const g=x=>{(x.sourceEvent.type==="mousedown"||x.sourceEvent.type==="touchstart")&&(b=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY])},v=x=>{const w=s();if(x.sourceEvent.type!=="mousemove"&&x.sourceEvent.type!=="touchmove"||!t)return;const E=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY],k=[E[0]-b[0],E[1]-b[1]];b=E;const I=r()*Math.max(w[2],Math.log(w[2]))*(m?-1:1),T={x:w[0]-k[0]*I,y:w[1]-k[1]*I},P=[[0,0],[c,d]];t.setViewportConstrained({x:T.x,y:T.y,zoom:w[2]},P,l)},N=Jo().on("start",g).on("zoom",f?v:null).on("zoom.wheel",u?p:null);o.call(N,{})}function i(){o.on("zoom",null)}return{update:a,destroy:i,pointer:Ie}}const $n=e=>({x:e.x,y:e.y,zoom:e.k}),qn=({x:e,y:t,zoom:s})=>Mn.translate(e,t).scale(s),ft=(e,t)=>e.target.closest(`.${t}`),ki=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),pf=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Zn=(e,t=0,s=pf,r=()=>{})=>{const o=typeof t=="number"&&t>0;return o||r(),o?e.transition().duration(t).ease(s).on("end",r):e},Ci=e=>{const t=e.ctrlKey&&Bt()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function xf({zoomPanValues:e,noWheelClassName:t,d3Selection:s,d3Zoom:r,panOnScrollMode:o,panOnScrollSpeed:a,zoomOnPinch:i,onPanZoomStart:l,onPanZoom:c,onPanZoomEnd:d}){return h=>{if(ft(h,t))return h.ctrlKey&&h.preventDefault(),!1;h.preventDefault(),h.stopImmediatePropagation();const f=s.property("__zoom").k||1;if(h.ctrlKey&&i){const g=Ie(h),v=Ci(h),N=f*Math.pow(2,v);r.scaleTo(s,N,g,h);return}const u=h.deltaMode===1?20:1;let m=o===it.Vertical?0:h.deltaX*u,p=o===it.Horizontal?0:h.deltaY*u;!Bt()&&h.shiftKey&&o!==it.Vertical&&(m=h.deltaY*u,p=0),r.translateBy(s,-(m/f)*a,-(p/f)*a,{internal:!0});const b=$n(s.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(c?.(h,b),e.panScrollTimeout=setTimeout(()=>{d?.(h,b),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,l?.(h,b))}}function gf({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:s}){return function(r,o){const a=r.type==="wheel",i=!t&&a&&!r.ctrlKey,l=ft(r,e);if(r.ctrlKey&&a&&l&&r.preventDefault(),i||l)return null;r.preventDefault(),s.call(this,r,o)}}function bf({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:s}){return r=>{if(r.sourceEvent?.internal)return;const o=$n(r.transform);e.mouseButton=r.sourceEvent?.button||0,e.isZoomingOrPanning=!0,e.prevViewport=o,r.sourceEvent?.type==="mousedown"&&t(!0),s&&s?.(r.sourceEvent,o)}}function yf({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:s,onTransformChange:r,onPanZoom:o}){return a=>{e.usedRightMouseButton=!!(s&&ki(t,e.mouseButton??0)),a.sourceEvent?.sync||r([a.transform.x,a.transform.y,a.transform.k]),o&&!a.sourceEvent?.internal&&o?.(a.sourceEvent,$n(a.transform))}}function vf({zoomPanValues:e,panOnDrag:t,panOnScroll:s,onDraggingChange:r,onPanZoomEnd:o,onPaneContextMenu:a}){return i=>{if(!i.sourceEvent?.internal&&(e.isZoomingOrPanning=!1,a&&ki(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&a(i.sourceEvent),e.usedRightMouseButton=!1,r(!1),o)){const l=$n(i.transform);e.prevViewport=l,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o?.(i.sourceEvent,l)},s?150:0)}}}function wf({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:s,panOnDrag:r,panOnScroll:o,zoomOnDoubleClick:a,userSelectionActive:i,noWheelClassName:l,noPanClassName:c,lib:d,connectionInProgress:h}){return f=>{const u=e||t,m=s&&f.ctrlKey,p=f.type==="wheel";if(f.button===1&&f.type==="mousedown"&&(ft(f,`${d}-flow__node`)||ft(f,`${d}-flow__edge`)))return!0;if(!r&&!u&&!o&&!a&&!s||i||h&&!p||ft(f,l)&&p||ft(f,c)&&(!p||o&&p&&!e)||!s&&f.ctrlKey&&p)return!1;if(!s&&f.type==="touchstart"&&f.touches?.length>1)return f.preventDefault(),!1;if(!u&&!o&&!m&&p||!r&&(f.type==="mousedown"||f.type==="touchstart")||Array.isArray(r)&&!r.includes(f.button)&&f.type==="mousedown")return!1;const b=Array.isArray(r)&&r.includes(f.button)||!f.button||f.button<=1;return(!f.ctrlKey||p)&&b}}function jf({domNode:e,minZoom:t,maxZoom:s,translateExtent:r,viewport:o,onPanZoom:a,onPanZoomStart:i,onPanZoomEnd:l,onDraggingChange:c}){const d={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},h=e.getBoundingClientRect(),f=Jo().scaleExtent([t,s]).translateExtent(r),u=Ce(e).call(f);N({x:o.x,y:o.y,zoom:wt(o.zoom,t,s)},[[0,0],[h.width,h.height]],r);const m=u.on("wheel.zoom"),p=u.on("dblclick.zoom");f.wheelDelta(Ci);function b(C,z){return u?new Promise(L=>{f?.interpolate(z?.interpolate==="linear"?Mt:ln).transform(Zn(u,z?.duration,z?.ease,()=>L(!0)),C)}):Promise.resolve(!1)}function g({noWheelClassName:C,noPanClassName:z,onPaneContextMenu:L,userSelectionActive:j,panOnScroll:M,panOnDrag:_,panOnScrollMode:A,panOnScrollSpeed:S,preventScrolling:$,zoomOnPinch:H,zoomOnScroll:F,zoomOnDoubleClick:O,zoomActivationKeyPressed:G,lib:Y,onTransformChange:ee,connectionInProgress:K,paneClickDistance:B,selectionOnDrag:D}){j&&!d.isZoomingOrPanning&&v();const X=M&&!G&&!j;f.clickDistance(D?1/0:!Ae(B)||B<0?0:B);const W=X?xf({zoomPanValues:d,noWheelClassName:C,d3Selection:u,d3Zoom:f,panOnScrollMode:A,panOnScrollSpeed:S,zoomOnPinch:H,onPanZoomStart:i,onPanZoom:a,onPanZoomEnd:l}):gf({noWheelClassName:C,preventScrolling:$,d3ZoomHandler:m});if(u.on("wheel.zoom",W,{passive:!1}),!j){const J=bf({zoomPanValues:d,onDraggingChange:c,onPanZoomStart:i});f.on("start",J);const ne=yf({zoomPanValues:d,panOnDrag:_,onPaneContextMenu:!!L,onPanZoom:a,onTransformChange:ee});f.on("zoom",ne);const oe=vf({zoomPanValues:d,panOnDrag:_,panOnScroll:M,onPaneContextMenu:L,onPanZoomEnd:l,onDraggingChange:c});f.on("end",oe)}const se=wf({zoomActivationKeyPressed:G,panOnDrag:_,zoomOnScroll:F,panOnScroll:M,zoomOnDoubleClick:O,zoomOnPinch:H,userSelectionActive:j,noPanClassName:z,noWheelClassName:C,lib:Y,connectionInProgress:K});f.filter(se),O?u.on("dblclick.zoom",p):u.on("dblclick.zoom",null)}function v(){f.on("zoom",null)}async function N(C,z,L){const j=qn(C),M=f?.constrain()(j,z,L);return M&&await b(M),new Promise(_=>_(M))}async function x(C,z){const L=qn(C);return await b(L,z),new Promise(j=>j(L))}function w(C){if(u){const z=qn(C),L=u.property("__zoom");(L.k!==C.zoom||L.x!==C.x||L.y!==C.y)&&f?.transform(u,z,null,{sync:!0})}}function E(){const C=u?Uo(u.node()):{x:0,y:0,k:1};return{x:C.x,y:C.y,zoom:C.k}}function k(C,z){return u?new Promise(L=>{f?.interpolate(z?.interpolate==="linear"?Mt:ln).scaleTo(Zn(u,z?.duration,z?.ease,()=>L(!0)),C)}):Promise.resolve(!1)}function I(C,z){return u?new Promise(L=>{f?.interpolate(z?.interpolate==="linear"?Mt:ln).scaleBy(Zn(u,z?.duration,z?.ease,()=>L(!0)),C)}):Promise.resolve(!1)}function T(C){f?.scaleExtent(C)}function P(C){f?.translateExtent(C)}function R(C){const z=!Ae(C)||C<0?0:C;f?.clickDistance(z)}return{update:g,destroy:v,setViewport:x,setViewportConstrained:N,getViewport:E,scaleTo:k,scaleBy:I,setScaleExtent:T,setTranslateExtent:P,syncViewport:w,setClickDistance:R}}var kt;(function(e){e.Line="line",e.Handle="handle"})(kt||(kt={}));function Nf({width:e,prevWidth:t,height:s,prevHeight:r,affectsX:o,affectsY:a}){const i=e-t,l=s-r,c=[i>0?1:i<0?-1:0,l>0?1:l<0?-1:0];return i&&o&&(c[0]=c[0]*-1),l&&a&&(c[1]=c[1]*-1),c}function Mr(e){const t=e.includes("right")||e.includes("left"),s=e.includes("bottom")||e.includes("top"),r=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:s,affectsX:r,affectsY:o}}function Xe(e,t){return Math.max(0,t-e)}function We(e,t){return Math.max(0,e-t)}function sn(e,t,s){return Math.max(0,t-e,e-s)}function Ar(e,t){return e?!t:t}function kf(e,t,s,r,o,a,i,l){let{affectsX:c,affectsY:d}=t;const{isHorizontal:h,isVertical:f}=t,u=h&&f,{xSnapped:m,ySnapped:p}=s,{minWidth:b,maxWidth:g,minHeight:v,maxHeight:N}=r,{x,y:w,width:E,height:k,aspectRatio:I}=e;let T=Math.floor(h?m-e.pointerX:0),P=Math.floor(f?p-e.pointerY:0);const R=E+(c?-T:T),C=k+(d?-P:P),z=-a[0]*E,L=-a[1]*k;let j=sn(R,b,g),M=sn(C,v,N);if(i){let S=0,$=0;c&&T<0?S=Xe(x+T+z,i[0][0]):!c&&T>0&&(S=We(x+R+z,i[1][0])),d&&P<0?$=Xe(w+P+L,i[0][1]):!d&&P>0&&($=We(w+C+L,i[1][1])),j=Math.max(j,S),M=Math.max(M,$)}if(l){let S=0,$=0;c&&T>0?S=We(x+T,l[0][0]):!c&&T<0&&(S=Xe(x+R,l[1][0])),d&&P>0?$=We(w+P,l[0][1]):!d&&P<0&&($=Xe(w+C,l[1][1])),j=Math.max(j,S),M=Math.max(M,$)}if(o){if(h){const S=sn(R/I,v,N)*I;if(j=Math.max(j,S),i){let $=0;!c&&!d||c&&!d&&u?$=We(w+L+R/I,i[1][1])*I:$=Xe(w+L+(c?T:-T)/I,i[0][1])*I,j=Math.max(j,$)}if(l){let $=0;!c&&!d||c&&!d&&u?$=Xe(w+R/I,l[1][1])*I:$=We(w+(c?T:-T)/I,l[0][1])*I,j=Math.max(j,$)}}if(f){const S=sn(C*I,b,g)/I;if(M=Math.max(M,S),i){let $=0;!c&&!d||d&&!c&&u?$=We(x+C*I+z,i[1][0])/I:$=Xe(x+(d?P:-P)*I+z,i[0][0])/I,M=Math.max(M,$)}if(l){let $=0;!c&&!d||d&&!c&&u?$=Xe(x+C*I,l[1][0])/I:$=We(x+(d?P:-P)*I,l[0][0])/I,M=Math.max(M,$)}}}P=P+(P<0?M:-M),T=T+(T<0?j:-j),o&&(u?R>C*I?P=(Ar(c,d)?-T:T)/I:T=(Ar(c,d)?-P:P)*I:h?(P=T/I,d=c):(T=P*I,c=d));const _=c?x+T:x,A=d?w+P:w;return{width:E+(c?-T:T),height:k+(d?-P:P),x:a[0]*T*(c?-1:1)+_,y:a[1]*P*(d?-1:1)+A}}const Si={width:0,height:0,x:0,y:0},Cf={...Si,pointerX:0,pointerY:0,aspectRatio:1};function Sf(e){return[[0,0],[e.measured.width,e.measured.height]]}function _f(e,t,s){const r=t.position.x+e.position.x,o=t.position.y+e.position.y,a=e.measured.width??0,i=e.measured.height??0,l=s[0]*a,c=s[1]*i;return[[r-l,o-c],[r+a-l,o+i-c]]}function Ef({domNode:e,nodeId:t,getStoreItems:s,onChange:r,onEnd:o}){const a=Ce(e);let i={controlDirection:Mr("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function l({controlPosition:d,boundaries:h,keepAspectRatio:f,resizeDirection:u,onResizeStart:m,onResize:p,onResizeEnd:b,shouldResize:g}){let v={...Si},N={...Cf};i={boundaries:h,resizeDirection:u,keepAspectRatio:f,controlDirection:Mr(d)};let x,w=null,E=[],k,I,T,P=!1;const R=zo().on("start",C=>{const{nodeLookup:z,transform:L,snapGrid:j,snapToGrid:M,nodeOrigin:_,paneDomNode:A}=s();if(x=z.get(t),!x)return;w=A?.getBoundingClientRect()??null;const{xSnapped:S,ySnapped:$}=At(C.sourceEvent,{transform:L,snapGrid:j,snapToGrid:M,containerBounds:w});v={width:x.measured.width??0,height:x.measured.height??0,x:x.position.x??0,y:x.position.y??0},N={...v,pointerX:S,pointerY:$,aspectRatio:v.width/v.height},k=void 0,x.parentId&&(x.extent==="parent"||x.expandParent)&&(k=z.get(x.parentId),I=k&&x.extent==="parent"?Sf(k):void 0),E=[],T=void 0;for(const[H,F]of z)if(F.parentId===t&&(E.push({id:H,position:{...F.position},extent:F.extent}),F.extent==="parent"||F.expandParent)){const O=_f(F,x,F.origin??_);T?T=[[Math.min(O[0][0],T[0][0]),Math.min(O[0][1],T[0][1])],[Math.max(O[1][0],T[1][0]),Math.max(O[1][1],T[1][1])]]:T=O}m?.(C,{...v})}).on("drag",C=>{const{transform:z,snapGrid:L,snapToGrid:j,nodeOrigin:M}=s(),_=At(C.sourceEvent,{transform:z,snapGrid:L,snapToGrid:j,containerBounds:w}),A=[];if(!x)return;const{x:S,y:$,width:H,height:F}=v,O={},G=x.origin??M,{width:Y,height:ee,x:K,y:B}=kf(N,i.controlDirection,_,i.boundaries,i.keepAspectRatio,G,I,T),D=Y!==H,X=ee!==F,W=K!==S&&D,se=B!==$&&X;if(!W&&!se&&!D&&!X)return;if((W||se||G[0]===1||G[1]===1)&&(O.x=W?K:v.x,O.y=se?B:v.y,v.x=O.x,v.y=O.y,E.length>0)){const le=K-S,ce=B-$;for(const he of E)he.position={x:he.position.x-le+G[0]*(Y-H),y:he.position.y-ce+G[1]*(ee-F)},A.push(he)}if((D||X)&&(O.width=D&&(!i.resizeDirection||i.resizeDirection==="horizontal")?Y:v.width,O.height=X&&(!i.resizeDirection||i.resizeDirection==="vertical")?ee:v.height,v.width=O.width,v.height=O.height),k&&x.expandParent){const le=G[0]*(O.width??0);O.x&&O.x<le&&(v.x=le,N.x=N.x-(O.x-le));const ce=G[1]*(O.height??0);O.y&&O.y<ce&&(v.y=ce,N.y=N.y-(O.y-ce))}const J=Nf({width:v.width,prevWidth:H,height:v.height,prevHeight:F,affectsX:i.controlDirection.affectsX,affectsY:i.controlDirection.affectsY}),ne={...v,direction:J};g?.(C,ne)!==!1&&(P=!0,p?.(C,ne),r(O,A))}).on("end",C=>{P&&(b?.(C,{...v}),o?.({...v}),P=!1)});a.call(R)}function c(){a.on(".drag",null)}return{update:l,destroy:c}}var Xn={exports:{}},Wn={},Un={exports:{}},Jn={};var Tr;function If(){if(Tr)return Jn;Tr=1;var e=ho();function t(f,u){return f===u&&(f!==0||1/f===1/u)||f!==f&&u!==u}var s=typeof Object.is=="function"?Object.is:t,r=e.useState,o=e.useEffect,a=e.useLayoutEffect,i=e.useDebugValue;function l(f,u){var m=u(),p=r({inst:{value:m,getSnapshot:u}}),b=p[0].inst,g=p[1];return a(function(){b.value=m,b.getSnapshot=u,c(b)&&g({inst:b})},[f,m,u]),o(function(){return c(b)&&g({inst:b}),f(function(){c(b)&&g({inst:b})})},[f]),i(m),m}function c(f){var u=f.getSnapshot;f=f.value;try{var m=u();return!s(f,m)}catch{return!0}}function d(f,u){return u()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return Jn.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:h,Jn}var $r;function Mf(){return $r||($r=1,Un.exports=If()),Un.exports}var Pr;function Af(){if(Pr)return Wn;Pr=1;var e=ho(),t=Mf();function s(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var r=typeof Object.is=="function"?Object.is:s,o=t.useSyncExternalStore,a=e.useRef,i=e.useEffect,l=e.useMemo,c=e.useDebugValue;return Wn.useSyncExternalStoreWithSelector=function(d,h,f,u,m){var p=a(null);if(p.current===null){var b={hasValue:!1,value:null};p.current=b}else b=p.current;p=l(function(){function v(k){if(!N){if(N=!0,x=k,k=u(k),m!==void 0&&b.hasValue){var I=b.value;if(m(I,k))return w=I}return w=k}if(I=w,r(x,k))return I;var T=u(k);return m!==void 0&&m(I,T)?(x=k,I):(x=k,w=T)}var N=!1,x,w,E=f===void 0?null:f;return[function(){return v(h())},E===null?void 0:function(){return v(E())}]},[h,f,u,m]);var g=o(d,p[0],p[1]);return i(function(){b.hasValue=!0,b.value=g},[g]),c(g),g},Wn}var Dr;function Tf(){return Dr||(Dr=1,Xn.exports=Af()),Xn.exports}var $f=Tf();const Pf=ol($f),Df={},zr=e=>{let t;const s=new Set,r=(h,f)=>{const u=typeof h=="function"?h(t):h;if(!Object.is(u,t)){const m=t;t=f??(typeof u!="object"||u===null)?u:Object.assign({},t,u),s.forEach(p=>p(t,m))}},o=()=>t,c={setState:r,getState:o,getInitialState:()=>d,subscribe:h=>(s.add(h),()=>s.delete(h)),destroy:()=>{(Df?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},d=t=e(r,o,c);return c},zf=e=>e?zr(e):zr,{useDebugValue:Rf}=il,{useSyncExternalStoreWithSelector:Lf}=Pf,Bf=e=>e;function _i(e,t=Bf,s){const r=Lf(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return Rf(r),r}const Rr=(e,t)=>{const s=zf(e),r=(o,a=t)=>_i(s,o,a);return Object.assign(r,s),r},Hf=(e,t)=>e?Rr(e,t):Rr;function de(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!1;for(const r of s)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}const Pn=y.createContext(null),Of=Pn.Provider,Ei=Re.error001();function ae(e,t){const s=y.useContext(Pn);if(s===null)throw new Error(Ei);return _i(s,e,t)}function ue(){const e=y.useContext(Pn);if(e===null)throw new Error(Ei);return y.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Lr={display:"none"},Vf={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ii="react-flow__node-desc",Mi="react-flow__edge-desc",Ff="react-flow__aria-live",Gf=e=>e.ariaLiveMessage,Yf=e=>e.ariaLabelConfig;function qf({rfId:e}){const t=ae(Gf);return n.jsx("div",{id:`${Ff}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Vf,children:t})}function Zf({rfId:e,disableKeyboardA11y:t}){const s=ae(Yf);return n.jsxs(n.Fragment,{children:[n.jsx("div",{id:`${Ii}-${e}`,style:Lr,children:t?s["node.a11yDescription.default"]:s["node.a11yDescription.keyboardDisabled"]}),n.jsx("div",{id:`${Mi}-${e}`,style:Lr,children:s["edge.a11yDescription.default"]}),!t&&n.jsx(qf,{rfId:e})]})}const Dn=y.forwardRef(({position:e="top-left",children:t,className:s,style:r,...o},a)=>{const i=`${e}`.split("-");return n.jsx("div",{className:xe(["react-flow__panel",s,...i]),style:r,ref:a,...o,children:t})});Dn.displayName="Panel";function Xf({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:n.jsx(Dn,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:n.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Wf=e=>{const t=[],s=[];for(const[,r]of e.nodeLookup)r.selected&&t.push(r.internals.userNode);for(const[,r]of e.edgeLookup)r.selected&&s.push(r);return{selectedNodes:t,selectedEdges:s}},rn=e=>e.id;function Uf(e,t){return de(e.selectedNodes.map(rn),t.selectedNodes.map(rn))&&de(e.selectedEdges.map(rn),t.selectedEdges.map(rn))}function Jf({onSelectionChange:e}){const t=ue(),{selectedNodes:s,selectedEdges:r}=ae(Wf,Uf);return y.useEffect(()=>{const o={nodes:s,edges:r};e?.(o),t.getState().onSelectionChangeHandlers.forEach(a=>a(o))},[s,r,e]),null}const Qf=e=>!!e.onSelectionChangeHandlers;function Kf({onSelectionChange:e}){const t=ae(Qf);return e||t?n.jsx(Jf,{onSelectionChange:e}):null}const Ai=[0,0],e0={x:0,y:0,zoom:1},t0=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],Br=[...t0,"rfId"],n0=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),Hr={translateExtent:zt,nodeOrigin:Ai,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function s0(e){const{setNodes:t,setEdges:s,setMinZoom:r,setMaxZoom:o,setTranslateExtent:a,setNodeExtent:i,reset:l,setDefaultNodesAndEdges:c}=ae(n0,de),d=ue();y.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{h.current=Hr,l()}),[]);const h=y.useRef(Hr);return y.useEffect(()=>{for(const f of Br){const u=e[f],m=h.current[f];u!==m&&(typeof e[f]>"u"||(f==="nodes"?t(u):f==="edges"?s(u):f==="minZoom"?r(u):f==="maxZoom"?o(u):f==="translateExtent"?a(u):f==="nodeExtent"?i(u):f==="ariaLabelConfig"?d.setState({ariaLabelConfig:Bh(u)}):f==="fitView"?d.setState({fitViewQueued:u}):f==="fitViewOptions"?d.setState({fitViewOptions:u}):d.setState({[f]:u})))}h.current=e},Br.map(f=>e[f])),null}function Or(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function r0(e){const[t,s]=y.useState(e==="system"?null:e);return y.useEffect(()=>{if(e!=="system"){s(e);return}const r=Or(),o=()=>s(r?.matches?"dark":"light");return o(),r?.addEventListener("change",o),()=>{r?.removeEventListener("change",o)}},[e]),t!==null?t:Or()?.matches?"dark":"light"}const Vr=typeof document<"u"?document:null;function Ht(e=null,t={target:Vr,actInsideInputWithModifier:!0}){const[s,r]=y.useState(!1),o=y.useRef(!1),a=y.useRef(new Set([])),[i,l]=y.useMemo(()=>{if(e!==null){const d=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),h=d.reduce((f,u)=>f.concat(...u),[]);return[d,h]}return[[],[]]},[e]);return y.useEffect(()=>{const c=t?.target??Vr,d=t?.actInsideInputWithModifier??!0;if(e!==null){const h=m=>{if(o.current=m.ctrlKey||m.metaKey||m.shiftKey||m.altKey,(!o.current||o.current&&!d)&&di(m))return!1;const b=Gr(m.code,l);if(a.current.add(m[b]),Fr(i,a.current,!1)){const g=m.composedPath?.()?.[0]||m.target,v=g?.nodeName==="BUTTON"||g?.nodeName==="A";t.preventDefault!==!1&&(o.current||!v)&&m.preventDefault(),r(!0)}},f=m=>{const p=Gr(m.code,l);Fr(i,a.current,!0)?(r(!1),a.current.clear()):a.current.delete(m[p]),m.key==="Meta"&&a.current.clear(),o.current=!1},u=()=>{a.current.clear(),r(!1)};return c?.addEventListener("keydown",h),c?.addEventListener("keyup",f),window.addEventListener("blur",u),window.addEventListener("contextmenu",u),()=>{c?.removeEventListener("keydown",h),c?.removeEventListener("keyup",f),window.removeEventListener("blur",u),window.removeEventListener("contextmenu",u)}}},[e,r]),s}function Fr(e,t,s){return e.filter(r=>s||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function Gr(e,t){return t.includes(e)?"code":"key"}const o0=()=>{const e=ue();return y.useMemo(()=>({zoomIn:t=>{const{panZoom:s}=e.getState();return s?s.scaleBy(1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:s}=e.getState();return s?s.scaleBy(1/1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomTo:(t,s)=>{const{panZoom:r}=e.getState();return r?r.scaleTo(t,{duration:s?.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,s)=>{const{transform:[r,o,a],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??r,y:t.y??o,zoom:t.zoom??a},s),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,s,r]=e.getState().transform;return{x:t,y:s,zoom:r}},setCenter:async(t,s,r)=>e.getState().setCenter(t,s,r),fitBounds:async(t,s)=>{const{width:r,height:o,minZoom:a,maxZoom:i,panZoom:l}=e.getState(),c=Ls(t,r,o,a,i,s?.padding??.1);return l?(await l.setViewport(c,{duration:s?.duration,ease:s?.ease,interpolate:s?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,s={})=>{const{transform:r,snapGrid:o,snapToGrid:a,domNode:i}=e.getState();if(!i)return t;const{x:l,y:c}=i.getBoundingClientRect(),d={x:t.x-l,y:t.y-c},h=s.snapGrid??o,f=s.snapToGrid??a;return Xt(d,r,f,h)},flowToScreenPosition:t=>{const{transform:s,domNode:r}=e.getState();if(!r)return t;const{x:o,y:a}=r.getBoundingClientRect(),i=vn(t,s);return{x:i.x+o,y:i.y+a}}}),[])};function Ti(e,t){const s=[],r=new Map,o=[];for(const a of e)if(a.type==="add"){o.push(a);continue}else if(a.type==="remove"||a.type==="replace")r.set(a.id,[a]);else{const i=r.get(a.id);i?i.push(a):r.set(a.id,[a])}for(const a of t){const i=r.get(a.id);if(!i){s.push(a);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){s.push({...i[0].item});continue}const l={...a};for(const c of i)i0(c,l);s.push(l)}return o.length&&o.forEach(a=>{a.index!==void 0?s.splice(a.index,0,{...a.item}):s.push({...a.item})}),s}function i0(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function $i(e,t){return Ti(e,t)}function Pi(e,t){return Ti(e,t)}function st(e,t){return{id:e,type:"select",selected:t}}function mt(e,t=new Set,s=!1){const r=[];for(const[o,a]of e){const i=t.has(o);!(a.selected===void 0&&!i)&&a.selected!==i&&(s&&(a.selected=i),r.push(st(a.id,i)))}return r}function Yr({items:e=[],lookup:t}){const s=[],r=new Map(e.map(o=>[o.id,o]));for(const[o,a]of e.entries()){const i=t.get(a.id),l=i?.internals?.userNode??i;l!==void 0&&l!==a&&s.push({id:a.id,item:a,type:"replace"}),l===void 0&&s.push({item:a,type:"add",index:o})}for(const[o]of t)r.get(o)===void 0&&s.push({id:o,type:"remove"});return s}function qr(e){return{id:e.id,type:"remove"}}const Zr=e=>Ih(e),a0=e=>ni(e);function Di(e){return y.forwardRef(e)}const l0=typeof window<"u"?y.useLayoutEffect:y.useEffect;function Xr(e){const[t,s]=y.useState(BigInt(0)),[r]=y.useState(()=>c0(()=>s(o=>o+BigInt(1))));return l0(()=>{const o=r.get();o.length&&(e(o),r.reset())},[t]),r}function c0(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:s=>{t.push(s),e()}}}const zi=y.createContext(null);function d0({children:e}){const t=ue(),s=y.useCallback(l=>{const{nodes:c=[],setNodes:d,hasDefaultNodes:h,onNodesChange:f,nodeLookup:u,fitViewQueued:m,onNodesChangeMiddlewareMap:p}=t.getState();let b=c;for(const v of l)b=typeof v=="function"?v(b):v;let g=Yr({items:b,lookup:u});for(const v of p.values())g=v(g);h&&d(b),g.length>0?f?.(g):m&&window.requestAnimationFrame(()=>{const{fitViewQueued:v,nodes:N,setNodes:x}=t.getState();v&&x(N)})},[]),r=Xr(s),o=y.useCallback(l=>{const{edges:c=[],setEdges:d,hasDefaultEdges:h,onEdgesChange:f,edgeLookup:u}=t.getState();let m=c;for(const p of l)m=typeof p=="function"?p(m):p;h?d(m):f&&f(Yr({items:m,lookup:u}))},[]),a=Xr(o),i=y.useMemo(()=>({nodeQueue:r,edgeQueue:a}),[]);return n.jsx(zi.Provider,{value:i,children:e})}function u0(){const e=y.useContext(zi);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const h0=e=>!!e.panZoom;function zn(){const e=o0(),t=ue(),s=u0(),r=ae(h0),o=y.useMemo(()=>{const a=f=>t.getState().nodeLookup.get(f),i=f=>{s.nodeQueue.push(f)},l=f=>{s.edgeQueue.push(f)},c=f=>{const{nodeLookup:u,nodeOrigin:m}=t.getState(),p=Zr(f)?f:u.get(f.id),b=p.parentId?li(p.position,p.measured,p.parentId,u,m):p.position,g={...p,position:b,width:p.measured?.width??p.width,height:p.measured?.height??p.height};return jt(g)},d=(f,u,m={replace:!1})=>{i(p=>p.map(b=>{if(b.id===f){const g=typeof u=="function"?u(b):u;return m.replace&&Zr(g)?g:{...b,...g}}return b}))},h=(f,u,m={replace:!1})=>{l(p=>p.map(b=>{if(b.id===f){const g=typeof u=="function"?u(b):u;return m.replace&&a0(g)?g:{...b,...g}}return b}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>a(f)?.internals.userNode,getInternalNode:a,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(u=>({...u}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:i,setEdges:l,addNodes:f=>{const u=Array.isArray(f)?f:[f];s.nodeQueue.push(m=>[...m,...u])},addEdges:f=>{const u=Array.isArray(f)?f:[f];s.edgeQueue.push(m=>[...m,...u])},toObject:()=>{const{nodes:f=[],edges:u=[],transform:m}=t.getState(),[p,b,g]=m;return{nodes:f.map(v=>({...v})),edges:u.map(v=>({...v})),viewport:{x:p,y:b,zoom:g}}},deleteElements:async({nodes:f=[],edges:u=[]})=>{const{nodes:m,edges:p,onNodesDelete:b,onEdgesDelete:g,triggerNodeChanges:v,triggerEdgeChanges:N,onDelete:x,onBeforeDelete:w}=t.getState(),{nodes:E,edges:k}=await Ph({nodesToRemove:f,edgesToRemove:u,nodes:m,edges:p,onBeforeDelete:w}),I=k.length>0,T=E.length>0;if(I){const P=k.map(qr);g?.(k),N(P)}if(T){const P=E.map(qr);b?.(E),v(P)}return(T||I)&&x?.({nodes:E,edges:k}),{deletedNodes:E,deletedEdges:k}},getIntersectingNodes:(f,u=!0,m)=>{const p=yr(f),b=p?f:c(f),g=m!==void 0;return b?(m||t.getState().nodes).filter(v=>{const N=t.getState().nodeLookup.get(v.id);if(N&&!p&&(v.id===f.id||!N.internals.positionAbsolute))return!1;const x=jt(g?v:N),w=Lt(x,b);return u&&w>0||w>=x.width*x.height||w>=b.width*b.height}):[]},isNodeIntersecting:(f,u,m=!0)=>{const b=yr(f)?f:c(f);if(!b)return!1;const g=Lt(b,u);return m&&g>0||g>=u.width*u.height||g>=b.width*b.height},updateNode:d,updateNodeData:(f,u,m={replace:!1})=>{d(f,p=>{const b=typeof u=="function"?u(p):u;return m.replace?{...p,data:b}:{...p,data:{...p.data,...b}}},m)},updateEdge:h,updateEdgeData:(f,u,m={replace:!1})=>{h(f,p=>{const b=typeof u=="function"?u(p):u;return m.replace?{...p,data:b}:{...p,data:{...p.data,...b}}},m)},getNodesBounds:f=>{const{nodeLookup:u,nodeOrigin:m}=t.getState();return Mh(f,{nodeLookup:u,nodeOrigin:m})},getHandleConnections:({type:f,id:u,nodeId:m})=>Array.from(t.getState().connectionLookup.get(`${m}-${f}${u?`-${u}`:""}`)?.values()??[]),getNodeConnections:({type:f,handleId:u,nodeId:m})=>Array.from(t.getState().connectionLookup.get(`${m}${f?u?`-${f}-${u}`:`-${f}`:""}`)?.values()??[]),fitView:async f=>{const u=t.getState().fitViewResolver??Lh();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:u}),s.nodeQueue.push(m=>[...m]),u.promise}}},[]);return y.useMemo(()=>({...o,...e,viewportInitialized:r}),[r])}const Wr=e=>e.selected,f0=typeof window<"u"?window:void 0;function m0({deleteKeyCode:e,multiSelectionKeyCode:t}){const s=ue(),{deleteElements:r}=zn(),o=Ht(e,{actInsideInputWithModifier:!1}),a=Ht(t,{target:f0});y.useEffect(()=>{if(o){const{edges:i,nodes:l}=s.getState();r({nodes:l.filter(Wr),edges:i.filter(Wr)}),s.setState({nodesSelectionActive:!1})}},[o]),y.useEffect(()=>{s.setState({multiSelectionActive:a})},[a])}function p0(e){const t=ue();y.useEffect(()=>{const s=()=>{if(!e.current||!(e.current.checkVisibility?.()??!0))return!1;const r=Bs(e.current);(r.height===0||r.width===0)&&t.getState().onError?.("004",Re.error004()),t.setState({width:r.width||500,height:r.height||500})};if(e.current){s(),window.addEventListener("resize",s);const r=new ResizeObserver(()=>s());return r.observe(e.current),()=>{window.removeEventListener("resize",s),r&&e.current&&r.unobserve(e.current)}}},[])}const Rn={position:"absolute",width:"100%",height:"100%",top:0,left:0},x0=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function g0({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:s=!0,panOnScroll:r=!1,panOnScrollSpeed:o=.5,panOnScrollMode:a=it.Free,zoomOnDoubleClick:i=!0,panOnDrag:l=!0,defaultViewport:c,translateExtent:d,minZoom:h,maxZoom:f,zoomActivationKeyCode:u,preventScrolling:m=!0,children:p,noWheelClassName:b,noPanClassName:g,onViewportChange:v,isControlledViewport:N,paneClickDistance:x,selectionOnDrag:w}){const E=ue(),k=y.useRef(null),{userSelectionActive:I,lib:T,connectionInProgress:P}=ae(x0,de),R=Ht(u),C=y.useRef();p0(k);const z=y.useCallback(L=>{v?.({x:L[0],y:L[1],zoom:L[2]}),N||E.setState({transform:L})},[v,N]);return y.useEffect(()=>{if(k.current){C.current=jf({domNode:k.current,minZoom:h,maxZoom:f,translateExtent:d,viewport:c,onDraggingChange:_=>E.setState({paneDragging:_}),onPanZoomStart:(_,A)=>{const{onViewportChangeStart:S,onMoveStart:$}=E.getState();$?.(_,A),S?.(A)},onPanZoom:(_,A)=>{const{onViewportChange:S,onMove:$}=E.getState();$?.(_,A),S?.(A)},onPanZoomEnd:(_,A)=>{const{onViewportChangeEnd:S,onMoveEnd:$}=E.getState();$?.(_,A),S?.(A)}});const{x:L,y:j,zoom:M}=C.current.getViewport();return E.setState({panZoom:C.current,transform:[L,j,M],domNode:k.current.closest(".react-flow")}),()=>{C.current?.destroy()}}},[]),y.useEffect(()=>{C.current?.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:s,panOnScroll:r,panOnScrollSpeed:o,panOnScrollMode:a,zoomOnDoubleClick:i,panOnDrag:l,zoomActivationKeyPressed:R,preventScrolling:m,noPanClassName:g,userSelectionActive:I,noWheelClassName:b,lib:T,onTransformChange:z,connectionInProgress:P,selectionOnDrag:w,paneClickDistance:x})},[e,t,s,r,o,a,i,l,R,m,g,I,b,T,z,P,w,x]),n.jsx("div",{className:"react-flow__renderer",ref:k,style:Rn,children:p})}const b0=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function y0(){const{userSelectionActive:e,userSelectionRect:t}=ae(b0,de);return e&&t?n.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const Qn=(e,t)=>s=>{s.target===t.current&&e?.(s)},v0=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function w0({isSelecting:e,selectionKeyPressed:t,selectionMode:s=Rt.Full,panOnDrag:r,paneClickDistance:o,selectionOnDrag:a,onSelectionStart:i,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:d,onPaneScroll:h,onPaneMouseEnter:f,onPaneMouseMove:u,onPaneMouseLeave:m,children:p}){const b=ue(),{userSelectionActive:g,elementsSelectable:v,dragging:N,connectionInProgress:x}=ae(v0,de),w=v&&(e||g),E=y.useRef(null),k=y.useRef(),I=y.useRef(new Set),T=y.useRef(new Set),P=y.useRef(!1),R=S=>{if(P.current||x){P.current=!1;return}c?.(S),b.getState().resetSelectedElements(),b.setState({nodesSelectionActive:!1})},C=S=>{if(Array.isArray(r)&&r?.includes(2)){S.preventDefault();return}d?.(S)},z=h?S=>h(S):void 0,L=S=>{P.current&&(S.stopPropagation(),P.current=!1)},j=S=>{const{domNode:$}=b.getState();if(k.current=$?.getBoundingClientRect(),!k.current)return;const H=S.target===E.current;if(!H&&!!S.target.closest(".nokey")||!e||!(a&&H||t)||S.button!==0||!S.isPrimary)return;S.target?.setPointerCapture?.(S.pointerId),P.current=!1;const{x:G,y:Y}=Te(S.nativeEvent,k.current);b.setState({userSelectionRect:{width:0,height:0,startX:G,startY:Y,x:G,y:Y}}),H||(S.stopPropagation(),S.preventDefault())},M=S=>{const{userSelectionRect:$,transform:H,nodeLookup:F,edgeLookup:O,connectionLookup:G,triggerNodeChanges:Y,triggerEdgeChanges:ee,defaultEdgeOptions:K,resetSelectedElements:B}=b.getState();if(!k.current||!$)return;const{x:D,y:X}=Te(S.nativeEvent,k.current),{startX:W,startY:se}=$;if(!P.current){const ce=t?0:o;if(Math.hypot(D-W,X-se)<=ce)return;B(),i?.(S)}P.current=!0;const J={startX:W,startY:se,x:D<W?D:W,y:X<se?X:se,width:Math.abs(D-W),height:Math.abs(X-se)},ne=I.current,oe=T.current;I.current=new Set(Rs(F,J,H,s===Rt.Partial,!0).map(ce=>ce.id)),T.current=new Set;const le=K?.selectable??!0;for(const ce of I.current){const he=G.get(ce);if(he)for(const{edgeId:be}of he.values()){const ke=O.get(be);ke&&(ke.selectable??le)&&T.current.add(be)}}if(!vr(ne,I.current)){const ce=mt(F,I.current,!0);Y(ce)}if(!vr(oe,T.current)){const ce=mt(O,T.current);ee(ce)}b.setState({userSelectionRect:J,userSelectionActive:!0,nodesSelectionActive:!1})},_=S=>{S.button===0&&(S.target?.releasePointerCapture?.(S.pointerId),!g&&S.target===E.current&&b.getState().userSelectionRect&&R?.(S),b.setState({userSelectionActive:!1,userSelectionRect:null}),P.current&&(l?.(S),b.setState({nodesSelectionActive:I.current.size>0})))},A=r===!0||Array.isArray(r)&&r.includes(0);return n.jsxs("div",{className:xe(["react-flow__pane",{draggable:A,dragging:N,selection:e}]),onClick:w?void 0:Qn(R,E),onContextMenu:Qn(C,E),onWheel:Qn(z,E),onPointerEnter:w?void 0:f,onPointerMove:w?M:u,onPointerUp:w?_:void 0,onPointerDownCapture:w?j:void 0,onClickCapture:w?L:void 0,onPointerLeave:m,ref:E,style:Rn,children:[p,n.jsx(y0,{})]})}function ws({id:e,store:t,unselect:s=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:a,multiSelectionActive:i,nodeLookup:l,onError:c}=t.getState(),d=l.get(e);if(!d){c?.("012",Re.error012(e));return}t.setState({nodesSelectionActive:!1}),d.selected?(s||d.selected&&i)&&(a({nodes:[d],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):o([e])}function Ri({nodeRef:e,disabled:t=!1,noDragClassName:s,handleSelector:r,nodeId:o,isSelectable:a,nodeClickDistance:i}){const l=ue(),[c,d]=y.useState(!1),h=y.useRef();return y.useEffect(()=>{h.current=lf({getStoreItems:()=>l.getState(),onNodeMouseDown:f=>{ws({id:f,store:l,nodeRef:e})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),y.useEffect(()=>{if(t)h.current?.destroy();else if(e.current)return h.current?.update({noDragClassName:s,handleSelector:r,domNode:e.current,isSelectable:a,nodeId:o,nodeClickDistance:i}),()=>{h.current?.destroy()}},[s,r,t,a,e,o]),c}const j0=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Li(){const e=ue();return y.useCallback(s=>{const{nodeExtent:r,snapToGrid:o,snapGrid:a,nodesDraggable:i,onError:l,updateNodePositions:c,nodeLookup:d,nodeOrigin:h}=e.getState(),f=new Map,u=j0(i),m=o?a[0]:5,p=o?a[1]:5,b=s.direction.x*m*s.factor,g=s.direction.y*p*s.factor;for(const[,v]of d){if(!u(v))continue;let N={x:v.internals.positionAbsolute.x+b,y:v.internals.positionAbsolute.y+g};o&&(N=Zt(N,a));const{position:x,positionAbsolute:w}=si({nodeId:v.id,nextPosition:N,nodeLookup:d,nodeExtent:r,nodeOrigin:h,onError:l});v.position=x,v.internals.positionAbsolute=w,f.set(v.id,v)}c(f)},[])}const Ys=y.createContext(null),N0=Ys.Provider;Ys.Consumer;const Bi=()=>y.useContext(Ys),k0=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),C0=(e,t,s)=>r=>{const{connectionClickStartHandle:o,connectionMode:a,connection:i}=r,{fromHandle:l,toHandle:c,isValid:d}=i,h=c?.nodeId===e&&c?.id===t&&c?.type===s;return{connectingFrom:l?.nodeId===e&&l?.id===t&&l?.type===s,connectingTo:h,clickConnecting:o?.nodeId===e&&o?.id===t&&o?.type===s,isPossibleEndHandle:a===yt.Strict?l?.type!==s:e!==l?.nodeId||t!==l?.id,connectionInProcess:!!l,clickConnectionInProcess:!!o,valid:h&&d}};function S0({type:e="source",position:t=te.Top,isValidConnection:s,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:a=!0,id:i,onConnect:l,children:c,className:d,onMouseDown:h,onTouchStart:f,...u},m){const p=i||null,b=e==="target",g=ue(),v=Bi(),{connectOnClick:N,noPanClassName:x,rfId:w}=ae(k0,de),{connectingFrom:E,connectingTo:k,clickConnecting:I,isPossibleEndHandle:T,connectionInProcess:P,clickConnectionInProcess:R,valid:C}=ae(C0(v,p,e),de);v||g.getState().onError?.("010",Re.error010());const z=M=>{const{defaultEdgeOptions:_,onConnect:A,hasDefaultEdges:S}=g.getState(),$={..._,...M};if(S){const{edges:H,setEdges:F}=g.getState();F(Yh($,H))}A?.($),l?.($)},L=M=>{if(!v)return;const _=ui(M.nativeEvent);if(o&&(_&&M.button===0||!_)){const A=g.getState();vs.onPointerDown(M.nativeEvent,{handleDomNode:M.currentTarget,autoPanOnConnect:A.autoPanOnConnect,connectionMode:A.connectionMode,connectionRadius:A.connectionRadius,domNode:A.domNode,nodeLookup:A.nodeLookup,lib:A.lib,isTarget:b,handleId:p,nodeId:v,flowId:A.rfId,panBy:A.panBy,cancelConnection:A.cancelConnection,onConnectStart:A.onConnectStart,onConnectEnd:A.onConnectEnd,updateConnection:A.updateConnection,onConnect:z,isValidConnection:s||A.isValidConnection,getTransform:()=>g.getState().transform,getFromHandle:()=>g.getState().connection.fromHandle,autoPanSpeed:A.autoPanSpeed,dragThreshold:A.connectionDragThreshold})}_?h?.(M):f?.(M)},j=M=>{const{onClickConnectStart:_,onClickConnectEnd:A,connectionClickStartHandle:S,connectionMode:$,isValidConnection:H,lib:F,rfId:O,nodeLookup:G,connection:Y}=g.getState();if(!v||!S&&!o)return;if(!S){_?.(M.nativeEvent,{nodeId:v,handleId:p,handleType:e}),g.setState({connectionClickStartHandle:{nodeId:v,type:e,id:p}});return}const ee=ci(M.target),K=s||H,{connection:B,isValid:D}=vs.isValid(M.nativeEvent,{handle:{nodeId:v,id:p,type:e},connectionMode:$,fromNodeId:S.nodeId,fromHandleId:S.id||null,fromType:S.type,isValidConnection:K,flowId:O,doc:ee,lib:F,nodeLookup:G});D&&B&&z(B);const X=structuredClone(Y);delete X.inProgress,X.toPosition=X.toHandle?X.toHandle.position:null,A?.(M,X),g.setState({connectionClickStartHandle:null})};return n.jsx("div",{"data-handleid":p,"data-nodeid":v,"data-handlepos":t,"data-id":`${w}-${v}-${p}-${e}`,className:xe(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",x,d,{source:!b,target:b,connectable:r,connectablestart:o,connectableend:a,clickconnecting:I,connectingfrom:E,connectingto:k,valid:C,connectionindicator:r&&(!P||T)&&(P||R?a:o)}]),onMouseDown:L,onTouchStart:L,onClick:N?j:void 0,ref:m,...u,children:c})}const Je=y.memo(Di(S0));function _0({data:e,isConnectable:t,sourcePosition:s=te.Bottom}){return n.jsxs(n.Fragment,{children:[e?.label,n.jsx(Je,{type:"source",position:s,isConnectable:t})]})}function E0({data:e,isConnectable:t,targetPosition:s=te.Top,sourcePosition:r=te.Bottom}){return n.jsxs(n.Fragment,{children:[n.jsx(Je,{type:"target",position:s,isConnectable:t}),e?.label,n.jsx(Je,{type:"source",position:r,isConnectable:t})]})}function I0(){return null}function M0({data:e,isConnectable:t,targetPosition:s=te.Top}){return n.jsxs(n.Fragment,{children:[n.jsx(Je,{type:"target",position:s,isConnectable:t}),e?.label]})}const wn={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Ur={input:_0,default:E0,output:M0,group:I0};function A0(e){return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??e.style?.width,height:e.height??e.initialHeight??e.style?.height}:{width:e.width??e.style?.width,height:e.height??e.style?.height}}const T0=e=>{const{width:t,height:s,x:r,y:o}=qt(e.nodeLookup,{filter:a=>!!a.selected});return{width:Ae(t)?t:null,height:Ae(s)?s:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${r}px,${o}px)`}};function $0({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:s}){const r=ue(),{width:o,height:a,transformString:i,userSelectionActive:l}=ae(T0,de),c=Li(),d=y.useRef(null);if(y.useEffect(()=>{s||d.current?.focus({preventScroll:!0})},[s]),Ri({nodeRef:d}),l||!o||!a)return null;const h=e?u=>{const m=r.getState().nodes.filter(p=>p.selected);e(u,m)}:void 0,f=u=>{Object.prototype.hasOwnProperty.call(wn,u.key)&&(u.preventDefault(),c({direction:wn[u.key],factor:u.shiftKey?4:1}))};return n.jsx("div",{className:xe(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:n.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:s?void 0:-1,onKeyDown:s?void 0:f,style:{width:o,height:a}})})}const Jr=typeof window<"u"?window:void 0,P0=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Hi({children:e,onPaneClick:t,onPaneMouseEnter:s,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,paneClickDistance:l,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:h,selectionMode:f,onSelectionStart:u,onSelectionEnd:m,multiSelectionKeyCode:p,panActivationKeyCode:b,zoomActivationKeyCode:g,elementsSelectable:v,zoomOnScroll:N,zoomOnPinch:x,panOnScroll:w,panOnScrollSpeed:E,panOnScrollMode:k,zoomOnDoubleClick:I,panOnDrag:T,defaultViewport:P,translateExtent:R,minZoom:C,maxZoom:z,preventScrolling:L,onSelectionContextMenu:j,noWheelClassName:M,noPanClassName:_,disableKeyboardA11y:A,onViewportChange:S,isControlledViewport:$}){const{nodesSelectionActive:H,userSelectionActive:F}=ae(P0,de),O=Ht(d,{target:Jr}),G=Ht(b,{target:Jr}),Y=G||T,ee=G||w,K=h&&Y!==!0,B=O||F||K;return m0({deleteKeyCode:c,multiSelectionKeyCode:p}),n.jsx(g0,{onPaneContextMenu:a,elementsSelectable:v,zoomOnScroll:N,zoomOnPinch:x,panOnScroll:ee,panOnScrollSpeed:E,panOnScrollMode:k,zoomOnDoubleClick:I,panOnDrag:!O&&Y,defaultViewport:P,translateExtent:R,minZoom:C,maxZoom:z,zoomActivationKeyCode:g,preventScrolling:L,noWheelClassName:M,noPanClassName:_,onViewportChange:S,isControlledViewport:$,paneClickDistance:l,selectionOnDrag:K,children:n.jsxs(w0,{onSelectionStart:u,onSelectionEnd:m,onPaneClick:t,onPaneMouseEnter:s,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,panOnDrag:Y,isSelecting:!!B,selectionMode:f,selectionKeyPressed:O,paneClickDistance:l,selectionOnDrag:K,children:[e,H&&n.jsx($0,{onSelectionContextMenu:j,noPanClassName:_,disableKeyboardA11y:A})]})})}Hi.displayName="FlowRenderer";const D0=y.memo(Hi),z0=e=>t=>e?Rs(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(s=>s.id):Array.from(t.nodeLookup.keys());function R0(e){return ae(y.useCallback(z0(e),[e]),de)}const L0=e=>e.updateNodeInternals;function B0(){const e=ae(L0),[t]=y.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(s=>{const r=new Map;s.forEach(o=>{const a=o.target.getAttribute("data-id");r.set(a,{id:a,nodeElement:o.target,force:!0})}),e(r)}));return y.useEffect(()=>()=>{t?.disconnect()},[t]),t}function H0({node:e,nodeType:t,hasDimensions:s,resizeObserver:r}){const o=ue(),a=y.useRef(null),i=y.useRef(null),l=y.useRef(e.sourcePosition),c=y.useRef(e.targetPosition),d=y.useRef(t),h=s&&!!e.internals.handleBounds;return y.useEffect(()=>{a.current&&!e.hidden&&(!h||i.current!==a.current)&&(i.current&&r?.unobserve(i.current),r?.observe(a.current),i.current=a.current)},[h,e.hidden]),y.useEffect(()=>()=>{i.current&&(r?.unobserve(i.current),i.current=null)},[]),y.useEffect(()=>{if(a.current){const f=d.current!==t,u=l.current!==e.sourcePosition,m=c.current!==e.targetPosition;(f||u||m)&&(d.current=t,l.current=e.sourcePosition,c.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:a.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),a}function O0({id:e,onClick:t,onMouseEnter:s,onMouseMove:r,onMouseLeave:o,onContextMenu:a,onDoubleClick:i,nodesDraggable:l,elementsSelectable:c,nodesConnectable:d,nodesFocusable:h,resizeObserver:f,noDragClassName:u,noPanClassName:m,disableKeyboardA11y:p,rfId:b,nodeTypes:g,nodeClickDistance:v,onError:N}){const{node:x,internals:w,isParent:E}=ae(D=>{const X=D.nodeLookup.get(e),W=D.parentLookup.has(e);return{node:X,internals:X.internals,isParent:W}},de);let k=x.type||"default",I=g?.[k]||Ur[k];I===void 0&&(N?.("003",Re.error003(k)),k="default",I=g?.default||Ur.default);const T=!!(x.draggable||l&&typeof x.draggable>"u"),P=!!(x.selectable||c&&typeof x.selectable>"u"),R=!!(x.connectable||d&&typeof x.connectable>"u"),C=!!(x.focusable||h&&typeof x.focusable>"u"),z=ue(),L=ai(x),j=H0({node:x,nodeType:k,hasDimensions:L,resizeObserver:f}),M=Ri({nodeRef:j,disabled:x.hidden||!T,noDragClassName:u,handleSelector:x.dragHandle,nodeId:e,isSelectable:P,nodeClickDistance:v}),_=Li();if(x.hidden)return null;const A=Ge(x),S=A0(x),$=P||T||t||s||r||o,H=s?D=>s(D,{...w.userNode}):void 0,F=r?D=>r(D,{...w.userNode}):void 0,O=o?D=>o(D,{...w.userNode}):void 0,G=a?D=>a(D,{...w.userNode}):void 0,Y=i?D=>i(D,{...w.userNode}):void 0,ee=D=>{const{selectNodesOnDrag:X,nodeDragThreshold:W}=z.getState();P&&(!X||!T||W>0)&&ws({id:e,store:z,nodeRef:j}),t&&t(D,{...w.userNode})},K=D=>{if(!(di(D.nativeEvent)||p)){if(Qo.includes(D.key)&&P){const X=D.key==="Escape";ws({id:e,store:z,unselect:X,nodeRef:j})}else if(T&&x.selected&&Object.prototype.hasOwnProperty.call(wn,D.key)){D.preventDefault();const{ariaLabelConfig:X}=z.getState();z.setState({ariaLiveMessage:X["node.a11yDescription.ariaLiveMessage"]({direction:D.key.replace("Arrow","").toLowerCase(),x:~~w.positionAbsolute.x,y:~~w.positionAbsolute.y})}),_({direction:wn[D.key],factor:D.shiftKey?4:1})}}},B=()=>{if(p||!j.current?.matches(":focus-visible"))return;const{transform:D,width:X,height:W,autoPanOnNodeFocus:se,setCenter:J}=z.getState();if(!se)return;Rs(new Map([[e,x]]),{x:0,y:0,width:X,height:W},D,!0).length>0||J(x.position.x+A.width/2,x.position.y+A.height/2,{zoom:D[2]})};return n.jsx("div",{className:xe(["react-flow__node",`react-flow__node-${k}`,{[m]:T},x.className,{selected:x.selected,selectable:P,parent:E,draggable:T,dragging:M}]),ref:j,style:{zIndex:w.z,transform:`translate(${w.positionAbsolute.x}px,${w.positionAbsolute.y}px)`,pointerEvents:$?"all":"none",visibility:L?"visible":"hidden",...x.style,...S},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:H,onMouseMove:F,onMouseLeave:O,onContextMenu:G,onClick:ee,onDoubleClick:Y,onKeyDown:C?K:void 0,tabIndex:C?0:void 0,onFocus:C?B:void 0,role:x.ariaRole??(C?"group":void 0),"aria-roledescription":"node","aria-describedby":p?void 0:`${Ii}-${b}`,"aria-label":x.ariaLabel,...x.domAttributes,children:n.jsx(N0,{value:e,children:n.jsx(I,{id:e,data:x.data,type:k,positionAbsoluteX:w.positionAbsolute.x,positionAbsoluteY:w.positionAbsolute.y,selected:x.selected??!1,selectable:P,draggable:T,deletable:x.deletable??!0,isConnectable:R,sourcePosition:x.sourcePosition,targetPosition:x.targetPosition,dragging:M,dragHandle:x.dragHandle,zIndex:w.z,parentId:x.parentId,...A})})})}var V0=y.memo(O0);const F0=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Oi(e){const{nodesDraggable:t,nodesConnectable:s,nodesFocusable:r,elementsSelectable:o,onError:a}=ae(F0,de),i=R0(e.onlyRenderVisibleElements),l=B0();return n.jsx("div",{className:"react-flow__nodes",style:Rn,children:i.map(c=>n.jsx(V0,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:l,nodesDraggable:t,nodesConnectable:s,nodesFocusable:r,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:a},c))})}Oi.displayName="NodeRenderer";const G0=y.memo(Oi);function Y0(e){return ae(y.useCallback(s=>{if(!e)return s.edges.map(o=>o.id);const r=[];if(s.width&&s.height)for(const o of s.edges){const a=s.nodeLookup.get(o.source),i=s.nodeLookup.get(o.target);a&&i&&Vh({sourceNode:a,targetNode:i,width:s.width,height:s.height,transform:s.transform})&&r.push(o.id)}return r},[e]),de)}const q0=({color:e="none",strokeWidth:t=1})=>{const s={strokeWidth:t,...e&&{stroke:e}};return n.jsx("polyline",{className:"arrow",style:s,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},Z0=({color:e="none",strokeWidth:t=1})=>{const s={strokeWidth:t,...e&&{stroke:e,fill:e}};return n.jsx("polyline",{className:"arrowclosed",style:s,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Qr={[vt.Arrow]:q0,[vt.ArrowClosed]:Z0};function X0(e){const t=ue();return y.useMemo(()=>Object.prototype.hasOwnProperty.call(Qr,e)?Qr[e]:(t.getState().onError?.("009",Re.error009(e)),null),[e])}const W0=({id:e,type:t,color:s,width:r=12.5,height:o=12.5,markerUnits:a="strokeWidth",strokeWidth:i,orient:l="auto-start-reverse"})=>{const c=X0(t);return c?n.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:l,refX:"0",refY:"0",children:n.jsx(c,{color:s,strokeWidth:i})}):null},Vi=({defaultColor:e,rfId:t})=>{const s=ae(a=>a.edges),r=ae(a=>a.defaultEdgeOptions),o=y.useMemo(()=>Uh(s,{id:t,defaultColor:e,defaultMarkerStart:r?.markerStart,defaultMarkerEnd:r?.markerEnd}),[s,r,t,e]);return o.length?n.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:n.jsx("defs",{children:o.map(a=>n.jsx(W0,{id:a.id,type:a.type,color:a.color,width:a.width,height:a.height,markerUnits:a.markerUnits,strokeWidth:a.strokeWidth,orient:a.orient},a.id))})}):null};Vi.displayName="MarkerDefinitions";var U0=y.memo(Vi);function Fi({x:e,y:t,label:s,labelStyle:r,labelShowBg:o=!0,labelBgStyle:a,labelBgPadding:i=[2,4],labelBgBorderRadius:l=2,children:c,className:d,...h}){const[f,u]=y.useState({x:1,y:0,width:0,height:0}),m=xe(["react-flow__edge-textwrapper",d]),p=y.useRef(null);return y.useEffect(()=>{if(p.current){const b=p.current.getBBox();u({x:b.x,y:b.y,width:b.width,height:b.height})}},[s]),s?n.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:m,visibility:f.width?"visible":"hidden",...h,children:[o&&n.jsx("rect",{width:f.width+2*i[0],x:-i[0],y:-i[1],height:f.height+2*i[1],className:"react-flow__edge-textbg",style:a,rx:l,ry:l}),n.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:p,style:r,children:s}),c]}):null}Fi.displayName="EdgeText";const J0=y.memo(Fi);function Ln({path:e,labelX:t,labelY:s,label:r,labelStyle:o,labelShowBg:a,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,interactionWidth:d=20,...h}){return n.jsxs(n.Fragment,{children:[n.jsx("path",{...h,d:e,fill:"none",className:xe(["react-flow__edge-path",h.className])}),d?n.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:d,className:"react-flow__edge-interaction"}):null,r&&Ae(t)&&Ae(s)?n.jsx(J0,{x:t,y:s,label:r,labelStyle:o,labelShowBg:a,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c}):null]})}function Kr({pos:e,x1:t,y1:s,x2:r,y2:o}){return e===te.Left||e===te.Right?[.5*(t+r),s]:[t,.5*(s+o)]}function Gi({sourceX:e,sourceY:t,sourcePosition:s=te.Bottom,targetX:r,targetY:o,targetPosition:a=te.Top}){const[i,l]=Kr({pos:s,x1:e,y1:t,x2:r,y2:o}),[c,d]=Kr({pos:a,x1:r,y1:o,x2:e,y2:t}),[h,f,u,m]=hi({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:i,sourceControlY:l,targetControlX:c,targetControlY:d});return[`M${e},${t} C${i},${l} ${c},${d} ${r},${o}`,h,f,u,m]}function Yi(e){return y.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,sourcePosition:i,targetPosition:l,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:g,interactionWidth:v})=>{const[N,x,w]=Gi({sourceX:s,sourceY:r,sourcePosition:i,targetX:o,targetY:a,targetPosition:l}),E=e.isInternal?void 0:t;return n.jsx(Ln,{id:E,path:N,labelX:x,labelY:w,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:g,interactionWidth:v})})}const Q0=Yi({isInternal:!1}),qi=Yi({isInternal:!0});Q0.displayName="SimpleBezierEdge";qi.displayName="SimpleBezierEdgeInternal";function Zi(e){return y.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,sourcePosition:m=te.Bottom,targetPosition:p=te.Top,markerEnd:b,markerStart:g,pathOptions:v,interactionWidth:N})=>{const[x,w,E]=gs({sourceX:s,sourceY:r,sourcePosition:m,targetX:o,targetY:a,targetPosition:p,borderRadius:v?.borderRadius,offset:v?.offset,stepPosition:v?.stepPosition}),k=e.isInternal?void 0:t;return n.jsx(Ln,{id:k,path:x,labelX:w,labelY:E,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:b,markerStart:g,interactionWidth:N})})}const Xi=Zi({isInternal:!1}),Wi=Zi({isInternal:!0});Xi.displayName="SmoothStepEdge";Wi.displayName="SmoothStepEdgeInternal";function Ui(e){return y.memo(({id:t,...s})=>{const r=e.isInternal?void 0:t;return n.jsx(Xi,{...s,id:r,pathOptions:y.useMemo(()=>({borderRadius:0,offset:s.pathOptions?.offset}),[s.pathOptions?.offset])})})}const K0=Ui({isInternal:!1}),Ji=Ui({isInternal:!0});K0.displayName="StepEdge";Ji.displayName="StepEdgeInternal";function Qi(e){return y.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:m,markerStart:p,interactionWidth:b})=>{const[g,v,N]=pi({sourceX:s,sourceY:r,targetX:o,targetY:a}),x=e.isInternal?void 0:t;return n.jsx(Ln,{id:x,path:g,labelX:v,labelY:N,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:m,markerStart:p,interactionWidth:b})})}const em=Qi({isInternal:!1}),Ki=Qi({isInternal:!0});em.displayName="StraightEdge";Ki.displayName="StraightEdgeInternal";function ea(e){return y.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,sourcePosition:i=te.Bottom,targetPosition:l=te.Top,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:g,pathOptions:v,interactionWidth:N})=>{const[x,w,E]=fi({sourceX:s,sourceY:r,sourcePosition:i,targetX:o,targetY:a,targetPosition:l,curvature:v?.curvature}),k=e.isInternal?void 0:t;return n.jsx(Ln,{id:k,path:x,labelX:w,labelY:E,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:g,interactionWidth:N})})}const tm=ea({isInternal:!1}),ta=ea({isInternal:!0});tm.displayName="BezierEdge";ta.displayName="BezierEdgeInternal";const eo={default:ta,straight:Ki,step:Ji,smoothstep:Wi,simplebezier:qi},to={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},nm=(e,t,s)=>s===te.Left?e-t:s===te.Right?e+t:e,sm=(e,t,s)=>s===te.Top?e-t:s===te.Bottom?e+t:e,no="react-flow__edgeupdater";function so({position:e,centerX:t,centerY:s,radius:r=10,onMouseDown:o,onMouseEnter:a,onMouseOut:i,type:l}){return n.jsx("circle",{onMouseDown:o,onMouseEnter:a,onMouseOut:i,className:xe([no,`${no}-${l}`]),cx:nm(t,r,e),cy:sm(s,r,e),r,stroke:"transparent",fill:"transparent"})}function rm({isReconnectable:e,reconnectRadius:t,edge:s,sourceX:r,sourceY:o,targetX:a,targetY:i,sourcePosition:l,targetPosition:c,onReconnect:d,onReconnectStart:h,onReconnectEnd:f,setReconnecting:u,setUpdateHover:m}){const p=ue(),b=(w,E)=>{if(w.button!==0)return;const{autoPanOnConnect:k,domNode:I,isValidConnection:T,connectionMode:P,connectionRadius:R,lib:C,onConnectStart:z,onConnectEnd:L,cancelConnection:j,nodeLookup:M,rfId:_,panBy:A,updateConnection:S}=p.getState(),$=E.type==="target",H=(G,Y)=>{u(!1),f?.(G,s,E.type,Y)},F=G=>d?.(s,G),O=(G,Y)=>{u(!0),h?.(w,s,E.type),z?.(G,Y)};vs.onPointerDown(w.nativeEvent,{autoPanOnConnect:k,connectionMode:P,connectionRadius:R,domNode:I,handleId:E.id,nodeId:E.nodeId,nodeLookup:M,isTarget:$,edgeUpdaterType:E.type,lib:C,flowId:_,cancelConnection:j,panBy:A,isValidConnection:T,onConnect:F,onConnectStart:O,onConnectEnd:L,onReconnectEnd:H,updateConnection:S,getTransform:()=>p.getState().transform,getFromHandle:()=>p.getState().connection.fromHandle,dragThreshold:p.getState().connectionDragThreshold,handleDomNode:w.currentTarget})},g=w=>b(w,{nodeId:s.target,id:s.targetHandle??null,type:"target"}),v=w=>b(w,{nodeId:s.source,id:s.sourceHandle??null,type:"source"}),N=()=>m(!0),x=()=>m(!1);return n.jsxs(n.Fragment,{children:[(e===!0||e==="source")&&n.jsx(so,{position:l,centerX:r,centerY:o,radius:t,onMouseDown:g,onMouseEnter:N,onMouseOut:x,type:"source"}),(e===!0||e==="target")&&n.jsx(so,{position:c,centerX:a,centerY:i,radius:t,onMouseDown:v,onMouseEnter:N,onMouseOut:x,type:"target"})]})}function om({id:e,edgesFocusable:t,edgesReconnectable:s,elementsSelectable:r,onClick:o,onDoubleClick:a,onContextMenu:i,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,reconnectRadius:h,onReconnect:f,onReconnectStart:u,onReconnectEnd:m,rfId:p,edgeTypes:b,noPanClassName:g,onError:v,disableKeyboardA11y:N}){let x=ae(J=>J.edgeLookup.get(e));const w=ae(J=>J.defaultEdgeOptions);x=w?{...w,...x}:x;let E=x.type||"default",k=b?.[E]||eo[E];k===void 0&&(v?.("011",Re.error011(E)),E="default",k=b?.default||eo.default);const I=!!(x.focusable||t&&typeof x.focusable>"u"),T=typeof f<"u"&&(x.reconnectable||s&&typeof x.reconnectable>"u"),P=!!(x.selectable||r&&typeof x.selectable>"u"),R=y.useRef(null),[C,z]=y.useState(!1),[L,j]=y.useState(!1),M=ue(),{zIndex:_,sourceX:A,sourceY:S,targetX:$,targetY:H,sourcePosition:F,targetPosition:O}=ae(y.useCallback(J=>{const ne=J.nodeLookup.get(x.source),oe=J.nodeLookup.get(x.target);if(!ne||!oe)return{zIndex:x.zIndex,...to};const le=Wh({id:e,sourceNode:ne,targetNode:oe,sourceHandle:x.sourceHandle||null,targetHandle:x.targetHandle||null,connectionMode:J.connectionMode,onError:v});return{zIndex:Oh({selected:x.selected,zIndex:x.zIndex,sourceNode:ne,targetNode:oe,elevateOnSelect:J.elevateEdgesOnSelect,zIndexMode:J.zIndexMode}),...le||to}},[x.source,x.target,x.sourceHandle,x.targetHandle,x.selected,x.zIndex]),de),G=y.useMemo(()=>x.markerStart?`url('#${bs(x.markerStart,p)}')`:void 0,[x.markerStart,p]),Y=y.useMemo(()=>x.markerEnd?`url('#${bs(x.markerEnd,p)}')`:void 0,[x.markerEnd,p]);if(x.hidden||A===null||S===null||$===null||H===null)return null;const ee=J=>{const{addSelectedEdges:ne,unselectNodesAndEdges:oe,multiSelectionActive:le}=M.getState();P&&(M.setState({nodesSelectionActive:!1}),x.selected&&le?(oe({nodes:[],edges:[x]}),R.current?.blur()):ne([e])),o&&o(J,x)},K=a?J=>{a(J,{...x})}:void 0,B=i?J=>{i(J,{...x})}:void 0,D=l?J=>{l(J,{...x})}:void 0,X=c?J=>{c(J,{...x})}:void 0,W=d?J=>{d(J,{...x})}:void 0,se=J=>{if(!N&&Qo.includes(J.key)&&P){const{unselectNodesAndEdges:ne,addSelectedEdges:oe}=M.getState();J.key==="Escape"?(R.current?.blur(),ne({edges:[x]})):oe([e])}};return n.jsx("svg",{style:{zIndex:_},children:n.jsxs("g",{className:xe(["react-flow__edge",`react-flow__edge-${E}`,x.className,g,{selected:x.selected,animated:x.animated,inactive:!P&&!o,updating:C,selectable:P}]),onClick:ee,onDoubleClick:K,onContextMenu:B,onMouseEnter:D,onMouseMove:X,onMouseLeave:W,onKeyDown:I?se:void 0,tabIndex:I?0:void 0,role:x.ariaRole??(I?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":x.ariaLabel===null?void 0:x.ariaLabel||`Edge from ${x.source} to ${x.target}`,"aria-describedby":I?`${Mi}-${p}`:void 0,ref:R,...x.domAttributes,children:[!L&&n.jsx(k,{id:e,source:x.source,target:x.target,type:x.type,selected:x.selected,animated:x.animated,selectable:P,deletable:x.deletable??!0,label:x.label,labelStyle:x.labelStyle,labelShowBg:x.labelShowBg,labelBgStyle:x.labelBgStyle,labelBgPadding:x.labelBgPadding,labelBgBorderRadius:x.labelBgBorderRadius,sourceX:A,sourceY:S,targetX:$,targetY:H,sourcePosition:F,targetPosition:O,data:x.data,style:x.style,sourceHandleId:x.sourceHandle,targetHandleId:x.targetHandle,markerStart:G,markerEnd:Y,pathOptions:"pathOptions"in x?x.pathOptions:void 0,interactionWidth:x.interactionWidth}),T&&n.jsx(rm,{edge:x,isReconnectable:T,reconnectRadius:h,onReconnect:f,onReconnectStart:u,onReconnectEnd:m,sourceX:A,sourceY:S,targetX:$,targetY:H,sourcePosition:F,targetPosition:O,setUpdateHover:z,setReconnecting:j})]})})}var im=y.memo(om);const am=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function na({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:s,edgeTypes:r,noPanClassName:o,onReconnect:a,onEdgeContextMenu:i,onEdgeMouseEnter:l,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:h,reconnectRadius:f,onEdgeDoubleClick:u,onReconnectStart:m,onReconnectEnd:p,disableKeyboardA11y:b}){const{edgesFocusable:g,edgesReconnectable:v,elementsSelectable:N,onError:x}=ae(am,de),w=Y0(t);return n.jsxs("div",{className:"react-flow__edges",children:[n.jsx(U0,{defaultColor:e,rfId:s}),w.map(E=>n.jsx(im,{id:E,edgesFocusable:g,edgesReconnectable:v,elementsSelectable:N,noPanClassName:o,onReconnect:a,onContextMenu:i,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,onClick:h,reconnectRadius:f,onDoubleClick:u,onReconnectStart:m,onReconnectEnd:p,rfId:s,onError:x,edgeTypes:r,disableKeyboardA11y:b},E))]})}na.displayName="EdgeRenderer";const lm=y.memo(na),cm=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function dm({children:e}){const t=ae(cm);return n.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function um(e){const t=zn(),s=y.useRef(!1);y.useEffect(()=>{!s.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),s.current=!0)},[e,t.viewportInitialized])}const hm=e=>e.panZoom?.syncViewport;function fm(e){const t=ae(hm),s=ue();return y.useEffect(()=>{e&&(t?.(e),s.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function mm(e){return e.connection.inProgress?{...e.connection,to:Xt(e.connection.to,e.transform)}:{...e.connection}}function pm(e){return mm}function xm(e){const t=pm();return ae(t,de)}const gm=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function bm({containerStyle:e,style:t,type:s,component:r}){const{nodesConnectable:o,width:a,height:i,isValid:l,inProgress:c}=ae(gm,de);return!(a&&o&&c)?null:n.jsx("svg",{style:e,width:a,height:i,className:"react-flow__connectionline react-flow__container",children:n.jsx("g",{className:xe(["react-flow__connection",ti(l)]),children:n.jsx(sa,{style:t,type:s,CustomComponent:r,isValid:l})})})}const sa=({style:e,type:t=Ue.Bezier,CustomComponent:s,isValid:r})=>{const{inProgress:o,from:a,fromNode:i,fromHandle:l,fromPosition:c,to:d,toNode:h,toHandle:f,toPosition:u,pointer:m}=xm();if(!o)return;if(s)return n.jsx(s,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:l,fromX:a.x,fromY:a.y,toX:d.x,toY:d.y,fromPosition:c,toPosition:u,connectionStatus:ti(r),toNode:h,toHandle:f,pointer:m});let p="";const b={sourceX:a.x,sourceY:a.y,sourcePosition:c,targetX:d.x,targetY:d.y,targetPosition:u};switch(t){case Ue.Bezier:[p]=fi(b);break;case Ue.SimpleBezier:[p]=Gi(b);break;case Ue.Step:[p]=gs({...b,borderRadius:0});break;case Ue.SmoothStep:[p]=gs(b);break;default:[p]=pi(b)}return n.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:e})};sa.displayName="ConnectionLine";const ym={};function ro(e=ym){y.useRef(e),ue(),y.useEffect(()=>{},[e])}function vm(){ue(),y.useRef(!1),y.useEffect(()=>{},[])}function ra({nodeTypes:e,edgeTypes:t,onInit:s,onNodeClick:r,onEdgeClick:o,onNodeDoubleClick:a,onEdgeDoubleClick:i,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:h,onSelectionContextMenu:f,onSelectionStart:u,onSelectionEnd:m,connectionLineType:p,connectionLineStyle:b,connectionLineComponent:g,connectionLineContainerStyle:v,selectionKeyCode:N,selectionOnDrag:x,selectionMode:w,multiSelectionKeyCode:E,panActivationKeyCode:k,zoomActivationKeyCode:I,deleteKeyCode:T,onlyRenderVisibleElements:P,elementsSelectable:R,defaultViewport:C,translateExtent:z,minZoom:L,maxZoom:j,preventScrolling:M,defaultMarkerColor:_,zoomOnScroll:A,zoomOnPinch:S,panOnScroll:$,panOnScrollSpeed:H,panOnScrollMode:F,zoomOnDoubleClick:O,panOnDrag:G,onPaneClick:Y,onPaneMouseEnter:ee,onPaneMouseMove:K,onPaneMouseLeave:B,onPaneScroll:D,onPaneContextMenu:X,paneClickDistance:W,nodeClickDistance:se,onEdgeContextMenu:J,onEdgeMouseEnter:ne,onEdgeMouseMove:oe,onEdgeMouseLeave:le,reconnectRadius:ce,onReconnect:he,onReconnectStart:be,onReconnectEnd:ke,noDragClassName:Ee,noWheelClassName:Be,noPanClassName:U,disableKeyboardA11y:ve,nodeExtent:tt,rfId:Ye,viewport:qe,onViewportChange:nt}){return ro(e),ro(t),vm(),um(s),fm(qe),n.jsx(D0,{onPaneClick:Y,onPaneMouseEnter:ee,onPaneMouseMove:K,onPaneMouseLeave:B,onPaneContextMenu:X,onPaneScroll:D,paneClickDistance:W,deleteKeyCode:T,selectionKeyCode:N,selectionOnDrag:x,selectionMode:w,onSelectionStart:u,onSelectionEnd:m,multiSelectionKeyCode:E,panActivationKeyCode:k,zoomActivationKeyCode:I,elementsSelectable:R,zoomOnScroll:A,zoomOnPinch:S,zoomOnDoubleClick:O,panOnScroll:$,panOnScrollSpeed:H,panOnScrollMode:F,panOnDrag:G,defaultViewport:C,translateExtent:z,minZoom:L,maxZoom:j,onSelectionContextMenu:f,preventScrolling:M,noDragClassName:Ee,noWheelClassName:Be,noPanClassName:U,disableKeyboardA11y:ve,onViewportChange:nt,isControlledViewport:!!qe,children:n.jsxs(dm,{children:[n.jsx(lm,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:i,onReconnect:he,onReconnectStart:be,onReconnectEnd:ke,onlyRenderVisibleElements:P,onEdgeContextMenu:J,onEdgeMouseEnter:ne,onEdgeMouseMove:oe,onEdgeMouseLeave:le,reconnectRadius:ce,defaultMarkerColor:_,noPanClassName:U,disableKeyboardA11y:ve,rfId:Ye}),n.jsx(bm,{style:b,type:p,component:g,containerStyle:v}),n.jsx("div",{className:"react-flow__edgelabel-renderer"}),n.jsx(G0,{nodeTypes:e,onNodeClick:r,onNodeDoubleClick:a,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:h,nodeClickDistance:se,onlyRenderVisibleElements:P,noPanClassName:U,noDragClassName:Ee,disableKeyboardA11y:ve,nodeExtent:tt,rfId:Ye}),n.jsx("div",{className:"react-flow__viewport-portal"})]})})}ra.displayName="GraphView";const wm=y.memo(ra),oo=({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c=.5,maxZoom:d=2,nodeOrigin:h,nodeExtent:f,zIndexMode:u="basic"}={})=>{const m=new Map,p=new Map,b=new Map,g=new Map,v=r??t??[],N=s??e??[],x=h??[0,0],w=f??zt;bi(b,g,v);const E=ys(N,m,p,{nodeOrigin:x,nodeExtent:w,zIndexMode:u});let k=[0,0,1];if(i&&o&&a){const I=qt(m,{filter:C=>!!((C.width||C.initialWidth)&&(C.height||C.initialHeight))}),{x:T,y:P,zoom:R}=Ls(I,o,a,c,d,l?.padding??.1);k=[T,P,R]}return{rfId:"1",width:o??0,height:a??0,transform:k,nodes:N,nodesInitialized:E,nodeLookup:m,parentLookup:p,edges:v,edgeLookup:g,connectionLookup:b,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:s!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:c,maxZoom:d,translateExtent:zt,nodeExtent:w,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:yt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:x,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:l,fitViewResolver:null,connection:{...ei},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Dh,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Ko,zIndexMode:u,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},jm=({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c,maxZoom:d,nodeOrigin:h,nodeExtent:f,zIndexMode:u})=>Hf((m,p)=>{async function b(){const{nodeLookup:g,panZoom:v,fitViewOptions:N,fitViewResolver:x,width:w,height:E,minZoom:k,maxZoom:I}=p();v&&(await $h({nodes:g,width:w,height:E,panZoom:v,minZoom:k,maxZoom:I},N),x?.resolve(!0),m({fitViewResolver:null}))}return{...oo({nodes:e,edges:t,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c,maxZoom:d,nodeOrigin:h,nodeExtent:f,defaultNodes:s,defaultEdges:r,zIndexMode:u}),setNodes:g=>{const{nodeLookup:v,parentLookup:N,nodeOrigin:x,elevateNodesOnSelect:w,fitViewQueued:E,zIndexMode:k}=p(),I=ys(g,v,N,{nodeOrigin:x,nodeExtent:f,elevateNodesOnSelect:w,checkEquality:!0,zIndexMode:k});E&&I?(b(),m({nodes:g,nodesInitialized:I,fitViewQueued:!1,fitViewOptions:void 0})):m({nodes:g,nodesInitialized:I})},setEdges:g=>{const{connectionLookup:v,edgeLookup:N}=p();bi(v,N,g),m({edges:g})},setDefaultNodesAndEdges:(g,v)=>{if(g){const{setNodes:N}=p();N(g),m({hasDefaultNodes:!0})}if(v){const{setEdges:N}=p();N(v),m({hasDefaultEdges:!0})}},updateNodeInternals:g=>{const{triggerNodeChanges:v,nodeLookup:N,parentLookup:x,domNode:w,nodeOrigin:E,nodeExtent:k,debug:I,fitViewQueued:T,zIndexMode:P}=p(),{changes:R,updatedInternals:C}=sf(g,N,x,w,E,k,P);C&&(Kh(N,x,{nodeOrigin:E,nodeExtent:k,zIndexMode:P}),T?(b(),m({fitViewQueued:!1,fitViewOptions:void 0})):m({}),R?.length>0&&(I&&console.log("React Flow: trigger node changes",R),v?.(R)))},updateNodePositions:(g,v=!1)=>{const N=[];let x=[];const{nodeLookup:w,triggerNodeChanges:E,connection:k,updateConnection:I,onNodesChangeMiddlewareMap:T}=p();for(const[P,R]of g){const C=w.get(P),z=!!(C?.expandParent&&C?.parentId&&R?.position),L={id:P,type:"position",position:z?{x:Math.max(0,R.position.x),y:Math.max(0,R.position.y)}:R.position,dragging:v};if(C&&k.inProgress&&k.fromNode.id===C.id){const j=dt(C,k.fromHandle,te.Left,!0);I({...k,from:j})}z&&C.parentId&&N.push({id:P,parentId:C.parentId,rect:{...R.internals.positionAbsolute,width:R.measured.width??0,height:R.measured.height??0}}),x.push(L)}if(N.length>0){const{parentLookup:P,nodeOrigin:R}=p(),C=Gs(N,w,P,R);x.push(...C)}for(const P of T.values())x=P(x);E(x)},triggerNodeChanges:g=>{const{onNodesChange:v,setNodes:N,nodes:x,hasDefaultNodes:w,debug:E}=p();if(g?.length){if(w){const k=$i(g,x);N(k)}E&&console.log("React Flow: trigger node changes",g),v?.(g)}},triggerEdgeChanges:g=>{const{onEdgesChange:v,setEdges:N,edges:x,hasDefaultEdges:w,debug:E}=p();if(g?.length){if(w){const k=Pi(g,x);N(k)}E&&console.log("React Flow: trigger edge changes",g),v?.(g)}},addSelectedNodes:g=>{const{multiSelectionActive:v,edgeLookup:N,nodeLookup:x,triggerNodeChanges:w,triggerEdgeChanges:E}=p();if(v){const k=g.map(I=>st(I,!0));w(k);return}w(mt(x,new Set([...g]),!0)),E(mt(N))},addSelectedEdges:g=>{const{multiSelectionActive:v,edgeLookup:N,nodeLookup:x,triggerNodeChanges:w,triggerEdgeChanges:E}=p();if(v){const k=g.map(I=>st(I,!0));E(k);return}E(mt(N,new Set([...g]))),w(mt(x,new Set,!0))},unselectNodesAndEdges:({nodes:g,edges:v}={})=>{const{edges:N,nodes:x,nodeLookup:w,triggerNodeChanges:E,triggerEdgeChanges:k}=p(),I=g||x,T=v||N,P=I.map(C=>{const z=w.get(C.id);return z&&(z.selected=!1),st(C.id,!1)}),R=T.map(C=>st(C.id,!1));E(P),k(R)},setMinZoom:g=>{const{panZoom:v,maxZoom:N}=p();v?.setScaleExtent([g,N]),m({minZoom:g})},setMaxZoom:g=>{const{panZoom:v,minZoom:N}=p();v?.setScaleExtent([N,g]),m({maxZoom:g})},setTranslateExtent:g=>{p().panZoom?.setTranslateExtent(g),m({translateExtent:g})},resetSelectedElements:()=>{const{edges:g,nodes:v,triggerNodeChanges:N,triggerEdgeChanges:x,elementsSelectable:w}=p();if(!w)return;const E=v.reduce((I,T)=>T.selected?[...I,st(T.id,!1)]:I,[]),k=g.reduce((I,T)=>T.selected?[...I,st(T.id,!1)]:I,[]);N(E),x(k)},setNodeExtent:g=>{const{nodes:v,nodeLookup:N,parentLookup:x,nodeOrigin:w,elevateNodesOnSelect:E,nodeExtent:k,zIndexMode:I}=p();g[0][0]===k[0][0]&&g[0][1]===k[0][1]&&g[1][0]===k[1][0]&&g[1][1]===k[1][1]||(ys(v,N,x,{nodeOrigin:w,nodeExtent:g,elevateNodesOnSelect:E,checkEquality:!1,zIndexMode:I}),m({nodeExtent:g}))},panBy:g=>{const{transform:v,width:N,height:x,panZoom:w,translateExtent:E}=p();return rf({delta:g,panZoom:w,transform:v,translateExtent:E,width:N,height:x})},setCenter:async(g,v,N)=>{const{width:x,height:w,maxZoom:E,panZoom:k}=p();if(!k)return Promise.resolve(!1);const I=typeof N?.zoom<"u"?N.zoom:E;return await k.setViewport({x:x/2-g*I,y:w/2-v*I,zoom:I},{duration:N?.duration,ease:N?.ease,interpolate:N?.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{m({connection:{...ei}})},updateConnection:g=>{m({connection:g})},reset:()=>m({...oo()})}},Object.is);function oa({initialNodes:e,initialEdges:t,defaultNodes:s,defaultEdges:r,initialWidth:o,initialHeight:a,initialMinZoom:i,initialMaxZoom:l,initialFitViewOptions:c,fitView:d,nodeOrigin:h,nodeExtent:f,zIndexMode:u,children:m}){const[p]=y.useState(()=>jm({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:d,minZoom:i,maxZoom:l,fitViewOptions:c,nodeOrigin:h,nodeExtent:f,zIndexMode:u}));return n.jsx(Of,{value:p,children:n.jsx(d0,{children:m})})}function Nm({children:e,nodes:t,edges:s,defaultNodes:r,defaultEdges:o,width:a,height:i,fitView:l,fitViewOptions:c,minZoom:d,maxZoom:h,nodeOrigin:f,nodeExtent:u,zIndexMode:m}){return y.useContext(Pn)?n.jsx(n.Fragment,{children:e}):n.jsx(oa,{initialNodes:t,initialEdges:s,defaultNodes:r,defaultEdges:o,initialWidth:a,initialHeight:i,fitView:l,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:h,nodeOrigin:f,nodeExtent:u,zIndexMode:m,children:e})}const km={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Cm({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,className:o,nodeTypes:a,edgeTypes:i,onNodeClick:l,onEdgeClick:c,onInit:d,onMove:h,onMoveStart:f,onMoveEnd:u,onConnect:m,onConnectStart:p,onConnectEnd:b,onClickConnectStart:g,onClickConnectEnd:v,onNodeMouseEnter:N,onNodeMouseMove:x,onNodeMouseLeave:w,onNodeContextMenu:E,onNodeDoubleClick:k,onNodeDragStart:I,onNodeDrag:T,onNodeDragStop:P,onNodesDelete:R,onEdgesDelete:C,onDelete:z,onSelectionChange:L,onSelectionDragStart:j,onSelectionDrag:M,onSelectionDragStop:_,onSelectionContextMenu:A,onSelectionStart:S,onSelectionEnd:$,onBeforeDelete:H,connectionMode:F,connectionLineType:O=Ue.Bezier,connectionLineStyle:G,connectionLineComponent:Y,connectionLineContainerStyle:ee,deleteKeyCode:K="Backspace",selectionKeyCode:B="Shift",selectionOnDrag:D=!1,selectionMode:X=Rt.Full,panActivationKeyCode:W="Space",multiSelectionKeyCode:se=Bt()?"Meta":"Control",zoomActivationKeyCode:J=Bt()?"Meta":"Control",snapToGrid:ne,snapGrid:oe,onlyRenderVisibleElements:le=!1,selectNodesOnDrag:ce,nodesDraggable:he,autoPanOnNodeFocus:be,nodesConnectable:ke,nodesFocusable:Ee,nodeOrigin:Be=Ai,edgesFocusable:U,edgesReconnectable:ve,elementsSelectable:tt=!0,defaultViewport:Ye=e0,minZoom:qe=.5,maxZoom:nt=2,translateExtent:He=zt,preventScrolling:V=!0,nodeExtent:Z,defaultMarkerColor:Q="#b1b1b7",zoomOnScroll:q=!0,zoomOnPinch:ie=!0,panOnScroll:fe=!1,panOnScrollSpeed:pe=.5,panOnScrollMode:Ze=it.Free,zoomOnDoubleClick:we=!0,panOnDrag:Wt=!0,onPaneClick:Ut,onPaneMouseEnter:Bn,onPaneMouseMove:ca,onPaneMouseLeave:da,onPaneScroll:ua,onPaneContextMenu:ha,paneClickDistance:fa=1,nodeClickDistance:ma=0,children:pa,onReconnect:xa,onReconnectStart:ga,onReconnectEnd:ba,onEdgeContextMenu:ya,onEdgeDoubleClick:va,onEdgeMouseEnter:wa,onEdgeMouseMove:ja,onEdgeMouseLeave:Na,reconnectRadius:ka=10,onNodesChange:Ca,onEdgesChange:Sa,noDragClassName:_a="nodrag",noWheelClassName:Ea="nowheel",noPanClassName:qs="nopan",fitView:Zs,fitViewOptions:Xs,connectOnClick:Ia,attributionPosition:Ma,proOptions:Aa,defaultEdgeOptions:Ta,elevateNodesOnSelect:$a=!0,elevateEdgesOnSelect:Pa=!1,disableKeyboardA11y:Ws=!1,autoPanOnConnect:Da,autoPanOnNodeDrag:za,autoPanSpeed:Ra,connectionRadius:La,isValidConnection:Ba,onError:Ha,style:Oa,id:Us,nodeDragThreshold:Va,connectionDragThreshold:Fa,viewport:Ga,onViewportChange:Ya,width:qa,height:Za,colorMode:Xa="light",debug:Wa,onScroll:Js,ariaLabelConfig:Ua,zIndexMode:Qs="basic",...Ja},Qa){const Hn=Us||"1",Ka=r0(Xa),el=y.useCallback(Ks=>{Ks.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Js?.(Ks)},[Js]);return n.jsx("div",{"data-testid":"rf__wrapper",...Ja,onScroll:el,style:{...Oa,...km},ref:Qa,className:xe(["react-flow",o,Ka]),id:Us,role:"application",children:n.jsxs(Nm,{nodes:e,edges:t,width:qa,height:Za,fitView:Zs,fitViewOptions:Xs,minZoom:qe,maxZoom:nt,nodeOrigin:Be,nodeExtent:Z,zIndexMode:Qs,children:[n.jsx(wm,{onInit:d,onNodeClick:l,onEdgeClick:c,onNodeMouseEnter:N,onNodeMouseMove:x,onNodeMouseLeave:w,onNodeContextMenu:E,onNodeDoubleClick:k,nodeTypes:a,edgeTypes:i,connectionLineType:O,connectionLineStyle:G,connectionLineComponent:Y,connectionLineContainerStyle:ee,selectionKeyCode:B,selectionOnDrag:D,selectionMode:X,deleteKeyCode:K,multiSelectionKeyCode:se,panActivationKeyCode:W,zoomActivationKeyCode:J,onlyRenderVisibleElements:le,defaultViewport:Ye,translateExtent:He,minZoom:qe,maxZoom:nt,preventScrolling:V,zoomOnScroll:q,zoomOnPinch:ie,zoomOnDoubleClick:we,panOnScroll:fe,panOnScrollSpeed:pe,panOnScrollMode:Ze,panOnDrag:Wt,onPaneClick:Ut,onPaneMouseEnter:Bn,onPaneMouseMove:ca,onPaneMouseLeave:da,onPaneScroll:ua,onPaneContextMenu:ha,paneClickDistance:fa,nodeClickDistance:ma,onSelectionContextMenu:A,onSelectionStart:S,onSelectionEnd:$,onReconnect:xa,onReconnectStart:ga,onReconnectEnd:ba,onEdgeContextMenu:ya,onEdgeDoubleClick:va,onEdgeMouseEnter:wa,onEdgeMouseMove:ja,onEdgeMouseLeave:Na,reconnectRadius:ka,defaultMarkerColor:Q,noDragClassName:_a,noWheelClassName:Ea,noPanClassName:qs,rfId:Hn,disableKeyboardA11y:Ws,nodeExtent:Z,viewport:Ga,onViewportChange:Ya}),n.jsx(s0,{nodes:e,edges:t,defaultNodes:s,defaultEdges:r,onConnect:m,onConnectStart:p,onConnectEnd:b,onClickConnectStart:g,onClickConnectEnd:v,nodesDraggable:he,autoPanOnNodeFocus:be,nodesConnectable:ke,nodesFocusable:Ee,edgesFocusable:U,edgesReconnectable:ve,elementsSelectable:tt,elevateNodesOnSelect:$a,elevateEdgesOnSelect:Pa,minZoom:qe,maxZoom:nt,nodeExtent:Z,onNodesChange:Ca,onEdgesChange:Sa,snapToGrid:ne,snapGrid:oe,connectionMode:F,translateExtent:He,connectOnClick:Ia,defaultEdgeOptions:Ta,fitView:Zs,fitViewOptions:Xs,onNodesDelete:R,onEdgesDelete:C,onDelete:z,onNodeDragStart:I,onNodeDrag:T,onNodeDragStop:P,onSelectionDrag:M,onSelectionDragStart:j,onSelectionDragStop:_,onMove:h,onMoveStart:f,onMoveEnd:u,noPanClassName:qs,nodeOrigin:Be,rfId:Hn,autoPanOnConnect:Da,autoPanOnNodeDrag:za,autoPanSpeed:Ra,onError:Ha,connectionRadius:La,isValidConnection:Ba,selectNodesOnDrag:ce,nodeDragThreshold:Va,connectionDragThreshold:Fa,onBeforeDelete:H,debug:Wa,ariaLabelConfig:Ua,zIndexMode:Qs}),n.jsx(Kf,{onSelectionChange:L}),pa,n.jsx(Xf,{proOptions:Aa,position:Ma}),n.jsx(Zf,{rfId:Hn,disableKeyboardA11y:Ws})]})})}var Sm=Di(Cm);function _m(e){const[t,s]=y.useState(e),r=y.useCallback(o=>s(a=>$i(o,a)),[]);return[t,s,r]}function Em(e){const[t,s]=y.useState(e),r=y.useCallback(o=>s(a=>Pi(o,a)),[]);return[t,s,r]}function Im({dimensions:e,lineWidth:t,variant:s,className:r}){return n.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:xe(["react-flow__background-pattern",s,r])})}function Mm({radius:e,className:t}){return n.jsx("circle",{cx:e,cy:e,r:e,className:xe(["react-flow__background-pattern","dots",t])})}var Ke;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ke||(Ke={}));const Am={[Ke.Dots]:1,[Ke.Lines]:1,[Ke.Cross]:6},Tm=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ia({id:e,variant:t=Ke.Dots,gap:s=20,size:r,lineWidth:o=1,offset:a=0,color:i,bgColor:l,style:c,className:d,patternClassName:h}){const f=y.useRef(null),{transform:u,patternId:m}=ae(Tm,de),p=r||Am[t],b=t===Ke.Dots,g=t===Ke.Cross,v=Array.isArray(s)?s:[s,s],N=[v[0]*u[2]||1,v[1]*u[2]||1],x=p*u[2],w=Array.isArray(a)?a:[a,a],E=g?[x,x]:N,k=[w[0]*u[2]||1+E[0]/2,w[1]*u[2]||1+E[1]/2],I=`${m}${e||""}`;return n.jsxs("svg",{className:xe(["react-flow__background",d]),style:{...c,...Rn,"--xy-background-color-props":l,"--xy-background-pattern-color-props":i},ref:f,"data-testid":"rf__background",children:[n.jsx("pattern",{id:I,x:u[0]%N[0],y:u[1]%N[1],width:N[0],height:N[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${k[0]},-${k[1]})`,children:b?n.jsx(Mm,{radius:x/2,className:h}):n.jsx(Im,{dimensions:E,lineWidth:o,variant:t,className:h})}),n.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${I})`})]})}ia.displayName="Background";const $m=y.memo(ia);function Pm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:n.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Dm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:n.jsx("path",{d:"M0 0h32v4.2H0z"})})}function zm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:n.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Rm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:n.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Lm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:n.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function on({children:e,className:t,...s}){return n.jsx("button",{type:"button",className:xe(["react-flow__controls-button",t]),...s,children:e})}const Bm=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function aa({style:e,showZoom:t=!0,showFitView:s=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:a,onZoomOut:i,onFitView:l,onInteractiveChange:c,className:d,children:h,position:f="bottom-left",orientation:u="vertical","aria-label":m}){const p=ue(),{isInteractive:b,minZoomReached:g,maxZoomReached:v,ariaLabelConfig:N}=ae(Bm,de),{zoomIn:x,zoomOut:w,fitView:E}=zn(),k=()=>{x(),a?.()},I=()=>{w(),i?.()},T=()=>{E(o),l?.()},P=()=>{p.setState({nodesDraggable:!b,nodesConnectable:!b,elementsSelectable:!b}),c?.(!b)},R=u==="horizontal"?"horizontal":"vertical";return n.jsxs(Dn,{className:xe(["react-flow__controls",R,d]),position:f,style:e,"data-testid":"rf__controls","aria-label":m??N["controls.ariaLabel"],children:[t&&n.jsxs(n.Fragment,{children:[n.jsx(on,{onClick:k,className:"react-flow__controls-zoomin",title:N["controls.zoomIn.ariaLabel"],"aria-label":N["controls.zoomIn.ariaLabel"],disabled:v,children:n.jsx(Pm,{})}),n.jsx(on,{onClick:I,className:"react-flow__controls-zoomout",title:N["controls.zoomOut.ariaLabel"],"aria-label":N["controls.zoomOut.ariaLabel"],disabled:g,children:n.jsx(Dm,{})})]}),s&&n.jsx(on,{className:"react-flow__controls-fitview",onClick:T,title:N["controls.fitView.ariaLabel"],"aria-label":N["controls.fitView.ariaLabel"],children:n.jsx(zm,{})}),r&&n.jsx(on,{className:"react-flow__controls-interactive",onClick:P,title:N["controls.interactive.ariaLabel"],"aria-label":N["controls.interactive.ariaLabel"],children:b?n.jsx(Lm,{}):n.jsx(Rm,{})}),h]})}aa.displayName="Controls";const Hm=y.memo(aa);function Om({id:e,x:t,y:s,width:r,height:o,style:a,color:i,strokeColor:l,strokeWidth:c,className:d,borderRadius:h,shapeRendering:f,selected:u,onClick:m}){const{background:p,backgroundColor:b}=a||{},g=i||p||b;return n.jsx("rect",{className:xe(["react-flow__minimap-node",{selected:u},d]),x:t,y:s,rx:h,ry:h,width:r,height:o,style:{fill:g,stroke:l,strokeWidth:c},shapeRendering:f,onClick:m?v=>m(v,e):void 0})}const Vm=y.memo(Om),Fm=e=>e.nodes.map(t=>t.id),Kn=e=>e instanceof Function?e:()=>e;function Gm({nodeStrokeColor:e,nodeColor:t,nodeClassName:s="",nodeBorderRadius:r=5,nodeStrokeWidth:o,nodeComponent:a=Vm,onClick:i}){const l=ae(Fm,de),c=Kn(t),d=Kn(e),h=Kn(s),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return n.jsx(n.Fragment,{children:l.map(u=>n.jsx(qm,{id:u,nodeColorFunc:c,nodeStrokeColorFunc:d,nodeClassNameFunc:h,nodeBorderRadius:r,nodeStrokeWidth:o,NodeComponent:a,onClick:i,shapeRendering:f},u))})}function Ym({id:e,nodeColorFunc:t,nodeStrokeColorFunc:s,nodeClassNameFunc:r,nodeBorderRadius:o,nodeStrokeWidth:a,shapeRendering:i,NodeComponent:l,onClick:c}){const{node:d,x:h,y:f,width:u,height:m}=ae(p=>{const{internals:b}=p.nodeLookup.get(e),g=b.userNode,{x:v,y:N}=b.positionAbsolute,{width:x,height:w}=Ge(g);return{node:g,x:v,y:N,width:x,height:w}},de);return!d||d.hidden||!ai(d)?null:n.jsx(l,{x:h,y:f,width:u,height:m,style:d.style,selected:!!d.selected,className:r(d),color:t(d),borderRadius:o,strokeColor:s(d),strokeWidth:a,shapeRendering:i,onClick:c,id:d.id})}const qm=y.memo(Ym);var Zm=y.memo(Gm);const Xm=200,Wm=150,Um=e=>!e.hidden,Jm=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ii(qt(e.nodeLookup,{filter:Um}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Qm="react-flow__minimap-desc";function la({style:e,className:t,nodeStrokeColor:s,nodeColor:r,nodeClassName:o="",nodeBorderRadius:a=5,nodeStrokeWidth:i,nodeComponent:l,bgColor:c,maskColor:d,maskStrokeColor:h,maskStrokeWidth:f,position:u="bottom-right",onClick:m,onNodeClick:p,pannable:b=!1,zoomable:g=!1,ariaLabel:v,inversePan:N,zoomStep:x=1,offsetScale:w=5}){const E=ue(),k=y.useRef(null),{boundingRect:I,viewBB:T,rfId:P,panZoom:R,translateExtent:C,flowWidth:z,flowHeight:L,ariaLabelConfig:j}=ae(Jm,de),M=e?.width??Xm,_=e?.height??Wm,A=I.width/M,S=I.height/_,$=Math.max(A,S),H=$*M,F=$*_,O=w*$,G=I.x-(H-I.width)/2-O,Y=I.y-(F-I.height)/2-O,ee=H+O*2,K=F+O*2,B=`${Qm}-${P}`,D=y.useRef(0),X=y.useRef();D.current=$,y.useEffect(()=>{if(k.current&&R)return X.current=mf({domNode:k.current,panZoom:R,getTransform:()=>E.getState().transform,getViewScale:()=>D.current}),()=>{X.current?.destroy()}},[R]),y.useEffect(()=>{X.current?.update({translateExtent:C,width:z,height:L,inversePan:N,pannable:b,zoomStep:x,zoomable:g})},[b,g,N,x,C,z,L]);const W=m?ne=>{const[oe,le]=X.current?.pointer(ne)||[0,0];m(ne,{x:oe,y:le})}:void 0,se=p?y.useCallback((ne,oe)=>{const le=E.getState().nodeLookup.get(oe).internals.userNode;p(ne,le)},[]):void 0,J=v??j["minimap.ariaLabel"];return n.jsx(Dn,{position:u,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-color-props":typeof h=="string"?h:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*$:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:xe(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:n.jsxs("svg",{width:M,height:_,viewBox:`${G} ${Y} ${ee} ${K}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":B,ref:k,onClick:W,children:[J&&n.jsx("title",{id:B,children:J}),n.jsx(Zm,{onClick:se,nodeColor:r,nodeStrokeColor:s,nodeBorderRadius:a,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:l}),n.jsx("path",{className:"react-flow__minimap-mask",d:`M${G-O},${Y-O}h${ee+O*2}v${K+O*2}h${-ee-O*2}z
        M${T.x},${T.y}h${T.width}v${T.height}h${-T.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}la.displayName="MiniMap";const Km=y.memo(la),ep=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,tp={[kt.Line]:"right",[kt.Handle]:"bottom-right"};function np({nodeId:e,position:t,variant:s=kt.Handle,className:r,style:o=void 0,children:a,color:i,minWidth:l=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:h=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:u,autoScale:m=!0,shouldResize:p,onResizeStart:b,onResize:g,onResizeEnd:v}){const N=Bi(),x=typeof e=="string"?e:N,w=ue(),E=y.useRef(null),k=s===kt.Handle,I=ae(y.useCallback(ep(k&&m),[k,m]),de),T=y.useRef(null),P=t??tp[s];y.useEffect(()=>{if(!(!E.current||!x))return T.current||(T.current=Ef({domNode:E.current,nodeId:x,getStoreItems:()=>{const{nodeLookup:C,transform:z,snapGrid:L,snapToGrid:j,nodeOrigin:M,domNode:_}=w.getState();return{nodeLookup:C,transform:z,snapGrid:L,snapToGrid:j,nodeOrigin:M,paneDomNode:_}},onChange:(C,z)=>{const{triggerNodeChanges:L,nodeLookup:j,parentLookup:M,nodeOrigin:_}=w.getState(),A=[],S={x:C.x,y:C.y},$=j.get(x);if($&&$.expandParent&&$.parentId){const H=$.origin??_,F=C.width??$.measured.width??0,O=C.height??$.measured.height??0,G={id:$.id,parentId:$.parentId,rect:{width:F,height:O,...li({x:C.x??$.position.x,y:C.y??$.position.y},{width:F,height:O},$.parentId,j,H)}},Y=Gs([G],j,M,_);A.push(...Y),S.x=C.x?Math.max(H[0]*F,C.x):void 0,S.y=C.y?Math.max(H[1]*O,C.y):void 0}if(S.x!==void 0&&S.y!==void 0){const H={id:x,type:"position",position:{...S}};A.push(H)}if(C.width!==void 0&&C.height!==void 0){const F={id:x,type:"dimensions",resizing:!0,setAttributes:u?u==="horizontal"?"width":"height":!0,dimensions:{width:C.width,height:C.height}};A.push(F)}for(const H of z){const F={...H,type:"position"};A.push(F)}L(A)},onEnd:({width:C,height:z})=>{const L={id:x,type:"dimensions",resizing:!1,dimensions:{width:C,height:z}};w.getState().triggerNodeChanges([L])}})),T.current.update({controlPosition:P,boundaries:{minWidth:l,minHeight:c,maxWidth:d,maxHeight:h},keepAspectRatio:f,resizeDirection:u,onResizeStart:b,onResize:g,onResizeEnd:v,shouldResize:p}),()=>{T.current?.destroy()}},[P,l,c,d,h,f,b,g,v,p]);const R=P.split("-");return n.jsx("div",{className:xe(["react-flow__resize-control","nodrag",...R,s,r]),ref:E,style:{...o,scale:I,...i&&{[k?"backgroundColor":"borderColor"]:i}},children:a})}y.memo(np);function je({icon:e,onClick:t,active:s,title:r}){return n.jsx("button",{type:"button",onClick:t,title:r,className:`p-2 rounded-lg transition-colors ${s?"bg-blue-500 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,children:e})}function sp({value:e,onChange:t,direction:s="rtl",placeholder:r=" ...",className:o=""}){const a=y.useRef(null),[i,l]=y.useState(null),[c,d]=y.useState(""),[h,f]=y.useState(""),u=y.useCallback((g,v)=>{document.execCommand(g,!1,v),a.current?.focus(),m()},[]),m=y.useCallback(()=>{a.current&&t(a.current.innerHTML)},[t]),p=y.useCallback(g=>{if(!c)return;let v="";if(g==="image")v=`<img src="${c}" alt="${h}" class="inline-media rounded-lg max-w-full my-2" />`;else if(c.includes("youtube.com")||c.includes("youtu.be")){const N=c.match(/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/\s]{11})/)?.[1];N&&(v=`<iframe src="https://www.youtube.com/embed/${N}" class="inline-media rounded-lg w-full aspect-video my-2" frameborder="0" allowfullscreen></iframe>`)}else v=`<video src="${c}" controls class="inline-media rounded-lg max-w-full my-2"></video>`;v&&(document.execCommand("insertHTML",!1,v),m()),l(null),d(""),f("")},[c,h,m]),b=y.useCallback(()=>{const g=prompt(" :");g&&u("createLink",g)},[u]);return n.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 overflow-hidden ${o}`,children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 border-b border-slate-700 bg-slate-900/50",children:[n.jsx(je,{icon:n.jsx(xl,{className:"w-4 h-4"}),onClick:()=>u("bold"),title:""}),n.jsx(je,{icon:n.jsx(jl,{className:"w-4 h-4"}),onClick:()=>u("italic"),title:""}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(je,{icon:n.jsx(vl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","h1"),title:" "}),n.jsx(je,{icon:n.jsx(wl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","h2"),title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(je,{icon:n.jsx(Sl,{className:"w-4 h-4"}),onClick:()=>u("insertUnorderedList"),title:" "}),n.jsx(je,{icon:n.jsx(Cl,{className:"w-4 h-4"}),onClick:()=>u("insertOrderedList"),title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(je,{icon:n.jsx(et,{className:"w-4 h-4"}),onClick:()=>l("image"),title:" "}),n.jsx(je,{icon:n.jsx(ut,{className:"w-4 h-4"}),onClick:()=>l("video"),title:" "}),n.jsx(je,{icon:n.jsx(mo,{className:"w-4 h-4"}),onClick:b,title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(je,{icon:n.jsx(Pl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","blockquote"),title:""}),n.jsx(je,{icon:n.jsx(kn,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","pre"),title:""}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(je,{icon:s==="rtl"?n.jsx(pl,{className:"w-4 h-4"}):n.jsx(ml,{className:"w-4 h-4"}),onClick:()=>{a.current&&(a.current.dir=a.current.dir==="rtl"?"ltr":"rtl")},title:" "}),n.jsx("div",{className:"flex-1"}),n.jsx(je,{icon:n.jsx(Hl,{className:"w-4 h-4"}),onClick:()=>u("undo"),title:""}),n.jsx(je,{icon:n.jsx(Dl,{className:"w-4 h-4"}),onClick:()=>u("redo"),title:""})]}),n.jsx("div",{ref:a,contentEditable:!0,dir:s,className:`min-h-[200px] p-4 outline-none rich-text-content ${s==="rtl"?"rtl":""}`,onInput:m,dangerouslySetInnerHTML:{__html:e},"data-placeholder":r,style:{minHeight:"200px"}}),i&&n.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:i==="image"?" ":" "}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:i==="image"?" ":" "}),n.jsx("input",{type:"url",value:c,onChange:g=>d(g.target.value),placeholder:i==="image"?"https://example.com/image.jpg":"https://youtube.com/watch?v=...",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",dir:"ltr"})]}),i==="image"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"  ()"}),n.jsx("input",{type:"text",value:h,onChange:g=>f(g.target.value),placeholder:" ",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),i==="video"&&n.jsx("p",{className:"text-sm text-slate-400",children:"   YouTube    "})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:()=>{l(null),d(""),f("")},className:"flex-1 px-4 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:""}),n.jsx("button",{onClick:()=>p(i),disabled:!c,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:""})]})]})})]})}function rp({onRecordingComplete:e,onClose:t,showLibrarySave:s=!0}){const[r,o]=y.useState(null),[a,i]=y.useState("idle"),[l,c]=y.useState(0),[d,h]=y.useState(null),[f,u]=y.useState(null),[m,p]=y.useState(!0),b=y.useRef(null),g=y.useRef(null),v=y.useRef(null),N=y.useRef(null),x=y.useRef([]),w=y.useRef(null),E=y.useRef(null),k=y.useRef(null),I=y.useRef(null);y.useEffect(()=>()=>{T(),k.current&&clearInterval(k.current),I.current&&cancelAnimationFrame(I.current)},[]);const T=y.useCallback(()=>{w.current&&(w.current.getTracks().forEach(A=>A.stop()),w.current=null),E.current&&(E.current.getTracks().forEach(A=>A.stop()),E.current=null)},[]),P=y.useCallback(async A=>{u(null),i("preparing"),o(A),x.current=[];try{let S;if(A==="camera")S=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:"user"},audio:m}),w.current=S,b.current&&(b.current.srcObject=S,await b.current.play());else if(A==="screen"){const H=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080},audio:!0});if(m)try{const O=(await navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0];H.addTrack(O)}catch{console.log("Could not add microphone audio")}S=H,w.current=S,b.current&&(b.current.srcObject=S,await b.current.play())}else{const H=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080},audio:!1}),F=await navigator.mediaDevices.getUserMedia({video:{width:320,height:240,facingMode:"user"},audio:m});w.current=H,E.current=F,b.current&&(b.current.srcObject=H,await b.current.play()),g.current&&(g.current.srcObject=F,await g.current.play());const O=v.current,G=O.getContext("2d");O.width=1920,O.height=1080;const Y=()=>{if(a==="stopped")return;G.drawImage(b.current,0,0,O.width,O.height);const K=320,B=240,D=20;G.save(),G.beginPath(),G.arc(O.width-D-K/2,O.height-D-B/2,Math.min(K,B)/2,0,Math.PI*2),G.clip(),G.drawImage(g.current,O.width-D-K,O.height-D-B,K,B),G.restore(),I.current=requestAnimationFrame(Y)};Y();const ee=O.captureStream(30);m&&F.getAudioTracks().length>0&&ee.addTrack(F.getAudioTracks()[0]),S=ee}const $=new MediaRecorder(S,{mimeType:"video/webm;codecs=vp9"});$.ondataavailable=H=>{H.data.size>0&&x.current.push(H.data)},$.onstop=()=>{const H=new Blob(x.current,{type:"video/webm"});h(H),i("stopped"),T(),I.current&&cancelAnimationFrame(I.current)},N.current=$,$.start(1e3),i("recording"),c(0),k.current=window.setInterval(()=>{c(H=>H+1)},1e3)}catch(S){console.error("Recording error:",S),u("   .     ."),i("idle"),o(null),T()}},[m,T]),R=y.useCallback(()=>{N.current&&a==="recording"&&(N.current.pause(),i("paused"),k.current&&clearInterval(k.current))},[a]),C=y.useCallback(()=>{N.current&&a==="paused"&&(N.current.resume(),i("recording"),k.current=window.setInterval(()=>{c(A=>A+1)},1e3))},[a]),z=y.useCallback(()=>{N.current&&(N.current.stop(),k.current&&clearInterval(k.current))},[]),L=y.useCallback(()=>{h(null),i("idle"),o(null),c(0),u(null),T()},[T]),j=y.useCallback(()=>{d&&r&&e&&e(d,r)},[d,r,e]),M=y.useCallback(()=>{if(d){const A=URL.createObjectURL(d),S=document.createElement("a");S.href=A,S.download=`recording-${Date.now()}.webm`,S.click(),URL.revokeObjectURL(A)}},[d]),_=A=>{const S=Math.floor(A/60),$=A%60;return`${S.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`};return n.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h3",{className:"text-lg font-bold text-white",children:" "}),t&&n.jsx("button",{onClick:t,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-4",children:[a==="idle"&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{className:"text-slate-300 text-center mb-6",children:"  "}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[n.jsxs("button",{onClick:()=>P("camera"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-500/20 flex items-center justify-center group-hover:bg-blue-500/30 transition-colors",children:n.jsx(bo,{className:"w-7 h-7 text-blue-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:""}),n.jsx("div",{className:"text-xs text-slate-400",children:"   "})]})]}),n.jsxs("button",{onClick:()=>P("screen"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-emerald-500/20 flex items-center justify-center group-hover:bg-emerald-500/30 transition-colors",children:n.jsx(Al,{className:"w-7 h-7 text-emerald-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:""}),n.jsx("div",{className:"text-xs text-slate-400",children:"  "})]})]}),n.jsxs("button",{onClick:()=>P("camera_screen"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-amber-500/20 flex items-center justify-center group-hover:bg-amber-500/30 transition-colors",children:n.jsx(Ml,{className:"w-7 h-7 text-amber-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:" + "}),n.jsx("div",{className:"text-xs text-slate-400",children:" Loom"})]})]})]}),n.jsx("div",{className:"flex items-center justify-center gap-2 pt-4",children:n.jsxs("button",{onClick:()=>p(!m),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${m?"bg-blue-500/20 text-blue-400":"bg-slate-700 text-slate-400"}`,children:[m?n.jsx(Il,{className:"w-4 h-4"}):n.jsx(El,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:m?" ":" "})]})}),f&&n.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-sm text-center",children:f})]}),a==="preparing"&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[n.jsx(me,{className:"w-12 h-12 text-blue-400 animate-spin mb-4"}),n.jsx("p",{className:"text-slate-300",children:" ..."})]}),(a==="recording"||a==="paused")&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative aspect-video bg-black rounded-xl overflow-hidden",children:[n.jsx("video",{ref:b,className:"w-full h-full object-contain",muted:!0,playsInline:!0}),r==="camera_screen"&&n.jsx("video",{ref:g,className:"absolute bottom-4 right-4 w-32 h-24 rounded-full object-cover border-2 border-white shadow-lg",muted:!0,playsInline:!0}),n.jsx("canvas",{ref:v,className:"hidden"}),n.jsx("div",{className:"absolute top-4 left-4",children:n.jsx("div",{className:`recording-indicator ${a==="paused"?"opacity-50":""}`,children:n.jsx("span",{className:"text-sm font-medium",children:a==="paused"?" ":" "})})}),n.jsx("div",{className:"absolute top-4 right-4 bg-black/50 px-3 py-1 rounded-full",children:n.jsx("span",{className:"text-white font-mono text-sm",children:_(l)})})]}),n.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a==="recording"?n.jsx("button",{onClick:R,className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors",title:" ",children:n.jsx(dl,{className:"w-6 h-6 text-white"})}):n.jsx("button",{onClick:C,className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors",title:"",children:n.jsx(fo,{className:"w-6 h-6 text-white"})}),n.jsx("button",{onClick:z,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full transition-colors",title:" ",children:n.jsx(vo,{className:"w-6 h-6 text-white fill-current"})})]})]}),a==="stopped"&&d&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"aspect-video bg-black rounded-xl overflow-hidden",children:n.jsx("video",{src:URL.createObjectURL(d),controls:!0,className:"w-full h-full object-contain"})}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"text-slate-400 text-sm",children:[": ",_(l)]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:L,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[n.jsx(ul,{className:"w-4 h-4"}),n.jsx("span",{children:" "})]}),n.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[n.jsx(hl,{className:"w-4 h-4"}),n.jsx("span",{children:""})]}),s&&n.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[n.jsx(jn,{className:"w-4 h-4"}),n.jsx("span",{children:""})]})]})]})]})]})]})}function op({block:e,allBlocks:t,edges:s,onUpdate:r,onAddEdge:o,onRemoveEdge:a,onClose:i}){const{enabled:l,isLoading:c}=Ns(),[d,h]=y.useState("content"),f=(p,b)=>{r({content:{...e.content,[p]:b}})},u=s.filter(p=>p.from===e.id),m=t.filter(p=>p.id!==e.id&&!u.some(b=>b.to===p.id));return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit Block"}),n.jsx("button",{onClick:i,className:"p-1.5 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:n.jsxs("div",{className:"p-4 space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:e.content.title||"",onChange:p=>f("title",p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Block title"})]}),n.jsx(io,{title:"Content",isOpen:d==="content",onToggle:()=>h(d==="content"?"":"content"),children:ip(e,f,l,c)}),n.jsx(io,{title:"Connections",isOpen:d==="connections",onToggle:()=>h(d==="connections"?"":"connections"),children:n.jsxs("div",{className:"space-y-3",children:[n.jsx("p",{className:"text-xs text-slate-500",children:"Define what happens after this block."}),u.length>0&&n.jsx("div",{className:"space-y-2",children:u.map(p=>{const b=t.find(g=>g.id===p.to);return n.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-900 rounded-lg group",children:[n.jsx("span",{className:"text-sm text-slate-300 flex-1",children:b?.content?.title||"Unknown block"}),p.condition&&n.jsx("span",{className:"text-xs text-warning mr-2",children:"Conditional"}),n.jsx("button",{onClick:()=>a(p.to),className:"p-1 text-slate-500 hover:text-error hover:bg-error/10 rounded transition-colors",title:"Remove connection",children:n.jsx(_e,{className:"w-4 h-4"})})]},`${p.from}-${p.to}`)})}),m.length>0&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Connect to:"}),n.jsxs("select",{onChange:p=>{p.target.value&&(o(p.target.value),p.target.value="")},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"",children:"Select a block..."}),m.map(p=>n.jsx("option",{value:p.id,children:p.content?.title||p.type},p.id))]})]}),e.type==="quiz"&&n.jsxs("div",{className:"mt-4 p-3 bg-slate-900/50 rounded-lg",children:[n.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Conditional Routing"}),n.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Add connections with conditions based on quiz score."}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("button",{onClick:()=>{const p=m[0];p&&o(p.id,{all:[{fact:"quiz.scorePercent",op:"gte",value:50}]})},disabled:m.length===0,className:"w-full px-3 py-2 text-sm bg-emerald-600/20 text-emerald-400 rounded-lg hover:bg-emerald-600/30 disabled:opacity-50 transition-colors",children:'Add "Pass" connection (score >= 50%)'}),n.jsx("button",{onClick:()=>{const p=m[0];p&&o(p.id,{all:[{fact:"quiz.scorePercent",op:"lt",value:50}]})},disabled:m.length===0,className:"w-full px-3 py-2 text-sm bg-red-600/20 text-red-400 rounded-lg hover:bg-red-600/30 disabled:opacity-50 transition-colors",children:'Add "Fail" connection (score < 50%)'})]})]})]})})]})})]})}function io({title:e,isOpen:t,onToggle:s,children:r}){return n.jsxs("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:[n.jsxs("button",{onClick:s,className:"w-full flex items-center justify-between px-4 py-3 bg-slate-800 text-white hover:bg-slate-700 transition-colors",children:[n.jsx("span",{className:"font-medium",children:e}),t?n.jsx(as,{className:"w-4 h-4"}):n.jsx(is,{className:"w-4 h-4"})]}),t&&n.jsx("div",{className:"p-4 bg-slate-800/50",children:r})]})}function ip(e,t,s,r){const o=e.content;switch(e.type){case"read":return n.jsx(ap,{content:o,updateContent:t,aiEnabled:s,aiSettingsLoading:r});case"video":return n.jsx(lp,{content:o,updateContent:t,aiEnabled:s,aiSettingsLoading:r});case"image":return n.jsx(cp,{content:o,updateContent:t,aiEnabled:s,aiSettingsLoading:r});case"quiz":return n.jsx(dp,{content:o,updateContent:t,aiEnabled:s,aiSettingsLoading:r});case"mission":return n.jsx(up,{content:o,updateContent:t});case"form":return n.jsx(hp,{content:o,updateContent:t});case"ai_help":return n.jsx(fp,{content:o,updateContent:t});case"checkpoint":return n.jsx(mp,{content:o,updateContent:t});case"animation":return n.jsx(pp,{content:o,updateContent:t});case"code":return n.jsx(gp,{content:o,updateContent:t});case"exercise":return n.jsx(bp,{content:o,updateContent:t});case"resource":return n.jsx(yp,{content:o,updateContent:t});default:return n.jsx("p",{className:"text-slate-500",children:"No editor available for this block type."})}}function ap({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const[o,a]=y.useState(!1),[i,l]=y.useState(""),[c,d]=y.useState(!1),[h,f]=y.useState("markdown"),u=async()=>{if(!(!i.trim()||!s)){a(!0);try{const v=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"content",topic:i,existingContent:e.markdown||""})})).json();v.result&&(t("markdown",v.result),d(!1),l(""))}catch(g){console.error("AI generation failed:",g)}finally{a(!1)}}},m=g=>g?g.replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>").replace(/^- (.*$)/gm,"<li>$1</li>").replace(/\n/g,"<br>"):"",p=g=>g?g.replace(/<h1>(.*?)<\/h1>/g,`# $1
`).replace(/<h2>(.*?)<\/h2>/g,`## $1
`).replace(/<h3>(.*?)<\/h3>/g,`### $1
`).replace(/<strong>(.*?)<\/strong>/g,"**$1**").replace(/<b>(.*?)<\/b>/g,"**$1**").replace(/<em>(.*?)<\/em>/g,"*$1*").replace(/<i>(.*?)<\/i>/g,"*$1*").replace(/<code>(.*?)<\/code>/g,"`$1`").replace(/<blockquote>(.*?)<\/blockquote>/g,`> $1
`).replace(/<li>(.*?)<\/li>/g,`- $1
`).replace(/<br\s*\/?>/g,`
`).replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").trim():"",b=g=>{const v=p(g);t("markdown",v)};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm text-slate-400",children:"Editor Mode:"}),n.jsxs("div",{className:"flex bg-slate-900 rounded-lg p-1",children:[n.jsxs("button",{onClick:()=>f("markdown"),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm transition-colors ${h==="markdown"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:[n.jsx(Ot,{className:"w-4 h-4"}),"Markdown"]}),n.jsxs("button",{onClick:()=>f("richtext"),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm transition-colors ${h==="richtext"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:[n.jsx(Bl,{className:"w-4 h-4"}),"Rich Text"]})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:["Content (",h==="markdown"?"Markdown":"Rich Text",")"]}),h==="markdown"?n.jsx("textarea",{value:e.markdown||"",onChange:g=>t("markdown",g.target.value),rows:12,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:`# Heading

Your content here...`}):n.jsx(sp,{value:m(e.markdown||""),onChange:b,direction:"ltr",placeholder:"Start writing your content...",className:"min-h-[300px]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Est. Read Time (minutes)"}),n.jsx("input",{type:"number",value:e.estimatedReadTime||3,onChange:g=>t("estimatedReadTime",parseInt(g.target.value)||3),min:1,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),!s&&!r?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(js,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI content generation is disabled by the administrator."})]}):c?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:i,onChange:g=>l(g.target.value),placeholder:"What topic should this content cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>d(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:u,disabled:o||!i.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[o?n.jsx(me,{className:"w-4 h-4 animate-spin"}):n.jsx(ge,{className:"w-4 h-4"}),o?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>d(!0),disabled:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(ge,{className:"w-4 h-4"}),"Generate Content with AI"]})]})}function lp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const[o,a]=y.useState("url"),[i,l]=y.useState(!1),[c,d]=y.useState(""),[h,f]=y.useState(!1),[u,m]=y.useState(!1),p=async()=>{if(!(!c.trim()||!s)){l(!0);try{const v=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"video_script",topic:c,duration:5})})).json();v.result&&(t("transcript",v.result),t("description",`Video script: ${c}`),f(!1),d(""))}catch(g){console.error("AI generation failed:",g)}finally{l(!1)}}},b=async(g,v)=>{const N=URL.createObjectURL(g);t("url",N),t("recordingMode",v),m(!1),a("url")};return u?n.jsxs("div",{className:"space-y-4",children:[n.jsx(rp,{onRecordingComplete:b,onClose:()=>{m(!1),a("url")},showLibrarySave:!0}),n.jsx("p",{className:"text-xs text-slate-400 text-center",children:"Note: In production, videos will be uploaded to Taalam storage."})]}):n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>a("url"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="url"?"bg-primary-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(mo,{className:"w-4 h-4"}),"URL"]}),n.jsxs("button",{onClick:()=>a("upload"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="upload"?"bg-primary-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(po,{className:"w-4 h-4"}),"Upload"]}),n.jsxs("button",{onClick:()=>{a("record"),m(!0)},className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="record"?"bg-error text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(bo,{className:"w-4 h-4"}),"Record"]})]}),o==="url"?n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Video URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:g=>t("url",g.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://youtube.com/watch?v=... or video URL"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Supports YouTube, Vimeo, and direct video URLs"})]}):o==="upload"?n.jsxs("div",{className:"border-2 border-dashed border-slate-700 rounded-lg p-6 text-center",children:[n.jsx(ut,{className:"w-10 h-10 text-slate-600 mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Drag and drop or click to upload"}),n.jsx("input",{type:"file",accept:"video/*",className:"hidden"}),n.jsx("button",{className:"px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Choose File"})]}):null,n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Transcript / Script"}),n.jsx("textarea",{value:e.transcript||"",onChange:g=>t("transcript",g.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Video transcript or script..."})]}),!s&&!r?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(js,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI script generation is disabled by the administrator."})]}):h?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:c,onChange:g=>d(g.target.value),placeholder:"What should the video script cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>f(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:p,disabled:i||!c.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[i?n.jsx(me,{className:"w-4 h-4 animate-spin"}):n.jsx(ge,{className:"w-4 h-4"}),i?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>f(!0),disabled:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(ge,{className:"w-4 h-4"}),"Generate Script with AI"]})]})}function cp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const o=["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=800"],[a,i]=y.useState(!1),[l,c]=y.useState(!1),[d,h]=y.useState(""),[f,u]=y.useState(!1);return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Image URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:m=>t("url",m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/image.jpg"})]}),e.url?n.jsx("div",{className:"relative aspect-video bg-slate-900 rounded-lg overflow-hidden",children:n.jsx("img",{src:e.url,alt:"Preview",className:"w-full h-full object-contain"})}):n.jsxs("button",{onClick:()=>i(!a),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-600 transition-colors",children:[n.jsx(et,{className:"w-8 h-8 text-slate-600"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Choose from gallery or paste URL above"})]}),a&&!e.url&&n.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.map((m,p)=>n.jsx("button",{onClick:()=>{t("url",m),i(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:m,alt:"",className:"w-full h-full object-cover"})},p))}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Caption (optional)"}),n.jsx("input",{type:"text",value:e.caption||"",onChange:m=>t("caption",m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Image caption..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Alt Text"}),n.jsx("input",{type:"text",value:e.alt||"",onChange:m=>t("alt",m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe the image for accessibility..."})]}),!r&&s&&n.jsxs("div",{className:"pt-4 border-t border-slate-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Generate with AI"}),!f&&n.jsx("button",{onClick:()=>u(!0),className:"text-xs text-primary-400 hover:text-primary-300",children:"Show"})]}),f&&n.jsxs("div",{className:"space-y-3",children:[n.jsx("textarea",{value:d,onChange:m=>h(m.target.value),placeholder:`Describe the image you want... (e.g., "A diagram showing how neural networks work" or "${e.caption||e.title||"educational illustration"}")`,rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-sm"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:async()=>{if(d.trim()){c(!0);try{const p=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/image-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({prompt:d,contextTitle:e.title})})).json();p.url?(t("url",p.url),u(!1),h("")):console.error("No URL in response:",p)}catch(m){console.error("AI image generation failed:",m)}finally{c(!1)}}},disabled:l||!d.trim(),className:"flex-1 px-3 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-lg text-sm font-medium hover:from-emerald-700 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:l?n.jsxs(n.Fragment,{children:[n.jsx(me,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(ge,{className:"w-4 h-4"}),"Generate Image"]})}),n.jsx("button",{onClick:()=>{u(!1),h("")},disabled:l,className:"px-3 py-2 bg-slate-700 text-white rounded-lg text-sm hover:bg-slate-600 disabled:opacity-50 transition-colors",children:"Cancel"})]}),n.jsx("div",{className:"text-xs text-slate-500",children:"Powered by GPT-Image-1.5  Images are generated and hosted by OpenAI"})]})]}),!s&&!r&&n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(AlertCircle,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI image generation is disabled by the administrator."})]})]})}function dp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const o=e.questions||[],[a,i]=y.useState(!1),[l,c]=y.useState(""),[d,h]=y.useState(!1),f=()=>{const b={id:`q_${Date.now()}`,prompt:"",choices:["","","",""],correctIndex:0,tags:[]};t("questions",[...o,b])},u=(b,g)=>{const v=o.map((N,x)=>x===b?{...N,...g}:N);t("questions",v)},m=b=>{t("questions",o.filter((g,v)=>v!==b))},p=async()=>{if(!(!l.trim()||!s)){i(!0);try{const g=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"quiz",topic:l})})).json();if(g.result&&Array.isArray(g.result)){const v=g.result.map((N,x)=>({...N,id:`q_${Date.now()}_${x}`}));t("questions",[...o,...v]),h(!1),c("")}}catch(b){console.error("AI generation failed:",b)}finally{i(!1)}}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{children:n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Passing Score (%)"})}),n.jsx("input",{type:"number",value:e.passingScore||50,onChange:b=>t("passingScore",parseInt(b.target.value)||50),min:0,max:100,className:"w-20 px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsx("div",{className:"space-y-4",children:o.map((b,g)=>n.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg space-y-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(_s,{className:"w-4 h-4 text-slate-600"}),n.jsxs("span",{className:"text-sm font-medium text-slate-400",children:["Q",g+1]})]}),n.jsx("button",{onClick:()=>m(g),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(_e,{className:"w-4 h-4"})})]}),n.jsx("input",{type:"text",value:b.prompt,onChange:v=>u(g,{prompt:v.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Question..."}),n.jsx("div",{className:"space-y-2",children:b.choices.map((v,N)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"radio",checked:b.correctIndex===N,onChange:()=>u(g,{correctIndex:N}),className:"w-4 h-4 text-emerald-500"}),n.jsx("input",{type:"text",value:v,onChange:x=>{const w=[...b.choices];w[N]=x.target.value,u(g,{choices:w})},className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Option ${N+1}`})]},N))}),n.jsx("input",{type:"text",value:b.explanation||"",onChange:v=>u(g,{explanation:v.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Explanation (shown after answer)..."}),n.jsx("input",{type:"text",value:b.tags.join(", "),onChange:v=>u(g,{tags:v.target.value.split(",").map(N=>N.trim()).filter(Boolean)}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tags (comma-separated)..."})]},b.id))}),n.jsxs("button",{onClick:f,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(Qe,{className:"w-4 h-4"}),"Add Question"]}),!s&&!r?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(js,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI question generation is disabled by the administrator."})]}):d?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:l,onChange:b=>c(b.target.value),placeholder:"What topic should the questions cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:p,disabled:a||!l.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[a?n.jsx(me,{className:"w-4 h-4 animate-spin"}):n.jsx(ge,{className:"w-4 h-4"}),a?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>h(!0),disabled:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(ge,{className:"w-4 h-4"}),"Generate Questions with AI"]})]})}function up({content:e,updateContent:t}){const s=e.steps||[],[r,o]=y.useState(null),a=()=>{const c={id:`step_${Date.now()}`,instruction:"",verificationMethod:"self_report"};t("steps",[...s,c])},i=(c,d)=>{const h=s.map((f,u)=>u===c?{...f,...d}:f);t("steps",h)},l=c=>{t("steps",s.filter((d,h)=>h!==c))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:c=>t("description",c.target.value),rows:2,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"What is this mission about?"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"External URL (optional)"}),n.jsx("input",{type:"url",value:e.externalUrl||"",onChange:c=>t("externalUrl",c.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Steps"}),s.map((c,d)=>n.jsx("div",{className:"p-3 bg-slate-900 rounded-lg space-y-2",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded bg-slate-700 flex items-center justify-center text-xs text-slate-400 mt-1",children:d+1}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("input",{type:"text",value:c.instruction,onChange:h=>i(d,{instruction:h.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Step instruction / question..."}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("select",{value:c.verificationMethod||"self_report",onChange:h=>i(d,{verificationMethod:h.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"self_report",children:"Self Report"}),n.jsx("option",{value:"screenshot",children:"Screenshot"}),n.jsx("option",{value:"url_check",children:"URL Check"}),n.jsx("option",{value:"ai_validate",children:"AI Validation"})]}),c.verificationMethod==="ai_validate"&&n.jsx("button",{onClick:()=>o(r===c.id?null:c.id),className:"px-2 py-1 text-xs bg-primary-600/20 text-primary-400 rounded hover:bg-primary-600/30 transition-colors",children:r===c.id?"Hide Options":"AI Options"})]}),c.verificationMethod==="ai_validate"&&r===c.id&&n.jsxs("div",{className:"space-y-2 p-2 bg-slate-800 rounded border border-slate-700",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Expected Criteria"}),n.jsx("textarea",{value:c.expectedCriteria||"",onChange:h=>i(d,{expectedCriteria:h.target.value}),rows:2,className:"w-full px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white placeholder-slate-500 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Describe what makes a correct answer (e.g., 'Must mention key concept X and demonstrate understanding of Y')"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Input Type"}),n.jsxs("select",{value:c.inputType||"text",onChange:h=>i(d,{inputType:h.target.value}),className:"w-full px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"text",children:"Single Line (short answer)"}),n.jsx("option",{value:"textarea",children:"Multi Line (long answer)"})]})]})]})]}),n.jsx("button",{onClick:()=>l(d),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(_e,{className:"w-4 h-4"})})]})},c.id))]}),n.jsxs("button",{onClick:a,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(Qe,{className:"w-4 h-4"}),"Add Step"]}),n.jsx("div",{className:"p-3 bg-primary-900/20 border border-primary-700/30 rounded-lg",children:n.jsxs("p",{className:"text-xs text-primary-300",children:[n.jsx("strong",{children:"AI Validation:"})," When selected, learners must provide an answer that will be evaluated by AI against your criteria. The AI will provide feedback and mark the step as complete if correct."]})})]})}function hp({content:e,updateContent:t}){const s=e.fields||[],r=i=>{const l={id:`field_${Date.now()}`,type:i,label:"",required:!1};t("fields",[...s,l])},o=(i,l)=>{const c=s.map((d,h)=>h===i?{...d,...l}:d);t("fields",c)},a=i=>{t("fields",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:i=>t("description",i.target.value),rows:2,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Fields"}),s.map((i,l)=>n.jsx("div",{className:"p-2 bg-slate-900 rounded-lg space-y-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("select",{value:i.type,onChange:c=>o(l,{type:c.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"text",children:"Text"}),n.jsx("option",{value:"textarea",children:"Textarea"}),n.jsx("option",{value:"select",children:"Select"}),n.jsx("option",{value:"checkbox",children:"Checkbox"}),n.jsx("option",{value:"radio",children:"Radio"})]}),n.jsx("input",{type:"text",value:i.label,onChange:c=>o(l,{label:c.target.value}),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Label..."}),n.jsxs("label",{className:"flex items-center gap-1 text-xs text-slate-400",children:[n.jsx("input",{type:"checkbox",checked:i.required,onChange:c=>o(l,{required:c.target.checked})}),"Required"]}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(_e,{className:"w-4 h-4"})})]})},i.id))]}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:["text","textarea","select","checkbox","radio"].map(i=>n.jsxs("button",{onClick:()=>r(i),className:"px-3 py-1 bg-slate-700 text-white text-sm rounded hover:bg-slate-600 transition-colors",children:["+ ",i]},i))})]})}function fp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Mode"}),n.jsxs("select",{value:e.mode||"targeted_remediation",onChange:s=>t("mode",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"targeted_remediation",children:"Targeted Remediation"}),n.jsx("option",{value:"open_chat",children:"Open Chat"}),n.jsx("option",{value:"guided_explanation",children:"Guided Explanation"})]}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:e.mode==="targeted_remediation"?"AI focuses on topics the learner struggled with":e.mode==="open_chat"?"Open-ended conversation about the material":"Step-by-step guided explanation"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Max Turns"}),n.jsx("input",{type:"number",value:e.maxTurns||5,onChange:s=>t("maxTurns",parseInt(s.target.value)||5),min:1,max:20,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}function mp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:s=>t("description",s.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"What does this checkpoint evaluate?"})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Checkpoints evaluate learner progress and can branch to different paths based on performance. Use the Connections section to set up conditional routing."})]})}function pp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Animation Type"}),n.jsxs("select",{value:e.animationType||"lottie",onChange:s=>t("animationType",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"lottie",children:"Lottie"}),n.jsx("option",{value:"video",children:"Video"}),n.jsx("option",{value:"interactive",children:"Interactive"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Animation URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:s=>t("url",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.autoplay??!0,onChange:s=>t("autoplay",s.target.checked)}),"Autoplay"]}),n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.loop??!1,onChange:s=>t("loop",s.target.checked)}),"Loop"]})]})]})}const xp=["javascript","typescript","python","java","csharp","cpp","c","ruby","go","rust","php","swift","kotlin","sql","html","css","json","bash","shell","markdown","yaml","xml"];function gp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Language"}),n.jsx("select",{value:e.language||"javascript",onChange:s=>t("language",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:xp.map(s=>n.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Code"}),n.jsx("textarea",{value:e.code||"",onChange:s=>t("code",s.target.value),rows:12,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:"// Your code here..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description (optional)"}),n.jsx("input",{type:"text",value:e.description||"",onChange:s=>t("description",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the code..."})]}),n.jsx("div",{className:"flex items-center gap-4",children:n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.showLineNumbers??!0,onChange:s=>t("showLineNumbers",s.target.checked)}),"Show Line Numbers"]})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Highlight Lines (comma-separated)"}),n.jsx("input",{type:"text",value:(e.highlightLines||[]).join(", "),onChange:s=>{const r=s.target.value.split(",").map(o=>parseInt(o.trim())).filter(o=>!isNaN(o)&&o>0);t("highlightLines",r)},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 1, 3, 5-7"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Lines to highlight (e.g., 1, 3, 5)"})]})]})}function bp({content:e,updateContent:t}){const s=e.hints||[],r=()=>{t("hints",[...s,""])},o=(i,l)=>{const c=s.map((d,h)=>h===i?l:d);t("hints",c)},a=i=>{t("hints",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:e.description||"",onChange:i=>t("description",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Problem"}),n.jsx("textarea",{value:e.problem||"",onChange:i=>t("problem",i.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Describe the problem or exercise..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Hints (optional)"}),n.jsx("div",{className:"space-y-2",children:s.map((i,l)=>n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded bg-slate-700 flex items-center justify-center text-xs text-slate-400 mt-1",children:l+1}),n.jsx("input",{type:"text",value:i,onChange:c=>o(l,c.target.value),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Hint..."}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(_e,{className:"w-4 h-4"})})]},l))}),n.jsxs("button",{onClick:r,className:"mt-2 flex items-center gap-2 px-3 py-1 bg-slate-700 text-white text-sm rounded hover:bg-slate-600 transition-colors",children:[n.jsx(Qe,{className:"w-4 h-4"}),"Add Hint"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Solution"}),n.jsx("textarea",{value:e.solution||"",onChange:i=>t("solution",i.target.value),rows:6,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:"The solution..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Solution Explanation (optional)"}),n.jsx("textarea",{value:e.solutionExplanation||"",onChange:i=>t("solutionExplanation",i.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Explain why this solution works..."})]})]})}function yp({content:e,updateContent:t}){const s=e.resources||[],r=()=>{const i={id:`res_${Date.now()}`,title:"",url:"",type:"link"};t("resources",[...s,i])},o=(i,l)=>{const c=s.map((d,h)=>h===i?{...d,...l}:d);t("resources",c)},a=i=>{t("resources",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:e.description||"",onChange:i=>t("description",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of resources..."})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Resources"}),s.map((i,l)=>n.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:i.title,onChange:c=>o(l,{title:c.target.value}),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Resource title..."}),n.jsxs("select",{value:i.type,onChange:c=>o(l,{type:c.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"link",children:"Link"}),n.jsx("option",{value:"download",children:"Download"}),n.jsx("option",{value:"video",children:"Video"}),n.jsx("option",{value:"document",children:"Document"})]}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(_e,{className:"w-4 h-4"})})]}),n.jsx("input",{type:"url",value:i.url,onChange:c=>o(l,{url:c.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."}),n.jsx("input",{type:"text",value:i.description||"",onChange:c=>o(l,{description:c.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Description (optional)..."})]},i.id))]}),n.jsxs("button",{onClick:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(Qe,{className:"w-4 h-4"}),"Add Resource"]})]})}function vp({onGenerate:e,onClose:t,existingGraph:s,trackModulesContext:r=[],currentModuleId:o}){const{enabled:a,contentModel:i,isLoading:l}=Ns(),[c,d]=y.useState(1),[h,f]=y.useState(!1),[u,m]=y.useState(""),[p,b]=y.useState(""),[g,v]=y.useState("beginners"),[N,x]=y.useState("beginner"),[w,E]=y.useState(20),[k,I]=y.useState(6),[T,P]=y.useState(!0),[R,C]=y.useState(!0),[z,L]=y.useState(!0),[j,M]=y.useState(!1),[_,A]=y.useState(!0),[S,$]=y.useState(!1),[H,F]=y.useState(!1),[O,G]=y.useState(!1),[Y,ee]=y.useState(!0),[K,B]=y.useState(!1),[D,X]=y.useState(!1),[W,se]=y.useState(!0),[J,ne]=y.useState(!1),[oe,le]=y.useState(""),[ce,he]=y.useState("gpt-4o"),[be,ke]=y.useState(null);y.useEffect(()=>{!l&&i&&he(i)},[l,i]);const Ee=async()=>{f(!0),m(""),le(W?"Researching topic on the web...":"Generating course...");try{const U=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"outline",topic:p,targetAudience:g,difficulty:N,duration:w,blockCount:k,includeVideo:T,includeQuiz:R,includeMission:z,includeImage:j,includeCode:_,includeExercise:S,includeResource:H,includeForm:O,includeAIHelp:Y,includeCheckpoint:K,includeAnimation:D,existingGraph:s,enableWebResearch:W,model:ce,trackModulesContext:r,generateImages:J&&j})});if(le("Creating course structure..."),!U.ok)throw new Error("Failed to generate course");const ve=await U.json();if(ve.error)throw new Error(ve.error);if(ve.result&&typeof ve.result=="object")ke(ve.result),d(3);else throw new Error("Invalid response format")}catch(U){m(U instanceof Error?U.message:"Generation failed")}finally{f(!1)}},Be=()=>{be&&e(be)};return n.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col border border-slate-700 shadow-2xl",children:[n.jsxs("div",{className:"p-6 border-b border-slate-700 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(ge,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-white",children:"AI Course Generator"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Create a complete course with AI assistance"})]})]}),n.jsx("button",{onClick:t,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[!l&&!a?n.jsx(xo,{}):l?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(me,{className:"w-8 h-8 text-purple-500 animate-spin"})}):c===1&&n.jsxs("div",{className:"space-y-6",children:[r.length>1&&n.jsxs("div",{className:"flex items-start gap-3 p-4 bg-purple-500/10 border border-purple-500/20 rounded-xl",children:[n.jsx(ge,{className:"w-5 h-5 text-purple-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-medium text-purple-300 mb-1",children:"Track-Aware Generation"}),n.jsxs("div",{className:"text-sm text-slate-400 mb-2",children:["AI will reference FULL content from ",r.filter(U=>!U.isCurrent).length," other module",r.filter(U=>!U.isCurrent).length!==1?"s":""," in this track to ensure progressive learning."]}),n.jsx("div",{className:"space-y-1",children:r.map(U=>n.jsxs("div",{className:`text-xs flex items-center gap-2 ${U.isCurrent?"text-purple-300 font-medium":"text-slate-500"}`,children:[n.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current"}),"Module ",U.orderIndex+1,": ",U.title,U.graph&&` (${U.graph.blocks?.length||0} blocks)`,U.isCurrent&&" (Current)"]},U.moduleId))})]})]}),s&&s.blocks.length>0&&n.jsxs("div",{className:"flex items-start gap-3 p-4 bg-primary-500/10 border border-primary-500/20 rounded-xl",children:[n.jsx(ns,{className:"w-5 h-5 text-primary-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-medium text-primary-300 mb-1",children:"Building Upon Existing Content"}),n.jsxs("div",{className:"text-sm text-slate-400",children:["AI will see your ",s.blocks.length," existing blocks and generate content that complements what you already have."]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"What do you want to teach?"}),n.jsx("textarea",{value:p,onChange:U=>b(U.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"e.g., Introduction to Machine Learning, How to use ChatGPT effectively, Basic Python programming..."})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Audience"}),n.jsxs("select",{value:g,onChange:U=>v(U.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginners",children:"Complete Beginners"}),n.jsx("option",{value:"students",children:"Students"}),n.jsx("option",{value:"professionals",children:"Professionals"}),n.jsx("option",{value:"technical",children:"Technical Audience"}),n.jsx("option",{value:"general",children:"General Audience"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Difficulty Level"}),n.jsxs("select",{value:N,onChange:U=>x(U.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsx("button",{onClick:()=>d(2),disabled:!p.trim(),className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Continue"})]}),c===2&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"p-4 bg-slate-900/50 rounded-xl",children:[n.jsx("h3",{className:"font-medium text-white mb-1",children:"Topic"}),n.jsx("p",{className:"text-slate-400",children:p})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Duration (minutes)"}),n.jsx("input",{type:"number",value:w,onChange:U=>E(parseInt(U.target.value)||20),min:5,max:120,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Number of Steps"}),n.jsx("input",{type:"number",value:k,onChange:U=>I(parseInt(U.target.value)||6),min:3,max:20,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Content Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:T,onChange:U=>P(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(ut,{className:"w-5 h-5 text-rose-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Video Blocks"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Add placeholder video sections"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:j,onChange:U=>M(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(et,{className:"w-5 h-5 text-emerald-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Image Blocks"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Add placeholder images and diagrams"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:_,onChange:U=>A(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(kn,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Code Snippets"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Syntax-highlighted code examples"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:H,onChange:U=>F(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(ks,{className:"w-5 h-5 text-indigo-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Additional Resources"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Curated links and downloads"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Interactive Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:R,onChange:U=>C(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Vt,{className:"w-5 h-5 text-purple-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Quiz & Assessment"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Test learner understanding with questions"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:z,onChange:U=>L(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Nn,{className:"w-5 h-5 text-orange-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Hands-on Mission"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Practical task for learners to complete"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:S,onChange:U=>$(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Cs,{className:"w-5 h-5 text-violet-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Practice Exercises"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Problems with hints and solutions"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:O,onChange:U=>G(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Ot,{className:"w-5 h-5 text-warning"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Data Collection Forms"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Gather learner input and surveys"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Support Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:Y,onChange:U=>ee(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Ss,{className:"w-5 h-5 text-primary-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"AI Help / Remediation"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Personalized AI tutoring when struggling"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:K,onChange:U=>B(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Cn,{className:"w-5 h-5 text-accent"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Progress Checkpoints"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Validate understanding before continuing"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:D,onChange:U=>X(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(fo,{className:"w-5 h-5 text-pink-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Animations"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Interactive visual animations"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"AI Research & Generation"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-primary-500/10 to-accent/10 border border-primary-500/20 rounded-xl cursor-pointer hover:border-primary-500/40 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:W,onChange:U=>se(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-blue-500 focus:ring-blue-500"}),n.jsx(yl,{className:"w-5 h-5 text-blue-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Web Research"}),n.jsx("div",{className:"text-xs text-slate-400",children:"AI will search the web for the latest information on this topic to ensure accurate, up-to-date content"})]}),n.jsx(yo,{className:"w-4 h-4 text-blue-400/50"})]}),j&&n.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-emerald-500/10 to-teal-500/10 border border-emerald-500/20 rounded-xl cursor-pointer hover:border-emerald-500/40 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:J,onChange:U=>ne(U.target.checked),className:"w-5 h-5 rounded border-slate-600 text-emerald-500 focus:ring-emerald-500"}),n.jsx(et,{className:"w-5 h-5 text-emerald-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Generate AI Images"}),n.jsx("div",{className:"text-xs text-slate-400",children:"Automatically generate educational images/diagrams for image blocks using GPT-Image-1.5"})]}),n.jsx(ge,{className:"w-4 h-4 text-emerald-400/50"})]})]})]}),u&&n.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400",children:[n.jsx(ns,{className:"w-5 h-5 flex-shrink-0"}),n.jsx("span",{children:u})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>d(1),className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"Back"}),n.jsx("button",{onClick:Ee,disabled:h,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-all",children:h?n.jsxs(n.Fragment,{children:[n.jsx(me,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{className:"text-sm",children:oe})]}):n.jsxs(n.Fragment,{children:[n.jsx(Vl,{className:"w-5 h-5"}),"Generate Course"]})})]})]}),c===3&&be&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center gap-3 p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl",children:[n.jsx(ss,{className:"w-6 h-6 text-emerald-400"}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-emerald-400",children:"Course Generated!"}),n.jsxs("div",{className:"text-sm text-slate-400",children:[be.blocks.length," blocks created with proper flow"]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-medium text-slate-300 mb-3",children:"Generated Structure"}),n.jsx("div",{className:"space-y-2",children:be.blocks.map((U,ve)=>{const tt=U.content,Ye=be.startBlockId===U.id;return n.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-700 flex items-center justify-center text-sm font-medium text-slate-300",children:ve+1}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-white font-medium",children:tt?.title||U.type}),Ye&&n.jsx("span",{className:"px-1.5 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded",children:"Start"})]}),n.jsx("div",{className:"text-xs text-slate-500 capitalize",children:U.type})]})]},U.id)})})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>d(2),className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"Regenerate"}),n.jsxs("button",{onClick:Be,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 transition-all",children:[n.jsx(ss,{className:"w-5 h-5"}),"Use This Course"]})]})]})]}),n.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-900/50",children:n.jsx("div",{className:"flex items-center justify-center gap-2",children:[1,2,3].map(U=>n.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${c>=U?"bg-purple-500":"bg-slate-600"}`},U))})})]})})}const wp={read:{icon:$e,color:"bg-primary-500",label:"Read"},video:{icon:ut,color:"bg-rose-500",label:"Video"},image:{icon:et,color:"bg-emerald-500",label:"Image"},quiz:{icon:Vt,color:"bg-purple-500",label:"Quiz"},mission:{icon:Nn,color:"bg-orange-500",label:"Mission"},form:{icon:Ot,color:"bg-teal-500",label:"Form"},ai_help:{icon:Ss,color:"bg-cyan-500",label:"AI Help"},checkpoint:{icon:Cn,color:"bg-yellow-500",label:"Checkpoint"},animation:{icon:go,color:"bg-pink-500",label:"Animation"},code:{icon:kn,color:"bg-slate-600",label:"Code"},exercise:{icon:Cs,color:"bg-violet-500",label:"Exercise"},resource:{icon:ks,color:"bg-indigo-500",label:"Resources"}};function jp(e){const t=e.content;switch(e.type){case"read":return`${t.estimatedReadTime||0} min read`;case"video":return t.url?"Video attached":"No video set";case"image":return t.url?"Image attached":"No image set";case"quiz":const s=t.questions||[];return`${s.length} question${s.length!==1?"s":""}`;case"mission":const r=t.steps||[];return`${r.length} step${r.length!==1?"s":""}`;case"form":const o=t.fields||[];return`${o.length} field${o.length!==1?"s":""}`;case"ai_help":return`Mode: ${t.mode||"remediation"}`;case"checkpoint":return"Progress checkpoint";case"animation":return t.animationType||"Animation";case"code":return t.language||"Code snippet";case"exercise":const a=t.hints||[];return`${a.length} hint${a.length!==1?"s":""}`;case"resource":const i=t.resources||[];return`${i.length} resource${i.length!==1?"s":""}`;default:return""}}function Np({data:e,selected:t}){const{block:s,isStart:r,isMultiSelected:o,isConnectionTarget:a,hasPassEdge:i,hasFailEdge:l,onEdit:c,onDelete:d,onStartConnection:h}=e,f=wp[s.type]||{icon:$e,color:"bg-slate-600",label:"Block"},u=f.icon,m=s.content?.title||`${f.label} Block`,p=jp(s),b=s.type==="quiz";return n.jsxs("div",{className:`
        relative min-w-[240px] max-w-[300px] bg-slate-800 rounded-xl border-2 transition-all shadow-lg
        ${o?"border-blue-500 bg-slate-700":t?"border-primary-500":"border-slate-700 hover:border-slate-600"}
        ${a?"ring-2 ring-primary-400 ring-dashed ring-offset-2 ring-offset-slate-900":""}
      `,children:[n.jsx(Je,{type:"target",position:te.Top,className:"!w-3 !h-3 !bg-slate-500 !border-2 !border-slate-400 hover:!bg-primary-500 hover:!border-primary-400 transition-colors"}),r&&n.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-emerald-500 text-white text-xs font-semibold rounded shadow",children:"START"}),n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:`w-10 h-10 ${f.color} rounded-lg flex items-center justify-center flex-shrink-0 shadow-md`,children:n.jsx(u,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:m}),n.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:f.label}),p&&n.jsx("p",{className:"text-xs text-slate-500 mt-1 truncate",children:p})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-1 mt-3 pt-3 border-t border-slate-700",children:[n.jsx("button",{onClick:g=>{g.stopPropagation(),h()},className:"p-1.5 text-slate-400 hover:text-primary-400 hover:bg-slate-700 rounded transition-colors",title:"Connect to another block",children:n.jsx(kl,{className:"w-4 h-4"})}),n.jsx("button",{onClick:g=>{g.stopPropagation(),c()},className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors",title:"Edit block",children:n.jsx(Rl,{className:"w-4 h-4"})}),n.jsx("button",{onClick:g=>{g.stopPropagation(),d()},className:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded transition-colors",title:"Delete block",children:n.jsx(_e,{className:"w-4 h-4"})})]})]}),b?n.jsxs(n.Fragment,{children:[n.jsx(Je,{type:"source",position:te.Bottom,id:"pass",className:`!w-3 !h-3 !border-2 transition-colors ${i?"!bg-emerald-500 !border-emerald-400":"!bg-emerald-500/50 !border-emerald-400/50 hover:!bg-emerald-500 hover:!border-emerald-400"}`,style:{left:"30%"}}),n.jsx(Je,{type:"source",position:te.Bottom,id:"fail",className:`!w-3 !h-3 !border-2 transition-colors ${l?"!bg-red-500 !border-red-400":"!bg-red-500/50 !border-red-400/50 hover:!bg-red-500 hover:!border-red-400"}`,style:{left:"70%"}}),n.jsxs("div",{className:"absolute -bottom-5 left-0 right-0 flex justify-between px-6 pointer-events-none",children:[n.jsx("span",{className:"text-[10px] font-semibold text-emerald-400",children:"Pass"}),n.jsx("span",{className:"text-[10px] font-semibold text-red-400",children:"Fail"})]})]}):n.jsx(Je,{type:"source",position:te.Bottom,className:"!w-3 !h-3 !bg-slate-500 !border-2 !border-slate-400 hover:!bg-primary-500 hover:!border-primary-400 transition-colors"})]})}const kp=y.memo(Np);function es(e){if(!e?.all?.[0])return"normal";const t=e.all[0];return t.fact==="quiz.scorePercent"?t.op==="gte"||t.op==="gt"?"pass":"fail":"normal"}const ts=[{type:"read",label:"Read",icon:$e,color:"bg-primary-500"},{type:"video",label:"Video",icon:ut,color:"bg-rose-500"},{type:"image",label:"Image",icon:et,color:"bg-emerald-500"},{type:"quiz",label:"Quiz",icon:Vt,color:"bg-purple-500"},{type:"mission",label:"Mission",icon:Nn,color:"bg-orange-500"},{type:"form",label:"Form",icon:Ot,color:"bg-teal-500"},{type:"ai_help",label:"AI Help",icon:Ss,color:"bg-cyan-500"},{type:"checkpoint",label:"Checkpoint",icon:Cn,color:"bg-yellow-500"},{type:"animation",label:"Animation",icon:go,color:"bg-pink-500"},{type:"code",label:"Code",icon:kn,color:"bg-slate-600"},{type:"exercise",label:"Exercise",icon:Cs,color:"bg-violet-500"},{type:"resource",label:"Resources",icon:ks,color:"bg-indigo-500"}],Cp={blockNode:kp},Sp={type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:2},markerEnd:{type:vt.ArrowClosed,color:"#6366f1"}};function _p({moduleId:e,journeyVersionId:t,onBack:s}){const r=y.useRef(null),{screenToFlowPosition:o,fitView:a}=zn(),[i,l]=y.useState({startBlockId:"",blocks:[],edges:[]}),[c,d,h]=_m([]),[f,u,m]=Em([]),[p,b]=y.useState(null),[g,v]=y.useState(!1),[N,x]=y.useState(!1),[w,E]=y.useState(!1),[k,I]=y.useState(null),[T,P]=y.useState(""),[R,C]=y.useState(t),[z,L]=y.useState(!1),[j,M]=y.useState(!1),[_,A]=y.useState(null),[S,$]=y.useState(new Set),[H,F]=y.useState(!1),[O,G]=y.useState([]),Y=y.useCallback((V,Z)=>V.map((Q,q)=>{const ie=Q.ui?.position||{x:400,y:100+q*200},fe=i.edges.filter(we=>we.from===Q.id),pe=fe.some(we=>es(we.condition)==="pass"),Ze=fe.some(we=>es(we.condition)==="fail");return{id:Q.id,type:"blockNode",position:ie,data:{block:Q,isStart:Z===Q.id,isSelected:p===Q.id,isMultiSelected:S.has(Q.id),isConnectionTarget:k!==null&&k.fromBlockId!==Q.id,outgoingEdgesCount:fe.length,hasPassEdge:pe,hasFailEdge:Ze,onEdit:()=>{b(Q.id),M(!0)},onDelete:()=>J(Q.id),onStartConnection:()=>I({fromBlockId:Q.id})}}}),[p,S,k,i.edges]),ee=y.useCallback(V=>{const Z={pass:"#10b981",fail:"#ef4444",normal:"#6366f1"},Q={pass:"Pass",fail:"Fail",normal:void 0};return V.map((q,ie)=>{const fe=es(q.condition),pe=Z[fe],Ze=Q[fe];return{id:q.id||`edge-${q.from}-${q.to}-${ie}`,source:q.from,target:q.to,sourceHandle:fe!=="normal"?fe:void 0,type:"smoothstep",animated:!0,style:{stroke:pe,strokeWidth:2},markerEnd:{type:vt.ArrowClosed,color:pe},label:Ze,labelStyle:{fill:pe,fontWeight:600,fontSize:12},labelBgStyle:{fill:"#1e293b",fillOpacity:.9},labelBgPadding:[4,8],labelBgBorderRadius:4}})},[]);y.useEffect(()=>{const V=Y(i.blocks,i.startBlockId),Z=ee(i.edges);d(V),u(Z)},[i,Y,ee,d,u]),y.useEffect(()=>{B()},[e,t]),y.useEffect(()=>{if(_){const V=setTimeout(()=>A(null),4e3);return()=>clearTimeout(V)}},[_]);const K=(V,Z)=>{A({type:V,message:Z})},B=async()=>{const{data:V}=await ye.from("modules").select("title, track_id").eq("id",e).single();if(V&&(P(V.title),V.track_id)){const{data:Z}=await ye.from("modules").select(`
            id,
            title,
            description,
            order_index,
            journey_versions (
              id,
              graph_json,
              status
            )
          `).eq("track_id",V.track_id).order("order_index");if(Z&&Z.length>0){const Q=Z.map(q=>({moduleId:q.id,title:q.title,description:q.description,orderIndex:q.order_index,isCurrent:q.id===e,graph:q.journey_versions?.[0]?.graph_json||null}));G(Q)}}if(t){const{data:Z}=await ye.from("journey_versions").select("graph_json").eq("id",t).single();if(Z?.graph_json){const Q=Z.graph_json,q=Q.blocks.map((ie,fe)=>ie.ui?.position?ie:{...ie,ui:{...ie.ui,position:{x:400,y:100+fe*200}}});l({...Q,blocks:q}),setTimeout(()=>a({padding:.2}),100)}}},D=async()=>{v(!0);let V=R;const Z=i.blocks.map(q=>{const ie=c.find(fe=>fe.id===q.id);return ie?{...q,ui:{...q.ui,position:ie.position}}:q}),Q={...i,blocks:Z};try{if(R){const{error:q}=await ye.from("journey_versions").update({graph_json:Q}).eq("id",R);if(q)throw q}else{const{data:q,error:ie}=await ye.from("journey_versions").insert({module_id:e,version:1,status:"draft",graph_json:Q}).select().single();if(ie)throw ie;q&&(C(q.id),V=q.id)}return l(Q),L(!1),K("success","Journey saved successfully"),V}catch(q){return console.error("Save error:",q),K("error","Failed to save journey"),null}finally{v(!1)}},X=async()=>{if(i.blocks.length===0){K("error","Cannot publish an empty journey. Add some blocks first.");return}x(!0);try{let V=R;if((!V||z)&&(V=await D()),!V)throw new Error("Failed to save journey before publishing");const{error:Z}=await ye.from("journey_versions").update({status:"published"}).eq("id",V);if(Z)throw Z;const{data:Q}=await ye.from("modules").select("track_id").eq("id",e).single();if(Q?.track_id){const{error:q}=await ye.from("tracks").update({published_version_id:V}).eq("id",Q.track_id);if(q)throw q}L(!1),K("success","Journey published successfully! Learners can now access it.")}catch(V){console.error("Publish error:",V),K("error","Failed to publish journey. Please try again.")}finally{x(!1)}},W=y.useCallback((V,Z)=>{const Q=`block_${Date.now()}`;let q=Z;if(!q)if(i.blocks.length===0)q={x:400,y:100};else{const we=i.blocks[i.blocks.length-1],Ut=c.find(Bn=>Bn.id===we.id)?.position||we.ui?.position||{x:400,y:0};q={x:Ut.x,y:Ut.y+200}}const ie={id:Q,type:V,content:Ip(V),ui:{position:q}},fe=[...i.blocks,ie],pe=i.startBlockId||Q,Ze=[...i.edges];if(i.blocks.length>0&&!i.edges.some(we=>we.to===Q)){const we=i.blocks[i.blocks.length-1];i.edges.some(Wt=>Wt.from===we.id)||Ze.push({from:we.id,to:Q})}l({...i,blocks:fe,edges:Ze,startBlockId:pe}),b(Q),M(!0),L(!0)},[i,c]),se=y.useCallback((V,Z)=>{const Q=i.blocks.map(q=>q.id===V?{...q,...Z}:q);l({...i,blocks:Q}),L(!0)},[i]),J=y.useCallback(V=>{const Z=i.blocks.filter(ie=>ie.id!==V),Q=i.edges.filter(ie=>ie.from!==V&&ie.to!==V),q=i.startBlockId===V?Z[0]?.id||"":i.startBlockId;l({...i,blocks:Z,edges:Q,startBlockId:q}),b(null),M(!1),L(!0)},[i]),ne=y.useCallback(()=>{const V=S.size,Z=i.blocks.filter(q=>S.has(q.id)).slice(0,5).map(q=>q.content?.title||"Untitled").join(", "),Q=V<=5?`Delete ${V} block${V>1?"s":""} (${Z})?`:`Delete ${V} blocks (${Z}, and ${V-5} more)?`;if(confirm(`${Q}

All connections to these blocks will also be removed. This action cannot be undone.`)){F(!0);try{const q=i.blocks.filter(pe=>!S.has(pe.id)),ie=i.edges.filter(pe=>!S.has(pe.from)&&!S.has(pe.to));let fe=i.startBlockId;S.has(i.startBlockId)&&(fe=q[0]?.id||""),l({...i,blocks:q,edges:ie,startBlockId:fe}),$(new Set),b(null),M(!1),L(!0),K("success",`Successfully deleted ${V} block${V>1?"s":""}`)}catch(q){console.error("Error bulk deleting blocks:",q),K("error","Failed to delete some blocks. Please try again.")}finally{F(!1)}}},[i,S]),oe=y.useCallback(V=>{const Z=new Set(S);Z.has(V)?Z.delete(V):Z.add(V),$(Z)},[S]),le=y.useCallback(()=>{$(new Set(i.blocks.map(V=>V.id)))},[i.blocks]),ce=y.useCallback(()=>{$(new Set)},[]),he=y.useCallback((V,Z)=>{if(i.edges.find(ie=>ie.from===V&&ie.to===Z)||V===Z)return;const q={from:V,to:Z};l({...i,edges:[...i.edges,q]}),L(!0)},[i]),be=y.useCallback((V,Z)=>{const Q=i.edges.filter(q=>!(q.from===V&&q.to===Z));l({...i,edges:Q}),L(!0)},[i]),ke=y.useCallback(V=>{l({...i,startBlockId:V}),L(!0)},[i]),Ee=y.useCallback(V=>{V.source&&V.target&&he(V.source,V.target)},[he]),Be=y.useCallback((V,Z)=>{k?(k.fromBlockId!==Z.id&&he(k.fromBlockId,Z.id),I(null)):(b(Z.id),M(!0))},[k,he]),U=y.useCallback((V,Z)=>{const Q=i.blocks.map(q=>q.id===Z.id?{...q,ui:{...q.ui,position:Z.position}}:q);l(q=>({...q,blocks:Q})),L(!0)},[i.blocks]),ve=y.useCallback(V=>{V.forEach(Z=>{be(Z.source,Z.target)})},[be]),tt=y.useCallback(V=>{V.preventDefault(),V.dataTransfer.dropEffect="move"},[]),Ye=y.useCallback(V=>{V.preventDefault();const Z=V.dataTransfer.getData("application/reactflow-type");if(!Z)return;const Q=o({x:V.clientX,y:V.clientY});W(Z,Q)},[o,W]),qe=y.useCallback((V,Z)=>{V.dataTransfer.setData("application/reactflow-type",Z),V.dataTransfer.effectAllowed="move"},[]),nt=V=>{const Z=V.blocks.map((Q,q)=>({...Q,ui:{...Q.ui,position:Q.ui?.position||{x:400,y:100+q*200}}}));l({...V,blocks:Z}),E(!1),L(!0),K("success","AI-generated content added to journey"),setTimeout(()=>a({padding:.2}),100)},He=i.blocks.find(V=>V.id===p);return n.jsxs("div",{className:"h-full flex flex-col bg-slate-900",children:[_&&n.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg border ${_.type==="success"?"bg-emerald-500/20 border-emerald-500/30 text-emerald-300":_.type==="error"?"bg-error/20 border-error/30 text-error":"bg-primary-500/20 border-primary-500/30 text-primary-300"}`,children:[_.type==="success"?n.jsx(jn,{className:"w-5 h-5"}):_.type==="error"?n.jsx(ns,{className:"w-5 h-5"}):n.jsx(me,{className:"w-5 h-5"}),n.jsx("span",{className:"font-medium",children:_.message}),n.jsx("button",{onClick:()=>A(null),className:"ml-2 opacity-60 hover:opacity-100",children:n.jsx(Ct,{className:"w-4 h-4"})})]}),n.jsx("header",{className:"bg-slate-800 border-b border-slate-700 px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-1 text-slate-400 hover:text-white transition-colors",children:[n.jsx(os,{className:"w-5 h-5"}),"Back"]}),n.jsx("div",{className:"h-6 w-px bg-slate-700"}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-semibold text-white",children:T}),n.jsxs("p",{className:"text-xs text-slate-500",children:[i.blocks.length," blocks, ",i.edges.length," connections",z&&n.jsx("span",{className:"text-warning ml-2",children:"Unsaved changes"})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[S.size>0&&n.jsxs("button",{onClick:ne,disabled:H,className:"flex items-center gap-2 px-3 py-1.5 bg-error text-white rounded-lg text-sm hover:bg-error/90 disabled:opacity-50 transition-colors",children:[H?n.jsx(me,{className:"w-4 h-4 animate-spin"}):n.jsx(_e,{className:"w-4 h-4"}),"Delete ",S.size]}),n.jsxs("button",{onClick:()=>E(!0),disabled:H,className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg text-sm hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(ge,{className:"w-4 h-4"}),"AI Generate"]}),n.jsxs("button",{onClick:D,disabled:g||!z||H,className:"flex items-center gap-2 px-3 py-1.5 bg-slate-700 text-white rounded-lg text-sm hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[g?n.jsx(me,{className:"w-4 h-4 animate-spin"}):n.jsx(zl,{className:"w-4 h-4"}),g?"Saving...":"Save"]}),n.jsxs("button",{onClick:X,disabled:N||i.blocks.length===0||H,className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 disabled:opacity-50 transition-colors",children:[N?n.jsx(me,{className:"w-4 h-4 animate-spin"}):n.jsx(po,{className:"w-4 h-4"}),N?"Publishing...":"Publish"]})]})]})}),n.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[n.jsxs("aside",{className:"w-64 bg-slate-800 border-r border-slate-700 flex flex-col",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Drag blocks to canvas"}),n.jsx("div",{className:"grid grid-cols-2 gap-2",children:ts.map(({type:V,label:Z,icon:Q,color:q})=>n.jsxs("div",{draggable:!0,onDragStart:ie=>qe(ie,V),className:"flex flex-col items-center gap-1.5 p-3 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors group cursor-grab active:cursor-grabbing",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(_s,{className:"w-3 h-3 text-slate-500 opacity-0 group-hover:opacity-100 transition-opacity"}),n.jsx("div",{className:`w-8 h-8 ${q} rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform`,children:n.jsx(Q,{className:"w-4 h-4 text-white"})})]}),n.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:Z})]},V))})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-300",children:"Blocks List"}),i.blocks.length>0&&n.jsx("div",{className:"flex items-center gap-1",children:S.size>0?n.jsxs("button",{onClick:ce,className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:["Clear (",S.size,")"]}):n.jsx("button",{onClick:le,className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Select All"})})]}),i.blocks.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"No blocks yet. Drag blocks to the canvas or use AI generate."}):n.jsx("div",{className:"space-y-2",children:i.blocks.map((V,Z)=>{const Q=ts.find(pe=>pe.type===V.type),q=Q?.icon||$e,ie=i.startBlockId===V.id,fe=p===V.id;return n.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg transition-colors cursor-pointer ${S.has(V.id)?"bg-primary-600/20 border border-primary-500":fe?"bg-primary-600/10 border border-primary-400":"bg-slate-700/50 hover:bg-slate-700 border border-transparent"}`,onClick:()=>{b(V.id),M(!0)},children:[n.jsx("input",{type:"checkbox",checked:S.has(V.id),onChange:pe=>{pe.stopPropagation(),oe(V.id)},disabled:H,className:"w-4 h-4 rounded border-slate-600 text-primary-600 focus:ring-primary-500 focus:ring-offset-slate-900"}),n.jsx("div",{className:`w-6 h-6 ${Q?.color||"bg-slate-600"} rounded flex items-center justify-center`,children:n.jsx(q,{className:"w-3 h-3 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-white truncate",children:V.content?.title||`${Q?.label||"Block"} ${Z+1}`}),n.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[ie&&n.jsx("span",{className:"text-emerald-400",children:"Start"}),!ie&&n.jsx("span",{children:Q?.label})]})]}),!ie&&n.jsx("button",{onClick:pe=>{pe.stopPropagation(),ke(V.id)},disabled:H,className:"p-1 text-slate-500 hover:text-emerald-400 rounded disabled:opacity-50",title:"Set as start",children:n.jsx(Cn,{className:"w-3 h-3"})})]},V.id)})})]}),k&&n.jsx("div",{className:"p-3 bg-primary-600/20 border-t border-primary-500/30",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-primary-300",children:"Click a block to connect"}),n.jsx("button",{onClick:()=>I(null),className:"text-xs text-primary-400 hover:text-primary-300",children:"Cancel"})]})})]}),n.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",ref:r,children:n.jsxs(Sm,{nodes:c,edges:f,onNodesChange:h,onEdgesChange:m,onConnect:Ee,onNodeClick:Be,onNodeDragStop:U,onEdgesDelete:ve,onDragOver:tt,onDrop:Ye,nodeTypes:Cp,defaultEdgeOptions:Sp,fitView:!0,fitViewOptions:{padding:.2},className:"bg-slate-900",proOptions:{hideAttribution:!0},deleteKeyCode:["Backspace","Delete"],selectionOnDrag:!0,panOnDrag:[1,2],selectionMode:1,children:[n.jsx($m,{color:"#334155",gap:20,size:1}),n.jsx(Hm,{className:"bg-slate-800 border border-slate-700 rounded-lg"}),n.jsx(Km,{nodeColor:V=>{const Z=i.blocks.find(Q=>Q.id===V.id);if(!Z)return"#475569";switch(ts.find(Q=>Q.type===Z.type),Z.type){case"read":return"#6366f1";case"video":return"#f43f5e";case"image":return"#10b981";case"quiz":return"#a855f7";case"mission":return"#f97316";case"form":return"#14b8a6";case"ai_help":return"#06b6d4";case"checkpoint":return"#eab308";case"animation":return"#ec4899";case"code":return"#475569";case"exercise":return"#8b5cf6";case"resource":return"#6366f1";default:return"#475569"}},maskColor:"rgba(15, 23, 42, 0.8)",className:"bg-slate-800 border border-slate-700 rounded-lg"}),i.blocks.length===0&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:n.jsxs("div",{className:"text-center pointer-events-auto",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center mx-auto mb-4",children:n.jsx(Qe,{className:"w-8 h-8 text-slate-600"})}),n.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"Start Building Your Journey"}),n.jsx("p",{className:"text-slate-500 mb-4 max-w-md",children:"Drag blocks from the sidebar to create your learning path, or use AI to generate a complete course outline."}),n.jsxs("button",{onClick:()=>E(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-colors",children:[n.jsx(ge,{className:"w-5 h-5"}),"Generate with AI"]})]})})]})}),j&&He&&n.jsx("aside",{className:"w-96 bg-slate-800 border-l border-slate-700 overflow-y-auto",children:n.jsx(op,{block:He,allBlocks:i.blocks,edges:i.edges,onUpdate:V=>se(He.id,V),onAddEdge:(V,Z)=>{const Q={from:He.id,to:V,condition:Z};l({...i,edges:[...i.edges.filter(q=>!(q.from===He.id&&q.to===V)),Q]}),L(!0)},onRemoveEdge:V=>{l({...i,edges:i.edges.filter(Z=>!(Z.from===He.id&&Z.to===V))}),L(!0)},onClose:()=>{M(!1),b(null)}})})]}),w&&n.jsx(vp,{onGenerate:nt,onClose:()=>E(!1),existingGraph:i,trackModulesContext:O,currentModuleId:e})]})}function Ep(e){return n.jsx(oa,{children:n.jsx(_p,{...e})})}function Ip(e){switch(e){case"read":return{title:"New Reading",markdown:`# Title

Your content here...`,estimatedReadTime:3};case"video":return{title:"New Video",url:""};case"image":return{title:"New Image",url:"",caption:"",alt:""};case"quiz":return{title:"Knowledge Check",questions:[],passingScore:50};case"mission":return{title:"New Mission",steps:[]};case"form":return{title:"New Form",fields:[]};case"ai_help":return{title:"AI Help",mode:"targeted_remediation"};case"checkpoint":return{title:"Checkpoint"};case"animation":return{title:"New Animation",animationType:"lottie",url:""};case"code":return{title:"Code Example",code:"// Your code here",language:"javascript",showLineNumbers:!0};case"exercise":return{title:"Practice Exercise",problem:"",solution:"",hints:[]};case"resource":return{title:"Resources",resources:[]};default:return{title:"New Block"}}}function Mp(){const{enabled:e,isLoading:t}=Ns(),[s,r]=y.useState("content"),[o,a]=y.useState(""),[i,l]=y.useState("beginners"),[c,d]=y.useState(""),[h,f]=y.useState(""),[u,m]=y.useState(!1),[p,b]=y.useState(!1),g=async()=>{if(o.trim()){m(!0),f("");try{const w=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:s,topic:o,targetAudience:i,existingContent:c||void 0})})).json();w.error?f(`Error: ${w.error}`):w.result&&(typeof w.result=="string"?f(w.result):f(JSON.stringify(w.result,null,2)))}catch(x){f(`Error: ${x instanceof Error?x.message:"Generation failed"}`)}finally{m(!1)}}},v=()=>{navigator.clipboard.writeText(h),b(!0),setTimeout(()=>b(!1),2e3)},N=[{id:"content",label:"Reading Content",icon:Ot,description:"Generate educational markdown content"},{id:"quiz",label:"Quiz Questions",icon:Vt,description:"Generate assessment questions with answers"},{id:"video_script",label:"Video Script",icon:ut,description:"Generate video narration scripts"}];return t?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsx(me,{className:"w-8 h-8 text-purple-500 animate-spin"})}):e?n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"p-6 border-b border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(ge,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"AI Content Studio"}),n.jsx("p",{className:"text-slate-400",children:"Generate educational content with AI assistance"})]})]})}),n.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[n.jsx("div",{className:"w-96 border-r border-slate-700 p-6 overflow-y-auto",children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"What to Generate"}),n.jsx("div",{className:"space-y-2",children:N.map(x=>{const w=x.icon,E=s===x.id;return n.jsxs("button",{onClick:()=>r(x.id),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-colors text-left ${E?"bg-purple-600/20 border border-purple-500":"bg-slate-800 border border-slate-700 hover:bg-slate-700"}`,children:[n.jsx(w,{className:`w-5 h-5 ${E?"text-purple-400":"text-slate-400"}`}),n.jsxs("div",{children:[n.jsx("div",{className:`font-medium ${E?"text-purple-300":"text-white"}`,children:x.label}),n.jsx("div",{className:"text-xs text-slate-500",children:x.description})]})]},x.id)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Topic / Subject"}),n.jsx("textarea",{value:o,onChange:x=>a(x.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"What topic should the content cover?"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Audience"}),n.jsxs("select",{value:i,onChange:x=>l(x.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginners",children:"Complete Beginners"}),n.jsx("option",{value:"students",children:"Students"}),n.jsx("option",{value:"professionals",children:"Professionals"}),n.jsx("option",{value:"technical",children:"Technical Audience"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Existing Content (optional)"}),n.jsx("textarea",{value:c,onChange:x=>d(x.target.value),rows:4,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"Paste existing content to expand upon..."})]}),n.jsx("button",{onClick:g,disabled:!o.trim()||u,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:u?n.jsxs(n.Fragment,{children:[n.jsx(me,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(ge,{className:"w-5 h-5"}),"Generate"]})})]})}),n.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h2",{className:"font-semibold text-white",children:"Generated Output"}),h&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:g,disabled:u,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:[n.jsx(al,{className:`w-4 h-4 ${u?"animate-spin":""}`}),"Regenerate"]}),n.jsx("button",{onClick:v,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:p?n.jsxs(n.Fragment,{children:[n.jsx(jn,{className:"w-4 h-4 text-emerald-400"}),"Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx(fl,{className:"w-4 h-4"}),"Copy"]})})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:u?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(me,{className:"w-12 h-12 text-purple-500 animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-400",children:"Generating content..."}),n.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"This may take a moment"})]})}):h?n.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:n.jsx("pre",{className:"text-slate-200 text-sm whitespace-pre-wrap font-mono",children:h})}):n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(ge,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),n.jsx("p",{className:"text-slate-400",children:"Generated content will appear here"}),n.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Fill in the form and click Generate to start"})]})})})]})]})]}):n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"p-6 border-b border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(ge,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"AI Content Studio"}),n.jsx("p",{className:"text-slate-400",children:"Generate educational content with AI assistance"})]})]})}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:n.jsx(xo,{})})]})}function ao(e){return e.startsWith("/admin/builder")?"builder":e.startsWith("/admin/tracks")?"tracks":e.startsWith("/admin/ai-studio")?"ai-studio":e.startsWith("/admin/settings")?"settings":"dashboard"}function zp({onExit:e,onSettingsChanged:t}){const s=uo(),r=co(),[o,a]=y.useState(()=>ao(s.pathname)),[i,l]=y.useState(null);y.useEffect(()=>{const f=ao(s.pathname);f!==o&&a(f)},[s.pathname]);const c=(f,u)=>{l({moduleId:f,journeyVersionId:u}),a("builder"),r(`/admin/builder/${f}${u?`?v=${u}`:""}`)},d=()=>{l(null),a("tracks"),r("/admin/tracks")},h=()=>{if(i&&o==="builder")return n.jsx(Ep,{moduleId:i.moduleId,journeyVersionId:i.journeyVersionId,onBack:d});switch(o){case"dashboard":return n.jsx(Ap,{onNavigate:a});case"tracks":return n.jsx(ql,{onEditJourney:c});case"builder":return n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Es,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),n.jsx("h2",{className:"text-xl font-semibold text-slate-400 mb-2",children:"Journey Builder"}),n.jsx("p",{className:"text-slate-500 mb-4",children:"Select a module from Tracks to edit its journey"}),n.jsx("button",{onClick:()=>a("tracks"),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Go to Tracks"})]})});case"ai-studio":return n.jsx(Mp,{});case"settings":return n.jsx(Tp,{onSettingsChanged:t});default:return null}};return n.jsx(Fl,{activeTab:o,onTabChange:a,onExit:e,children:h()})}function Ap({onNavigate:e}){const[t,s]=y.useState({totalTracks:0,activeLearners:0,avgCompletion:0,totalHours:0}),[r,o]=y.useState(!0);y.useEffect(()=>{a()},[]);const a=async()=>{try{const{supabase:l}=await rs(async()=>{const{supabase:N}=await import("./index-vT5yFsa4.js").then(x=>x.v);return{supabase:N}},__vite__mapDeps([0,1])),{count:c}=await l.from("tracks").select("*",{count:"exact",head:!0}),{data:d}=await l.from("user_journey_runs").select("user_id"),h=new Set(d?.map(N=>N.user_id)||[]),{data:f}=await l.from("user_journey_runs").select("status"),u=f?.length||0,m=f?.filter(N=>N.status==="completed").length||0,p=u>0?Math.round(m/u*100):0,{data:b}=await l.from("user_block_states").select("time_spent_seconds"),g=b?.reduce((N,x)=>N+(x.time_spent_seconds||0),0)||0,v=Math.round(g/3600);s({totalTracks:c||0,activeLearners:h.size,avgCompletion:p,totalHours:v})}catch(l){console.error("Error loading dashboard stats:",l)}finally{o(!1)}},i=[{label:"Total Tracks",value:r?"...":String(t.totalTracks),icon:$e,color:"bg-primary-500"},{label:"Active Learners",value:r?"...":String(t.activeLearners),icon:Ol,color:"bg-emerald-500"},{label:"Avg. Completion",value:r?"...":`${t.avgCompletion}%`,icon:ll,color:"bg-purple-500"},{label:"Total Hours",value:r?"...":String(t.totalHours),icon:cl,color:"bg-warning"}];return n.jsx("div",{className:"h-full overflow-y-auto",children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Admin Dashboard"}),n.jsx("p",{className:"text-slate-400",children:"Manage your learning content and track performance"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:i.map(l=>{const c=l.icon;return n.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:`w-12 h-12 ${l.color} rounded-xl flex items-center justify-center`,children:n.jsx(c,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-2xl font-bold text-white",children:l.value}),n.jsx("div",{className:"text-sm text-slate-400",children:l.label})]})]})},l.label)})}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Quick Actions"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{onClick:()=>e("tracks"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center",children:n.jsx($e,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"Create New Track"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Start a new learning path"})]})]}),n.jsxs("button",{onClick:()=>e("ai-studio"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:n.jsx(ge,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"AI Content Studio"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Generate content with AI"})]})]}),n.jsxs("button",{onClick:()=>e("tracks"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center",children:n.jsx(Es,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"Edit Existing Journey"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Modify course content"})]})]})]})]}),n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Recent Activity"}),n.jsx("div",{className:"space-y-4",children:[{action:"Track published",item:"GenAI Fundamentals",time:"2 hours ago"},{action:"Module created",item:"Advanced Prompting",time:"5 hours ago"},{action:"Quiz updated",item:"Knowledge Check #3",time:"1 day ago"},{action:"New learner enrolled",item:"John D.",time:"2 days ago"}].map((l,c)=>n.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700 last:border-0",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-white",children:l.action}),n.jsx("div",{className:"text-xs text-slate-500",children:l.item})]}),n.jsx("div",{className:"text-xs text-slate-500",children:l.time})]},c))})]})]})]})})}function Tp({onSettingsChanged:e}){const[t,s]=y.useState("Learning Hub"),[r,o]=y.useState("English"),[a,i]=y.useState("gpt-4o"),[l,c]=y.useState("gpt-4o-mini"),[d,h]=y.useState("gpt-image-1.5"),[f,u]=y.useState(!0),[m,p]=y.useState(!0),[b,g]=y.useState(!1),[v,N]=y.useState(null);y.useEffect(()=>{x()},[]);const x=async()=>{try{const{supabase:k}=await rs(async()=>{const{supabase:P}=await import("./index-vT5yFsa4.js").then(R=>R.v);return{supabase:P}},__vite__mapDeps([0,1])),{data:I,error:T}=await k.from("system_settings").select("setting_key, setting_value").in("setting_key",["ai_content_model","ai_help_model","ai_image_model","platform_name","default_language","ai_enabled"]);if(T)throw T;I&&I.forEach(P=>{switch(P.setting_key){case"ai_content_model":i(P.setting_value);break;case"ai_help_model":c(P.setting_value);break;case"ai_image_model":h(P.setting_value);break;case"platform_name":s(P.setting_value);break;case"default_language":o(P.setting_value);break;case"ai_enabled":u(P.setting_value==="true");break}})}catch(k){console.error("Error loading settings:",k),N({type:"error",text:"Failed to load settings. Please check your connection and try again."})}finally{p(!1)}},w=async()=>{g(!0),N(null);try{const{supabase:k}=await rs(async()=>{const{supabase:T}=await import("./index-vT5yFsa4.js").then(P=>P.v);return{supabase:T}},__vite__mapDeps([0,1])),I=[{setting_key:"ai_content_model",setting_value:a},{setting_key:"ai_help_model",setting_value:l},{setting_key:"ai_image_model",setting_value:d},{setting_key:"platform_name",setting_value:t},{setting_key:"default_language",setting_value:r},{setting_key:"ai_enabled",setting_value:String(f)}];for(const T of I){const{error:P}=await k.from("system_settings").upsert({setting_key:T.setting_key,setting_value:T.setting_value,category:T.setting_key.startsWith("ai_")?"ai":"general",description:E(T.setting_key)},{onConflict:"setting_key"});if(P)throw console.error(`Error saving ${T.setting_key}:`,P),P}N({type:"success",text:"Settings saved successfully!"}),setTimeout(()=>N(null),3e3),e&&e()}catch(k){console.error("Error saving settings:",k),N({type:"error",text:"Failed to save settings. Please try again."})}finally{g(!1)}},E=k=>({ai_content_model:"AI model used for content generation in AI Studio",ai_help_model:"AI model used for student help and assistance",ai_image_model:"AI model used for generating educational images and diagrams",platform_name:"Platform display name",default_language:"Default content language",ai_enabled:"Whether AI content generation is enabled"})[k]||"";return m?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsx("div",{className:"text-slate-400",children:"Loading settings..."})}):n.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[n.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"Settings"}),n.jsxs("div",{className:"max-w-2xl space-y-6",children:[n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"General Settings"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Platform Name"}),n.jsx("input",{type:"text",value:t,onChange:k=>s(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter platform name"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Default Language"}),n.jsxs("select",{value:r,onChange:k=>o(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"English",children:"English"}),n.jsx("option",{value:"Arabic",children:"Arabic"}),n.jsx("option",{value:"Spanish",children:"Spanish"}),n.jsx("option",{value:"French",children:"French"})]})]})]})]}),n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"AI Settings"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Content Generation Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for AI Studio and course generation"}),n.jsxs("select",{value:a,onChange:k=>i(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-4o",children:"GPT-4o (Recommended)"}),n.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o-mini (Faster)"}),n.jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),n.jsx("option",{value:"gpt-5.2",children:"GPT-5.2 (Latest)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"AI Help Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for student assistance and tutoring"}),n.jsxs("select",{value:l,onChange:k=>c(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-4o",children:"GPT-4o (Recommended)"}),n.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o-mini (Faster, Cost-effective)"}),n.jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),n.jsx("option",{value:"gpt-5.2",children:"GPT-5.2 (Latest)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Image Generation Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for generating educational images and diagrams"}),n.jsxs("select",{value:d,onChange:k=>h(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-image-1.5",children:"GPT Image 1.5 (Latest)"}),n.jsx("option",{value:"gpt-image-1",children:"GPT Image 1"}),n.jsx("option",{value:"dall-e-3",children:"DALL-E 3 (High Quality)"}),n.jsx("option",{value:"dall-e-2",children:"DALL-E 2 (Faster)"})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-slate-300",children:"Enable AI Content Generation"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Allow AI to generate course content"})]}),n.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:f,onChange:k=>u(k.target.checked),className:"sr-only peer"}),n.jsx("div",{className:"w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]})]})]}),v&&n.jsx("div",{className:`p-4 rounded-lg ${v.type==="success"?"bg-success/10 text-success border border-success/20":"bg-error/10 text-error border border-error/20"}`,children:v.text}),n.jsx("button",{onClick:w,disabled:b,className:"w-full px-6 py-3 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Saving...":"Save Settings"})]})]})}const $p={read:n.jsx($e,{className:"w-5 h-5 text-blue-400"}),video:n.jsx(ut,{className:"w-5 h-5 text-rose-400"}),quiz:n.jsx(Vt,{className:"w-5 h-5 text-purple-400"}),mission:n.jsx(Nn,{className:"w-5 h-5 text-orange-400"}),form:n.jsx(_l,{className:"w-5 h-5 text-cyan-400"}),checkpoint:n.jsx(ss,{className:"w-5 h-5 text-emerald-400"}),ai_help:n.jsx(ge,{className:"w-5 h-5 text-amber-400"}),animation:n.jsx($l,{className:"w-5 h-5 text-pink-400"})},lo={read:"",video:"",quiz:"",mission:"",form:"",checkpoint:" ",ai_help:" ",animation:" "};function Rp({blocks:e,edges:t,startBlockId:s,onReorder:r,onEditBlock:o,onDeleteBlock:a,onSetStart:i}){const[l,c]=y.useState(null),[d,h]=y.useState(null),[f,u]=y.useState(new Set),m=y.useRef(null),p=y.useCallback((R,C)=>{c(C),R.dataTransfer.effectAllowed="move",R.dataTransfer.setData("text/plain",C.toString()),m.current&&(m.current.style.opacity="0.5")},[]),b=y.useCallback((R,C)=>{R.preventDefault(),R.dataTransfer.dropEffect="move",l!==null&&l!==C&&h(C)},[l]),g=y.useCallback(()=>{h(null)},[]),v=y.useCallback((R,C)=>{if(R.preventDefault(),l===null||l===C){c(null),h(null);return}const z=[...e],[L]=z.splice(l,1);z.splice(C,0,L);const j=k(z,t);r(z,j),c(null),h(null)},[l,e,t,r]),N=y.useCallback(()=>{c(null),h(null)},[]),x=y.useCallback((R,C)=>{c(C)},[]),w=y.useCallback(R=>{if(l===null)return;const C=R.touches[0],L=document.elementsFromPoint(C.clientX,C.clientY).find(j=>j.hasAttribute("data-block-index"));if(L){const j=parseInt(L.getAttribute("data-block-index")||"-1");j!==-1&&j!==l&&h(j)}},[l]),E=y.useCallback(R=>{if(l!==null&&d!==null&&l!==d){const C=[...e],[z]=C.splice(l,1);C.splice(d,0,z);const L=k(C,t);r(C,L)}c(null),h(null)},[l,d,e,t,r]),k=(R,C)=>{const z=C.filter(j=>j.condition),L=[];for(let j=0;j<R.length-1;j++){const M=R[j],_=R[j+1];z.some(S=>S.from===M.id)||L.push({from:M.id,to:_.id})}return[...L,...z]},I=R=>{const C=new Set(f);C.has(R)?C.delete(R):C.add(R),u(C)},T=R=>t.filter(C=>C.from===R),P=(R,C)=>{const z=C==="up"?R-1:R+1;if(z<0||z>=e.length)return;const L=[...e];[L[R],L[z]]=[L[z],L[R]];const j=k(L,t);r(L,j)};return n.jsxs("div",{className:"space-y-2",children:[e.map((R,C)=>{const z=R.content,L=s===R.id,j=l===C,M=d===C,_=f.has(R.id),A=T(R.id),S=A.some($=>$.condition);return n.jsxs("div",{ref:j?m:null,"data-block-index":C,draggable:!0,onDragStart:$=>p($,C),onDragOver:$=>b($,C),onDragLeave:g,onDrop:$=>v($,C),onDragEnd:N,onTouchStart:$=>x($,C),onTouchMove:w,onTouchEnd:E,className:`
              bg-slate-800 rounded-xl border transition-all
              ${j?"dragging border-blue-500":"border-slate-700"}
              ${M?"border-blue-500 border-dashed bg-blue-500/10":""}
            `,children:[n.jsxs("div",{className:"flex items-center gap-3 p-4",children:[n.jsx("div",{className:"drag-handle p-1 text-slate-500 hover:text-slate-300 touch-manipulation",children:n.jsx(_s,{className:"w-5 h-5"})}),n.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-700 flex items-center justify-center flex-shrink-0",children:$p[R.type]||n.jsx($e,{className:"w-5 h-5 text-slate-400"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"font-medium text-white truncate",children:z?.title||lo[R.type]||R.type}),L&&n.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded-full flex-shrink-0",children:""}),S&&n.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full flex-shrink-0 flex items-center gap-1",children:[n.jsx(bl,{className:"w-3 h-3"}),""]})]}),n.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:lo[R.type]||R.type})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>P(C,"up"),disabled:C===0,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:" ",children:n.jsx(as,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>P(C,"down"),disabled:C===e.length-1,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:" ",children:n.jsx(is,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>I(R.id),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"",children:_?n.jsx(as,{className:"w-4 h-4"}):n.jsx(is,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>o(R),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"",children:n.jsx(Ll,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>a(R.id),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",title:"",children:n.jsx(_e,{className:"w-4 h-4"})})]})]}),_&&n.jsx("div",{className:"px-4 pb-4 border-t border-slate-700 mt-2 pt-4",children:n.jsxs("div",{className:"space-y-3",children:[!L&&n.jsx("button",{onClick:()=>i(R.id),className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",children:"  "}),A.length>0&&n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:":"}),n.jsx("div",{className:"space-y-1",children:A.map(($,H)=>{const O=e.find(G=>G.id===$.to)?.content;return n.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-2",children:[n.jsx("span",{className:"text-slate-600",children:""}),n.jsx("span",{children:O?.title||$.to}),$.condition&&n.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded",children:""})]},H)})})]})]})})]},R.id)}),e.length===0&&n.jsx("div",{className:"text-center py-12 text-slate-500",children:"  .   ."})]})}export{vp as AIContentGenerator,Mp as AIStudio,Fl as AdminLayout,zp as AdminPage,op as BlockEditor,kp as BlockNode,Rp as DraggableBlockList,Ep as JourneyBuilder,ql as TrackManager};

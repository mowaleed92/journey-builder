const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CxUWKkPj.js","assets/index-25yOeJuG.css"])))=>i.map(i=>d[i]);
import{r as nl,c as oe,a as y,u as uo,b as ho,j as n,B as Re,S as be,d as sl,L as pe,C as En,e as rl,s as ve,f as ol,X as Ct,g as fo,h as il,R as al,P as mo,A as Tt,i as cn,k as dn,T as In,l as ll,_ as as,m as cl,n as dl}from"./index-CxUWKkPj.js";import{C as ls,I as nt,V as ut,L as po,a as Mn,P as ul,R as hl,D as fl,u as Ns,U as xo,F as Vt,A as go,E as ml,b as ks,H as Ft,c as Cs,B as Ss,d as An,e as bo,f as pl}from"./useAIEnabled-hcTM4abB.js";nl();const xl=oe("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);const gl=oe("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);const bl=oe("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);const yo=oe("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const yl=oe("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);const xn=oe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const gn=oe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const vl=oe("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);const wl=oe("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const _s=oe("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const jl=oe("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);const Nl=oe("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);const kl=oe("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);const Es=oe("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const Cl=oe("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const Sl=oe("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const _l=oe("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);const El=oe("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);const Il=oe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const Ml=oe("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Al=oe("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Tl=oe("MonitorPlay",[["path",{d:"m10 7 5 3-5 3Z",key:"29ljg6"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]);const $l=oe("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);const Pl=oe("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);const Dl=oe("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);const et=oe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const zl=oe("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);const Rl=oe("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);const Ll=oe("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);const vo=oe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const Bl=oe("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);const Hl=oe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);const wo=oe("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const Te=oe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Ol=oe("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);const Vl=oe("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);const Fl=oe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const Gl=oe("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);function ql({children:e,activeTab:t,onTabChange:s,onExit:r}){const[o,a]=y.useState(!1),i=uo(),l=ho(),c=[{id:"dashboard",label:"Dashboard",icon:Cl,path:"/admin"},{id:"tracks",label:"Tracks",icon:Re,path:"/admin/tracks"},{id:"builder",label:"Journey Builder",icon:Es,path:"/admin/builder"},{id:"ai-studio",label:"AI Studio",icon:be,path:"/admin/ai-studio"},{id:"settings",label:"Settings",icon:sl,path:"/admin/settings"}],d=u=>{i(u.path),s(u.id)},f=(()=>{const u=l.pathname;return u.startsWith("/admin/builder")?"builder":u.startsWith("/admin/tracks")?"tracks":u.startsWith("/admin/ai-studio")?"ai-studio":u.startsWith("/admin/settings")?"settings":"dashboard"})();return n.jsxs("div",{className:"min-h-screen bg-slate-900 flex",children:[n.jsxs("aside",{className:`bg-slate-800 border-r border-slate-700 flex flex-col transition-all duration-300 ${o?"w-16":"w-64"}`,children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[!o&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("img",{src:"https://res.cloudinary.com/dujh5xuoi/image/upload/v1754423073/%D8%AA%D8%B9%D9%84%D9%91%D9%85_AIFinal_edvr4e.png",alt:"Platform logo",className:"max-h-8 w-auto object-contain"}),n.jsx("span",{className:"font-bold text-white",children:"Admin"})]}),n.jsx("button",{onClick:()=>a(!o),className:"p-1.5 rounded-lg hover:bg-slate-700 text-slate-400 transition-colors",children:n.jsx(ls,{className:`w-5 h-5 transition-transform ${o?"rotate-180":""}`})})]}),n.jsx("nav",{className:"flex-1 p-2 space-y-1",role:"navigation","aria-label":"Admin navigation",children:c.map(u=>{const m=u.icon,p=f===u.id||t===u.id;return n.jsxs("button",{onClick:()=>d(u),"aria-label":u.label,"aria-current":p?"page":void 0,className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors ${p?"bg-blue-600 text-white":"text-slate-400 hover:bg-slate-700 hover:text-white"}`,children:[n.jsx(m,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),!o&&n.jsx("span",{className:"font-medium",children:u.label})]},u.id)})}),n.jsx("div",{className:"p-2 border-t border-slate-700",children:n.jsxs("button",{onClick:r,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-400 hover:bg-slate-700 hover:text-white transition-colors",children:[n.jsx(ls,{className:"w-5 h-5 flex-shrink-0"}),!o&&n.jsx("span",{className:"font-medium",children:"Back to App"})]})})]}),n.jsx("main",{className:"flex-1 overflow-hidden",children:e})]})}function Yl({selectedCount:e,totalCount:t,onSelectAll:s,onSelectNone:r,onDelete:o,isDeleting:a=!1,itemName:i="items"}){return e===0?null:n.jsxs("div",{className:"sticky top-0 z-10 bg-slate-800 border-b border-slate-700 px-4 py-3 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("span",{className:"text-sm font-medium text-white",children:[e," of ",t," ",i," selected"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[e<t?n.jsxs("button",{onClick:s,disabled:a,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[n.jsx(yl,{className:"w-4 h-4"}),"Select All"]}):null,n.jsxs("button",{onClick:r,disabled:a,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[n.jsx(wo,{className:"w-4 h-4"}),"Clear Selection"]})]})]}),n.jsx("button",{onClick:o,disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",children:a?n.jsxs(n.Fragment,{children:[n.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):n.jsxs(n.Fragment,{children:[n.jsx(Te,{className:"w-4 h-4"}),"Delete Selected (",e,")"]})})]})}function Zl({isSelected:e,onToggleSelect:t,children:s,className:r="",disabled:o=!1}){return n.jsxs("div",{className:`relative group ${r} ${e?"ring-2 ring-blue-500":""} ${o?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:a=>{const i=a.target,l=i.closest("button"),c=i.closest("input, textarea, select");!l&&!c&&!o&&t()},children:[n.jsx("div",{className:`absolute top-3 left-3 z-10 w-6 h-6 rounded border-2 flex items-center justify-center transition-all ${e?"bg-blue-600 border-blue-600":"bg-slate-700 border-slate-600 group-hover:border-slate-500"}`,onClick:a=>{a.stopPropagation(),o||t()},children:e&&n.jsx(En,{className:"w-4 h-4 text-white"})}),s]})}const jo=["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3184325/pexels-photo-3184325.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181676/pexels-photo-1181676.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/4050315/pexels-photo-4050315.jpeg?auto=compress&cs=tinysrgb&w=800"];function Xl({onEditJourney:e}){const{showToast:t}=rl(),[s,r]=y.useState([]),[o,a]=y.useState(!0),[i,l]=y.useState(""),[c,d]=y.useState(!1),[h,f]=y.useState(null),[u,m]=y.useState(null),[p,b]=y.useState(null),[g,v]=y.useState(null),[N,x]=y.useState(!1),[w,E]=y.useState(!1),[k,I]=y.useState(!1),[T,P]=y.useState(new Set),[R,C]=y.useState(new Set),[z,L]=y.useState(!1);y.useEffect(()=>{j()},[]);const j=async()=>{a(!0);const{data:B}=await ve.from("tracks").select(`
        *,
        modules (
          *,
          journey_versions (id, status, version)
        )
      `).order("created_at",{ascending:!1});B&&r(B),a(!1)},M=async B=>{x(!0);try{const{error:D}=await ve.from("tracks").insert({title:B.title,description:B.description,level:B.level,cover_image_url:B.cover_image_url||null,tags:JSON.stringify([])});if(D)throw D;t("success","Track created successfully"),await j(),d(!1)}catch(D){console.error("Error creating track:",D),t("error","Failed to create track. Please try again.")}finally{x(!1)}},S=async(B,D)=>{E(!0);try{const W=s.find(le=>le.id===B)?.modules?.length||0,{data:se,error:J}=await ve.from("modules").insert({track_id:B,title:D.title,description:D.description,order_index:W}).select().single();if(J)throw J;if(!se)throw new Error("Module creation failed");const{data:ne,error:ie}=await ve.from("journey_versions").insert({module_id:se.id,version:1,status:"draft",graph_json:{startBlockId:"",blocks:[],edges:[]}}).select().single();ie?(console.error("Error creating journey version:",ie),t("warning","Module created but journey setup failed. Please try editing the module.")):t("success","Module created successfully"),await j(),f(null),ne&&e(se.id,ne.id)}catch(X){console.error("Error creating module:",X),t("error","Failed to create module. Please try again.")}finally{E(!1)}},A=async B=>{if(confirm("Are you sure you want to delete this track and all its modules?")){b(B);try{const{error:D}=await ve.from("tracks").delete().eq("id",B);if(D)throw D;t("success","Track deleted successfully"),await j()}catch(D){console.error("Error deleting track:",D),t("error","Failed to delete track. Please try again.")}finally{b(null)}}},_=async B=>{if(confirm("Are you sure you want to delete this module?")){v(B);try{const{error:D}=await ve.from("modules").delete().eq("id",B);if(D)throw D;t("success","Module deleted successfully"),await j()}catch(D){console.error("Error deleting module:",D),t("error","Failed to delete module. Please try again.")}finally{v(null)}}},$=async()=>{const B=T.size,D=s.filter(W=>T.has(W.id)).slice(0,5).map(W=>W.title).join(", "),X=B<=5?`Delete ${B} track${B>1?"s":""} (${D})?`:`Delete ${B} tracks (${D}, and ${B-5} more)?`;if(confirm(`${X}

This will also delete all associated modules and content. This action cannot be undone.`)){L(!0);try{const{error:W}=await ve.from("tracks").delete().in("id",Array.from(T));if(W)throw W;t("success",`Successfully deleted ${B} track${B>1?"s":""}`),P(new Set),await j()}catch(W){console.error("Error bulk deleting tracks:",W),t("error","Failed to delete some tracks. Please try again.")}finally{L(!1)}}},O=async()=>{const B=R.size,D=s.flatMap(W=>W.modules||[]).filter(W=>R.has(W.id)).slice(0,5).map(W=>W.title).join(", "),X=B<=5?`Delete ${B} module${B>1?"s":""} (${D})?`:`Delete ${B} modules (${D}, and ${B-5} more)?`;if(confirm(`${X}

This will also delete all associated journeys and content. This action cannot be undone.`)){L(!0);try{const{error:W}=await ve.from("modules").delete().in("id",Array.from(R));if(W)throw W;t("success",`Successfully deleted ${B} module${B>1?"s":""}`),C(new Set),await j()}catch(W){console.error("Error bulk deleting modules:",W),t("error","Failed to delete some modules. Please try again.")}finally{L(!1)}}},F=B=>{const D=new Set(T);D.has(B)?D.delete(B):D.add(B),P(D)},V=B=>{const D=new Set(R);D.has(B)?D.delete(B):D.add(B),C(D)},Y=()=>{P(new Set(Q.map(B=>B.id)))},Z=B=>{const D=s.find(W=>W.id===B);if(!D)return;const X=(D.modules||[]).map(W=>W.id);C(new Set([...R,...X]))},ee=()=>{P(new Set)},Q=s.filter(B=>B.title.toLowerCase().includes(i.toLowerCase()));return n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsxs("div",{className:"p-6 border-b border-slate-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"Track Manager"}),n.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[n.jsx(et,{className:"w-5 h-5"}),"New Track"]})]}),n.jsxs("div",{className:"relative",children:[n.jsx(vo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500"}),n.jsx("input",{type:"text",placeholder:"Search tracks...",value:i,onChange:B=>l(B.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:o?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(pe,{className:"w-8 h-8 text-primary-500 animate-spin"})}):Q.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Re,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"No tracks yet"}),n.jsx("p",{className:"text-slate-500 mb-4",children:"Create your first learning track to get started"}),n.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[n.jsx(et,{className:"w-5 h-5"}),"Create Track"]})]}):n.jsxs(n.Fragment,{children:[n.jsx(Yl,{selectedCount:T.size,totalCount:Q.length,onSelectAll:Y,onSelectNone:ee,onDelete:$,isDeleting:z,itemName:"tracks"}),n.jsx("div",{className:"p-6 space-y-4",children:Q.map(B=>n.jsxs(Zl,{isSelected:T.has(B.id),onToggleSelect:()=>F(B.id),disabled:z,className:"bg-slate-800 border border-slate-700 rounded-xl overflow-hidden",children:[n.jsxs("div",{className:"p-4 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4 pl-8",children:[B.cover_image_url?n.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden flex-shrink-0",children:n.jsx("img",{src:B.cover_image_url,alt:B.title,className:"w-full h-full object-cover"})}):n.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center flex-shrink-0",children:n.jsx(Re,{className:"w-8 h-8 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-white",children:B.title}),n.jsx("p",{className:"text-sm text-slate-400",children:B.description||"No description"}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${B.level==="beginner"?"bg-emerald-500/20 text-emerald-400":B.level==="intermediate"?"bg-warning/20 text-warning":"bg-rose-500/20 text-rose-400"}`,children:B.level}),n.jsxs("span",{className:"text-xs text-slate-500",children:[B.modules?.length||0," modules"]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:D=>{D.stopPropagation(),m(B)},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",disabled:p===B.id||z,children:n.jsx(Pl,{className:"w-5 h-5"})}),n.jsx("button",{onClick:D=>{D.stopPropagation(),A(B.id)},disabled:p===B.id||z,className:"p-2 text-slate-400 hover:text-error hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:p===B.id?n.jsx(pe,{className:"w-5 h-5 animate-spin"}):n.jsx(Te,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"border-t border-slate-700",children:[R.size>0&&(B.modules||[]).some(D=>R.has(D.id))&&n.jsxs("div",{className:"bg-slate-900/50 px-4 py-2 border-b border-slate-700 flex items-center justify-between",children:[n.jsxs("span",{className:"text-sm text-slate-400",children:[(B.modules||[]).filter(D=>R.has(D.id)).length," module",(B.modules||[]).filter(D=>R.has(D.id)).length>1?"s":""," selected"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:D=>{D.stopPropagation(),Z(B.id)},className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Select All"}),n.jsx("button",{onClick:D=>{D.stopPropagation(),O()},disabled:z,className:"text-xs px-2 py-1 bg-error text-white rounded hover:bg-error/90 disabled:opacity-50 transition-colors",children:"Delete Selected"})]})]}),B.modules?.map(D=>{const X=D.journey_versions?.find(J=>J.status==="published"),W=D.journey_versions?.find(J=>J.status==="draft"),se=X||W;return n.jsxs("div",{className:`px-4 py-3 flex items-center justify-between hover:bg-slate-700/50 transition-colors border-b border-slate-700 last:border-b-0 ${R.has(D.id)?"bg-primary-500/10":""}`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",checked:R.has(D.id),onChange:J=>{J.stopPropagation(),V(D.id)},disabled:z,className:"w-4 h-4 rounded border-slate-600 text-primary-600 focus:ring-primary-500 focus:ring-offset-slate-900"}),n.jsx("div",{className:"w-8 h-8 rounded bg-slate-700 flex items-center justify-center text-sm font-medium text-slate-300",children:D.order_index+1}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-slate-200",children:D.title}),n.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[X&&n.jsx("span",{className:"text-emerald-400",children:"Published"}),W&&!X&&n.jsx("span",{className:"text-warning",children:"Draft"}),!se&&n.jsx("span",{className:"text-slate-500",children:"No content"})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:J=>{J.stopPropagation(),e(D.id,se?.id)},className:"flex items-center gap-1 px-3 py-1.5 text-sm text-primary-400 hover:text-primary-300 hover:bg-primary-500/10 rounded-lg transition-colors",children:["Edit Journey",n.jsx(ol,{className:"w-4 h-4"})]}),n.jsx("button",{onClick:J=>{J.stopPropagation(),_(D.id)},disabled:g===D.id||z,className:"p-1.5 text-slate-500 hover:text-error rounded transition-colors disabled:opacity-50",children:g===D.id?n.jsx(pe,{className:"w-4 h-4 animate-spin"}):n.jsx(Te,{className:"w-4 h-4"})})]})]},D.id)}),n.jsxs("button",{onClick:D=>{D.stopPropagation(),f(B.id)},disabled:z,className:"w-full px-4 py-3 flex items-center justify-center gap-2 text-slate-400 hover:text-white hover:bg-slate-700/50 transition-colors disabled:opacity-50",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Module"]})]})]},B.id))})]})}),c&&n.jsx(Wl,{onClose:()=>d(!1),onCreate:M,isCreating:N}),h&&n.jsx(Ul,{onClose:()=>f(null),onCreate:B=>S(h,B),isCreating:w}),u&&n.jsx(Jl,{track:u,onClose:()=>m(null),isSaving:k,onSave:async B=>{I(!0);try{const{error:D}=await ve.from("tracks").update(B).eq("id",u.id);if(D)throw D;t("success","Track updated successfully"),await j(),m(null)}catch(D){console.error("Error updating track:",D),t("error","Failed to update track. Please try again.")}finally{I(!1)}}})]})}function Wl({onClose:e,onCreate:t,isCreating:s}){const[r,o]=y.useState(""),[a,i]=y.useState(""),[l,c]=y.useState("beginner"),[d,h]=y.useState(""),[f,u]=y.useState(!1);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-lg p-6 border border-slate-700 max-h-[90vh] overflow-y-auto",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Create New Track"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cover Image"}),n.jsx("div",{className:"relative",children:d?n.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-slate-900",children:[n.jsx("img",{src:d,alt:"Cover preview",className:"w-full h-full object-cover"}),n.jsx("button",{onClick:()=>h(""),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:n.jsx(Ct,{className:"w-4 h-4"})})]}):n.jsxs("button",{onClick:()=>u(!f),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-500 transition-colors",children:[n.jsx(nt,{className:"w-8 h-8 text-slate-500"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Add cover image"})]})}),f&&!d&&n.jsxs("div",{className:"mt-3 space-y-3",children:[n.jsx("input",{type:"url",value:d,onChange:m=>h(m.target.value),placeholder:"Paste image URL...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Or choose from gallery:"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:jo.map((m,p)=>n.jsx("button",{onClick:()=>{h(m),u(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:m,alt:"",className:"w-full h-full object-cover"})},p))})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:r,onChange:m=>o(m.target.value),placeholder:"e.g., GenAI Fundamentals",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:a,onChange:m=>i(m.target.value),placeholder:"What will learners gain from this track?",rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Level"}),n.jsxs("select",{value:l,onChange:m=>c(m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:e,disabled:s,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>t({title:r,description:a,level:l,cover_image_url:d||void 0}),disabled:!r.trim()||s,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[s&&n.jsx(pe,{className:"w-4 h-4 animate-spin"}),s?"Creating...":"Create Track"]})]})]})})}function Ul({onClose:e,onCreate:t,isCreating:s}){const[r,o]=y.useState(""),[a,i]=y.useState("");return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-md p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Add New Module"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:r,onChange:l=>o(l.target.value),placeholder:"e.g., Introduction to AI",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:a,onChange:l=>i(l.target.value),placeholder:"What will this module cover?",rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:e,disabled:s,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>t({title:r,description:a}),disabled:!r.trim()||s,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[s&&n.jsx(pe,{className:"w-4 h-4 animate-spin"}),s?"Creating...":"Create Module"]})]})]})})}function Jl({track:e,onClose:t,onSave:s,isSaving:r}){const[o,a]=y.useState(e.title),[i,l]=y.useState(e.description||""),[c,d]=y.useState(e.level),[h,f]=y.useState(e.cover_image_url||""),[u,m]=y.useState(!1);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl w-full max-w-lg p-6 border border-slate-700 max-h-[90vh] overflow-y-auto",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Edit Track"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cover Image"}),n.jsx("div",{className:"relative",children:h?n.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-slate-900",children:[n.jsx("img",{src:h,alt:"Cover preview",className:"w-full h-full object-cover"}),n.jsx("button",{onClick:()=>f(""),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:n.jsx(Ct,{className:"w-4 h-4"})})]}):n.jsxs("button",{onClick:()=>m(!u),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-500 transition-colors",children:[n.jsx(nt,{className:"w-8 h-8 text-slate-500"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Add cover image"})]})}),u&&!h&&n.jsxs("div",{className:"mt-3 space-y-3",children:[n.jsx("input",{type:"url",value:h,onChange:p=>f(p.target.value),placeholder:"Paste image URL...",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Or choose from gallery:"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:jo.map((p,b)=>n.jsx("button",{onClick:()=>{f(p),m(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:p,alt:"",className:"w-full h-full object-cover"})},b))})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:o,onChange:p=>a(p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:i,onChange:p=>l(p.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Level"}),n.jsxs("select",{value:c,onChange:p=>d(p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:t,disabled:r,className:"flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors disabled:opacity-50",children:"Cancel"}),n.jsxs("button",{onClick:()=>s({title:o,description:i,level:c,cover_image_url:h||null}),disabled:!o.trim()||r,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[r&&n.jsx(pe,{className:"w-4 h-4 animate-spin"}),r?"Saving...":"Save Changes"]})]})]})})}function xe(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let s=0,r;s<e.length;s++)(r=xe(e[s]))!==""&&(t+=(t&&" ")+r);else for(let s in e)e[s]&&(t+=(t&&" ")+s);return t}var Ql={value:()=>{}};function Tn(){for(var e=0,t=arguments.length,s={},r;e<t;++e){if(!(r=arguments[e]+"")||r in s||/[\s.]/.test(r))throw new Error("illegal type: "+r);s[r]=[]}return new un(s)}function un(e){this._=e}function Kl(e,t){return e.trim().split(/^|\s+/).map(function(s){var r="",o=s.indexOf(".");if(o>=0&&(r=s.slice(o+1),s=s.slice(0,o)),s&&!t.hasOwnProperty(s))throw new Error("unknown type: "+s);return{type:s,name:r}})}un.prototype=Tn.prototype={constructor:un,on:function(e,t){var s=this._,r=Kl(e+"",s),o,a=-1,i=r.length;if(arguments.length<2){for(;++a<i;)if((o=(e=r[a]).type)&&(o=ec(s[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<i;)if(o=(e=r[a]).type)s[o]=er(s[o],e.name,t);else if(t==null)for(o in s)s[o]=er(s[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var s in t)e[s]=t[s].slice();return new un(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var s=new Array(o),r=0,o,a;r<o;++r)s[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],r=0,o=a.length;r<o;++r)a[r].value.apply(t,s)},apply:function(e,t,s){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,a=r.length;o<a;++o)r[o].value.apply(t,s)}};function ec(e,t){for(var s=0,r=e.length,o;s<r;++s)if((o=e[s]).name===t)return o.value}function er(e,t,s){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=Ql,e=e.slice(0,r).concat(e.slice(r+1));break}return s!=null&&e.push({name:t,value:s}),e}var cs="http://www.w3.org/1999/xhtml";const tr={svg:"http://www.w3.org/2000/svg",xhtml:cs,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function $n(e){var t=e+="",s=t.indexOf(":");return s>=0&&(t=e.slice(0,s))!=="xmlns"&&(e=e.slice(s+1)),tr.hasOwnProperty(t)?{space:tr[t],local:e}:e}function tc(e){return function(){var t=this.ownerDocument,s=this.namespaceURI;return s===cs&&t.documentElement.namespaceURI===cs?t.createElement(e):t.createElementNS(s,e)}}function nc(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function No(e){var t=$n(e);return(t.local?nc:tc)(t)}function sc(){}function Is(e){return e==null?sc:function(){return this.querySelector(e)}}function rc(e){typeof e!="function"&&(e=Is(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=new Array(i),c,d,h=0;h<i;++h)(c=a[h])&&(d=e.call(c,c.__data__,h,a))&&("__data__"in c&&(d.__data__=c.__data__),l[h]=d);return new Ie(r,this._parents)}function oc(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function ic(){return[]}function ko(e){return e==null?ic:function(){return this.querySelectorAll(e)}}function ac(e){return function(){return oc(e.apply(this,arguments))}}function lc(e){typeof e=="function"?e=ac(e):e=ko(e);for(var t=this._groups,s=t.length,r=[],o=[],a=0;a<s;++a)for(var i=t[a],l=i.length,c,d=0;d<l;++d)(c=i[d])&&(r.push(e.call(c,c.__data__,d,i)),o.push(c));return new Ie(r,o)}function Co(e){return function(){return this.matches(e)}}function So(e){return function(t){return t.matches(e)}}var cc=Array.prototype.find;function dc(e){return function(){return cc.call(this.children,e)}}function uc(){return this.firstElementChild}function hc(e){return this.select(e==null?uc:dc(typeof e=="function"?e:So(e)))}var fc=Array.prototype.filter;function mc(){return Array.from(this.children)}function pc(e){return function(){return fc.call(this.children,e)}}function xc(e){return this.selectAll(e==null?mc:pc(typeof e=="function"?e:So(e)))}function gc(e){typeof e!="function"&&(e=Co(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=[],c,d=0;d<i;++d)(c=a[d])&&e.call(c,c.__data__,d,a)&&l.push(c);return new Ie(r,this._parents)}function _o(e){return new Array(e.length)}function bc(){return new Ie(this._enter||this._groups.map(_o),this._parents)}function bn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}bn.prototype={constructor:bn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function yc(e){return function(){return e}}function vc(e,t,s,r,o,a){for(var i=0,l,c=t.length,d=a.length;i<d;++i)(l=t[i])?(l.__data__=a[i],r[i]=l):s[i]=new bn(e,a[i]);for(;i<c;++i)(l=t[i])&&(o[i]=l)}function wc(e,t,s,r,o,a,i){var l,c,d=new Map,h=t.length,f=a.length,u=new Array(h),m;for(l=0;l<h;++l)(c=t[l])&&(u[l]=m=i.call(c,c.__data__,l,t)+"",d.has(m)?o[l]=c:d.set(m,c));for(l=0;l<f;++l)m=i.call(e,a[l],l,a)+"",(c=d.get(m))?(r[l]=c,c.__data__=a[l],d.delete(m)):s[l]=new bn(e,a[l]);for(l=0;l<h;++l)(c=t[l])&&d.get(u[l])===c&&(o[l]=c)}function jc(e){return e.__data__}function Nc(e,t){if(!arguments.length)return Array.from(this,jc);var s=t?wc:vc,r=this._parents,o=this._groups;typeof e!="function"&&(e=yc(e));for(var a=o.length,i=new Array(a),l=new Array(a),c=new Array(a),d=0;d<a;++d){var h=r[d],f=o[d],u=f.length,m=kc(e.call(h,h&&h.__data__,d,r)),p=m.length,b=l[d]=new Array(p),g=i[d]=new Array(p),v=c[d]=new Array(u);s(h,f,b,g,v,m,t);for(var N=0,x=0,w,E;N<p;++N)if(w=b[N]){for(N>=x&&(x=N+1);!(E=g[x])&&++x<p;);w._next=E||null}}return i=new Ie(i,r),i._enter=l,i._exit=c,i}function kc(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Cc(){return new Ie(this._exit||this._groups.map(_o),this._parents)}function Sc(e,t,s){var r=this.enter(),o=this,a=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),s==null?a.remove():s(a),r&&o?r.merge(o).order():o}function _c(e){for(var t=e.selection?e.selection():e,s=this._groups,r=t._groups,o=s.length,a=r.length,i=Math.min(o,a),l=new Array(o),c=0;c<i;++c)for(var d=s[c],h=r[c],f=d.length,u=l[c]=new Array(f),m,p=0;p<f;++p)(m=d[p]||h[p])&&(u[p]=m);for(;c<o;++c)l[c]=s[c];return new Ie(l,this._parents)}function Ec(){for(var e=this._groups,t=-1,s=e.length;++t<s;)for(var r=e[t],o=r.length-1,a=r[o],i;--o>=0;)(i=r[o])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}function Ic(e){e||(e=Mc);function t(f,u){return f&&u?e(f.__data__,u.__data__):!f-!u}for(var s=this._groups,r=s.length,o=new Array(r),a=0;a<r;++a){for(var i=s[a],l=i.length,c=o[a]=new Array(l),d,h=0;h<l;++h)(d=i[h])&&(c[h]=d);c.sort(t)}return new Ie(o,this._parents).order()}function Mc(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ac(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Tc(){return Array.from(this)}function $c(){for(var e=this._groups,t=0,s=e.length;t<s;++t)for(var r=e[t],o=0,a=r.length;o<a;++o){var i=r[o];if(i)return i}return null}function Pc(){let e=0;for(const t of this)++e;return e}function Dc(){return!this.node()}function zc(e){for(var t=this._groups,s=0,r=t.length;s<r;++s)for(var o=t[s],a=0,i=o.length,l;a<i;++a)(l=o[a])&&e.call(l,l.__data__,a,o);return this}function Rc(e){return function(){this.removeAttribute(e)}}function Lc(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Bc(e,t){return function(){this.setAttribute(e,t)}}function Hc(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Oc(e,t){return function(){var s=t.apply(this,arguments);s==null?this.removeAttribute(e):this.setAttribute(e,s)}}function Vc(e,t){return function(){var s=t.apply(this,arguments);s==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,s)}}function Fc(e,t){var s=$n(e);if(arguments.length<2){var r=this.node();return s.local?r.getAttributeNS(s.space,s.local):r.getAttribute(s)}return this.each((t==null?s.local?Lc:Rc:typeof t=="function"?s.local?Vc:Oc:s.local?Hc:Bc)(s,t))}function Eo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Gc(e){return function(){this.style.removeProperty(e)}}function qc(e,t,s){return function(){this.style.setProperty(e,t,s)}}function Yc(e,t,s){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,s)}}function Zc(e,t,s){return arguments.length>1?this.each((t==null?Gc:typeof t=="function"?Yc:qc)(e,t,s??"")):gt(this.node(),e)}function gt(e,t){return e.style.getPropertyValue(t)||Eo(e).getComputedStyle(e,null).getPropertyValue(t)}function Xc(e){return function(){delete this[e]}}function Wc(e,t){return function(){this[e]=t}}function Uc(e,t){return function(){var s=t.apply(this,arguments);s==null?delete this[e]:this[e]=s}}function Jc(e,t){return arguments.length>1?this.each((t==null?Xc:typeof t=="function"?Uc:Wc)(e,t)):this.node()[e]}function Io(e){return e.trim().split(/^|\s+/)}function Ms(e){return e.classList||new Mo(e)}function Mo(e){this._node=e,this._names=Io(e.getAttribute("class")||"")}Mo.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Ao(e,t){for(var s=Ms(e),r=-1,o=t.length;++r<o;)s.add(t[r])}function To(e,t){for(var s=Ms(e),r=-1,o=t.length;++r<o;)s.remove(t[r])}function Qc(e){return function(){Ao(this,e)}}function Kc(e){return function(){To(this,e)}}function ed(e,t){return function(){(t.apply(this,arguments)?Ao:To)(this,e)}}function td(e,t){var s=Io(e+"");if(arguments.length<2){for(var r=Ms(this.node()),o=-1,a=s.length;++o<a;)if(!r.contains(s[o]))return!1;return!0}return this.each((typeof t=="function"?ed:t?Qc:Kc)(s,t))}function nd(){this.textContent=""}function sd(e){return function(){this.textContent=e}}function rd(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function od(e){return arguments.length?this.each(e==null?nd:(typeof e=="function"?rd:sd)(e)):this.node().textContent}function id(){this.innerHTML=""}function ad(e){return function(){this.innerHTML=e}}function ld(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function cd(e){return arguments.length?this.each(e==null?id:(typeof e=="function"?ld:ad)(e)):this.node().innerHTML}function dd(){this.nextSibling&&this.parentNode.appendChild(this)}function ud(){return this.each(dd)}function hd(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function fd(){return this.each(hd)}function md(e){var t=typeof e=="function"?e:No(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function pd(){return null}function xd(e,t){var s=typeof e=="function"?e:No(e),r=t==null?pd:typeof t=="function"?t:Is(t);return this.select(function(){return this.insertBefore(s.apply(this,arguments),r.apply(this,arguments)||null)})}function gd(){var e=this.parentNode;e&&e.removeChild(this)}function bd(){return this.each(gd)}function yd(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function vd(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function wd(e){return this.select(e?vd:yd)}function jd(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Nd(e){return function(t){e.call(this,t,this.__data__)}}function kd(e){return e.trim().split(/^|\s+/).map(function(t){var s="",r=t.indexOf(".");return r>=0&&(s=t.slice(r+1),t=t.slice(0,r)),{type:t,name:s}})}function Cd(e){return function(){var t=this.__on;if(t){for(var s=0,r=-1,o=t.length,a;s<o;++s)a=t[s],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++r]=a;++r?t.length=r:delete this.__on}}}function Sd(e,t,s){return function(){var r=this.__on,o,a=Nd(t);if(r){for(var i=0,l=r.length;i<l;++i)if((o=r[i]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=a,o.options=s),o.value=t;return}}this.addEventListener(e.type,a,s),o={type:e.type,name:e.name,value:t,listener:a,options:s},r?r.push(o):this.__on=[o]}}function _d(e,t,s){var r=kd(e+""),o,a=r.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,h;c<d;++c)for(o=0,h=l[c];o<a;++o)if((i=r[o]).type===h.type&&i.name===h.name)return h.value}return}for(l=t?Sd:Cd,o=0;o<a;++o)this.each(l(r[o],t,s));return this}function $o(e,t,s){var r=Eo(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,s):(o=r.document.createEvent("Event"),s?(o.initEvent(t,s.bubbles,s.cancelable),o.detail=s.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function Ed(e,t){return function(){return $o(this,e,t)}}function Id(e,t){return function(){return $o(this,e,t.apply(this,arguments))}}function Md(e,t){return this.each((typeof t=="function"?Id:Ed)(e,t))}function*Ad(){for(var e=this._groups,t=0,s=e.length;t<s;++t)for(var r=e[t],o=0,a=r.length,i;o<a;++o)(i=r[o])&&(yield i)}var Po=[null];function Ie(e,t){this._groups=e,this._parents=t}function Gt(){return new Ie([[document.documentElement]],Po)}function Td(){return this}Ie.prototype=Gt.prototype={constructor:Ie,select:rc,selectAll:lc,selectChild:hc,selectChildren:xc,filter:gc,data:Nc,enter:bc,exit:Cc,join:Sc,merge:_c,selection:Td,order:Ec,sort:Ic,call:Ac,nodes:Tc,node:$c,size:Pc,empty:Dc,each:zc,attr:Fc,style:Zc,property:Jc,classed:td,text:od,html:cd,raise:ud,lower:fd,append:md,insert:xd,remove:bd,clone:wd,datum:jd,on:_d,dispatch:Md,[Symbol.iterator]:Ad};function Ee(e){return typeof e=="string"?new Ie([[document.querySelector(e)]],[document.documentElement]):new Ie([[e]],Po)}function $d(e){let t;for(;t=e.sourceEvent;)e=t;return e}function $e(e,t){if(e=$d(e),t===void 0&&(t=e.currentTarget),t){var s=t.ownerSVGElement||t;if(s.createSVGPoint){var r=s.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Pd={passive:!1},$t={capture:!0,passive:!1};function Yn(e){e.stopImmediatePropagation()}function pt(e){e.preventDefault(),e.stopImmediatePropagation()}function Do(e){var t=e.document.documentElement,s=Ee(e).on("dragstart.drag",pt,$t);"onselectstart"in t?s.on("selectstart.drag",pt,$t):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function zo(e,t){var s=e.document.documentElement,r=Ee(e).on("dragstart.drag",null);t&&(r.on("click.drag",pt,$t),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in s?r.on("selectstart.drag",null):(s.style.MozUserSelect=s.__noselect,delete s.__noselect)}const Kt=e=>()=>e;function ds(e,{sourceEvent:t,subject:s,target:r,identifier:o,active:a,x:i,y:l,dx:c,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:s,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}ds.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Dd(e){return!e.ctrlKey&&!e.button}function zd(){return this.parentNode}function Rd(e,t){return t??{x:e.x,y:e.y}}function Ld(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ro(){var e=Dd,t=zd,s=Rd,r=Ld,o={},a=Tn("start","drag","end"),i=0,l,c,d,h,f=0;function u(w){w.on("mousedown.drag",m).filter(r).on("touchstart.drag",g).on("touchmove.drag",v,Pd).on("touchend.drag touchcancel.drag",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(w,E){if(!(h||!e.call(this,w,E))){var k=x(this,t.call(this,w,E),w,E,"mouse");k&&(Ee(w.view).on("mousemove.drag",p,$t).on("mouseup.drag",b,$t),Do(w.view),Yn(w),d=!1,l=w.clientX,c=w.clientY,k("start",w))}}function p(w){if(pt(w),!d){var E=w.clientX-l,k=w.clientY-c;d=E*E+k*k>f}o.mouse("drag",w)}function b(w){Ee(w.view).on("mousemove.drag mouseup.drag",null),zo(w.view,d),pt(w),o.mouse("end",w)}function g(w,E){if(e.call(this,w,E)){var k=w.changedTouches,I=t.call(this,w,E),T=k.length,P,R;for(P=0;P<T;++P)(R=x(this,I,w,E,k[P].identifier,k[P]))&&(Yn(w),R("start",w,k[P]))}}function v(w){var E=w.changedTouches,k=E.length,I,T;for(I=0;I<k;++I)(T=o[E[I].identifier])&&(pt(w),T("drag",w,E[I]))}function N(w){var E=w.changedTouches,k=E.length,I,T;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),I=0;I<k;++I)(T=o[E[I].identifier])&&(Yn(w),T("end",w,E[I]))}function x(w,E,k,I,T,P){var R=a.copy(),C=$e(P||k,E),z,L,j;if((j=s.call(w,new ds("beforestart",{sourceEvent:k,target:u,identifier:T,active:i,x:C[0],y:C[1],dx:0,dy:0,dispatch:R}),I))!=null)return z=j.x-C[0]||0,L=j.y-C[1]||0,function M(S,A,_){var $=C,O;switch(S){case"start":o[T]=M,O=i++;break;case"end":delete o[T],--i;case"drag":C=$e(_||A,E),O=i;break}R.call(S,w,new ds(S,{sourceEvent:A,subject:j,target:u,identifier:T,active:O,x:C[0]+z,y:C[1]+L,dx:C[0]-$[0],dy:C[1]-$[1],dispatch:R}),I)}}return u.filter=function(w){return arguments.length?(e=typeof w=="function"?w:Kt(!!w),u):e},u.container=function(w){return arguments.length?(t=typeof w=="function"?w:Kt(w),u):t},u.subject=function(w){return arguments.length?(s=typeof w=="function"?w:Kt(w),u):s},u.touchable=function(w){return arguments.length?(r=typeof w=="function"?w:Kt(!!w),u):r},u.on=function(){var w=a.on.apply(a,arguments);return w===a?u:w},u.clickDistance=function(w){return arguments.length?(f=(w=+w)*w,u):Math.sqrt(f)},u}function As(e,t,s){e.prototype=t.prototype=s,s.constructor=e}function Lo(e,t){var s=Object.create(e.prototype);for(var r in t)s[r]=t[r];return s}function qt(){}var Pt=.7,yn=1/Pt,xt="\\s*([+-]?\\d+)\\s*",Dt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",He="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Bd=/^#([0-9a-f]{3,8})$/,Hd=new RegExp(`^rgb\\(${xt},${xt},${xt}\\)$`),Od=new RegExp(`^rgb\\(${He},${He},${He}\\)$`),Vd=new RegExp(`^rgba\\(${xt},${xt},${xt},${Dt}\\)$`),Fd=new RegExp(`^rgba\\(${He},${He},${He},${Dt}\\)$`),Gd=new RegExp(`^hsl\\(${Dt},${He},${He}\\)$`),qd=new RegExp(`^hsla\\(${Dt},${He},${He},${Dt}\\)$`),nr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};As(qt,at,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:sr,formatHex:sr,formatHex8:Yd,formatHsl:Zd,formatRgb:rr,toString:rr});function sr(){return this.rgb().formatHex()}function Yd(){return this.rgb().formatHex8()}function Zd(){return Bo(this).formatHsl()}function rr(){return this.rgb().formatRgb()}function at(e){var t,s;return e=(e+"").trim().toLowerCase(),(t=Bd.exec(e))?(s=t[1].length,t=parseInt(t[1],16),s===6?or(t):s===3?new Ce(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):s===8?en(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):s===4?en(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Hd.exec(e))?new Ce(t[1],t[2],t[3],1):(t=Od.exec(e))?new Ce(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Vd.exec(e))?en(t[1],t[2],t[3],t[4]):(t=Fd.exec(e))?en(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Gd.exec(e))?lr(t[1],t[2]/100,t[3]/100,1):(t=qd.exec(e))?lr(t[1],t[2]/100,t[3]/100,t[4]):nr.hasOwnProperty(e)?or(nr[e]):e==="transparent"?new Ce(NaN,NaN,NaN,0):null}function or(e){return new Ce(e>>16&255,e>>8&255,e&255,1)}function en(e,t,s,r){return r<=0&&(e=t=s=NaN),new Ce(e,t,s,r)}function Xd(e){return e instanceof qt||(e=at(e)),e?(e=e.rgb(),new Ce(e.r,e.g,e.b,e.opacity)):new Ce}function us(e,t,s,r){return arguments.length===1?Xd(e):new Ce(e,t,s,r??1)}function Ce(e,t,s,r){this.r=+e,this.g=+t,this.b=+s,this.opacity=+r}As(Ce,us,Lo(qt,{brighter(e){return e=e==null?yn:Math.pow(yn,e),new Ce(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Pt:Math.pow(Pt,e),new Ce(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ce(ot(this.r),ot(this.g),ot(this.b),vn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ir,formatHex:ir,formatHex8:Wd,formatRgb:ar,toString:ar}));function ir(){return`#${rt(this.r)}${rt(this.g)}${rt(this.b)}`}function Wd(){return`#${rt(this.r)}${rt(this.g)}${rt(this.b)}${rt((isNaN(this.opacity)?1:this.opacity)*255)}`}function ar(){const e=vn(this.opacity);return`${e===1?"rgb(":"rgba("}${ot(this.r)}, ${ot(this.g)}, ${ot(this.b)}${e===1?")":`, ${e})`}`}function vn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ot(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function rt(e){return e=ot(e),(e<16?"0":"")+e.toString(16)}function lr(e,t,s,r){return r<=0?e=t=s=NaN:s<=0||s>=1?e=t=NaN:t<=0&&(e=NaN),new Pe(e,t,s,r)}function Bo(e){if(e instanceof Pe)return new Pe(e.h,e.s,e.l,e.opacity);if(e instanceof qt||(e=at(e)),!e)return new Pe;if(e instanceof Pe)return e;e=e.rgb();var t=e.r/255,s=e.g/255,r=e.b/255,o=Math.min(t,s,r),a=Math.max(t,s,r),i=NaN,l=a-o,c=(a+o)/2;return l?(t===a?i=(s-r)/l+(s<r)*6:s===a?i=(r-t)/l+2:i=(t-s)/l+4,l/=c<.5?a+o:2-a-o,i*=60):l=c>0&&c<1?0:i,new Pe(i,l,c,e.opacity)}function Ud(e,t,s,r){return arguments.length===1?Bo(e):new Pe(e,t,s,r??1)}function Pe(e,t,s,r){this.h=+e,this.s=+t,this.l=+s,this.opacity=+r}As(Pe,Ud,Lo(qt,{brighter(e){return e=e==null?yn:Math.pow(yn,e),new Pe(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Pt:Math.pow(Pt,e),new Pe(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,s=this.l,r=s+(s<.5?s:1-s)*t,o=2*s-r;return new Ce(Zn(e>=240?e-240:e+120,o,r),Zn(e,o,r),Zn(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new Pe(cr(this.h),tn(this.s),tn(this.l),vn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=vn(this.opacity);return`${e===1?"hsl(":"hsla("}${cr(this.h)}, ${tn(this.s)*100}%, ${tn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function cr(e){return e=(e||0)%360,e<0?e+360:e}function tn(e){return Math.max(0,Math.min(1,e||0))}function Zn(e,t,s){return(e<60?t+(s-t)*e/60:e<180?s:e<240?t+(s-t)*(240-e)/60:t)*255}const Ts=e=>()=>e;function Jd(e,t){return function(s){return e+s*t}}function Qd(e,t,s){return e=Math.pow(e,s),t=Math.pow(t,s)-e,s=1/s,function(r){return Math.pow(e+r*t,s)}}function Kd(e){return(e=+e)==1?Ho:function(t,s){return s-t?Qd(t,s,e):Ts(isNaN(t)?s:t)}}function Ho(e,t){var s=t-e;return s?Jd(e,s):Ts(isNaN(e)?t:e)}const wn=(function e(t){var s=Kd(t);function r(o,a){var i=s((o=us(o)).r,(a=us(a)).r),l=s(o.g,a.g),c=s(o.b,a.b),d=Ho(o.opacity,a.opacity);return function(h){return o.r=i(h),o.g=l(h),o.b=c(h),o.opacity=d(h),o+""}}return r.gamma=e,r})(1);function eu(e,t){t||(t=[]);var s=e?Math.min(t.length,e.length):0,r=t.slice(),o;return function(a){for(o=0;o<s;++o)r[o]=e[o]*(1-a)+t[o]*a;return r}}function tu(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function nu(e,t){var s=t?t.length:0,r=e?Math.min(s,e.length):0,o=new Array(r),a=new Array(s),i;for(i=0;i<r;++i)o[i]=Mt(e[i],t[i]);for(;i<s;++i)a[i]=t[i];return function(l){for(i=0;i<r;++i)a[i]=o[i](l);return a}}function su(e,t){var s=new Date;return e=+e,t=+t,function(r){return s.setTime(e*(1-r)+t*r),s}}function Be(e,t){return e=+e,t=+t,function(s){return e*(1-s)+t*s}}function ru(e,t){var s={},r={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?s[o]=Mt(e[o],t[o]):r[o]=t[o];return function(a){for(o in s)r[o]=s[o](a);return r}}var hs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Xn=new RegExp(hs.source,"g");function ou(e){return function(){return e}}function iu(e){return function(t){return e(t)+""}}function Oo(e,t){var s=hs.lastIndex=Xn.lastIndex=0,r,o,a,i=-1,l=[],c=[];for(e=e+"",t=t+"";(r=hs.exec(e))&&(o=Xn.exec(t));)(a=o.index)>s&&(a=t.slice(s,a),l[i]?l[i]+=a:l[++i]=a),(r=r[0])===(o=o[0])?l[i]?l[i]+=o:l[++i]=o:(l[++i]=null,c.push({i,x:Be(r,o)})),s=Xn.lastIndex;return s<t.length&&(a=t.slice(s),l[i]?l[i]+=a:l[++i]=a),l.length<2?c[0]?iu(c[0].x):ou(t):(t=c.length,function(d){for(var h=0,f;h<t;++h)l[(f=c[h]).i]=f.x(d);return l.join("")})}function Mt(e,t){var s=typeof t,r;return t==null||s==="boolean"?Ts(t):(s==="number"?Be:s==="string"?(r=at(t))?(t=r,wn):Oo:t instanceof at?wn:t instanceof Date?su:tu(t)?eu:Array.isArray(t)?nu:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?ru:Be)(e,t)}var dr=180/Math.PI,fs={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Vo(e,t,s,r,o,a){var i,l,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*s+t*r)&&(s-=e*c,r-=t*c),(l=Math.sqrt(s*s+r*r))&&(s/=l,r/=l,c/=l),e*r<t*s&&(e=-e,t=-t,c=-c,i=-i),{translateX:o,translateY:a,rotate:Math.atan2(t,e)*dr,skewX:Math.atan(c)*dr,scaleX:i,scaleY:l}}var nn;function au(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?fs:Vo(t.a,t.b,t.c,t.d,t.e,t.f)}function lu(e){return e==null||(nn||(nn=document.createElementNS("http://www.w3.org/2000/svg","g")),nn.setAttribute("transform",e),!(e=nn.transform.baseVal.consolidate()))?fs:(e=e.matrix,Vo(e.a,e.b,e.c,e.d,e.e,e.f))}function Fo(e,t,s,r){function o(d){return d.length?d.pop()+" ":""}function a(d,h,f,u,m,p){if(d!==f||h!==u){var b=m.push("translate(",null,t,null,s);p.push({i:b-4,x:Be(d,f)},{i:b-2,x:Be(h,u)})}else(f||u)&&m.push("translate("+f+t+u+s)}function i(d,h,f,u){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),u.push({i:f.push(o(f)+"rotate(",null,r)-2,x:Be(d,h)})):h&&f.push(o(f)+"rotate("+h+r)}function l(d,h,f,u){d!==h?u.push({i:f.push(o(f)+"skewX(",null,r)-2,x:Be(d,h)}):h&&f.push(o(f)+"skewX("+h+r)}function c(d,h,f,u,m,p){if(d!==f||h!==u){var b=m.push(o(m)+"scale(",null,",",null,")");p.push({i:b-4,x:Be(d,f)},{i:b-2,x:Be(h,u)})}else(f!==1||u!==1)&&m.push(o(m)+"scale("+f+","+u+")")}return function(d,h){var f=[],u=[];return d=e(d),h=e(h),a(d.translateX,d.translateY,h.translateX,h.translateY,f,u),i(d.rotate,h.rotate,f,u),l(d.skewX,h.skewX,f,u),c(d.scaleX,d.scaleY,h.scaleX,h.scaleY,f,u),d=h=null,function(m){for(var p=-1,b=u.length,g;++p<b;)f[(g=u[p]).i]=g.x(m);return f.join("")}}}var cu=Fo(au,"px, ","px)","deg)"),du=Fo(lu,", ",")",")"),uu=1e-12;function ur(e){return((e=Math.exp(e))+1/e)/2}function hu(e){return((e=Math.exp(e))-1/e)/2}function fu(e){return((e=Math.exp(2*e))-1)/(e+1)}const hn=(function e(t,s,r){function o(a,i){var l=a[0],c=a[1],d=a[2],h=i[0],f=i[1],u=i[2],m=h-l,p=f-c,b=m*m+p*p,g,v;if(b<uu)v=Math.log(u/d)/t,g=function(I){return[l+I*m,c+I*p,d*Math.exp(t*I*v)]};else{var N=Math.sqrt(b),x=(u*u-d*d+r*b)/(2*d*s*N),w=(u*u-d*d-r*b)/(2*u*s*N),E=Math.log(Math.sqrt(x*x+1)-x),k=Math.log(Math.sqrt(w*w+1)-w);v=(k-E)/t,g=function(I){var T=I*v,P=ur(E),R=d/(s*N)*(P*fu(t*T+E)-hu(E));return[l+R*m,c+R*p,d*P/ur(t*T+E)]}}return g.duration=v*1e3*t/Math.SQRT2,g}return o.rho=function(a){var i=Math.max(.001,+a),l=i*i,c=l*l;return e(i,l,c)},o})(Math.SQRT2,2,4);var bt=0,Et=0,St=0,Go=1e3,jn,It,Nn=0,lt=0,Pn=0,zt=typeof performance=="object"&&performance.now?performance:Date,qo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function $s(){return lt||(qo(mu),lt=zt.now()+Pn)}function mu(){lt=0}function kn(){this._call=this._time=this._next=null}kn.prototype=Yo.prototype={constructor:kn,restart:function(e,t,s){if(typeof e!="function")throw new TypeError("callback is not a function");s=(s==null?$s():+s)+(t==null?0:+t),!this._next&&It!==this&&(It?It._next=this:jn=this,It=this),this._call=e,this._time=s,ms()},stop:function(){this._call&&(this._call=null,this._time=1/0,ms())}};function Yo(e,t,s){var r=new kn;return r.restart(e,t,s),r}function pu(){$s(),++bt;for(var e=jn,t;e;)(t=lt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--bt}function hr(){lt=(Nn=zt.now())+Pn,bt=Et=0;try{pu()}finally{bt=0,gu(),lt=0}}function xu(){var e=zt.now(),t=e-Nn;t>Go&&(Pn-=t,Nn=e)}function gu(){for(var e,t=jn,s,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(s=t._next,t._next=null,t=e?e._next=s:jn=s);It=e,ms(r)}function ms(e){if(!bt){Et&&(Et=clearTimeout(Et));var t=e-lt;t>24?(e<1/0&&(Et=setTimeout(hr,e-zt.now()-Pn)),St&&(St=clearInterval(St))):(St||(Nn=zt.now(),St=setInterval(xu,Go)),bt=1,qo(hr))}}function fr(e,t,s){var r=new kn;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,s),r}var bu=Tn("start","end","cancel","interrupt"),yu=[],Zo=0,mr=1,ps=2,fn=3,pr=4,xs=5,mn=6;function Dn(e,t,s,r,o,a){var i=e.__transition;if(!i)e.__transition={};else if(s in i)return;vu(e,s,{name:t,index:r,group:o,on:bu,tween:yu,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Zo})}function Ps(e,t){var s=Le(e,t);if(s.state>Zo)throw new Error("too late; already scheduled");return s}function Ve(e,t){var s=Le(e,t);if(s.state>fn)throw new Error("too late; already running");return s}function Le(e,t){var s=e.__transition;if(!s||!(s=s[t]))throw new Error("transition not found");return s}function vu(e,t,s){var r=e.__transition,o;r[t]=s,s.timer=Yo(a,0,s.time);function a(d){s.state=mr,s.timer.restart(i,s.delay,s.time),s.delay<=d&&i(d-s.delay)}function i(d){var h,f,u,m;if(s.state!==mr)return c();for(h in r)if(m=r[h],m.name===s.name){if(m.state===fn)return fr(i);m.state===pr?(m.state=mn,m.timer.stop(),m.on.call("interrupt",e,e.__data__,m.index,m.group),delete r[h]):+h<t&&(m.state=mn,m.timer.stop(),m.on.call("cancel",e,e.__data__,m.index,m.group),delete r[h])}if(fr(function(){s.state===fn&&(s.state=pr,s.timer.restart(l,s.delay,s.time),l(d))}),s.state=ps,s.on.call("start",e,e.__data__,s.index,s.group),s.state===ps){for(s.state=fn,o=new Array(u=s.tween.length),h=0,f=-1;h<u;++h)(m=s.tween[h].value.call(e,e.__data__,s.index,s.group))&&(o[++f]=m);o.length=f+1}}function l(d){for(var h=d<s.duration?s.ease.call(null,d/s.duration):(s.timer.restart(c),s.state=xs,1),f=-1,u=o.length;++f<u;)o[f].call(e,h);s.state===xs&&(s.on.call("end",e,e.__data__,s.index,s.group),c())}function c(){s.state=mn,s.timer.stop(),delete r[t];for(var d in r)return;delete e.__transition}}function pn(e,t){var s=e.__transition,r,o,a=!0,i;if(s){t=t==null?null:t+"";for(i in s){if((r=s[i]).name!==t){a=!1;continue}o=r.state>ps&&r.state<xs,r.state=mn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete s[i]}a&&delete e.__transition}}function wu(e){return this.each(function(){pn(this,e)})}function ju(e,t){var s,r;return function(){var o=Ve(this,e),a=o.tween;if(a!==s){r=s=a;for(var i=0,l=r.length;i<l;++i)if(r[i].name===t){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function Nu(e,t,s){var r,o;if(typeof s!="function")throw new Error;return function(){var a=Ve(this,e),i=a.tween;if(i!==r){o=(r=i).slice();for(var l={name:t,value:s},c=0,d=o.length;c<d;++c)if(o[c].name===t){o[c]=l;break}c===d&&o.push(l)}a.tween=o}}function ku(e,t){var s=this._id;if(e+="",arguments.length<2){for(var r=Le(this.node(),s).tween,o=0,a=r.length,i;o<a;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((t==null?ju:Nu)(s,e,t))}function Ds(e,t,s){var r=e._id;return e.each(function(){var o=Ve(this,r);(o.value||(o.value={}))[t]=s.apply(this,arguments)}),function(o){return Le(o,r).value[t]}}function Xo(e,t){var s;return(typeof t=="number"?Be:t instanceof at?wn:(s=at(t))?(t=s,wn):Oo)(e,t)}function Cu(e){return function(){this.removeAttribute(e)}}function Su(e){return function(){this.removeAttributeNS(e.space,e.local)}}function _u(e,t,s){var r,o=s+"",a;return function(){var i=this.getAttribute(e);return i===o?null:i===r?a:a=t(r=i,s)}}function Eu(e,t,s){var r,o=s+"",a;return function(){var i=this.getAttributeNS(e.space,e.local);return i===o?null:i===r?a:a=t(r=i,s)}}function Iu(e,t,s){var r,o,a;return function(){var i,l=s(this),c;return l==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=l+"",i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l)))}}function Mu(e,t,s){var r,o,a;return function(){var i,l=s(this),c;return l==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=l+"",i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l)))}}function Au(e,t){var s=$n(e),r=s==="transform"?du:Xo;return this.attrTween(e,typeof t=="function"?(s.local?Mu:Iu)(s,r,Ds(this,"attr."+e,t)):t==null?(s.local?Su:Cu)(s):(s.local?Eu:_u)(s,r,t))}function Tu(e,t){return function(s){this.setAttribute(e,t.call(this,s))}}function $u(e,t){return function(s){this.setAttributeNS(e.space,e.local,t.call(this,s))}}function Pu(e,t){var s,r;function o(){var a=t.apply(this,arguments);return a!==r&&(s=(r=a)&&$u(e,a)),s}return o._value=t,o}function Du(e,t){var s,r;function o(){var a=t.apply(this,arguments);return a!==r&&(s=(r=a)&&Tu(e,a)),s}return o._value=t,o}function zu(e,t){var s="attr."+e;if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;var r=$n(e);return this.tween(s,(r.local?Pu:Du)(r,t))}function Ru(e,t){return function(){Ps(this,e).delay=+t.apply(this,arguments)}}function Lu(e,t){return t=+t,function(){Ps(this,e).delay=t}}function Bu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ru:Lu)(t,e)):Le(this.node(),t).delay}function Hu(e,t){return function(){Ve(this,e).duration=+t.apply(this,arguments)}}function Ou(e,t){return t=+t,function(){Ve(this,e).duration=t}}function Vu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Hu:Ou)(t,e)):Le(this.node(),t).duration}function Fu(e,t){if(typeof t!="function")throw new Error;return function(){Ve(this,e).ease=t}}function Gu(e){var t=this._id;return arguments.length?this.each(Fu(t,e)):Le(this.node(),t).ease}function qu(e,t){return function(){var s=t.apply(this,arguments);if(typeof s!="function")throw new Error;Ve(this,e).ease=s}}function Yu(e){if(typeof e!="function")throw new Error;return this.each(qu(this._id,e))}function Zu(e){typeof e!="function"&&(e=Co(e));for(var t=this._groups,s=t.length,r=new Array(s),o=0;o<s;++o)for(var a=t[o],i=a.length,l=r[o]=[],c,d=0;d<i;++d)(c=a[d])&&e.call(c,c.__data__,d,a)&&l.push(c);return new Xe(r,this._parents,this._name,this._id)}function Xu(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,s=e._groups,r=t.length,o=s.length,a=Math.min(r,o),i=new Array(r),l=0;l<a;++l)for(var c=t[l],d=s[l],h=c.length,f=i[l]=new Array(h),u,m=0;m<h;++m)(u=c[m]||d[m])&&(f[m]=u);for(;l<r;++l)i[l]=t[l];return new Xe(i,this._parents,this._name,this._id)}function Wu(e){return(e+"").trim().split(/^|\s+/).every(function(t){var s=t.indexOf(".");return s>=0&&(t=t.slice(0,s)),!t||t==="start"})}function Uu(e,t,s){var r,o,a=Wu(t)?Ps:Ve;return function(){var i=a(this,e),l=i.on;l!==r&&(o=(r=l).copy()).on(t,s),i.on=o}}function Ju(e,t){var s=this._id;return arguments.length<2?Le(this.node(),s).on.on(e):this.each(Uu(s,e,t))}function Qu(e){return function(){var t=this.parentNode;for(var s in this.__transition)if(+s!==e)return;t&&t.removeChild(this)}}function Ku(){return this.on("end.remove",Qu(this._id))}function eh(e){var t=this._name,s=this._id;typeof e!="function"&&(e=Is(e));for(var r=this._groups,o=r.length,a=new Array(o),i=0;i<o;++i)for(var l=r[i],c=l.length,d=a[i]=new Array(c),h,f,u=0;u<c;++u)(h=l[u])&&(f=e.call(h,h.__data__,u,l))&&("__data__"in h&&(f.__data__=h.__data__),d[u]=f,Dn(d[u],t,s,u,d,Le(h,s)));return new Xe(a,this._parents,t,s)}function th(e){var t=this._name,s=this._id;typeof e!="function"&&(e=ko(e));for(var r=this._groups,o=r.length,a=[],i=[],l=0;l<o;++l)for(var c=r[l],d=c.length,h,f=0;f<d;++f)if(h=c[f]){for(var u=e.call(h,h.__data__,f,c),m,p=Le(h,s),b=0,g=u.length;b<g;++b)(m=u[b])&&Dn(m,t,s,b,u,p);a.push(u),i.push(h)}return new Xe(a,i,t,s)}var nh=Gt.prototype.constructor;function sh(){return new nh(this._groups,this._parents)}function rh(e,t){var s,r,o;return function(){var a=gt(this,e),i=(this.style.removeProperty(e),gt(this,e));return a===i?null:a===s&&i===r?o:o=t(s=a,r=i)}}function Wo(e){return function(){this.style.removeProperty(e)}}function oh(e,t,s){var r,o=s+"",a;return function(){var i=gt(this,e);return i===o?null:i===r?a:a=t(r=i,s)}}function ih(e,t,s){var r,o,a;return function(){var i=gt(this,e),l=s(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(e),gt(this,e))),i===c?null:i===r&&c===o?a:(o=c,a=t(r=i,l))}}function ah(e,t){var s,r,o,a="style."+t,i="end."+a,l;return function(){var c=Ve(this,e),d=c.on,h=c.value[a]==null?l||(l=Wo(t)):void 0;(d!==s||o!==h)&&(r=(s=d).copy()).on(i,o=h),c.on=r}}function lh(e,t,s){var r=(e+="")=="transform"?cu:Xo;return t==null?this.styleTween(e,rh(e,r)).on("end.style."+e,Wo(e)):typeof t=="function"?this.styleTween(e,ih(e,r,Ds(this,"style."+e,t))).each(ah(this._id,e)):this.styleTween(e,oh(e,r,t),s).on("end.style."+e,null)}function ch(e,t,s){return function(r){this.style.setProperty(e,t.call(this,r),s)}}function dh(e,t,s){var r,o;function a(){var i=t.apply(this,arguments);return i!==o&&(r=(o=i)&&ch(e,i,s)),r}return a._value=t,a}function uh(e,t,s){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,dh(e,t,s??""))}function hh(e){return function(){this.textContent=e}}function fh(e){return function(){var t=e(this);this.textContent=t??""}}function mh(e){return this.tween("text",typeof e=="function"?fh(Ds(this,"text",e)):hh(e==null?"":e+""))}function ph(e){return function(t){this.textContent=e.call(this,t)}}function xh(e){var t,s;function r(){var o=e.apply(this,arguments);return o!==s&&(t=(s=o)&&ph(o)),t}return r._value=e,r}function gh(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,xh(e))}function bh(){for(var e=this._name,t=this._id,s=Uo(),r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],l=i.length,c,d=0;d<l;++d)if(c=i[d]){var h=Le(c,t);Dn(c,e,s,d,i,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Xe(r,this._parents,e,s)}function yh(){var e,t,s=this,r=s._id,o=s.size();return new Promise(function(a,i){var l={value:i},c={value:function(){--o===0&&a()}};s.each(function(){var d=Ve(this,r),h=d.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(c)),d.on=t}),o===0&&a()})}var vh=0;function Xe(e,t,s,r){this._groups=e,this._parents=t,this._name=s,this._id=r}function Uo(){return++vh}var Ye=Gt.prototype;Xe.prototype={constructor:Xe,select:eh,selectAll:th,selectChild:Ye.selectChild,selectChildren:Ye.selectChildren,filter:Zu,merge:Xu,selection:sh,transition:bh,call:Ye.call,nodes:Ye.nodes,node:Ye.node,size:Ye.size,empty:Ye.empty,each:Ye.each,on:Ju,attr:Au,attrTween:zu,style:lh,styleTween:uh,text:mh,textTween:gh,remove:Ku,tween:ku,delay:Bu,duration:Vu,ease:Gu,easeVarying:Yu,end:yh,[Symbol.iterator]:Ye[Symbol.iterator]};function wh(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var jh={time:null,delay:0,duration:250,ease:wh};function Nh(e,t){for(var s;!(s=e.__transition)||!(s=s[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return s}function kh(e){var t,s;e instanceof Xe?(t=e._id,e=e._name):(t=Uo(),(s=jh).time=$s(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],l=i.length,c,d=0;d<l;++d)(c=i[d])&&Dn(c,e,t,d,i,s||Nh(c,t));return new Xe(r,this._parents,e,t)}Gt.prototype.interrupt=wu;Gt.prototype.transition=kh;const sn=e=>()=>e;function Ch(e,{sourceEvent:t,target:s,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function Ze(e,t,s){this.k=e,this.x=t,this.y=s}Ze.prototype={constructor:Ze,scale:function(e){return e===1?this:new Ze(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Ze(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var zn=new Ze(1,0,0);Jo.prototype=Ze.prototype;function Jo(e){for(;!e.__zoom;)if(!(e=e.parentNode))return zn;return e.__zoom}function Wn(e){e.stopImmediatePropagation()}function _t(e){e.preventDefault(),e.stopImmediatePropagation()}function Sh(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function _h(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function xr(){return this.__zoom||zn}function Eh(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Ih(){return navigator.maxTouchPoints||"ontouchstart"in this}function Mh(e,t,s){var r=e.invertX(t[0][0])-s[0][0],o=e.invertX(t[1][0])-s[1][0],a=e.invertY(t[0][1])-s[0][1],i=e.invertY(t[1][1])-s[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),i>a?(a+i)/2:Math.min(0,a)||Math.max(0,i))}function Qo(){var e=Sh,t=_h,s=Mh,r=Eh,o=Ih,a=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,c=hn,d=Tn("start","zoom","end"),h,f,u,m=500,p=150,b=0,g=10;function v(j){j.property("__zoom",xr).on("wheel.zoom",T,{passive:!1}).on("mousedown.zoom",P).on("dblclick.zoom",R).filter(o).on("touchstart.zoom",C).on("touchmove.zoom",z).on("touchend.zoom touchcancel.zoom",L).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(j,M,S,A){var _=j.selection?j.selection():j;_.property("__zoom",xr),j!==_?E(j,M,S,A):_.interrupt().each(function(){k(this,arguments).event(A).start().zoom(null,typeof M=="function"?M.apply(this,arguments):M).end()})},v.scaleBy=function(j,M,S,A){v.scaleTo(j,function(){var _=this.__zoom.k,$=typeof M=="function"?M.apply(this,arguments):M;return _*$},S,A)},v.scaleTo=function(j,M,S,A){v.transform(j,function(){var _=t.apply(this,arguments),$=this.__zoom,O=S==null?w(_):typeof S=="function"?S.apply(this,arguments):S,F=$.invert(O),V=typeof M=="function"?M.apply(this,arguments):M;return s(x(N($,V),O,F),_,i)},S,A)},v.translateBy=function(j,M,S,A){v.transform(j,function(){return s(this.__zoom.translate(typeof M=="function"?M.apply(this,arguments):M,typeof S=="function"?S.apply(this,arguments):S),t.apply(this,arguments),i)},null,A)},v.translateTo=function(j,M,S,A,_){v.transform(j,function(){var $=t.apply(this,arguments),O=this.__zoom,F=A==null?w($):typeof A=="function"?A.apply(this,arguments):A;return s(zn.translate(F[0],F[1]).scale(O.k).translate(typeof M=="function"?-M.apply(this,arguments):-M,typeof S=="function"?-S.apply(this,arguments):-S),$,i)},A,_)};function N(j,M){return M=Math.max(a[0],Math.min(a[1],M)),M===j.k?j:new Ze(M,j.x,j.y)}function x(j,M,S){var A=M[0]-S[0]*j.k,_=M[1]-S[1]*j.k;return A===j.x&&_===j.y?j:new Ze(j.k,A,_)}function w(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function E(j,M,S,A){j.on("start.zoom",function(){k(this,arguments).event(A).start()}).on("interrupt.zoom end.zoom",function(){k(this,arguments).event(A).end()}).tween("zoom",function(){var _=this,$=arguments,O=k(_,$).event(A),F=t.apply(_,$),V=S==null?w(F):typeof S=="function"?S.apply(_,$):S,Y=Math.max(F[1][0]-F[0][0],F[1][1]-F[0][1]),Z=_.__zoom,ee=typeof M=="function"?M.apply(_,$):M,Q=c(Z.invert(V).concat(Y/Z.k),ee.invert(V).concat(Y/ee.k));return function(B){if(B===1)B=ee;else{var D=Q(B),X=Y/D[2];B=new Ze(X,V[0]-D[0]*X,V[1]-D[1]*X)}O.zoom(null,B)}})}function k(j,M,S){return!S&&j.__zooming||new I(j,M)}function I(j,M){this.that=j,this.args=M,this.active=0,this.sourceEvent=null,this.extent=t.apply(j,M),this.taps=0}I.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,M){return this.mouse&&j!=="mouse"&&(this.mouse[1]=M.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=M.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=M.invert(this.touch1[0])),this.that.__zoom=M,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var M=Ee(this.that).datum();d.call(j,this.that,new Ch(j,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:d}),M)}};function T(j,...M){if(!e.apply(this,arguments))return;var S=k(this,M).event(j),A=this.__zoom,_=Math.max(a[0],Math.min(a[1],A.k*Math.pow(2,r.apply(this,arguments)))),$=$e(j);if(S.wheel)(S.mouse[0][0]!==$[0]||S.mouse[0][1]!==$[1])&&(S.mouse[1]=A.invert(S.mouse[0]=$)),clearTimeout(S.wheel);else{if(A.k===_)return;S.mouse=[$,A.invert($)],pn(this),S.start()}_t(j),S.wheel=setTimeout(O,p),S.zoom("mouse",s(x(N(A,_),S.mouse[0],S.mouse[1]),S.extent,i));function O(){S.wheel=null,S.end()}}function P(j,...M){if(u||!e.apply(this,arguments))return;var S=j.currentTarget,A=k(this,M,!0).event(j),_=Ee(j.view).on("mousemove.zoom",V,!0).on("mouseup.zoom",Y,!0),$=$e(j,S),O=j.clientX,F=j.clientY;Do(j.view),Wn(j),A.mouse=[$,this.__zoom.invert($)],pn(this),A.start();function V(Z){if(_t(Z),!A.moved){var ee=Z.clientX-O,Q=Z.clientY-F;A.moved=ee*ee+Q*Q>b}A.event(Z).zoom("mouse",s(x(A.that.__zoom,A.mouse[0]=$e(Z,S),A.mouse[1]),A.extent,i))}function Y(Z){_.on("mousemove.zoom mouseup.zoom",null),zo(Z.view,A.moved),_t(Z),A.event(Z).end()}}function R(j,...M){if(e.apply(this,arguments)){var S=this.__zoom,A=$e(j.changedTouches?j.changedTouches[0]:j,this),_=S.invert(A),$=S.k*(j.shiftKey?.5:2),O=s(x(N(S,$),A,_),t.apply(this,M),i);_t(j),l>0?Ee(this).transition().duration(l).call(E,O,A,j):Ee(this).call(v.transform,O,A,j)}}function C(j,...M){if(e.apply(this,arguments)){var S=j.touches,A=S.length,_=k(this,M,j.changedTouches.length===A).event(j),$,O,F,V;for(Wn(j),O=0;O<A;++O)F=S[O],V=$e(F,this),V=[V,this.__zoom.invert(V),F.identifier],_.touch0?!_.touch1&&_.touch0[2]!==V[2]&&(_.touch1=V,_.taps=0):(_.touch0=V,$=!0,_.taps=1+!!h);h&&(h=clearTimeout(h)),$&&(_.taps<2&&(f=V[0],h=setTimeout(function(){h=null},m)),pn(this),_.start())}}function z(j,...M){if(this.__zooming){var S=k(this,M).event(j),A=j.changedTouches,_=A.length,$,O,F,V;for(_t(j),$=0;$<_;++$)O=A[$],F=$e(O,this),S.touch0&&S.touch0[2]===O.identifier?S.touch0[0]=F:S.touch1&&S.touch1[2]===O.identifier&&(S.touch1[0]=F);if(O=S.that.__zoom,S.touch1){var Y=S.touch0[0],Z=S.touch0[1],ee=S.touch1[0],Q=S.touch1[1],B=(B=ee[0]-Y[0])*B+(B=ee[1]-Y[1])*B,D=(D=Q[0]-Z[0])*D+(D=Q[1]-Z[1])*D;O=N(O,Math.sqrt(B/D)),F=[(Y[0]+ee[0])/2,(Y[1]+ee[1])/2],V=[(Z[0]+Q[0])/2,(Z[1]+Q[1])/2]}else if(S.touch0)F=S.touch0[0],V=S.touch0[1];else return;S.zoom("touch",s(x(O,F,V),S.extent,i))}}function L(j,...M){if(this.__zooming){var S=k(this,M).event(j),A=j.changedTouches,_=A.length,$,O;for(Wn(j),u&&clearTimeout(u),u=setTimeout(function(){u=null},m),$=0;$<_;++$)O=A[$],S.touch0&&S.touch0[2]===O.identifier?delete S.touch0:S.touch1&&S.touch1[2]===O.identifier&&delete S.touch1;if(S.touch1&&!S.touch0&&(S.touch0=S.touch1,delete S.touch1),S.touch0)S.touch0[1]=this.__zoom.invert(S.touch0[0]);else if(S.end(),S.taps===2&&(O=$e(O,this),Math.hypot(f[0]-O[0],f[1]-O[1])<g)){var F=Ee(this).on("dblclick.zoom");F&&F.apply(this,arguments)}}}return v.wheelDelta=function(j){return arguments.length?(r=typeof j=="function"?j:sn(+j),v):r},v.filter=function(j){return arguments.length?(e=typeof j=="function"?j:sn(!!j),v):e},v.touchable=function(j){return arguments.length?(o=typeof j=="function"?j:sn(!!j),v):o},v.extent=function(j){return arguments.length?(t=typeof j=="function"?j:sn([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),v):t},v.scaleExtent=function(j){return arguments.length?(a[0]=+j[0],a[1]=+j[1],v):[a[0],a[1]]},v.translateExtent=function(j){return arguments.length?(i[0][0]=+j[0][0],i[1][0]=+j[1][0],i[0][1]=+j[0][1],i[1][1]=+j[1][1],v):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},v.constrain=function(j){return arguments.length?(s=j,v):s},v.duration=function(j){return arguments.length?(l=+j,v):l},v.interpolate=function(j){return arguments.length?(c=j,v):c},v.on=function(){var j=d.on.apply(d,arguments);return j===d?v:j},v.clickDistance=function(j){return arguments.length?(b=(j=+j)*j,v):Math.sqrt(b)},v.tapDistance=function(j){return arguments.length?(g=+j,v):g},v}const Oe={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:s,targetHandle:r})=>`Couldn't create edge for ${e} handle id: "${e==="source"?s:r}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Rt=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ko=["Enter"," ","Escape"],ei={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:s})=>`Moved selected node ${e}. New position, x: ${t}, y: ${s}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var yt;(function(e){e.Strict="strict",e.Loose="loose"})(yt||(yt={}));var it;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(it||(it={}));var Lt;(function(e){e.Partial="partial",e.Full="full"})(Lt||(Lt={}));const ti={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Qe;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Qe||(Qe={}));var vt;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(vt||(vt={}));var te;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(te||(te={}));const gr={[te.Left]:te.Right,[te.Right]:te.Left,[te.Top]:te.Bottom,[te.Bottom]:te.Top};function ni(e){return e===null?null:e?"valid":"invalid"}const si=e=>"id"in e&&"source"in e&&"target"in e,Ah=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),zs=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Yt=(e,t=[0,0])=>{const{width:s,height:r}=We(e),o=e.origin??t,a=s*o[0],i=r*o[1];return{x:e.position.x-a,y:e.position.y-i}},Th=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const s=e.reduce((r,o)=>{const a=typeof o=="string";let i=!t.nodeLookup&&!a?o:void 0;t.nodeLookup&&(i=a?t.nodeLookup.get(o):zs(o)?o:t.nodeLookup.get(o.id));const l=i?Cn(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Rn(r,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Ln(s)},Zt=(e,t={})=>{let s={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return e.forEach(o=>{(t.filter===void 0||t.filter(o))&&(s=Rn(s,Cn(o)),r=!0)}),r?Ln(s):{x:0,y:0,width:0,height:0}},Rs=(e,t,[s,r,o]=[0,0,1],a=!1,i=!1)=>{const l={...Wt(t,[s,r,o]),width:t.width/o,height:t.height/o},c=[];for(const d of e.values()){const{measured:h,selectable:f=!0,hidden:u=!1}=d;if(i&&!f||u)continue;const m=h.width??d.width??d.initialWidth??null,p=h.height??d.height??d.initialHeight??null,b=Bt(l,jt(d)),g=(m??0)*(p??0),v=a&&b>0;(!d.internals.handleBounds||v||b>=g||d.dragging)&&c.push(d)}return c},$h=(e,t)=>{const s=new Set;return e.forEach(r=>{s.add(r.id)}),t.filter(r=>s.has(r.source)||s.has(r.target))};function Ph(e,t){const s=new Map,r=t?.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&(t?.includeHiddenNodes||!o.hidden)&&(!r||r.has(o.id))&&s.set(o.id,o)}),s}async function Dh({nodes:e,width:t,height:s,panZoom:r,minZoom:o,maxZoom:a},i){if(e.size===0)return Promise.resolve(!0);const l=Ph(e,i),c=Zt(l),d=Ls(c,t,s,i?.minZoom??o,i?.maxZoom??a,i?.padding??.1);return await r.setViewport(d,{duration:i?.duration,ease:i?.ease,interpolate:i?.interpolate}),Promise.resolve(!0)}function ri({nodeId:e,nextPosition:t,nodeLookup:s,nodeOrigin:r=[0,0],nodeExtent:o,onError:a}){const i=s.get(e),l=i.parentId?s.get(i.parentId):void 0,{x:c,y:d}=l?l.internals.positionAbsolute:{x:0,y:0},h=i.origin??r;let f=i.extent||o;if(i.extent==="parent"&&!i.expandParent)if(!l)a?.("005",Oe.error005());else{const m=l.measured.width,p=l.measured.height;m&&p&&(f=[[c,d],[c+m,d+p]])}else l&&Nt(i.extent)&&(f=[[i.extent[0][0]+c,i.extent[0][1]+d],[i.extent[1][0]+c,i.extent[1][1]+d]]);const u=Nt(f)?ct(t,f,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&a?.("015",Oe.error015()),{position:{x:u.x-c+(i.measured.width??0)*h[0],y:u.y-d+(i.measured.height??0)*h[1]},positionAbsolute:u}}async function zh({nodesToRemove:e=[],edgesToRemove:t=[],nodes:s,edges:r,onBeforeDelete:o}){const a=new Set(e.map(u=>u.id)),i=[];for(const u of s){if(u.deletable===!1)continue;const m=a.has(u.id),p=!m&&u.parentId&&i.find(b=>b.id===u.parentId);(m||p)&&i.push(u)}const l=new Set(t.map(u=>u.id)),c=r.filter(u=>u.deletable!==!1),h=$h(i,c);for(const u of c)l.has(u.id)&&!h.find(p=>p.id===u.id)&&h.push(u);if(!o)return{edges:h,nodes:i};const f=await o({nodes:i,edges:h});return typeof f=="boolean"?f?{edges:h,nodes:i}:{edges:[],nodes:[]}:f}const wt=(e,t=0,s=1)=>Math.min(Math.max(e,t),s),ct=(e={x:0,y:0},t,s)=>({x:wt(e.x,t[0][0],t[1][0]-(s?.width??0)),y:wt(e.y,t[0][1],t[1][1]-(s?.height??0))});function oi(e,t,s){const{width:r,height:o}=We(s),{x:a,y:i}=s.internals.positionAbsolute;return ct(e,[[a,i],[a+r,i+o]],t)}const br=(e,t,s)=>e<t?wt(Math.abs(e-t),1,t)/t:e>s?-wt(Math.abs(e-s),1,t)/t:0,ii=(e,t,s=15,r=40)=>{const o=br(e.x,r,t.width-r)*s,a=br(e.y,r,t.height-r)*s;return[o,a]},Rn=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),gs=({x:e,y:t,width:s,height:r})=>({x:e,y:t,x2:e+s,y2:t+r}),Ln=({x:e,y:t,x2:s,y2:r})=>({x:e,y:t,width:s-e,height:r-t}),jt=(e,t=[0,0])=>{const{x:s,y:r}=zs(e)?e.internals.positionAbsolute:Yt(e,t);return{x:s,y:r,width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}},Cn=(e,t=[0,0])=>{const{x:s,y:r}=zs(e)?e.internals.positionAbsolute:Yt(e,t);return{x:s,y:r,x2:s+(e.measured?.width??e.width??e.initialWidth??0),y2:r+(e.measured?.height??e.height??e.initialHeight??0)}},ai=(e,t)=>Ln(Rn(gs(e),gs(t))),Bt=(e,t)=>{const s=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(s*r)},yr=e=>De(e.width)&&De(e.height)&&De(e.x)&&De(e.y),De=e=>!isNaN(e)&&isFinite(e),Rh=(e,t)=>{},Xt=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Wt=({x:e,y:t},[s,r,o],a=!1,i=[1,1])=>{const l={x:(e-s)/o,y:(t-r)/o};return a?Xt(l,i):l},Sn=({x:e,y:t},[s,r,o])=>({x:e*o+s,y:t*o+r});function ht(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const s=parseFloat(e);if(!Number.isNaN(s))return Math.floor(s)}if(typeof e=="string"&&e.endsWith("%")){const s=parseFloat(e);if(!Number.isNaN(s))return Math.floor(t*s*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Lh(e,t,s){if(typeof e=="string"||typeof e=="number"){const r=ht(e,s),o=ht(e,t);return{top:r,right:o,bottom:r,left:o,x:o*2,y:r*2}}if(typeof e=="object"){const r=ht(e.top??e.y??0,s),o=ht(e.bottom??e.y??0,s),a=ht(e.left??e.x??0,t),i=ht(e.right??e.x??0,t);return{top:r,right:i,bottom:o,left:a,x:a+i,y:r+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Bh(e,t,s,r,o,a){const{x:i,y:l}=Sn(e,[t,s,r]),{x:c,y:d}=Sn({x:e.x+e.width,y:e.y+e.height},[t,s,r]),h=o-c,f=a-d;return{left:Math.floor(i),top:Math.floor(l),right:Math.floor(h),bottom:Math.floor(f)}}const Ls=(e,t,s,r,o,a)=>{const i=Lh(a,t,s),l=(t-i.x)/e.width,c=(s-i.y)/e.height,d=Math.min(l,c),h=wt(d,r,o),f=e.x+e.width/2,u=e.y+e.height/2,m=t/2-f*h,p=s/2-u*h,b=Bh(e,m,p,h,t,s),g={left:Math.min(b.left-i.left,0),top:Math.min(b.top-i.top,0),right:Math.min(b.right-i.right,0),bottom:Math.min(b.bottom-i.bottom,0)};return{x:m-g.left+g.right,y:p-g.top+g.bottom,zoom:h}},Ht=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function Nt(e){return e!=null&&e!=="parent"}function We(e){return{width:e.measured?.width??e.width??e.initialWidth??0,height:e.measured?.height??e.height??e.initialHeight??0}}function li(e){return(e.measured?.width??e.width??e.initialWidth)!==void 0&&(e.measured?.height??e.height??e.initialHeight)!==void 0}function ci(e,t={width:0,height:0},s,r,o){const a={...e},i=r.get(s);if(i){const l=i.origin||o;a.x+=i.internals.positionAbsolute.x-(t.width??0)*l[0],a.y+=i.internals.positionAbsolute.y-(t.height??0)*l[1]}return a}function vr(e,t){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}function Hh(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}function Oh(e){return{...ei,...e||{}}}function At(e,{snapGrid:t=[0,0],snapToGrid:s=!1,transform:r,containerBounds:o}){const{x:a,y:i}=ze(e),l=Wt({x:a-(o?.left??0),y:i-(o?.top??0)},r),{x:c,y:d}=s?Xt(l,t):l;return{xSnapped:c,ySnapped:d,...l}}const Bs=e=>({width:e.offsetWidth,height:e.offsetHeight}),di=e=>e?.getRootNode?.()||window?.document,Vh=["INPUT","SELECT","TEXTAREA"];function ui(e){const t=e.composedPath?.()?.[0]||e.target;return t?.nodeType!==1?!1:Vh.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const hi=e=>"clientX"in e,ze=(e,t)=>{const s=hi(e),r=s?e.clientX:e.touches?.[0].clientX,o=s?e.clientY:e.touches?.[0].clientY;return{x:r-(t?.left??0),y:o-(t?.top??0)}},wr=(e,t,s,r,o)=>{const a=t.querySelectorAll(`.${e}`);return!a||!a.length?null:Array.from(a).map(i=>{const l=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:o,position:i.getAttribute("data-handlepos"),x:(l.left-s.left)/r,y:(l.top-s.top)/r,...Bs(i)}})};function fi({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:o,sourceControlY:a,targetControlX:i,targetControlY:l}){const c=e*.125+o*.375+i*.375+s*.125,d=t*.125+a*.375+l*.375+r*.125,h=Math.abs(c-e),f=Math.abs(d-t);return[c,d,h,f]}function rn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function jr({pos:e,x1:t,y1:s,x2:r,y2:o,c:a}){switch(e){case te.Left:return[t-rn(t-r,a),s];case te.Right:return[t+rn(r-t,a),s];case te.Top:return[t,s-rn(s-o,a)];case te.Bottom:return[t,s+rn(o-s,a)]}}function mi({sourceX:e,sourceY:t,sourcePosition:s=te.Bottom,targetX:r,targetY:o,targetPosition:a=te.Top,curvature:i=.25}){const[l,c]=jr({pos:s,x1:e,y1:t,x2:r,y2:o,c:i}),[d,h]=jr({pos:a,x1:r,y1:o,x2:e,y2:t,c:i}),[f,u,m,p]=fi({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:l,sourceControlY:c,targetControlX:d,targetControlY:h});return[`M${e},${t} C${l},${c} ${d},${h} ${r},${o}`,f,u,m,p]}function pi({sourceX:e,sourceY:t,targetX:s,targetY:r}){const o=Math.abs(s-e)/2,a=s<e?s+o:s-o,i=Math.abs(r-t)/2,l=r<t?r+i:r-i;return[a,l,o,i]}function Fh({sourceNode:e,targetNode:t,selected:s=!1,zIndex:r=0,elevateOnSelect:o=!1,zIndexMode:a="basic"}){if(a==="manual")return r;const i=o&&s?r+1e3:r,l=Math.max(e.parentId||o&&e.selected?e.internals.z:0,t.parentId||o&&t.selected?t.internals.z:0);return i+l}function Gh({sourceNode:e,targetNode:t,width:s,height:r,transform:o}){const a=Rn(Cn(e),Cn(t));a.x===a.x2&&(a.x2+=1),a.y===a.y2&&(a.y2+=1);const i={x:-o[0]/o[2],y:-o[1]/o[2],width:s/o[2],height:r/o[2]};return Bt(i,Ln(a))>0}const qh=({source:e,sourceHandle:t,target:s,targetHandle:r})=>`xy-edge__${e}${t||""}-${s}${r||""}`,Yh=(e,t)=>t.some(s=>s.source===e.source&&s.target===e.target&&(s.sourceHandle===e.sourceHandle||!s.sourceHandle&&!e.sourceHandle)&&(s.targetHandle===e.targetHandle||!s.targetHandle&&!e.targetHandle)),Zh=(e,t,s={})=>{if(!e.source||!e.target)return t;const r=s.getEdgeId||qh;let o;return si(e)?o={...e}:o={...e,id:r(e)},Yh(o,t)?t:(o.sourceHandle===null&&delete o.sourceHandle,o.targetHandle===null&&delete o.targetHandle,t.concat(o))};function xi({sourceX:e,sourceY:t,targetX:s,targetY:r}){const[o,a,i,l]=pi({sourceX:e,sourceY:t,targetX:s,targetY:r});return[`M ${e},${t}L ${s},${r}`,o,a,i,l]}const Nr={[te.Left]:{x:-1,y:0},[te.Right]:{x:1,y:0},[te.Top]:{x:0,y:-1},[te.Bottom]:{x:0,y:1}},Xh=({source:e,sourcePosition:t=te.Bottom,target:s})=>t===te.Left||t===te.Right?e.x<s.x?{x:1,y:0}:{x:-1,y:0}:e.y<s.y?{x:0,y:1}:{x:0,y:-1},kr=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Wh({source:e,sourcePosition:t=te.Bottom,target:s,targetPosition:r=te.Top,center:o,offset:a,stepPosition:i}){const l=Nr[t],c=Nr[r],d={x:e.x+l.x*a,y:e.y+l.y*a},h={x:s.x+c.x*a,y:s.y+c.y*a},f=Xh({source:d,sourcePosition:t,target:h}),u=f.x!==0?"x":"y",m=f[u];let p=[],b,g;const v={x:0,y:0},N={x:0,y:0},[,,x,w]=pi({sourceX:e.x,sourceY:e.y,targetX:s.x,targetY:s.y});if(l[u]*c[u]===-1){u==="x"?(b=o.x??d.x+(h.x-d.x)*i,g=o.y??(d.y+h.y)/2):(b=o.x??(d.x+h.x)/2,g=o.y??d.y+(h.y-d.y)*i);const k=[{x:b,y:d.y},{x:b,y:h.y}],I=[{x:d.x,y:g},{x:h.x,y:g}];l[u]===m?p=u==="x"?k:I:p=u==="x"?I:k}else{const k=[{x:d.x,y:h.y}],I=[{x:h.x,y:d.y}];if(u==="x"?p=l.x===m?I:k:p=l.y===m?k:I,t===r){const z=Math.abs(e[u]-s[u]);if(z<=a){const L=Math.min(a-1,a-z);l[u]===m?v[u]=(d[u]>e[u]?-1:1)*L:N[u]=(h[u]>s[u]?-1:1)*L}}if(t!==r){const z=u==="x"?"y":"x",L=l[u]===c[z],j=d[z]>h[z],M=d[z]<h[z];(l[u]===1&&(!L&&j||L&&M)||l[u]!==1&&(!L&&M||L&&j))&&(p=u==="x"?k:I)}const T={x:d.x+v.x,y:d.y+v.y},P={x:h.x+N.x,y:h.y+N.y},R=Math.max(Math.abs(T.x-p[0].x),Math.abs(P.x-p[0].x)),C=Math.max(Math.abs(T.y-p[0].y),Math.abs(P.y-p[0].y));R>=C?(b=(T.x+P.x)/2,g=p[0].y):(b=p[0].x,g=(T.y+P.y)/2)}return[[e,{x:d.x+v.x,y:d.y+v.y},...p,{x:h.x+N.x,y:h.y+N.y},s],b,g,x,w]}function Uh(e,t,s,r){const o=Math.min(kr(e,t)/2,kr(t,s)/2,r),{x:a,y:i}=t;if(e.x===a&&a===s.x||e.y===i&&i===s.y)return`L${a} ${i}`;if(e.y===i){const d=e.x<s.x?-1:1,h=e.y<s.y?1:-1;return`L ${a+o*d},${i}Q ${a},${i} ${a},${i+o*h}`}const l=e.x<s.x?1:-1,c=e.y<s.y?-1:1;return`L ${a},${i+o*c}Q ${a},${i} ${a+o*l},${i}`}function bs({sourceX:e,sourceY:t,sourcePosition:s=te.Bottom,targetX:r,targetY:o,targetPosition:a=te.Top,borderRadius:i=5,centerX:l,centerY:c,offset:d=20,stepPosition:h=.5}){const[f,u,m,p,b]=Wh({source:{x:e,y:t},sourcePosition:s,target:{x:r,y:o},targetPosition:a,center:{x:l,y:c},offset:d,stepPosition:h});return[f.reduce((v,N,x)=>{let w="";return x>0&&x<f.length-1?w=Uh(f[x-1],N,f[x+1],i):w=`${x===0?"M":"L"}${N.x} ${N.y}`,v+=w,v},""),u,m,p,b]}function Cr(e){return e&&!!(e.internals.handleBounds||e.handles?.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Jh(e){const{sourceNode:t,targetNode:s}=e;if(!Cr(t)||!Cr(s))return null;const r=t.internals.handleBounds||Sr(t.handles),o=s.internals.handleBounds||Sr(s.handles),a=_r(r?.source??[],e.sourceHandle),i=_r(e.connectionMode===yt.Strict?o?.target??[]:(o?.target??[]).concat(o?.source??[]),e.targetHandle);if(!a||!i)return e.onError?.("008",Oe.error008(a?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=a?.position||te.Bottom,c=i?.position||te.Top,d=dt(t,a,l),h=dt(s,i,c);return{sourceX:d.x,sourceY:d.y,targetX:h.x,targetY:h.y,sourcePosition:l,targetPosition:c}}function Sr(e){if(!e)return null;const t=[],s=[];for(const r of e)r.width=r.width??1,r.height=r.height??1,r.type==="source"?t.push(r):r.type==="target"&&s.push(r);return{source:t,target:s}}function dt(e,t,s=te.Left,r=!1){const o=(t?.x??0)+e.internals.positionAbsolute.x,a=(t?.y??0)+e.internals.positionAbsolute.y,{width:i,height:l}=t??We(e);if(r)return{x:o+i/2,y:a+l/2};switch(t?.position??s){case te.Top:return{x:o+i/2,y:a};case te.Right:return{x:o+i,y:a+l/2};case te.Bottom:return{x:o+i/2,y:a+l};case te.Left:return{x:o,y:a+l/2}}}function _r(e,t){return e&&(t?e.find(s=>s.id===t):e[0])||null}function ys(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`:""}function Qh(e,{id:t,defaultColor:s,defaultMarkerStart:r,defaultMarkerEnd:o}){const a=new Set;return e.reduce((i,l)=>([l.markerStart||r,l.markerEnd||o].forEach(c=>{if(c&&typeof c=="object"){const d=ys(c,t);a.has(d)||(i.push({id:d,color:c.color||s,...c}),a.add(d))}}),i),[]).sort((i,l)=>i.id.localeCompare(l.id))}const gi=1e3,Kh=10,Hs={nodeOrigin:[0,0],nodeExtent:Rt,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},ef={...Hs,checkEquality:!0};function Os(e,t){const s={...e};for(const r in t)t[r]!==void 0&&(s[r]=t[r]);return s}function tf(e,t,s){const r=Os(Hs,s);for(const o of e.values())if(o.parentId)Fs(o,e,t,r);else{const a=Yt(o,r.nodeOrigin),i=Nt(o.extent)?o.extent:r.nodeExtent,l=ct(a,i,We(o));o.internals.positionAbsolute=l}}function nf(e,t){if(!e.handles)return e.measured?t?.internals.handleBounds:void 0;const s=[],r=[];for(const o of e.handles){const a={id:o.id,width:o.width??1,height:o.height??1,nodeId:e.id,x:o.x,y:o.y,position:o.position,type:o.type};o.type==="source"?s.push(a):o.type==="target"&&r.push(a)}return{source:s,target:r}}function Vs(e){return e==="manual"}function vs(e,t,s,r={}){const o=Os(ef,r),a={i:0},i=new Map(t),l=o?.elevateNodesOnSelect&&!Vs(o.zIndexMode)?gi:0;let c=e.length>0;t.clear(),s.clear();for(const d of e){let h=i.get(d.id);if(o.checkEquality&&d===h?.internals.userNode)t.set(d.id,h);else{const f=Yt(d,o.nodeOrigin),u=Nt(d.extent)?d.extent:o.nodeExtent,m=ct(f,u,We(d));h={...o.defaults,...d,measured:{width:d.measured?.width,height:d.measured?.height},internals:{positionAbsolute:m,handleBounds:nf(d,h),z:bi(d,l,o.zIndexMode),userNode:d}},t.set(d.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(c=!1),d.parentId&&Fs(h,t,s,r,a)}return c}function sf(e,t){if(!e.parentId)return;const s=t.get(e.parentId);s?s.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Fs(e,t,s,r,o){const{elevateNodesOnSelect:a,nodeOrigin:i,nodeExtent:l,zIndexMode:c}=Os(Hs,r),d=e.parentId,h=t.get(d);if(!h){console.warn(`Parent node ${d} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}sf(e,s),o&&!h.parentId&&h.internals.rootParentIndex===void 0&&c==="auto"&&(h.internals.rootParentIndex=++o.i,h.internals.z=h.internals.z+o.i*Kh),o&&h.internals.rootParentIndex!==void 0&&(o.i=h.internals.rootParentIndex);const f=a&&!Vs(c)?gi:0,{x:u,y:m,z:p}=rf(e,h,i,l,f,c),{positionAbsolute:b}=e.internals,g=u!==b.x||m!==b.y;(g||p!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:g?{x:u,y:m}:b,z:p}})}function bi(e,t,s){const r=De(e.zIndex)?e.zIndex:0;return Vs(s)?r:r+(e.selected?t:0)}function rf(e,t,s,r,o,a){const{x:i,y:l}=t.internals.positionAbsolute,c=We(e),d=Yt(e,s),h=Nt(e.extent)?ct(d,e.extent,c):d;let f=ct({x:i+h.x,y:l+h.y},r,c);e.extent==="parent"&&(f=oi(f,c,t));const u=bi(e,o,a),m=t.internals.z??0;return{x:f.x,y:f.y,z:m>=u?m+1:u}}function Gs(e,t,s,r=[0,0]){const o=[],a=new Map;for(const i of e){const l=t.get(i.parentId);if(!l)continue;const c=a.get(i.parentId)?.expandedRect??jt(l),d=ai(c,i.rect);a.set(i.parentId,{expandedRect:d,parent:l})}return a.size>0&&a.forEach(({expandedRect:i,parent:l},c)=>{const d=l.internals.positionAbsolute,h=We(l),f=l.origin??r,u=i.x<d.x?Math.round(Math.abs(d.x-i.x)):0,m=i.y<d.y?Math.round(Math.abs(d.y-i.y)):0,p=Math.max(h.width,Math.round(i.width)),b=Math.max(h.height,Math.round(i.height)),g=(p-h.width)*f[0],v=(b-h.height)*f[1];(u>0||m>0||g||v)&&(o.push({id:c,type:"position",position:{x:l.position.x-u+g,y:l.position.y-m+v}}),s.get(c)?.forEach(N=>{e.some(x=>x.id===N.id)||o.push({id:N.id,type:"position",position:{x:N.position.x+u,y:N.position.y+m}})})),(h.width<i.width||h.height<i.height||u||m)&&o.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:p+(u?f[0]*u-g:0),height:b+(m?f[1]*m-v:0)}})}),o}function of(e,t,s,r,o,a,i){const l=r?.querySelector(".xyflow__viewport");let c=!1;if(!l)return{changes:[],updatedInternals:c};const d=[],h=window.getComputedStyle(l),{m22:f}=new window.DOMMatrixReadOnly(h.transform),u=[];for(const m of e.values()){const p=t.get(m.id);if(!p)continue;if(p.hidden){t.set(p.id,{...p,internals:{...p.internals,handleBounds:void 0}}),c=!0;continue}const b=Bs(m.nodeElement),g=p.measured.width!==b.width||p.measured.height!==b.height;if(!!(b.width&&b.height&&(g||!p.internals.handleBounds||m.force))){const N=m.nodeElement.getBoundingClientRect(),x=Nt(p.extent)?p.extent:a;let{positionAbsolute:w}=p.internals;p.parentId&&p.extent==="parent"?w=oi(w,b,t.get(p.parentId)):x&&(w=ct(w,x,b));const E={...p,measured:b,internals:{...p.internals,positionAbsolute:w,handleBounds:{source:wr("source",m.nodeElement,N,f,p.id),target:wr("target",m.nodeElement,N,f,p.id)}}};t.set(p.id,E),p.parentId&&Fs(E,t,s,{nodeOrigin:o,zIndexMode:i}),c=!0,g&&(d.push({id:p.id,type:"dimensions",dimensions:b}),p.expandParent&&p.parentId&&u.push({id:p.id,parentId:p.parentId,rect:jt(E,o)}))}}if(u.length>0){const m=Gs(u,t,s,o);d.push(...m)}return{changes:d,updatedInternals:c}}async function af({delta:e,panZoom:t,transform:s,translateExtent:r,width:o,height:a}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:s[0]+e.x,y:s[1]+e.y,zoom:s[2]},[[0,0],[o,a]],r),l=!!i&&(i.x!==s[0]||i.y!==s[1]||i.k!==s[2]);return Promise.resolve(l)}function Er(e,t,s,r,o,a){let i=o;const l=r.get(i)||new Map;r.set(i,l.set(s,t)),i=`${o}-${e}`;const c=r.get(i)||new Map;if(r.set(i,c.set(s,t)),a){i=`${o}-${e}-${a}`;const d=r.get(i)||new Map;r.set(i,d.set(s,t))}}function yi(e,t,s){e.clear(),t.clear();for(const r of s){const{source:o,target:a,sourceHandle:i=null,targetHandle:l=null}=r,c={edgeId:r.id,source:o,target:a,sourceHandle:i,targetHandle:l},d=`${o}-${i}--${a}-${l}`,h=`${a}-${l}--${o}-${i}`;Er("source",c,h,e,o,i),Er("target",c,d,e,a,l),t.set(r.id,r)}}function vi(e,t){if(!e.parentId)return!1;const s=t.get(e.parentId);return s?s.selected?!0:vi(s,t):!1}function Ir(e,t,s){let r=e;do{if(r?.matches?.(t))return!0;if(r===s)return!1;r=r?.parentElement}while(r);return!1}function lf(e,t,s,r){const o=new Map;for(const[a,i]of e)if((i.selected||i.id===r)&&(!i.parentId||!vi(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const l=e.get(a);l&&o.set(a,{id:a,position:l.position||{x:0,y:0},distance:{x:s.x-l.internals.positionAbsolute.x,y:s.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return o}function Un({nodeId:e,dragItems:t,nodeLookup:s,dragging:r=!0}){const o=[];for(const[i,l]of t){const c=s.get(i)?.internals.userNode;c&&o.push({...c,position:l.position,dragging:r})}if(!e)return[o[0],o];const a=s.get(e)?.internals.userNode;return[a?{...a,position:t.get(e)?.position||a.position,dragging:r}:o[0],o]}function cf({dragItems:e,snapGrid:t,x:s,y:r}){const o=e.values().next().value;if(!o)return null;const a={x:s-o.distance.x,y:r-o.distance.y},i=Xt(a,t);return{x:i.x-a.x,y:i.y-a.y}}function df({onNodeMouseDown:e,getStoreItems:t,onDragStart:s,onDrag:r,onDragStop:o}){let a={x:null,y:null},i=0,l=new Map,c=!1,d={x:0,y:0},h=null,f=!1,u=null,m=!1,p=!1,b=null;function g({noDragClassName:N,handleSelector:x,domNode:w,isSelectable:E,nodeId:k,nodeClickDistance:I=0}){u=Ee(w);function T({x:z,y:L}){const{nodeLookup:j,nodeExtent:M,snapGrid:S,snapToGrid:A,nodeOrigin:_,onNodeDrag:$,onSelectionDrag:O,onError:F,updateNodePositions:V}=t();a={x:z,y:L};let Y=!1;const Z=l.size>1,ee=Z&&M?gs(Zt(l)):null,Q=Z&&A?cf({dragItems:l,snapGrid:S,x:z,y:L}):null;for(const[B,D]of l){if(!j.has(B))continue;let X={x:z-D.distance.x,y:L-D.distance.y};A&&(X=Q?{x:Math.round(X.x+Q.x),y:Math.round(X.y+Q.y)}:Xt(X,S));let W=null;if(Z&&M&&!D.extent&&ee){const{positionAbsolute:ne}=D.internals,ie=ne.x-ee.x+M[0][0],le=ne.x+D.measured.width-ee.x2+M[1][0],ce=ne.y-ee.y+M[0][1],ue=ne.y+D.measured.height-ee.y2+M[1][1];W=[[ie,ce],[le,ue]]}const{position:se,positionAbsolute:J}=ri({nodeId:B,nextPosition:X,nodeLookup:j,nodeExtent:W||M,nodeOrigin:_,onError:F});Y=Y||D.position.x!==se.x||D.position.y!==se.y,D.position=se,D.internals.positionAbsolute=J}if(p=p||Y,!!Y&&(V(l,!0),b&&(r||$||!k&&O))){const[B,D]=Un({nodeId:k,dragItems:l,nodeLookup:j});r?.(b,l,B,D),$?.(b,B,D),k||O?.(b,D)}}async function P(){if(!h)return;const{transform:z,panBy:L,autoPanSpeed:j,autoPanOnNodeDrag:M}=t();if(!M){c=!1,cancelAnimationFrame(i);return}const[S,A]=ii(d,h,j);(S!==0||A!==0)&&(a.x=(a.x??0)-S/z[2],a.y=(a.y??0)-A/z[2],await L({x:S,y:A})&&T(a)),i=requestAnimationFrame(P)}function R(z){const{nodeLookup:L,multiSelectionActive:j,nodesDraggable:M,transform:S,snapGrid:A,snapToGrid:_,selectNodesOnDrag:$,onNodeDragStart:O,onSelectionDragStart:F,unselectNodesAndEdges:V}=t();f=!0,(!$||!E)&&!j&&k&&(L.get(k)?.selected||V()),E&&$&&k&&e?.(k);const Y=At(z.sourceEvent,{transform:S,snapGrid:A,snapToGrid:_,containerBounds:h});if(a=Y,l=lf(L,M,Y,k),l.size>0&&(s||O||!k&&F)){const[Z,ee]=Un({nodeId:k,dragItems:l,nodeLookup:L});s?.(z.sourceEvent,l,Z,ee),O?.(z.sourceEvent,Z,ee),k||F?.(z.sourceEvent,ee)}}const C=Ro().clickDistance(I).on("start",z=>{const{domNode:L,nodeDragThreshold:j,transform:M,snapGrid:S,snapToGrid:A}=t();h=L?.getBoundingClientRect()||null,m=!1,p=!1,b=z.sourceEvent,j===0&&R(z),a=At(z.sourceEvent,{transform:M,snapGrid:S,snapToGrid:A,containerBounds:h}),d=ze(z.sourceEvent,h)}).on("drag",z=>{const{autoPanOnNodeDrag:L,transform:j,snapGrid:M,snapToGrid:S,nodeDragThreshold:A,nodeLookup:_}=t(),$=At(z.sourceEvent,{transform:j,snapGrid:M,snapToGrid:S,containerBounds:h});if(b=z.sourceEvent,(z.sourceEvent.type==="touchmove"&&z.sourceEvent.touches.length>1||k&&!_.has(k))&&(m=!0),!m){if(!c&&L&&f&&(c=!0,P()),!f){const O=ze(z.sourceEvent,h),F=O.x-d.x,V=O.y-d.y;Math.sqrt(F*F+V*V)>A&&R(z)}(a.x!==$.xSnapped||a.y!==$.ySnapped)&&l&&f&&(d=ze(z.sourceEvent,h),T($))}}).on("end",z=>{if(!(!f||m)&&(c=!1,f=!1,cancelAnimationFrame(i),l.size>0)){const{nodeLookup:L,updateNodePositions:j,onNodeDragStop:M,onSelectionDragStop:S}=t();if(p&&(j(l,!1),p=!1),o||M||!k&&S){const[A,_]=Un({nodeId:k,dragItems:l,nodeLookup:L,dragging:!1});o?.(z.sourceEvent,l,A,_),M?.(z.sourceEvent,A,_),k||S?.(z.sourceEvent,_)}}}).filter(z=>{const L=z.target;return!z.button&&(!N||!Ir(L,`.${N}`,w))&&(!x||Ir(L,x,w))});u.call(C)}function v(){u?.on(".drag",null)}return{update:g,destroy:v}}function uf(e,t,s){const r=[],o={x:e.x-s,y:e.y-s,width:s*2,height:s*2};for(const a of t.values())Bt(o,jt(a))>0&&r.push(a);return r}const hf=250;function ff(e,t,s,r){let o=[],a=1/0;const i=uf(e,s,t+hf);for(const l of i){const c=[...l.internals.handleBounds?.source??[],...l.internals.handleBounds?.target??[]];for(const d of c){if(r.nodeId===d.nodeId&&r.type===d.type&&r.id===d.id)continue;const{x:h,y:f}=dt(l,d,d.position,!0),u=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(f-e.y,2));u>t||(u<a?(o=[{...d,x:h,y:f}],a=u):u===a&&o.push({...d,x:h,y:f}))}}if(!o.length)return null;if(o.length>1){const l=r.type==="source"?"target":"source";return o.find(c=>c.type===l)??o[0]}return o[0]}function wi(e,t,s,r,o,a=!1){const i=r.get(e);if(!i)return null;const l=o==="strict"?i.internals.handleBounds?.[t]:[...i.internals.handleBounds?.source??[],...i.internals.handleBounds?.target??[]],c=(s?l?.find(d=>d.id===s):l?.[0])??null;return c&&a?{...c,...dt(i,c,c.position,!0)}:c}function ji(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function mf(e,t){let s=null;return t?s=!0:e&&!t&&(s=!1),s}const Ni=()=>!0;function pf(e,{connectionMode:t,connectionRadius:s,handleId:r,nodeId:o,edgeUpdaterType:a,isTarget:i,domNode:l,nodeLookup:c,lib:d,autoPanOnConnect:h,flowId:f,panBy:u,cancelConnection:m,onConnectStart:p,onConnect:b,onConnectEnd:g,isValidConnection:v=Ni,onReconnectEnd:N,updateConnection:x,getTransform:w,getFromHandle:E,autoPanSpeed:k,dragThreshold:I=1,handleDomNode:T}){const P=di(e.target);let R=0,C;const{x:z,y:L}=ze(e),j=ji(a,T),M=l?.getBoundingClientRect();let S=!1;if(!M||!j)return;const A=wi(o,j,r,c,t);if(!A)return;let _=ze(e,M),$=!1,O=null,F=!1,V=null;function Y(){if(!h||!M)return;const[se,J]=ii(_,M,k);u({x:se,y:J}),R=requestAnimationFrame(Y)}const Z={...A,nodeId:o,type:j,position:A.position},ee=c.get(o);let B={inProgress:!0,isValid:null,from:dt(ee,Z,te.Left,!0),fromHandle:Z,fromPosition:Z.position,fromNode:ee,to:_,toHandle:null,toPosition:gr[Z.position],toNode:null,pointer:_};function D(){S=!0,x(B),p?.(e,{nodeId:o,handleId:r,handleType:j})}I===0&&D();function X(se){if(!S){const{x:ue,y:Se}=ze(se),_e=ue-z,we=Se-L;if(!(_e*_e+we*we>I*I))return;D()}if(!E()||!Z){W(se);return}const J=w();_=ze(se,M),C=ff(Wt(_,J,!1,[1,1]),s,c,Z),$||(Y(),$=!0);const ne=ki(se,{handle:C,connectionMode:t,fromNodeId:o,fromHandleId:r,fromType:i?"target":"source",isValidConnection:v,doc:P,lib:d,flowId:f,nodeLookup:c});V=ne.handleDomNode,O=ne.connection,F=mf(!!C,ne.isValid);const ie=c.get(o),le=ie?dt(ie,Z,te.Left,!0):B.from,ce={...B,from:le,isValid:F,to:ne.toHandle&&F?Sn({x:ne.toHandle.x,y:ne.toHandle.y},J):_,toHandle:ne.toHandle,toPosition:F&&ne.toHandle?ne.toHandle.position:gr[Z.position],toNode:ne.toHandle?c.get(ne.toHandle.nodeId):null,pointer:_};x(ce),B=ce}function W(se){if(!("touches"in se&&se.touches.length>0)){if(S){(C||V)&&O&&F&&b?.(O);const{inProgress:J,...ne}=B,ie={...ne,toPosition:B.toHandle?B.toPosition:null};g?.(se,ie),a&&N?.(se,ie)}m(),cancelAnimationFrame(R),$=!1,F=!1,O=null,V=null,P.removeEventListener("mousemove",X),P.removeEventListener("mouseup",W),P.removeEventListener("touchmove",X),P.removeEventListener("touchend",W)}}P.addEventListener("mousemove",X),P.addEventListener("mouseup",W),P.addEventListener("touchmove",X),P.addEventListener("touchend",W)}function ki(e,{handle:t,connectionMode:s,fromNodeId:r,fromHandleId:o,fromType:a,doc:i,lib:l,flowId:c,isValidConnection:d=Ni,nodeLookup:h}){const f=a==="target",u=t?i.querySelector(`.${l}-flow__handle[data-id="${c}-${t?.nodeId}-${t?.id}-${t?.type}"]`):null,{x:m,y:p}=ze(e),b=i.elementFromPoint(m,p),g=b?.classList.contains(`${l}-flow__handle`)?b:u,v={handleDomNode:g,isValid:!1,connection:null,toHandle:null};if(g){const N=ji(void 0,g),x=g.getAttribute("data-nodeid"),w=g.getAttribute("data-handleid"),E=g.classList.contains("connectable"),k=g.classList.contains("connectableend");if(!x||!N)return v;const I={source:f?x:r,sourceHandle:f?w:o,target:f?r:x,targetHandle:f?o:w};v.connection=I;const P=E&&k&&(s===yt.Strict?f&&N==="source"||!f&&N==="target":x!==r||w!==o);v.isValid=P&&d(I),v.toHandle=wi(x,N,w,h,s,!0)}return v}const ws={onPointerDown:pf,isValid:ki};function xf({domNode:e,panZoom:t,getTransform:s,getViewScale:r}){const o=Ee(e);function a({translateExtent:l,width:c,height:d,zoomStep:h=1,pannable:f=!0,zoomable:u=!0,inversePan:m=!1}){const p=x=>{if(x.sourceEvent.type!=="wheel"||!t)return;const w=s(),E=x.sourceEvent.ctrlKey&&Ht()?10:1,k=-x.sourceEvent.deltaY*(x.sourceEvent.deltaMode===1?.05:x.sourceEvent.deltaMode?1:.002)*h,I=w[2]*Math.pow(2,k*E);t.scaleTo(I)};let b=[0,0];const g=x=>{(x.sourceEvent.type==="mousedown"||x.sourceEvent.type==="touchstart")&&(b=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY])},v=x=>{const w=s();if(x.sourceEvent.type!=="mousemove"&&x.sourceEvent.type!=="touchmove"||!t)return;const E=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY],k=[E[0]-b[0],E[1]-b[1]];b=E;const I=r()*Math.max(w[2],Math.log(w[2]))*(m?-1:1),T={x:w[0]-k[0]*I,y:w[1]-k[1]*I},P=[[0,0],[c,d]];t.setViewportConstrained({x:T.x,y:T.y,zoom:w[2]},P,l)},N=Qo().on("start",g).on("zoom",f?v:null).on("zoom.wheel",u?p:null);o.call(N,{})}function i(){o.on("zoom",null)}return{update:a,destroy:i,pointer:$e}}const Bn=e=>({x:e.x,y:e.y,zoom:e.k}),Jn=({x:e,y:t,zoom:s})=>zn.translate(e,t).scale(s),ft=(e,t)=>e.target.closest(`.${t}`),Ci=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),gf=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Qn=(e,t=0,s=gf,r=()=>{})=>{const o=typeof t=="number"&&t>0;return o||r(),o?e.transition().duration(t).ease(s).on("end",r):e},Si=e=>{const t=e.ctrlKey&&Ht()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function bf({zoomPanValues:e,noWheelClassName:t,d3Selection:s,d3Zoom:r,panOnScrollMode:o,panOnScrollSpeed:a,zoomOnPinch:i,onPanZoomStart:l,onPanZoom:c,onPanZoomEnd:d}){return h=>{if(ft(h,t))return h.ctrlKey&&h.preventDefault(),!1;h.preventDefault(),h.stopImmediatePropagation();const f=s.property("__zoom").k||1;if(h.ctrlKey&&i){const g=$e(h),v=Si(h),N=f*Math.pow(2,v);r.scaleTo(s,N,g,h);return}const u=h.deltaMode===1?20:1;let m=o===it.Vertical?0:h.deltaX*u,p=o===it.Horizontal?0:h.deltaY*u;!Ht()&&h.shiftKey&&o!==it.Vertical&&(m=h.deltaY*u,p=0),r.translateBy(s,-(m/f)*a,-(p/f)*a,{internal:!0});const b=Bn(s.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(c?.(h,b),e.panScrollTimeout=setTimeout(()=>{d?.(h,b),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,l?.(h,b))}}function yf({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:s}){return function(r,o){const a=r.type==="wheel",i=!t&&a&&!r.ctrlKey,l=ft(r,e);if(r.ctrlKey&&a&&l&&r.preventDefault(),i||l)return null;r.preventDefault(),s.call(this,r,o)}}function vf({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:s}){return r=>{if(r.sourceEvent?.internal)return;const o=Bn(r.transform);e.mouseButton=r.sourceEvent?.button||0,e.isZoomingOrPanning=!0,e.prevViewport=o,r.sourceEvent?.type==="mousedown"&&t(!0),s&&s?.(r.sourceEvent,o)}}function wf({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:s,onTransformChange:r,onPanZoom:o}){return a=>{e.usedRightMouseButton=!!(s&&Ci(t,e.mouseButton??0)),a.sourceEvent?.sync||r([a.transform.x,a.transform.y,a.transform.k]),o&&!a.sourceEvent?.internal&&o?.(a.sourceEvent,Bn(a.transform))}}function jf({zoomPanValues:e,panOnDrag:t,panOnScroll:s,onDraggingChange:r,onPanZoomEnd:o,onPaneContextMenu:a}){return i=>{if(!i.sourceEvent?.internal&&(e.isZoomingOrPanning=!1,a&&Ci(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&a(i.sourceEvent),e.usedRightMouseButton=!1,r(!1),o)){const l=Bn(i.transform);e.prevViewport=l,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o?.(i.sourceEvent,l)},s?150:0)}}}function Nf({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:s,panOnDrag:r,panOnScroll:o,zoomOnDoubleClick:a,userSelectionActive:i,noWheelClassName:l,noPanClassName:c,lib:d,connectionInProgress:h}){return f=>{const u=e||t,m=s&&f.ctrlKey,p=f.type==="wheel";if(f.button===1&&f.type==="mousedown"&&(ft(f,`${d}-flow__node`)||ft(f,`${d}-flow__edge`)))return!0;if(!r&&!u&&!o&&!a&&!s||i||h&&!p||ft(f,l)&&p||ft(f,c)&&(!p||o&&p&&!e)||!s&&f.ctrlKey&&p)return!1;if(!s&&f.type==="touchstart"&&f.touches?.length>1)return f.preventDefault(),!1;if(!u&&!o&&!m&&p||!r&&(f.type==="mousedown"||f.type==="touchstart")||Array.isArray(r)&&!r.includes(f.button)&&f.type==="mousedown")return!1;const b=Array.isArray(r)&&r.includes(f.button)||!f.button||f.button<=1;return(!f.ctrlKey||p)&&b}}function kf({domNode:e,minZoom:t,maxZoom:s,translateExtent:r,viewport:o,onPanZoom:a,onPanZoomStart:i,onPanZoomEnd:l,onDraggingChange:c}){const d={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},h=e.getBoundingClientRect(),f=Qo().scaleExtent([t,s]).translateExtent(r),u=Ee(e).call(f);N({x:o.x,y:o.y,zoom:wt(o.zoom,t,s)},[[0,0],[h.width,h.height]],r);const m=u.on("wheel.zoom"),p=u.on("dblclick.zoom");f.wheelDelta(Si);function b(C,z){return u?new Promise(L=>{f?.interpolate(z?.interpolate==="linear"?Mt:hn).transform(Qn(u,z?.duration,z?.ease,()=>L(!0)),C)}):Promise.resolve(!1)}function g({noWheelClassName:C,noPanClassName:z,onPaneContextMenu:L,userSelectionActive:j,panOnScroll:M,panOnDrag:S,panOnScrollMode:A,panOnScrollSpeed:_,preventScrolling:$,zoomOnPinch:O,zoomOnScroll:F,zoomOnDoubleClick:V,zoomActivationKeyPressed:Y,lib:Z,onTransformChange:ee,connectionInProgress:Q,paneClickDistance:B,selectionOnDrag:D}){j&&!d.isZoomingOrPanning&&v();const X=M&&!Y&&!j;f.clickDistance(D?1/0:!De(B)||B<0?0:B);const W=X?bf({zoomPanValues:d,noWheelClassName:C,d3Selection:u,d3Zoom:f,panOnScrollMode:A,panOnScrollSpeed:_,zoomOnPinch:O,onPanZoomStart:i,onPanZoom:a,onPanZoomEnd:l}):yf({noWheelClassName:C,preventScrolling:$,d3ZoomHandler:m});if(u.on("wheel.zoom",W,{passive:!1}),!j){const J=vf({zoomPanValues:d,onDraggingChange:c,onPanZoomStart:i});f.on("start",J);const ne=wf({zoomPanValues:d,panOnDrag:S,onPaneContextMenu:!!L,onPanZoom:a,onTransformChange:ee});f.on("zoom",ne);const ie=jf({zoomPanValues:d,panOnDrag:S,panOnScroll:M,onPaneContextMenu:L,onPanZoomEnd:l,onDraggingChange:c});f.on("end",ie)}const se=Nf({zoomActivationKeyPressed:Y,panOnDrag:S,zoomOnScroll:F,panOnScroll:M,zoomOnDoubleClick:V,zoomOnPinch:O,userSelectionActive:j,noPanClassName:z,noWheelClassName:C,lib:Z,connectionInProgress:Q});f.filter(se),V?u.on("dblclick.zoom",p):u.on("dblclick.zoom",null)}function v(){f.on("zoom",null)}async function N(C,z,L){const j=Jn(C),M=f?.constrain()(j,z,L);return M&&await b(M),new Promise(S=>S(M))}async function x(C,z){const L=Jn(C);return await b(L,z),new Promise(j=>j(L))}function w(C){if(u){const z=Jn(C),L=u.property("__zoom");(L.k!==C.zoom||L.x!==C.x||L.y!==C.y)&&f?.transform(u,z,null,{sync:!0})}}function E(){const C=u?Jo(u.node()):{x:0,y:0,k:1};return{x:C.x,y:C.y,zoom:C.k}}function k(C,z){return u?new Promise(L=>{f?.interpolate(z?.interpolate==="linear"?Mt:hn).scaleTo(Qn(u,z?.duration,z?.ease,()=>L(!0)),C)}):Promise.resolve(!1)}function I(C,z){return u?new Promise(L=>{f?.interpolate(z?.interpolate==="linear"?Mt:hn).scaleBy(Qn(u,z?.duration,z?.ease,()=>L(!0)),C)}):Promise.resolve(!1)}function T(C){f?.scaleExtent(C)}function P(C){f?.translateExtent(C)}function R(C){const z=!De(C)||C<0?0:C;f?.clickDistance(z)}return{update:g,destroy:v,setViewport:x,setViewportConstrained:N,getViewport:E,scaleTo:k,scaleBy:I,setScaleExtent:T,setTranslateExtent:P,syncViewport:w,setClickDistance:R}}var kt;(function(e){e.Line="line",e.Handle="handle"})(kt||(kt={}));function Cf({width:e,prevWidth:t,height:s,prevHeight:r,affectsX:o,affectsY:a}){const i=e-t,l=s-r,c=[i>0?1:i<0?-1:0,l>0?1:l<0?-1:0];return i&&o&&(c[0]=c[0]*-1),l&&a&&(c[1]=c[1]*-1),c}function Mr(e){const t=e.includes("right")||e.includes("left"),s=e.includes("bottom")||e.includes("top"),r=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:s,affectsX:r,affectsY:o}}function Ue(e,t){return Math.max(0,t-e)}function Je(e,t){return Math.max(0,e-t)}function on(e,t,s){return Math.max(0,t-e,e-s)}function Ar(e,t){return e?!t:t}function Sf(e,t,s,r,o,a,i,l){let{affectsX:c,affectsY:d}=t;const{isHorizontal:h,isVertical:f}=t,u=h&&f,{xSnapped:m,ySnapped:p}=s,{minWidth:b,maxWidth:g,minHeight:v,maxHeight:N}=r,{x,y:w,width:E,height:k,aspectRatio:I}=e;let T=Math.floor(h?m-e.pointerX:0),P=Math.floor(f?p-e.pointerY:0);const R=E+(c?-T:T),C=k+(d?-P:P),z=-a[0]*E,L=-a[1]*k;let j=on(R,b,g),M=on(C,v,N);if(i){let _=0,$=0;c&&T<0?_=Ue(x+T+z,i[0][0]):!c&&T>0&&(_=Je(x+R+z,i[1][0])),d&&P<0?$=Ue(w+P+L,i[0][1]):!d&&P>0&&($=Je(w+C+L,i[1][1])),j=Math.max(j,_),M=Math.max(M,$)}if(l){let _=0,$=0;c&&T>0?_=Je(x+T,l[0][0]):!c&&T<0&&(_=Ue(x+R,l[1][0])),d&&P>0?$=Je(w+P,l[0][1]):!d&&P<0&&($=Ue(w+C,l[1][1])),j=Math.max(j,_),M=Math.max(M,$)}if(o){if(h){const _=on(R/I,v,N)*I;if(j=Math.max(j,_),i){let $=0;!c&&!d||c&&!d&&u?$=Je(w+L+R/I,i[1][1])*I:$=Ue(w+L+(c?T:-T)/I,i[0][1])*I,j=Math.max(j,$)}if(l){let $=0;!c&&!d||c&&!d&&u?$=Ue(w+R/I,l[1][1])*I:$=Je(w+(c?T:-T)/I,l[0][1])*I,j=Math.max(j,$)}}if(f){const _=on(C*I,b,g)/I;if(M=Math.max(M,_),i){let $=0;!c&&!d||d&&!c&&u?$=Je(x+C*I+z,i[1][0])/I:$=Ue(x+(d?P:-P)*I+z,i[0][0])/I,M=Math.max(M,$)}if(l){let $=0;!c&&!d||d&&!c&&u?$=Ue(x+C*I,l[1][0])/I:$=Je(x+(d?P:-P)*I,l[0][0])/I,M=Math.max(M,$)}}}P=P+(P<0?M:-M),T=T+(T<0?j:-j),o&&(u?R>C*I?P=(Ar(c,d)?-T:T)/I:T=(Ar(c,d)?-P:P)*I:h?(P=T/I,d=c):(T=P*I,c=d));const S=c?x+T:x,A=d?w+P:w;return{width:E+(c?-T:T),height:k+(d?-P:P),x:a[0]*T*(c?-1:1)+S,y:a[1]*P*(d?-1:1)+A}}const _i={width:0,height:0,x:0,y:0},_f={..._i,pointerX:0,pointerY:0,aspectRatio:1};function Ef(e){return[[0,0],[e.measured.width,e.measured.height]]}function If(e,t,s){const r=t.position.x+e.position.x,o=t.position.y+e.position.y,a=e.measured.width??0,i=e.measured.height??0,l=s[0]*a,c=s[1]*i;return[[r-l,o-c],[r+a-l,o+i-c]]}function Mf({domNode:e,nodeId:t,getStoreItems:s,onChange:r,onEnd:o}){const a=Ee(e);let i={controlDirection:Mr("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function l({controlPosition:d,boundaries:h,keepAspectRatio:f,resizeDirection:u,onResizeStart:m,onResize:p,onResizeEnd:b,shouldResize:g}){let v={..._i},N={..._f};i={boundaries:h,resizeDirection:u,keepAspectRatio:f,controlDirection:Mr(d)};let x,w=null,E=[],k,I,T,P=!1;const R=Ro().on("start",C=>{const{nodeLookup:z,transform:L,snapGrid:j,snapToGrid:M,nodeOrigin:S,paneDomNode:A}=s();if(x=z.get(t),!x)return;w=A?.getBoundingClientRect()??null;const{xSnapped:_,ySnapped:$}=At(C.sourceEvent,{transform:L,snapGrid:j,snapToGrid:M,containerBounds:w});v={width:x.measured.width??0,height:x.measured.height??0,x:x.position.x??0,y:x.position.y??0},N={...v,pointerX:_,pointerY:$,aspectRatio:v.width/v.height},k=void 0,x.parentId&&(x.extent==="parent"||x.expandParent)&&(k=z.get(x.parentId),I=k&&x.extent==="parent"?Ef(k):void 0),E=[],T=void 0;for(const[O,F]of z)if(F.parentId===t&&(E.push({id:O,position:{...F.position},extent:F.extent}),F.extent==="parent"||F.expandParent)){const V=If(F,x,F.origin??S);T?T=[[Math.min(V[0][0],T[0][0]),Math.min(V[0][1],T[0][1])],[Math.max(V[1][0],T[1][0]),Math.max(V[1][1],T[1][1])]]:T=V}m?.(C,{...v})}).on("drag",C=>{const{transform:z,snapGrid:L,snapToGrid:j,nodeOrigin:M}=s(),S=At(C.sourceEvent,{transform:z,snapGrid:L,snapToGrid:j,containerBounds:w}),A=[];if(!x)return;const{x:_,y:$,width:O,height:F}=v,V={},Y=x.origin??M,{width:Z,height:ee,x:Q,y:B}=Sf(N,i.controlDirection,S,i.boundaries,i.keepAspectRatio,Y,I,T),D=Z!==O,X=ee!==F,W=Q!==_&&D,se=B!==$&&X;if(!W&&!se&&!D&&!X)return;if((W||se||Y[0]===1||Y[1]===1)&&(V.x=W?Q:v.x,V.y=se?B:v.y,v.x=V.x,v.y=V.y,E.length>0)){const le=Q-_,ce=B-$;for(const ue of E)ue.position={x:ue.position.x-le+Y[0]*(Z-O),y:ue.position.y-ce+Y[1]*(ee-F)},A.push(ue)}if((D||X)&&(V.width=D&&(!i.resizeDirection||i.resizeDirection==="horizontal")?Z:v.width,V.height=X&&(!i.resizeDirection||i.resizeDirection==="vertical")?ee:v.height,v.width=V.width,v.height=V.height),k&&x.expandParent){const le=Y[0]*(V.width??0);V.x&&V.x<le&&(v.x=le,N.x=N.x-(V.x-le));const ce=Y[1]*(V.height??0);V.y&&V.y<ce&&(v.y=ce,N.y=N.y-(V.y-ce))}const J=Cf({width:v.width,prevWidth:O,height:v.height,prevHeight:F,affectsX:i.controlDirection.affectsX,affectsY:i.controlDirection.affectsY}),ne={...v,direction:J};g?.(C,ne)!==!1&&(P=!0,p?.(C,ne),r(V,A))}).on("end",C=>{P&&(b?.(C,{...v}),o?.({...v}),P=!1)});a.call(R)}function c(){a.on(".drag",null)}return{update:l,destroy:c}}var Kn={exports:{}},es={},ts={exports:{}},ns={};var Tr;function Af(){if(Tr)return ns;Tr=1;var e=fo();function t(f,u){return f===u&&(f!==0||1/f===1/u)||f!==f&&u!==u}var s=typeof Object.is=="function"?Object.is:t,r=e.useState,o=e.useEffect,a=e.useLayoutEffect,i=e.useDebugValue;function l(f,u){var m=u(),p=r({inst:{value:m,getSnapshot:u}}),b=p[0].inst,g=p[1];return a(function(){b.value=m,b.getSnapshot=u,c(b)&&g({inst:b})},[f,m,u]),o(function(){return c(b)&&g({inst:b}),f(function(){c(b)&&g({inst:b})})},[f]),i(m),m}function c(f){var u=f.getSnapshot;f=f.value;try{var m=u();return!s(f,m)}catch{return!0}}function d(f,u){return u()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return ns.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:h,ns}var $r;function Tf(){return $r||($r=1,ts.exports=Af()),ts.exports}var Pr;function $f(){if(Pr)return es;Pr=1;var e=fo(),t=Tf();function s(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var r=typeof Object.is=="function"?Object.is:s,o=t.useSyncExternalStore,a=e.useRef,i=e.useEffect,l=e.useMemo,c=e.useDebugValue;return es.useSyncExternalStoreWithSelector=function(d,h,f,u,m){var p=a(null);if(p.current===null){var b={hasValue:!1,value:null};p.current=b}else b=p.current;p=l(function(){function v(k){if(!N){if(N=!0,x=k,k=u(k),m!==void 0&&b.hasValue){var I=b.value;if(m(I,k))return w=I}return w=k}if(I=w,r(x,k))return I;var T=u(k);return m!==void 0&&m(I,T)?(x=k,I):(x=k,w=T)}var N=!1,x,w,E=f===void 0?null:f;return[function(){return v(h())},E===null?void 0:function(){return v(E())}]},[h,f,u,m]);var g=o(d,p[0],p[1]);return i(function(){b.hasValue=!0,b.value=g},[g]),c(g),g},es}var Dr;function Pf(){return Dr||(Dr=1,Kn.exports=$f()),Kn.exports}var Df=Pf();const zf=il(Df),Rf={},zr=e=>{let t;const s=new Set,r=(h,f)=>{const u=typeof h=="function"?h(t):h;if(!Object.is(u,t)){const m=t;t=f??(typeof u!="object"||u===null)?u:Object.assign({},t,u),s.forEach(p=>p(t,m))}},o=()=>t,c={setState:r,getState:o,getInitialState:()=>d,subscribe:h=>(s.add(h),()=>s.delete(h)),destroy:()=>{(Rf?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},d=t=e(r,o,c);return c},Lf=e=>e?zr(e):zr,{useDebugValue:Bf}=al,{useSyncExternalStoreWithSelector:Hf}=zf,Of=e=>e;function Ei(e,t=Of,s){const r=Hf(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return Bf(r),r}const Rr=(e,t)=>{const s=Lf(e),r=(o,a=t)=>Ei(s,o,a);return Object.assign(r,s),r},Vf=(e,t)=>e?Rr(e,t):Rr;function he(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!1;for(const r of s)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}const Hn=y.createContext(null),Ff=Hn.Provider,Ii=Oe.error001();function ae(e,t){const s=y.useContext(Hn);if(s===null)throw new Error(Ii);return Ei(s,e,t)}function fe(){const e=y.useContext(Hn);if(e===null)throw new Error(Ii);return y.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Lr={display:"none"},Gf={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Mi="react-flow__node-desc",Ai="react-flow__edge-desc",qf="react-flow__aria-live",Yf=e=>e.ariaLiveMessage,Zf=e=>e.ariaLabelConfig;function Xf({rfId:e}){const t=ae(Yf);return n.jsx("div",{id:`${qf}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Gf,children:t})}function Wf({rfId:e,disableKeyboardA11y:t}){const s=ae(Zf);return n.jsxs(n.Fragment,{children:[n.jsx("div",{id:`${Mi}-${e}`,style:Lr,children:t?s["node.a11yDescription.default"]:s["node.a11yDescription.keyboardDisabled"]}),n.jsx("div",{id:`${Ai}-${e}`,style:Lr,children:s["edge.a11yDescription.default"]}),!t&&n.jsx(Xf,{rfId:e})]})}const Ut=y.forwardRef(({position:e="top-left",children:t,className:s,style:r,...o},a)=>{const i=`${e}`.split("-");return n.jsx("div",{className:xe(["react-flow__panel",s,...i]),style:r,ref:a,...o,children:t})});Ut.displayName="Panel";function Uf({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:n.jsx(Ut,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:n.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Jf=e=>{const t=[],s=[];for(const[,r]of e.nodeLookup)r.selected&&t.push(r.internals.userNode);for(const[,r]of e.edgeLookup)r.selected&&s.push(r);return{selectedNodes:t,selectedEdges:s}},an=e=>e.id;function Qf(e,t){return he(e.selectedNodes.map(an),t.selectedNodes.map(an))&&he(e.selectedEdges.map(an),t.selectedEdges.map(an))}function Kf({onSelectionChange:e}){const t=fe(),{selectedNodes:s,selectedEdges:r}=ae(Jf,Qf);return y.useEffect(()=>{const o={nodes:s,edges:r};e?.(o),t.getState().onSelectionChangeHandlers.forEach(a=>a(o))},[s,r,e]),null}const e0=e=>!!e.onSelectionChangeHandlers;function t0({onSelectionChange:e}){const t=ae(e0);return e||t?n.jsx(Kf,{onSelectionChange:e}):null}const Ti=[0,0],n0={x:0,y:0,zoom:1},s0=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],Br=[...s0,"rfId"],r0=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),Hr={translateExtent:Rt,nodeOrigin:Ti,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function o0(e){const{setNodes:t,setEdges:s,setMinZoom:r,setMaxZoom:o,setTranslateExtent:a,setNodeExtent:i,reset:l,setDefaultNodesAndEdges:c}=ae(r0,he),d=fe();y.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{h.current=Hr,l()}),[]);const h=y.useRef(Hr);return y.useEffect(()=>{for(const f of Br){const u=e[f],m=h.current[f];u!==m&&(typeof e[f]>"u"||(f==="nodes"?t(u):f==="edges"?s(u):f==="minZoom"?r(u):f==="maxZoom"?o(u):f==="translateExtent"?a(u):f==="nodeExtent"?i(u):f==="ariaLabelConfig"?d.setState({ariaLabelConfig:Oh(u)}):f==="fitView"?d.setState({fitViewQueued:u}):f==="fitViewOptions"?d.setState({fitViewOptions:u}):d.setState({[f]:u})))}h.current=e},Br.map(f=>e[f])),null}function Or(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function i0(e){const[t,s]=y.useState(e==="system"?null:e);return y.useEffect(()=>{if(e!=="system"){s(e);return}const r=Or(),o=()=>s(r?.matches?"dark":"light");return o(),r?.addEventListener("change",o),()=>{r?.removeEventListener("change",o)}},[e]),t!==null?t:Or()?.matches?"dark":"light"}const Vr=typeof document<"u"?document:null;function Ot(e=null,t={target:Vr,actInsideInputWithModifier:!0}){const[s,r]=y.useState(!1),o=y.useRef(!1),a=y.useRef(new Set([])),[i,l]=y.useMemo(()=>{if(e!==null){const d=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),h=d.reduce((f,u)=>f.concat(...u),[]);return[d,h]}return[[],[]]},[e]);return y.useEffect(()=>{const c=t?.target??Vr,d=t?.actInsideInputWithModifier??!0;if(e!==null){const h=m=>{if(o.current=m.ctrlKey||m.metaKey||m.shiftKey||m.altKey,(!o.current||o.current&&!d)&&ui(m))return!1;const b=Gr(m.code,l);if(a.current.add(m[b]),Fr(i,a.current,!1)){const g=m.composedPath?.()?.[0]||m.target,v=g?.nodeName==="BUTTON"||g?.nodeName==="A";t.preventDefault!==!1&&(o.current||!v)&&m.preventDefault(),r(!0)}},f=m=>{const p=Gr(m.code,l);Fr(i,a.current,!0)?(r(!1),a.current.clear()):a.current.delete(m[p]),m.key==="Meta"&&a.current.clear(),o.current=!1},u=()=>{a.current.clear(),r(!1)};return c?.addEventListener("keydown",h),c?.addEventListener("keyup",f),window.addEventListener("blur",u),window.addEventListener("contextmenu",u),()=>{c?.removeEventListener("keydown",h),c?.removeEventListener("keyup",f),window.removeEventListener("blur",u),window.removeEventListener("contextmenu",u)}}},[e,r]),s}function Fr(e,t,s){return e.filter(r=>s||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function Gr(e,t){return t.includes(e)?"code":"key"}const a0=()=>{const e=fe();return y.useMemo(()=>({zoomIn:t=>{const{panZoom:s}=e.getState();return s?s.scaleBy(1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:s}=e.getState();return s?s.scaleBy(1/1.2,{duration:t?.duration}):Promise.resolve(!1)},zoomTo:(t,s)=>{const{panZoom:r}=e.getState();return r?r.scaleTo(t,{duration:s?.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,s)=>{const{transform:[r,o,a],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??r,y:t.y??o,zoom:t.zoom??a},s),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,s,r]=e.getState().transform;return{x:t,y:s,zoom:r}},setCenter:async(t,s,r)=>e.getState().setCenter(t,s,r),fitBounds:async(t,s)=>{const{width:r,height:o,minZoom:a,maxZoom:i,panZoom:l}=e.getState(),c=Ls(t,r,o,a,i,s?.padding??.1);return l?(await l.setViewport(c,{duration:s?.duration,ease:s?.ease,interpolate:s?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,s={})=>{const{transform:r,snapGrid:o,snapToGrid:a,domNode:i}=e.getState();if(!i)return t;const{x:l,y:c}=i.getBoundingClientRect(),d={x:t.x-l,y:t.y-c},h=s.snapGrid??o,f=s.snapToGrid??a;return Wt(d,r,f,h)},flowToScreenPosition:t=>{const{transform:s,domNode:r}=e.getState();if(!r)return t;const{x:o,y:a}=r.getBoundingClientRect(),i=Sn(t,s);return{x:i.x+o,y:i.y+a}}}),[])};function $i(e,t){const s=[],r=new Map,o=[];for(const a of e)if(a.type==="add"){o.push(a);continue}else if(a.type==="remove"||a.type==="replace")r.set(a.id,[a]);else{const i=r.get(a.id);i?i.push(a):r.set(a.id,[a])}for(const a of t){const i=r.get(a.id);if(!i){s.push(a);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){s.push({...i[0].item});continue}const l={...a};for(const c of i)l0(c,l);s.push(l)}return o.length&&o.forEach(a=>{a.index!==void 0?s.splice(a.index,0,{...a.item}):s.push({...a.item})}),s}function l0(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Pi(e,t){return $i(e,t)}function Di(e,t){return $i(e,t)}function st(e,t){return{id:e,type:"select",selected:t}}function mt(e,t=new Set,s=!1){const r=[];for(const[o,a]of e){const i=t.has(o);!(a.selected===void 0&&!i)&&a.selected!==i&&(s&&(a.selected=i),r.push(st(a.id,i)))}return r}function qr({items:e=[],lookup:t}){const s=[],r=new Map(e.map(o=>[o.id,o]));for(const[o,a]of e.entries()){const i=t.get(a.id),l=i?.internals?.userNode??i;l!==void 0&&l!==a&&s.push({id:a.id,item:a,type:"replace"}),l===void 0&&s.push({item:a,type:"add",index:o})}for(const[o]of t)r.get(o)===void 0&&s.push({id:o,type:"remove"});return s}function Yr(e){return{id:e.id,type:"remove"}}const Zr=e=>Ah(e),c0=e=>si(e);function zi(e){return y.forwardRef(e)}const d0=typeof window<"u"?y.useLayoutEffect:y.useEffect;function Xr(e){const[t,s]=y.useState(BigInt(0)),[r]=y.useState(()=>u0(()=>s(o=>o+BigInt(1))));return d0(()=>{const o=r.get();o.length&&(e(o),r.reset())},[t]),r}function u0(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:s=>{t.push(s),e()}}}const Ri=y.createContext(null);function h0({children:e}){const t=fe(),s=y.useCallback(l=>{const{nodes:c=[],setNodes:d,hasDefaultNodes:h,onNodesChange:f,nodeLookup:u,fitViewQueued:m,onNodesChangeMiddlewareMap:p}=t.getState();let b=c;for(const v of l)b=typeof v=="function"?v(b):v;let g=qr({items:b,lookup:u});for(const v of p.values())g=v(g);h&&d(b),g.length>0?f?.(g):m&&window.requestAnimationFrame(()=>{const{fitViewQueued:v,nodes:N,setNodes:x}=t.getState();v&&x(N)})},[]),r=Xr(s),o=y.useCallback(l=>{const{edges:c=[],setEdges:d,hasDefaultEdges:h,onEdgesChange:f,edgeLookup:u}=t.getState();let m=c;for(const p of l)m=typeof p=="function"?p(m):p;h?d(m):f&&f(qr({items:m,lookup:u}))},[]),a=Xr(o),i=y.useMemo(()=>({nodeQueue:r,edgeQueue:a}),[]);return n.jsx(Ri.Provider,{value:i,children:e})}function f0(){const e=y.useContext(Ri);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const m0=e=>!!e.panZoom;function On(){const e=a0(),t=fe(),s=f0(),r=ae(m0),o=y.useMemo(()=>{const a=f=>t.getState().nodeLookup.get(f),i=f=>{s.nodeQueue.push(f)},l=f=>{s.edgeQueue.push(f)},c=f=>{const{nodeLookup:u,nodeOrigin:m}=t.getState(),p=Zr(f)?f:u.get(f.id),b=p.parentId?ci(p.position,p.measured,p.parentId,u,m):p.position,g={...p,position:b,width:p.measured?.width??p.width,height:p.measured?.height??p.height};return jt(g)},d=(f,u,m={replace:!1})=>{i(p=>p.map(b=>{if(b.id===f){const g=typeof u=="function"?u(b):u;return m.replace&&Zr(g)?g:{...b,...g}}return b}))},h=(f,u,m={replace:!1})=>{l(p=>p.map(b=>{if(b.id===f){const g=typeof u=="function"?u(b):u;return m.replace&&c0(g)?g:{...b,...g}}return b}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>a(f)?.internals.userNode,getInternalNode:a,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(u=>({...u}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:i,setEdges:l,addNodes:f=>{const u=Array.isArray(f)?f:[f];s.nodeQueue.push(m=>[...m,...u])},addEdges:f=>{const u=Array.isArray(f)?f:[f];s.edgeQueue.push(m=>[...m,...u])},toObject:()=>{const{nodes:f=[],edges:u=[],transform:m}=t.getState(),[p,b,g]=m;return{nodes:f.map(v=>({...v})),edges:u.map(v=>({...v})),viewport:{x:p,y:b,zoom:g}}},deleteElements:async({nodes:f=[],edges:u=[]})=>{const{nodes:m,edges:p,onNodesDelete:b,onEdgesDelete:g,triggerNodeChanges:v,triggerEdgeChanges:N,onDelete:x,onBeforeDelete:w}=t.getState(),{nodes:E,edges:k}=await zh({nodesToRemove:f,edgesToRemove:u,nodes:m,edges:p,onBeforeDelete:w}),I=k.length>0,T=E.length>0;if(I){const P=k.map(Yr);g?.(k),N(P)}if(T){const P=E.map(Yr);b?.(E),v(P)}return(T||I)&&x?.({nodes:E,edges:k}),{deletedNodes:E,deletedEdges:k}},getIntersectingNodes:(f,u=!0,m)=>{const p=yr(f),b=p?f:c(f),g=m!==void 0;return b?(m||t.getState().nodes).filter(v=>{const N=t.getState().nodeLookup.get(v.id);if(N&&!p&&(v.id===f.id||!N.internals.positionAbsolute))return!1;const x=jt(g?v:N),w=Bt(x,b);return u&&w>0||w>=x.width*x.height||w>=b.width*b.height}):[]},isNodeIntersecting:(f,u,m=!0)=>{const b=yr(f)?f:c(f);if(!b)return!1;const g=Bt(b,u);return m&&g>0||g>=u.width*u.height||g>=b.width*b.height},updateNode:d,updateNodeData:(f,u,m={replace:!1})=>{d(f,p=>{const b=typeof u=="function"?u(p):u;return m.replace?{...p,data:b}:{...p,data:{...p.data,...b}}},m)},updateEdge:h,updateEdgeData:(f,u,m={replace:!1})=>{h(f,p=>{const b=typeof u=="function"?u(p):u;return m.replace?{...p,data:b}:{...p,data:{...p.data,...b}}},m)},getNodesBounds:f=>{const{nodeLookup:u,nodeOrigin:m}=t.getState();return Th(f,{nodeLookup:u,nodeOrigin:m})},getHandleConnections:({type:f,id:u,nodeId:m})=>Array.from(t.getState().connectionLookup.get(`${m}-${f}${u?`-${u}`:""}`)?.values()??[]),getNodeConnections:({type:f,handleId:u,nodeId:m})=>Array.from(t.getState().connectionLookup.get(`${m}${f?u?`-${f}-${u}`:`-${f}`:""}`)?.values()??[]),fitView:async f=>{const u=t.getState().fitViewResolver??Hh();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:u}),s.nodeQueue.push(m=>[...m]),u.promise}}},[]);return y.useMemo(()=>({...o,...e,viewportInitialized:r}),[r])}const Wr=e=>e.selected,p0=typeof window<"u"?window:void 0;function x0({deleteKeyCode:e,multiSelectionKeyCode:t}){const s=fe(),{deleteElements:r}=On(),o=Ot(e,{actInsideInputWithModifier:!1}),a=Ot(t,{target:p0});y.useEffect(()=>{if(o){const{edges:i,nodes:l}=s.getState();r({nodes:l.filter(Wr),edges:i.filter(Wr)}),s.setState({nodesSelectionActive:!1})}},[o]),y.useEffect(()=>{s.setState({multiSelectionActive:a})},[a])}function g0(e){const t=fe();y.useEffect(()=>{const s=()=>{if(!e.current||!(e.current.checkVisibility?.()??!0))return!1;const r=Bs(e.current);(r.height===0||r.width===0)&&t.getState().onError?.("004",Oe.error004()),t.setState({width:r.width||500,height:r.height||500})};if(e.current){s(),window.addEventListener("resize",s);const r=new ResizeObserver(()=>s());return r.observe(e.current),()=>{window.removeEventListener("resize",s),r&&e.current&&r.unobserve(e.current)}}},[])}const Vn={position:"absolute",width:"100%",height:"100%",top:0,left:0},b0=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function y0({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:s=!0,panOnScroll:r=!1,panOnScrollSpeed:o=.5,panOnScrollMode:a=it.Free,zoomOnDoubleClick:i=!0,panOnDrag:l=!0,defaultViewport:c,translateExtent:d,minZoom:h,maxZoom:f,zoomActivationKeyCode:u,preventScrolling:m=!0,children:p,noWheelClassName:b,noPanClassName:g,onViewportChange:v,isControlledViewport:N,paneClickDistance:x,selectionOnDrag:w}){const E=fe(),k=y.useRef(null),{userSelectionActive:I,lib:T,connectionInProgress:P}=ae(b0,he),R=Ot(u),C=y.useRef();g0(k);const z=y.useCallback(L=>{v?.({x:L[0],y:L[1],zoom:L[2]}),N||E.setState({transform:L})},[v,N]);return y.useEffect(()=>{if(k.current){C.current=kf({domNode:k.current,minZoom:h,maxZoom:f,translateExtent:d,viewport:c,onDraggingChange:S=>E.setState({paneDragging:S}),onPanZoomStart:(S,A)=>{const{onViewportChangeStart:_,onMoveStart:$}=E.getState();$?.(S,A),_?.(A)},onPanZoom:(S,A)=>{const{onViewportChange:_,onMove:$}=E.getState();$?.(S,A),_?.(A)},onPanZoomEnd:(S,A)=>{const{onViewportChangeEnd:_,onMoveEnd:$}=E.getState();$?.(S,A),_?.(A)}});const{x:L,y:j,zoom:M}=C.current.getViewport();return E.setState({panZoom:C.current,transform:[L,j,M],domNode:k.current.closest(".react-flow")}),()=>{C.current?.destroy()}}},[]),y.useEffect(()=>{C.current?.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:s,panOnScroll:r,panOnScrollSpeed:o,panOnScrollMode:a,zoomOnDoubleClick:i,panOnDrag:l,zoomActivationKeyPressed:R,preventScrolling:m,noPanClassName:g,userSelectionActive:I,noWheelClassName:b,lib:T,onTransformChange:z,connectionInProgress:P,selectionOnDrag:w,paneClickDistance:x})},[e,t,s,r,o,a,i,l,R,m,g,I,b,T,z,P,w,x]),n.jsx("div",{className:"react-flow__renderer",ref:k,style:Vn,children:p})}const v0=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function w0(){const{userSelectionActive:e,userSelectionRect:t}=ae(v0,he);return e&&t?n.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const ss=(e,t)=>s=>{s.target===t.current&&e?.(s)},j0=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function N0({isSelecting:e,selectionKeyPressed:t,selectionMode:s=Lt.Full,panOnDrag:r,paneClickDistance:o,selectionOnDrag:a,onSelectionStart:i,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:d,onPaneScroll:h,onPaneMouseEnter:f,onPaneMouseMove:u,onPaneMouseLeave:m,children:p}){const b=fe(),{userSelectionActive:g,elementsSelectable:v,dragging:N,connectionInProgress:x}=ae(j0,he),w=v&&(e||g),E=y.useRef(null),k=y.useRef(),I=y.useRef(new Set),T=y.useRef(new Set),P=y.useRef(!1),R=_=>{if(P.current||x){P.current=!1;return}c?.(_),b.getState().resetSelectedElements(),b.setState({nodesSelectionActive:!1})},C=_=>{if(Array.isArray(r)&&r?.includes(2)){_.preventDefault();return}d?.(_)},z=h?_=>h(_):void 0,L=_=>{P.current&&(_.stopPropagation(),P.current=!1)},j=_=>{const{domNode:$}=b.getState();if(k.current=$?.getBoundingClientRect(),!k.current)return;const O=_.target===E.current;if(!O&&!!_.target.closest(".nokey")||!e||!(a&&O||t)||_.button!==0||!_.isPrimary)return;_.target?.setPointerCapture?.(_.pointerId),P.current=!1;const{x:Y,y:Z}=ze(_.nativeEvent,k.current);b.setState({userSelectionRect:{width:0,height:0,startX:Y,startY:Z,x:Y,y:Z}}),O||(_.stopPropagation(),_.preventDefault())},M=_=>{const{userSelectionRect:$,transform:O,nodeLookup:F,edgeLookup:V,connectionLookup:Y,triggerNodeChanges:Z,triggerEdgeChanges:ee,defaultEdgeOptions:Q,resetSelectedElements:B}=b.getState();if(!k.current||!$)return;const{x:D,y:X}=ze(_.nativeEvent,k.current),{startX:W,startY:se}=$;if(!P.current){const ce=t?0:o;if(Math.hypot(D-W,X-se)<=ce)return;B(),i?.(_)}P.current=!0;const J={startX:W,startY:se,x:D<W?D:W,y:X<se?X:se,width:Math.abs(D-W),height:Math.abs(X-se)},ne=I.current,ie=T.current;I.current=new Set(Rs(F,J,O,s===Lt.Partial,!0).map(ce=>ce.id)),T.current=new Set;const le=Q?.selectable??!0;for(const ce of I.current){const ue=Y.get(ce);if(ue)for(const{edgeId:Se}of ue.values()){const _e=V.get(Se);_e&&(_e.selectable??le)&&T.current.add(Se)}}if(!vr(ne,I.current)){const ce=mt(F,I.current,!0);Z(ce)}if(!vr(ie,T.current)){const ce=mt(V,T.current);ee(ce)}b.setState({userSelectionRect:J,userSelectionActive:!0,nodesSelectionActive:!1})},S=_=>{_.button===0&&(_.target?.releasePointerCapture?.(_.pointerId),!g&&_.target===E.current&&b.getState().userSelectionRect&&R?.(_),b.setState({userSelectionActive:!1,userSelectionRect:null}),P.current&&(l?.(_),b.setState({nodesSelectionActive:I.current.size>0})))},A=r===!0||Array.isArray(r)&&r.includes(0);return n.jsxs("div",{className:xe(["react-flow__pane",{draggable:A,dragging:N,selection:e}]),onClick:w?void 0:ss(R,E),onContextMenu:ss(C,E),onWheel:ss(z,E),onPointerEnter:w?void 0:f,onPointerMove:w?M:u,onPointerUp:w?S:void 0,onPointerDownCapture:w?j:void 0,onClickCapture:w?L:void 0,onPointerLeave:m,ref:E,style:Vn,children:[p,n.jsx(w0,{})]})}function js({id:e,store:t,unselect:s=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:a,multiSelectionActive:i,nodeLookup:l,onError:c}=t.getState(),d=l.get(e);if(!d){c?.("012",Oe.error012(e));return}t.setState({nodesSelectionActive:!1}),d.selected?(s||d.selected&&i)&&(a({nodes:[d],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):o([e])}function Li({nodeRef:e,disabled:t=!1,noDragClassName:s,handleSelector:r,nodeId:o,isSelectable:a,nodeClickDistance:i}){const l=fe(),[c,d]=y.useState(!1),h=y.useRef();return y.useEffect(()=>{h.current=df({getStoreItems:()=>l.getState(),onNodeMouseDown:f=>{js({id:f,store:l,nodeRef:e})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),y.useEffect(()=>{if(t)h.current?.destroy();else if(e.current)return h.current?.update({noDragClassName:s,handleSelector:r,domNode:e.current,isSelectable:a,nodeId:o,nodeClickDistance:i}),()=>{h.current?.destroy()}},[s,r,t,a,e,o]),c}const k0=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Bi(){const e=fe();return y.useCallback(s=>{const{nodeExtent:r,snapToGrid:o,snapGrid:a,nodesDraggable:i,onError:l,updateNodePositions:c,nodeLookup:d,nodeOrigin:h}=e.getState(),f=new Map,u=k0(i),m=o?a[0]:5,p=o?a[1]:5,b=s.direction.x*m*s.factor,g=s.direction.y*p*s.factor;for(const[,v]of d){if(!u(v))continue;let N={x:v.internals.positionAbsolute.x+b,y:v.internals.positionAbsolute.y+g};o&&(N=Xt(N,a));const{position:x,positionAbsolute:w}=ri({nodeId:v.id,nextPosition:N,nodeLookup:d,nodeExtent:r,nodeOrigin:h,onError:l});v.position=x,v.internals.positionAbsolute=w,f.set(v.id,v)}c(f)},[])}const qs=y.createContext(null),C0=qs.Provider;qs.Consumer;const Hi=()=>y.useContext(qs),S0=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),_0=(e,t,s)=>r=>{const{connectionClickStartHandle:o,connectionMode:a,connection:i}=r,{fromHandle:l,toHandle:c,isValid:d}=i,h=c?.nodeId===e&&c?.id===t&&c?.type===s;return{connectingFrom:l?.nodeId===e&&l?.id===t&&l?.type===s,connectingTo:h,clickConnecting:o?.nodeId===e&&o?.id===t&&o?.type===s,isPossibleEndHandle:a===yt.Strict?l?.type!==s:e!==l?.nodeId||t!==l?.id,connectionInProcess:!!l,clickConnectionInProcess:!!o,valid:h&&d}};function E0({type:e="source",position:t=te.Top,isValidConnection:s,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:a=!0,id:i,onConnect:l,children:c,className:d,onMouseDown:h,onTouchStart:f,...u},m){const p=i||null,b=e==="target",g=fe(),v=Hi(),{connectOnClick:N,noPanClassName:x,rfId:w}=ae(S0,he),{connectingFrom:E,connectingTo:k,clickConnecting:I,isPossibleEndHandle:T,connectionInProcess:P,clickConnectionInProcess:R,valid:C}=ae(_0(v,p,e),he);v||g.getState().onError?.("010",Oe.error010());const z=M=>{const{defaultEdgeOptions:S,onConnect:A,hasDefaultEdges:_}=g.getState(),$={...S,...M};if(_){const{edges:O,setEdges:F}=g.getState();F(Zh($,O))}A?.($),l?.($)},L=M=>{if(!v)return;const S=hi(M.nativeEvent);if(o&&(S&&M.button===0||!S)){const A=g.getState();ws.onPointerDown(M.nativeEvent,{handleDomNode:M.currentTarget,autoPanOnConnect:A.autoPanOnConnect,connectionMode:A.connectionMode,connectionRadius:A.connectionRadius,domNode:A.domNode,nodeLookup:A.nodeLookup,lib:A.lib,isTarget:b,handleId:p,nodeId:v,flowId:A.rfId,panBy:A.panBy,cancelConnection:A.cancelConnection,onConnectStart:A.onConnectStart,onConnectEnd:A.onConnectEnd,updateConnection:A.updateConnection,onConnect:z,isValidConnection:s||A.isValidConnection,getTransform:()=>g.getState().transform,getFromHandle:()=>g.getState().connection.fromHandle,autoPanSpeed:A.autoPanSpeed,dragThreshold:A.connectionDragThreshold})}S?h?.(M):f?.(M)},j=M=>{const{onClickConnectStart:S,onClickConnectEnd:A,connectionClickStartHandle:_,connectionMode:$,isValidConnection:O,lib:F,rfId:V,nodeLookup:Y,connection:Z}=g.getState();if(!v||!_&&!o)return;if(!_){S?.(M.nativeEvent,{nodeId:v,handleId:p,handleType:e}),g.setState({connectionClickStartHandle:{nodeId:v,type:e,id:p}});return}const ee=di(M.target),Q=s||O,{connection:B,isValid:D}=ws.isValid(M.nativeEvent,{handle:{nodeId:v,id:p,type:e},connectionMode:$,fromNodeId:_.nodeId,fromHandleId:_.id||null,fromType:_.type,isValidConnection:Q,flowId:V,doc:ee,lib:F,nodeLookup:Y});D&&B&&z(B);const X=structuredClone(Z);delete X.inProgress,X.toPosition=X.toHandle?X.toHandle.position:null,A?.(M,X),g.setState({connectionClickStartHandle:null})};return n.jsx("div",{"data-handleid":p,"data-nodeid":v,"data-handlepos":t,"data-id":`${w}-${v}-${p}-${e}`,className:xe(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",x,d,{source:!b,target:b,connectable:r,connectablestart:o,connectableend:a,clickconnecting:I,connectingfrom:E,connectingto:k,valid:C,connectionindicator:r&&(!P||T)&&(P||R?a:o)}]),onMouseDown:L,onTouchStart:L,onClick:N?j:void 0,ref:m,...u,children:c})}const Ke=y.memo(zi(E0));function I0({data:e,isConnectable:t,sourcePosition:s=te.Bottom}){return n.jsxs(n.Fragment,{children:[e?.label,n.jsx(Ke,{type:"source",position:s,isConnectable:t})]})}function M0({data:e,isConnectable:t,targetPosition:s=te.Top,sourcePosition:r=te.Bottom}){return n.jsxs(n.Fragment,{children:[n.jsx(Ke,{type:"target",position:s,isConnectable:t}),e?.label,n.jsx(Ke,{type:"source",position:r,isConnectable:t})]})}function A0(){return null}function T0({data:e,isConnectable:t,targetPosition:s=te.Top}){return n.jsxs(n.Fragment,{children:[n.jsx(Ke,{type:"target",position:s,isConnectable:t}),e?.label]})}const _n={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Ur={input:I0,default:M0,output:T0,group:A0};function $0(e){return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??e.style?.width,height:e.height??e.initialHeight??e.style?.height}:{width:e.width??e.style?.width,height:e.height??e.style?.height}}const P0=e=>{const{width:t,height:s,x:r,y:o}=Zt(e.nodeLookup,{filter:a=>!!a.selected});return{width:De(t)?t:null,height:De(s)?s:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${r}px,${o}px)`}};function D0({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:s}){const r=fe(),{width:o,height:a,transformString:i,userSelectionActive:l}=ae(P0,he),c=Bi(),d=y.useRef(null);if(y.useEffect(()=>{s||d.current?.focus({preventScroll:!0})},[s]),Li({nodeRef:d}),l||!o||!a)return null;const h=e?u=>{const m=r.getState().nodes.filter(p=>p.selected);e(u,m)}:void 0,f=u=>{Object.prototype.hasOwnProperty.call(_n,u.key)&&(u.preventDefault(),c({direction:_n[u.key],factor:u.shiftKey?4:1}))};return n.jsx("div",{className:xe(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:n.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:s?void 0:-1,onKeyDown:s?void 0:f,style:{width:o,height:a}})})}const Jr=typeof window<"u"?window:void 0,z0=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Oi({children:e,onPaneClick:t,onPaneMouseEnter:s,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,paneClickDistance:l,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:h,selectionMode:f,onSelectionStart:u,onSelectionEnd:m,multiSelectionKeyCode:p,panActivationKeyCode:b,zoomActivationKeyCode:g,elementsSelectable:v,zoomOnScroll:N,zoomOnPinch:x,panOnScroll:w,panOnScrollSpeed:E,panOnScrollMode:k,zoomOnDoubleClick:I,panOnDrag:T,defaultViewport:P,translateExtent:R,minZoom:C,maxZoom:z,preventScrolling:L,onSelectionContextMenu:j,noWheelClassName:M,noPanClassName:S,disableKeyboardA11y:A,onViewportChange:_,isControlledViewport:$}){const{nodesSelectionActive:O,userSelectionActive:F}=ae(z0,he),V=Ot(d,{target:Jr}),Y=Ot(b,{target:Jr}),Z=Y||T,ee=Y||w,Q=h&&Z!==!0,B=V||F||Q;return x0({deleteKeyCode:c,multiSelectionKeyCode:p}),n.jsx(y0,{onPaneContextMenu:a,elementsSelectable:v,zoomOnScroll:N,zoomOnPinch:x,panOnScroll:ee,panOnScrollSpeed:E,panOnScrollMode:k,zoomOnDoubleClick:I,panOnDrag:!V&&Z,defaultViewport:P,translateExtent:R,minZoom:C,maxZoom:z,zoomActivationKeyCode:g,preventScrolling:L,noWheelClassName:M,noPanClassName:S,onViewportChange:_,isControlledViewport:$,paneClickDistance:l,selectionOnDrag:Q,children:n.jsxs(N0,{onSelectionStart:u,onSelectionEnd:m,onPaneClick:t,onPaneMouseEnter:s,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,panOnDrag:Z,isSelecting:!!B,selectionMode:f,selectionKeyPressed:V,paneClickDistance:l,selectionOnDrag:Q,children:[e,O&&n.jsx(D0,{onSelectionContextMenu:j,noPanClassName:S,disableKeyboardA11y:A})]})})}Oi.displayName="FlowRenderer";const R0=y.memo(Oi),L0=e=>t=>e?Rs(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(s=>s.id):Array.from(t.nodeLookup.keys());function B0(e){return ae(y.useCallback(L0(e),[e]),he)}const H0=e=>e.updateNodeInternals;function O0(){const e=ae(H0),[t]=y.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(s=>{const r=new Map;s.forEach(o=>{const a=o.target.getAttribute("data-id");r.set(a,{id:a,nodeElement:o.target,force:!0})}),e(r)}));return y.useEffect(()=>()=>{t?.disconnect()},[t]),t}function V0({node:e,nodeType:t,hasDimensions:s,resizeObserver:r}){const o=fe(),a=y.useRef(null),i=y.useRef(null),l=y.useRef(e.sourcePosition),c=y.useRef(e.targetPosition),d=y.useRef(t),h=s&&!!e.internals.handleBounds;return y.useEffect(()=>{a.current&&!e.hidden&&(!h||i.current!==a.current)&&(i.current&&r?.unobserve(i.current),r?.observe(a.current),i.current=a.current)},[h,e.hidden]),y.useEffect(()=>()=>{i.current&&(r?.unobserve(i.current),i.current=null)},[]),y.useEffect(()=>{if(a.current){const f=d.current!==t,u=l.current!==e.sourcePosition,m=c.current!==e.targetPosition;(f||u||m)&&(d.current=t,l.current=e.sourcePosition,c.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:a.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),a}function F0({id:e,onClick:t,onMouseEnter:s,onMouseMove:r,onMouseLeave:o,onContextMenu:a,onDoubleClick:i,nodesDraggable:l,elementsSelectable:c,nodesConnectable:d,nodesFocusable:h,resizeObserver:f,noDragClassName:u,noPanClassName:m,disableKeyboardA11y:p,rfId:b,nodeTypes:g,nodeClickDistance:v,onError:N}){const{node:x,internals:w,isParent:E}=ae(D=>{const X=D.nodeLookup.get(e),W=D.parentLookup.has(e);return{node:X,internals:X.internals,isParent:W}},he);let k=x.type||"default",I=g?.[k]||Ur[k];I===void 0&&(N?.("003",Oe.error003(k)),k="default",I=g?.default||Ur.default);const T=!!(x.draggable||l&&typeof x.draggable>"u"),P=!!(x.selectable||c&&typeof x.selectable>"u"),R=!!(x.connectable||d&&typeof x.connectable>"u"),C=!!(x.focusable||h&&typeof x.focusable>"u"),z=fe(),L=li(x),j=V0({node:x,nodeType:k,hasDimensions:L,resizeObserver:f}),M=Li({nodeRef:j,disabled:x.hidden||!T,noDragClassName:u,handleSelector:x.dragHandle,nodeId:e,isSelectable:P,nodeClickDistance:v}),S=Bi();if(x.hidden)return null;const A=We(x),_=$0(x),$=P||T||t||s||r||o,O=s?D=>s(D,{...w.userNode}):void 0,F=r?D=>r(D,{...w.userNode}):void 0,V=o?D=>o(D,{...w.userNode}):void 0,Y=a?D=>a(D,{...w.userNode}):void 0,Z=i?D=>i(D,{...w.userNode}):void 0,ee=D=>{const{selectNodesOnDrag:X,nodeDragThreshold:W}=z.getState();P&&(!X||!T||W>0)&&js({id:e,store:z,nodeRef:j}),t&&t(D,{...w.userNode})},Q=D=>{if(!(ui(D.nativeEvent)||p)){if(Ko.includes(D.key)&&P){const X=D.key==="Escape";js({id:e,store:z,unselect:X,nodeRef:j})}else if(T&&x.selected&&Object.prototype.hasOwnProperty.call(_n,D.key)){D.preventDefault();const{ariaLabelConfig:X}=z.getState();z.setState({ariaLiveMessage:X["node.a11yDescription.ariaLiveMessage"]({direction:D.key.replace("Arrow","").toLowerCase(),x:~~w.positionAbsolute.x,y:~~w.positionAbsolute.y})}),S({direction:_n[D.key],factor:D.shiftKey?4:1})}}},B=()=>{if(p||!j.current?.matches(":focus-visible"))return;const{transform:D,width:X,height:W,autoPanOnNodeFocus:se,setCenter:J}=z.getState();if(!se)return;Rs(new Map([[e,x]]),{x:0,y:0,width:X,height:W},D,!0).length>0||J(x.position.x+A.width/2,x.position.y+A.height/2,{zoom:D[2]})};return n.jsx("div",{className:xe(["react-flow__node",`react-flow__node-${k}`,{[m]:T},x.className,{selected:x.selected,selectable:P,parent:E,draggable:T,dragging:M}]),ref:j,style:{zIndex:w.z,transform:`translate(${w.positionAbsolute.x}px,${w.positionAbsolute.y}px)`,pointerEvents:$?"all":"none",visibility:L?"visible":"hidden",...x.style,..._},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:O,onMouseMove:F,onMouseLeave:V,onContextMenu:Y,onClick:ee,onDoubleClick:Z,onKeyDown:C?Q:void 0,tabIndex:C?0:void 0,onFocus:C?B:void 0,role:x.ariaRole??(C?"group":void 0),"aria-roledescription":"node","aria-describedby":p?void 0:`${Mi}-${b}`,"aria-label":x.ariaLabel,...x.domAttributes,children:n.jsx(C0,{value:e,children:n.jsx(I,{id:e,data:x.data,type:k,positionAbsoluteX:w.positionAbsolute.x,positionAbsoluteY:w.positionAbsolute.y,selected:x.selected??!1,selectable:P,draggable:T,deletable:x.deletable??!0,isConnectable:R,sourcePosition:x.sourcePosition,targetPosition:x.targetPosition,dragging:M,dragHandle:x.dragHandle,zIndex:w.z,parentId:x.parentId,...A})})})}var G0=y.memo(F0);const q0=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Vi(e){const{nodesDraggable:t,nodesConnectable:s,nodesFocusable:r,elementsSelectable:o,onError:a}=ae(q0,he),i=B0(e.onlyRenderVisibleElements),l=O0();return n.jsx("div",{className:"react-flow__nodes",style:Vn,children:i.map(c=>n.jsx(G0,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:l,nodesDraggable:t,nodesConnectable:s,nodesFocusable:r,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:a},c))})}Vi.displayName="NodeRenderer";const Y0=y.memo(Vi);function Z0(e){return ae(y.useCallback(s=>{if(!e)return s.edges.map(o=>o.id);const r=[];if(s.width&&s.height)for(const o of s.edges){const a=s.nodeLookup.get(o.source),i=s.nodeLookup.get(o.target);a&&i&&Gh({sourceNode:a,targetNode:i,width:s.width,height:s.height,transform:s.transform})&&r.push(o.id)}return r},[e]),he)}const X0=({color:e="none",strokeWidth:t=1})=>{const s={strokeWidth:t,...e&&{stroke:e}};return n.jsx("polyline",{className:"arrow",style:s,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},W0=({color:e="none",strokeWidth:t=1})=>{const s={strokeWidth:t,...e&&{stroke:e,fill:e}};return n.jsx("polyline",{className:"arrowclosed",style:s,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Qr={[vt.Arrow]:X0,[vt.ArrowClosed]:W0};function U0(e){const t=fe();return y.useMemo(()=>Object.prototype.hasOwnProperty.call(Qr,e)?Qr[e]:(t.getState().onError?.("009",Oe.error009(e)),null),[e])}const J0=({id:e,type:t,color:s,width:r=12.5,height:o=12.5,markerUnits:a="strokeWidth",strokeWidth:i,orient:l="auto-start-reverse"})=>{const c=U0(t);return c?n.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:l,refX:"0",refY:"0",children:n.jsx(c,{color:s,strokeWidth:i})}):null},Fi=({defaultColor:e,rfId:t})=>{const s=ae(a=>a.edges),r=ae(a=>a.defaultEdgeOptions),o=y.useMemo(()=>Qh(s,{id:t,defaultColor:e,defaultMarkerStart:r?.markerStart,defaultMarkerEnd:r?.markerEnd}),[s,r,t,e]);return o.length?n.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:n.jsx("defs",{children:o.map(a=>n.jsx(J0,{id:a.id,type:a.type,color:a.color,width:a.width,height:a.height,markerUnits:a.markerUnits,strokeWidth:a.strokeWidth,orient:a.orient},a.id))})}):null};Fi.displayName="MarkerDefinitions";var Q0=y.memo(Fi);function Gi({x:e,y:t,label:s,labelStyle:r,labelShowBg:o=!0,labelBgStyle:a,labelBgPadding:i=[2,4],labelBgBorderRadius:l=2,children:c,className:d,...h}){const[f,u]=y.useState({x:1,y:0,width:0,height:0}),m=xe(["react-flow__edge-textwrapper",d]),p=y.useRef(null);return y.useEffect(()=>{if(p.current){const b=p.current.getBBox();u({x:b.x,y:b.y,width:b.width,height:b.height})}},[s]),s?n.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:m,visibility:f.width?"visible":"hidden",...h,children:[o&&n.jsx("rect",{width:f.width+2*i[0],x:-i[0],y:-i[1],height:f.height+2*i[1],className:"react-flow__edge-textbg",style:a,rx:l,ry:l}),n.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:p,style:r,children:s}),c]}):null}Gi.displayName="EdgeText";const K0=y.memo(Gi);function Fn({path:e,labelX:t,labelY:s,label:r,labelStyle:o,labelShowBg:a,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,interactionWidth:d=20,...h}){return n.jsxs(n.Fragment,{children:[n.jsx("path",{...h,d:e,fill:"none",className:xe(["react-flow__edge-path",h.className])}),d?n.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:d,className:"react-flow__edge-interaction"}):null,r&&De(t)&&De(s)?n.jsx(K0,{x:t,y:s,label:r,labelStyle:o,labelShowBg:a,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c}):null]})}function Kr({pos:e,x1:t,y1:s,x2:r,y2:o}){return e===te.Left||e===te.Right?[.5*(t+r),s]:[t,.5*(s+o)]}function qi({sourceX:e,sourceY:t,sourcePosition:s=te.Bottom,targetX:r,targetY:o,targetPosition:a=te.Top}){const[i,l]=Kr({pos:s,x1:e,y1:t,x2:r,y2:o}),[c,d]=Kr({pos:a,x1:r,y1:o,x2:e,y2:t}),[h,f,u,m]=fi({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:i,sourceControlY:l,targetControlX:c,targetControlY:d});return[`M${e},${t} C${i},${l} ${c},${d} ${r},${o}`,h,f,u,m]}function Yi(e){return y.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,sourcePosition:i,targetPosition:l,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:g,interactionWidth:v})=>{const[N,x,w]=qi({sourceX:s,sourceY:r,sourcePosition:i,targetX:o,targetY:a,targetPosition:l}),E=e.isInternal?void 0:t;return n.jsx(Fn,{id:E,path:N,labelX:x,labelY:w,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:g,interactionWidth:v})})}const em=Yi({isInternal:!1}),Zi=Yi({isInternal:!0});em.displayName="SimpleBezierEdge";Zi.displayName="SimpleBezierEdgeInternal";function Xi(e){return y.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,sourcePosition:m=te.Bottom,targetPosition:p=te.Top,markerEnd:b,markerStart:g,pathOptions:v,interactionWidth:N})=>{const[x,w,E]=bs({sourceX:s,sourceY:r,sourcePosition:m,targetX:o,targetY:a,targetPosition:p,borderRadius:v?.borderRadius,offset:v?.offset,stepPosition:v?.stepPosition}),k=e.isInternal?void 0:t;return n.jsx(Fn,{id:k,path:x,labelX:w,labelY:E,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:b,markerStart:g,interactionWidth:N})})}const Wi=Xi({isInternal:!1}),Ui=Xi({isInternal:!0});Wi.displayName="SmoothStepEdge";Ui.displayName="SmoothStepEdgeInternal";function Ji(e){return y.memo(({id:t,...s})=>{const r=e.isInternal?void 0:t;return n.jsx(Wi,{...s,id:r,pathOptions:y.useMemo(()=>({borderRadius:0,offset:s.pathOptions?.offset}),[s.pathOptions?.offset])})})}const tm=Ji({isInternal:!1}),Qi=Ji({isInternal:!0});tm.displayName="StepEdge";Qi.displayName="StepEdgeInternal";function Ki(e){return y.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:m,markerStart:p,interactionWidth:b})=>{const[g,v,N]=xi({sourceX:s,sourceY:r,targetX:o,targetY:a}),x=e.isInternal?void 0:t;return n.jsx(Fn,{id:x,path:g,labelX:v,labelY:N,label:i,labelStyle:l,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:u,markerEnd:m,markerStart:p,interactionWidth:b})})}const nm=Ki({isInternal:!1}),ea=Ki({isInternal:!0});nm.displayName="StraightEdge";ea.displayName="StraightEdgeInternal";function ta(e){return y.memo(({id:t,sourceX:s,sourceY:r,targetX:o,targetY:a,sourcePosition:i=te.Bottom,targetPosition:l=te.Top,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:g,pathOptions:v,interactionWidth:N})=>{const[x,w,E]=mi({sourceX:s,sourceY:r,sourcePosition:i,targetX:o,targetY:a,targetPosition:l,curvature:v?.curvature}),k=e.isInternal?void 0:t;return n.jsx(Fn,{id:k,path:x,labelX:w,labelY:E,label:c,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:u,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:g,interactionWidth:N})})}const sm=ta({isInternal:!1}),na=ta({isInternal:!0});sm.displayName="BezierEdge";na.displayName="BezierEdgeInternal";const eo={default:na,straight:ea,step:Qi,smoothstep:Ui,simplebezier:Zi},to={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},rm=(e,t,s)=>s===te.Left?e-t:s===te.Right?e+t:e,om=(e,t,s)=>s===te.Top?e-t:s===te.Bottom?e+t:e,no="react-flow__edgeupdater";function so({position:e,centerX:t,centerY:s,radius:r=10,onMouseDown:o,onMouseEnter:a,onMouseOut:i,type:l}){return n.jsx("circle",{onMouseDown:o,onMouseEnter:a,onMouseOut:i,className:xe([no,`${no}-${l}`]),cx:rm(t,r,e),cy:om(s,r,e),r,stroke:"transparent",fill:"transparent"})}function im({isReconnectable:e,reconnectRadius:t,edge:s,sourceX:r,sourceY:o,targetX:a,targetY:i,sourcePosition:l,targetPosition:c,onReconnect:d,onReconnectStart:h,onReconnectEnd:f,setReconnecting:u,setUpdateHover:m}){const p=fe(),b=(w,E)=>{if(w.button!==0)return;const{autoPanOnConnect:k,domNode:I,isValidConnection:T,connectionMode:P,connectionRadius:R,lib:C,onConnectStart:z,onConnectEnd:L,cancelConnection:j,nodeLookup:M,rfId:S,panBy:A,updateConnection:_}=p.getState(),$=E.type==="target",O=(Y,Z)=>{u(!1),f?.(Y,s,E.type,Z)},F=Y=>d?.(s,Y),V=(Y,Z)=>{u(!0),h?.(w,s,E.type),z?.(Y,Z)};ws.onPointerDown(w.nativeEvent,{autoPanOnConnect:k,connectionMode:P,connectionRadius:R,domNode:I,handleId:E.id,nodeId:E.nodeId,nodeLookup:M,isTarget:$,edgeUpdaterType:E.type,lib:C,flowId:S,cancelConnection:j,panBy:A,isValidConnection:T,onConnect:F,onConnectStart:V,onConnectEnd:L,onReconnectEnd:O,updateConnection:_,getTransform:()=>p.getState().transform,getFromHandle:()=>p.getState().connection.fromHandle,dragThreshold:p.getState().connectionDragThreshold,handleDomNode:w.currentTarget})},g=w=>b(w,{nodeId:s.target,id:s.targetHandle??null,type:"target"}),v=w=>b(w,{nodeId:s.source,id:s.sourceHandle??null,type:"source"}),N=()=>m(!0),x=()=>m(!1);return n.jsxs(n.Fragment,{children:[(e===!0||e==="source")&&n.jsx(so,{position:l,centerX:r,centerY:o,radius:t,onMouseDown:g,onMouseEnter:N,onMouseOut:x,type:"source"}),(e===!0||e==="target")&&n.jsx(so,{position:c,centerX:a,centerY:i,radius:t,onMouseDown:v,onMouseEnter:N,onMouseOut:x,type:"target"})]})}function am({id:e,edgesFocusable:t,edgesReconnectable:s,elementsSelectable:r,onClick:o,onDoubleClick:a,onContextMenu:i,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,reconnectRadius:h,onReconnect:f,onReconnectStart:u,onReconnectEnd:m,rfId:p,edgeTypes:b,noPanClassName:g,onError:v,disableKeyboardA11y:N}){let x=ae(J=>J.edgeLookup.get(e));const w=ae(J=>J.defaultEdgeOptions);x=w?{...w,...x}:x;let E=x.type||"default",k=b?.[E]||eo[E];k===void 0&&(v?.("011",Oe.error011(E)),E="default",k=b?.default||eo.default);const I=!!(x.focusable||t&&typeof x.focusable>"u"),T=typeof f<"u"&&(x.reconnectable||s&&typeof x.reconnectable>"u"),P=!!(x.selectable||r&&typeof x.selectable>"u"),R=y.useRef(null),[C,z]=y.useState(!1),[L,j]=y.useState(!1),M=fe(),{zIndex:S,sourceX:A,sourceY:_,targetX:$,targetY:O,sourcePosition:F,targetPosition:V}=ae(y.useCallback(J=>{const ne=J.nodeLookup.get(x.source),ie=J.nodeLookup.get(x.target);if(!ne||!ie)return{zIndex:x.zIndex,...to};const le=Jh({id:e,sourceNode:ne,targetNode:ie,sourceHandle:x.sourceHandle||null,targetHandle:x.targetHandle||null,connectionMode:J.connectionMode,onError:v});return{zIndex:Fh({selected:x.selected,zIndex:x.zIndex,sourceNode:ne,targetNode:ie,elevateOnSelect:J.elevateEdgesOnSelect,zIndexMode:J.zIndexMode}),...le||to}},[x.source,x.target,x.sourceHandle,x.targetHandle,x.selected,x.zIndex]),he),Y=y.useMemo(()=>x.markerStart?`url('#${ys(x.markerStart,p)}')`:void 0,[x.markerStart,p]),Z=y.useMemo(()=>x.markerEnd?`url('#${ys(x.markerEnd,p)}')`:void 0,[x.markerEnd,p]);if(x.hidden||A===null||_===null||$===null||O===null)return null;const ee=J=>{const{addSelectedEdges:ne,unselectNodesAndEdges:ie,multiSelectionActive:le}=M.getState();P&&(M.setState({nodesSelectionActive:!1}),x.selected&&le?(ie({nodes:[],edges:[x]}),R.current?.blur()):ne([e])),o&&o(J,x)},Q=a?J=>{a(J,{...x})}:void 0,B=i?J=>{i(J,{...x})}:void 0,D=l?J=>{l(J,{...x})}:void 0,X=c?J=>{c(J,{...x})}:void 0,W=d?J=>{d(J,{...x})}:void 0,se=J=>{if(!N&&Ko.includes(J.key)&&P){const{unselectNodesAndEdges:ne,addSelectedEdges:ie}=M.getState();J.key==="Escape"?(R.current?.blur(),ne({edges:[x]})):ie([e])}};return n.jsx("svg",{style:{zIndex:S},children:n.jsxs("g",{className:xe(["react-flow__edge",`react-flow__edge-${E}`,x.className,g,{selected:x.selected,animated:x.animated,inactive:!P&&!o,updating:C,selectable:P}]),onClick:ee,onDoubleClick:Q,onContextMenu:B,onMouseEnter:D,onMouseMove:X,onMouseLeave:W,onKeyDown:I?se:void 0,tabIndex:I?0:void 0,role:x.ariaRole??(I?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":x.ariaLabel===null?void 0:x.ariaLabel||`Edge from ${x.source} to ${x.target}`,"aria-describedby":I?`${Ai}-${p}`:void 0,ref:R,...x.domAttributes,children:[!L&&n.jsx(k,{id:e,source:x.source,target:x.target,type:x.type,selected:x.selected,animated:x.animated,selectable:P,deletable:x.deletable??!0,label:x.label,labelStyle:x.labelStyle,labelShowBg:x.labelShowBg,labelBgStyle:x.labelBgStyle,labelBgPadding:x.labelBgPadding,labelBgBorderRadius:x.labelBgBorderRadius,sourceX:A,sourceY:_,targetX:$,targetY:O,sourcePosition:F,targetPosition:V,data:x.data,style:x.style,sourceHandleId:x.sourceHandle,targetHandleId:x.targetHandle,markerStart:Y,markerEnd:Z,pathOptions:"pathOptions"in x?x.pathOptions:void 0,interactionWidth:x.interactionWidth}),T&&n.jsx(im,{edge:x,isReconnectable:T,reconnectRadius:h,onReconnect:f,onReconnectStart:u,onReconnectEnd:m,sourceX:A,sourceY:_,targetX:$,targetY:O,sourcePosition:F,targetPosition:V,setUpdateHover:z,setReconnecting:j})]})})}var lm=y.memo(am);const cm=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function sa({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:s,edgeTypes:r,noPanClassName:o,onReconnect:a,onEdgeContextMenu:i,onEdgeMouseEnter:l,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:h,reconnectRadius:f,onEdgeDoubleClick:u,onReconnectStart:m,onReconnectEnd:p,disableKeyboardA11y:b}){const{edgesFocusable:g,edgesReconnectable:v,elementsSelectable:N,onError:x}=ae(cm,he),w=Z0(t);return n.jsxs("div",{className:"react-flow__edges",children:[n.jsx(Q0,{defaultColor:e,rfId:s}),w.map(E=>n.jsx(lm,{id:E,edgesFocusable:g,edgesReconnectable:v,elementsSelectable:N,noPanClassName:o,onReconnect:a,onContextMenu:i,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,onClick:h,reconnectRadius:f,onDoubleClick:u,onReconnectStart:m,onReconnectEnd:p,rfId:s,onError:x,edgeTypes:r,disableKeyboardA11y:b},E))]})}sa.displayName="EdgeRenderer";const dm=y.memo(sa),um=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function hm({children:e}){const t=ae(um);return n.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function fm(e){const t=On(),s=y.useRef(!1);y.useEffect(()=>{!s.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),s.current=!0)},[e,t.viewportInitialized])}const mm=e=>e.panZoom?.syncViewport;function pm(e){const t=ae(mm),s=fe();return y.useEffect(()=>{e&&(t?.(e),s.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function xm(e){return e.connection.inProgress?{...e.connection,to:Wt(e.connection.to,e.transform)}:{...e.connection}}function gm(e){return xm}function bm(e){const t=gm();return ae(t,he)}const ym=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function vm({containerStyle:e,style:t,type:s,component:r}){const{nodesConnectable:o,width:a,height:i,isValid:l,inProgress:c}=ae(ym,he);return!(a&&o&&c)?null:n.jsx("svg",{style:e,width:a,height:i,className:"react-flow__connectionline react-flow__container",children:n.jsx("g",{className:xe(["react-flow__connection",ni(l)]),children:n.jsx(ra,{style:t,type:s,CustomComponent:r,isValid:l})})})}const ra=({style:e,type:t=Qe.Bezier,CustomComponent:s,isValid:r})=>{const{inProgress:o,from:a,fromNode:i,fromHandle:l,fromPosition:c,to:d,toNode:h,toHandle:f,toPosition:u,pointer:m}=bm();if(!o)return;if(s)return n.jsx(s,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:l,fromX:a.x,fromY:a.y,toX:d.x,toY:d.y,fromPosition:c,toPosition:u,connectionStatus:ni(r),toNode:h,toHandle:f,pointer:m});let p="";const b={sourceX:a.x,sourceY:a.y,sourcePosition:c,targetX:d.x,targetY:d.y,targetPosition:u};switch(t){case Qe.Bezier:[p]=mi(b);break;case Qe.SimpleBezier:[p]=qi(b);break;case Qe.Step:[p]=bs({...b,borderRadius:0});break;case Qe.SmoothStep:[p]=bs(b);break;default:[p]=xi(b)}return n.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:e})};ra.displayName="ConnectionLine";const wm={};function ro(e=wm){y.useRef(e),fe(),y.useEffect(()=>{},[e])}function jm(){fe(),y.useRef(!1),y.useEffect(()=>{},[])}function oa({nodeTypes:e,edgeTypes:t,onInit:s,onNodeClick:r,onEdgeClick:o,onNodeDoubleClick:a,onEdgeDoubleClick:i,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:h,onSelectionContextMenu:f,onSelectionStart:u,onSelectionEnd:m,connectionLineType:p,connectionLineStyle:b,connectionLineComponent:g,connectionLineContainerStyle:v,selectionKeyCode:N,selectionOnDrag:x,selectionMode:w,multiSelectionKeyCode:E,panActivationKeyCode:k,zoomActivationKeyCode:I,deleteKeyCode:T,onlyRenderVisibleElements:P,elementsSelectable:R,defaultViewport:C,translateExtent:z,minZoom:L,maxZoom:j,preventScrolling:M,defaultMarkerColor:S,zoomOnScroll:A,zoomOnPinch:_,panOnScroll:$,panOnScrollSpeed:O,panOnScrollMode:F,zoomOnDoubleClick:V,panOnDrag:Y,onPaneClick:Z,onPaneMouseEnter:ee,onPaneMouseMove:Q,onPaneMouseLeave:B,onPaneScroll:D,onPaneContextMenu:X,paneClickDistance:W,nodeClickDistance:se,onEdgeContextMenu:J,onEdgeMouseEnter:ne,onEdgeMouseMove:ie,onEdgeMouseLeave:le,reconnectRadius:ce,onReconnect:ue,onReconnectStart:Se,onReconnectEnd:_e,noDragClassName:we,noWheelClassName:Fe,noPanClassName:Ge,disableKeyboardA11y:qe,nodeExtent:K,rfId:ge,viewport:je,onViewportChange:Me}){return ro(e),ro(t),jm(),fm(s),pm(je),n.jsx(R0,{onPaneClick:Z,onPaneMouseEnter:ee,onPaneMouseMove:Q,onPaneMouseLeave:B,onPaneContextMenu:X,onPaneScroll:D,paneClickDistance:W,deleteKeyCode:T,selectionKeyCode:N,selectionOnDrag:x,selectionMode:w,onSelectionStart:u,onSelectionEnd:m,multiSelectionKeyCode:E,panActivationKeyCode:k,zoomActivationKeyCode:I,elementsSelectable:R,zoomOnScroll:A,zoomOnPinch:_,zoomOnDoubleClick:V,panOnScroll:$,panOnScrollSpeed:O,panOnScrollMode:F,panOnDrag:Y,defaultViewport:C,translateExtent:z,minZoom:L,maxZoom:j,onSelectionContextMenu:f,preventScrolling:M,noDragClassName:we,noWheelClassName:Fe,noPanClassName:Ge,disableKeyboardA11y:qe,onViewportChange:Me,isControlledViewport:!!je,children:n.jsxs(hm,{children:[n.jsx(dm,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:i,onReconnect:ue,onReconnectStart:Se,onReconnectEnd:_e,onlyRenderVisibleElements:P,onEdgeContextMenu:J,onEdgeMouseEnter:ne,onEdgeMouseMove:ie,onEdgeMouseLeave:le,reconnectRadius:ce,defaultMarkerColor:S,noPanClassName:Ge,disableKeyboardA11y:qe,rfId:ge}),n.jsx(vm,{style:b,type:p,component:g,containerStyle:v}),n.jsx("div",{className:"react-flow__edgelabel-renderer"}),n.jsx(Y0,{nodeTypes:e,onNodeClick:r,onNodeDoubleClick:a,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:h,nodeClickDistance:se,onlyRenderVisibleElements:P,noPanClassName:Ge,noDragClassName:we,disableKeyboardA11y:qe,nodeExtent:K,rfId:ge}),n.jsx("div",{className:"react-flow__viewport-portal"})]})})}oa.displayName="GraphView";const Nm=y.memo(oa),oo=({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c=.5,maxZoom:d=2,nodeOrigin:h,nodeExtent:f,zIndexMode:u="basic"}={})=>{const m=new Map,p=new Map,b=new Map,g=new Map,v=r??t??[],N=s??e??[],x=h??[0,0],w=f??Rt;yi(b,g,v);const E=vs(N,m,p,{nodeOrigin:x,nodeExtent:w,zIndexMode:u});let k=[0,0,1];if(i&&o&&a){const I=Zt(m,{filter:C=>!!((C.width||C.initialWidth)&&(C.height||C.initialHeight))}),{x:T,y:P,zoom:R}=Ls(I,o,a,c,d,l?.padding??.1);k=[T,P,R]}return{rfId:"1",width:o??0,height:a??0,transform:k,nodes:N,nodesInitialized:E,nodeLookup:m,parentLookup:p,edges:v,edgeLookup:g,connectionLookup:b,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:s!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:c,maxZoom:d,translateExtent:Rt,nodeExtent:w,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:yt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:x,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:l,fitViewResolver:null,connection:{...ti},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Rh,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:ei,zIndexMode:u,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},km=({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c,maxZoom:d,nodeOrigin:h,nodeExtent:f,zIndexMode:u})=>Vf((m,p)=>{async function b(){const{nodeLookup:g,panZoom:v,fitViewOptions:N,fitViewResolver:x,width:w,height:E,minZoom:k,maxZoom:I}=p();v&&(await Dh({nodes:g,width:w,height:E,panZoom:v,minZoom:k,maxZoom:I},N),x?.resolve(!0),m({fitViewResolver:null}))}return{...oo({nodes:e,edges:t,width:o,height:a,fitView:i,fitViewOptions:l,minZoom:c,maxZoom:d,nodeOrigin:h,nodeExtent:f,defaultNodes:s,defaultEdges:r,zIndexMode:u}),setNodes:g=>{const{nodeLookup:v,parentLookup:N,nodeOrigin:x,elevateNodesOnSelect:w,fitViewQueued:E,zIndexMode:k}=p(),I=vs(g,v,N,{nodeOrigin:x,nodeExtent:f,elevateNodesOnSelect:w,checkEquality:!0,zIndexMode:k});E&&I?(b(),m({nodes:g,nodesInitialized:I,fitViewQueued:!1,fitViewOptions:void 0})):m({nodes:g,nodesInitialized:I})},setEdges:g=>{const{connectionLookup:v,edgeLookup:N}=p();yi(v,N,g),m({edges:g})},setDefaultNodesAndEdges:(g,v)=>{if(g){const{setNodes:N}=p();N(g),m({hasDefaultNodes:!0})}if(v){const{setEdges:N}=p();N(v),m({hasDefaultEdges:!0})}},updateNodeInternals:g=>{const{triggerNodeChanges:v,nodeLookup:N,parentLookup:x,domNode:w,nodeOrigin:E,nodeExtent:k,debug:I,fitViewQueued:T,zIndexMode:P}=p(),{changes:R,updatedInternals:C}=of(g,N,x,w,E,k,P);C&&(tf(N,x,{nodeOrigin:E,nodeExtent:k,zIndexMode:P}),T?(b(),m({fitViewQueued:!1,fitViewOptions:void 0})):m({}),R?.length>0&&(I&&console.log("React Flow: trigger node changes",R),v?.(R)))},updateNodePositions:(g,v=!1)=>{const N=[];let x=[];const{nodeLookup:w,triggerNodeChanges:E,connection:k,updateConnection:I,onNodesChangeMiddlewareMap:T}=p();for(const[P,R]of g){const C=w.get(P),z=!!(C?.expandParent&&C?.parentId&&R?.position),L={id:P,type:"position",position:z?{x:Math.max(0,R.position.x),y:Math.max(0,R.position.y)}:R.position,dragging:v};if(C&&k.inProgress&&k.fromNode.id===C.id){const j=dt(C,k.fromHandle,te.Left,!0);I({...k,from:j})}z&&C.parentId&&N.push({id:P,parentId:C.parentId,rect:{...R.internals.positionAbsolute,width:R.measured.width??0,height:R.measured.height??0}}),x.push(L)}if(N.length>0){const{parentLookup:P,nodeOrigin:R}=p(),C=Gs(N,w,P,R);x.push(...C)}for(const P of T.values())x=P(x);E(x)},triggerNodeChanges:g=>{const{onNodesChange:v,setNodes:N,nodes:x,hasDefaultNodes:w,debug:E}=p();if(g?.length){if(w){const k=Pi(g,x);N(k)}E&&console.log("React Flow: trigger node changes",g),v?.(g)}},triggerEdgeChanges:g=>{const{onEdgesChange:v,setEdges:N,edges:x,hasDefaultEdges:w,debug:E}=p();if(g?.length){if(w){const k=Di(g,x);N(k)}E&&console.log("React Flow: trigger edge changes",g),v?.(g)}},addSelectedNodes:g=>{const{multiSelectionActive:v,edgeLookup:N,nodeLookup:x,triggerNodeChanges:w,triggerEdgeChanges:E}=p();if(v){const k=g.map(I=>st(I,!0));w(k);return}w(mt(x,new Set([...g]),!0)),E(mt(N))},addSelectedEdges:g=>{const{multiSelectionActive:v,edgeLookup:N,nodeLookup:x,triggerNodeChanges:w,triggerEdgeChanges:E}=p();if(v){const k=g.map(I=>st(I,!0));E(k);return}E(mt(N,new Set([...g]))),w(mt(x,new Set,!0))},unselectNodesAndEdges:({nodes:g,edges:v}={})=>{const{edges:N,nodes:x,nodeLookup:w,triggerNodeChanges:E,triggerEdgeChanges:k}=p(),I=g||x,T=v||N,P=I.map(C=>{const z=w.get(C.id);return z&&(z.selected=!1),st(C.id,!1)}),R=T.map(C=>st(C.id,!1));E(P),k(R)},setMinZoom:g=>{const{panZoom:v,maxZoom:N}=p();v?.setScaleExtent([g,N]),m({minZoom:g})},setMaxZoom:g=>{const{panZoom:v,minZoom:N}=p();v?.setScaleExtent([N,g]),m({maxZoom:g})},setTranslateExtent:g=>{p().panZoom?.setTranslateExtent(g),m({translateExtent:g})},resetSelectedElements:()=>{const{edges:g,nodes:v,triggerNodeChanges:N,triggerEdgeChanges:x,elementsSelectable:w}=p();if(!w)return;const E=v.reduce((I,T)=>T.selected?[...I,st(T.id,!1)]:I,[]),k=g.reduce((I,T)=>T.selected?[...I,st(T.id,!1)]:I,[]);N(E),x(k)},setNodeExtent:g=>{const{nodes:v,nodeLookup:N,parentLookup:x,nodeOrigin:w,elevateNodesOnSelect:E,nodeExtent:k,zIndexMode:I}=p();g[0][0]===k[0][0]&&g[0][1]===k[0][1]&&g[1][0]===k[1][0]&&g[1][1]===k[1][1]||(vs(v,N,x,{nodeOrigin:w,nodeExtent:g,elevateNodesOnSelect:E,checkEquality:!1,zIndexMode:I}),m({nodeExtent:g}))},panBy:g=>{const{transform:v,width:N,height:x,panZoom:w,translateExtent:E}=p();return af({delta:g,panZoom:w,transform:v,translateExtent:E,width:N,height:x})},setCenter:async(g,v,N)=>{const{width:x,height:w,maxZoom:E,panZoom:k}=p();if(!k)return Promise.resolve(!1);const I=typeof N?.zoom<"u"?N.zoom:E;return await k.setViewport({x:x/2-g*I,y:w/2-v*I,zoom:I},{duration:N?.duration,ease:N?.ease,interpolate:N?.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{m({connection:{...ti}})},updateConnection:g=>{m({connection:g})},reset:()=>m({...oo()})}},Object.is);function ia({initialNodes:e,initialEdges:t,defaultNodes:s,defaultEdges:r,initialWidth:o,initialHeight:a,initialMinZoom:i,initialMaxZoom:l,initialFitViewOptions:c,fitView:d,nodeOrigin:h,nodeExtent:f,zIndexMode:u,children:m}){const[p]=y.useState(()=>km({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,width:o,height:a,fitView:d,minZoom:i,maxZoom:l,fitViewOptions:c,nodeOrigin:h,nodeExtent:f,zIndexMode:u}));return n.jsx(Ff,{value:p,children:n.jsx(h0,{children:m})})}function Cm({children:e,nodes:t,edges:s,defaultNodes:r,defaultEdges:o,width:a,height:i,fitView:l,fitViewOptions:c,minZoom:d,maxZoom:h,nodeOrigin:f,nodeExtent:u,zIndexMode:m}){return y.useContext(Hn)?n.jsx(n.Fragment,{children:e}):n.jsx(ia,{initialNodes:t,initialEdges:s,defaultNodes:r,defaultEdges:o,initialWidth:a,initialHeight:i,fitView:l,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:h,nodeOrigin:f,nodeExtent:u,zIndexMode:m,children:e})}const Sm={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function _m({nodes:e,edges:t,defaultNodes:s,defaultEdges:r,className:o,nodeTypes:a,edgeTypes:i,onNodeClick:l,onEdgeClick:c,onInit:d,onMove:h,onMoveStart:f,onMoveEnd:u,onConnect:m,onConnectStart:p,onConnectEnd:b,onClickConnectStart:g,onClickConnectEnd:v,onNodeMouseEnter:N,onNodeMouseMove:x,onNodeMouseLeave:w,onNodeContextMenu:E,onNodeDoubleClick:k,onNodeDragStart:I,onNodeDrag:T,onNodeDragStop:P,onNodesDelete:R,onEdgesDelete:C,onDelete:z,onSelectionChange:L,onSelectionDragStart:j,onSelectionDrag:M,onSelectionDragStop:S,onSelectionContextMenu:A,onSelectionStart:_,onSelectionEnd:$,onBeforeDelete:O,connectionMode:F,connectionLineType:V=Qe.Bezier,connectionLineStyle:Y,connectionLineComponent:Z,connectionLineContainerStyle:ee,deleteKeyCode:Q="Backspace",selectionKeyCode:B="Shift",selectionOnDrag:D=!1,selectionMode:X=Lt.Full,panActivationKeyCode:W="Space",multiSelectionKeyCode:se=Ht()?"Meta":"Control",zoomActivationKeyCode:J=Ht()?"Meta":"Control",snapToGrid:ne,snapGrid:ie,onlyRenderVisibleElements:le=!1,selectNodesOnDrag:ce,nodesDraggable:ue,autoPanOnNodeFocus:Se,nodesConnectable:_e,nodesFocusable:we,nodeOrigin:Fe=Ti,edgesFocusable:Ge,edgesReconnectable:qe,elementsSelectable:K=!0,defaultViewport:ge=n0,minZoom:je=.5,maxZoom:Me=2,translateExtent:Ne=Rt,preventScrolling:H=!0,nodeExtent:G,defaultMarkerColor:U="#b1b1b7",zoomOnScroll:q=!0,zoomOnPinch:re=!0,panOnScroll:de=!1,panOnScrollSpeed:me=.5,panOnScrollMode:Ae=it.Free,zoomOnDoubleClick:ye=!0,panOnDrag:Jt=!0,onPaneClick:Qt,onPaneMouseEnter:Gn,onPaneMouseMove:da,onPaneMouseLeave:ua,onPaneScroll:ha,onPaneContextMenu:fa,paneClickDistance:ma=1,nodeClickDistance:pa=0,children:xa,onReconnect:ga,onReconnectStart:ba,onReconnectEnd:ya,onEdgeContextMenu:va,onEdgeDoubleClick:wa,onEdgeMouseEnter:ja,onEdgeMouseMove:Na,onEdgeMouseLeave:ka,reconnectRadius:Ca=10,onNodesChange:Sa,onEdgesChange:_a,noDragClassName:Ea="nodrag",noWheelClassName:Ia="nowheel",noPanClassName:Ys="nopan",fitView:Zs,fitViewOptions:Xs,connectOnClick:Ma,attributionPosition:Aa,proOptions:Ta,defaultEdgeOptions:$a,elevateNodesOnSelect:Pa=!0,elevateEdgesOnSelect:Da=!1,disableKeyboardA11y:Ws=!1,autoPanOnConnect:za,autoPanOnNodeDrag:Ra,autoPanSpeed:La,connectionRadius:Ba,isValidConnection:Ha,onError:Oa,style:Va,id:Us,nodeDragThreshold:Fa,connectionDragThreshold:Ga,viewport:qa,onViewportChange:Ya,width:Za,height:Xa,colorMode:Wa="light",debug:Ua,onScroll:Js,ariaLabelConfig:Ja,zIndexMode:Qs="basic",...Qa},Ka){const qn=Us||"1",el=i0(Wa),tl=y.useCallback(Ks=>{Ks.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Js?.(Ks)},[Js]);return n.jsx("div",{"data-testid":"rf__wrapper",...Qa,onScroll:tl,style:{...Va,...Sm},ref:Ka,className:xe(["react-flow",o,el]),id:Us,role:"application",children:n.jsxs(Cm,{nodes:e,edges:t,width:Za,height:Xa,fitView:Zs,fitViewOptions:Xs,minZoom:je,maxZoom:Me,nodeOrigin:Fe,nodeExtent:G,zIndexMode:Qs,children:[n.jsx(Nm,{onInit:d,onNodeClick:l,onEdgeClick:c,onNodeMouseEnter:N,onNodeMouseMove:x,onNodeMouseLeave:w,onNodeContextMenu:E,onNodeDoubleClick:k,nodeTypes:a,edgeTypes:i,connectionLineType:V,connectionLineStyle:Y,connectionLineComponent:Z,connectionLineContainerStyle:ee,selectionKeyCode:B,selectionOnDrag:D,selectionMode:X,deleteKeyCode:Q,multiSelectionKeyCode:se,panActivationKeyCode:W,zoomActivationKeyCode:J,onlyRenderVisibleElements:le,defaultViewport:ge,translateExtent:Ne,minZoom:je,maxZoom:Me,preventScrolling:H,zoomOnScroll:q,zoomOnPinch:re,zoomOnDoubleClick:ye,panOnScroll:de,panOnScrollSpeed:me,panOnScrollMode:Ae,panOnDrag:Jt,onPaneClick:Qt,onPaneMouseEnter:Gn,onPaneMouseMove:da,onPaneMouseLeave:ua,onPaneScroll:ha,onPaneContextMenu:fa,paneClickDistance:ma,nodeClickDistance:pa,onSelectionContextMenu:A,onSelectionStart:_,onSelectionEnd:$,onReconnect:ga,onReconnectStart:ba,onReconnectEnd:ya,onEdgeContextMenu:va,onEdgeDoubleClick:wa,onEdgeMouseEnter:ja,onEdgeMouseMove:Na,onEdgeMouseLeave:ka,reconnectRadius:Ca,defaultMarkerColor:U,noDragClassName:Ea,noWheelClassName:Ia,noPanClassName:Ys,rfId:qn,disableKeyboardA11y:Ws,nodeExtent:G,viewport:qa,onViewportChange:Ya}),n.jsx(o0,{nodes:e,edges:t,defaultNodes:s,defaultEdges:r,onConnect:m,onConnectStart:p,onConnectEnd:b,onClickConnectStart:g,onClickConnectEnd:v,nodesDraggable:ue,autoPanOnNodeFocus:Se,nodesConnectable:_e,nodesFocusable:we,edgesFocusable:Ge,edgesReconnectable:qe,elementsSelectable:K,elevateNodesOnSelect:Pa,elevateEdgesOnSelect:Da,minZoom:je,maxZoom:Me,nodeExtent:G,onNodesChange:Sa,onEdgesChange:_a,snapToGrid:ne,snapGrid:ie,connectionMode:F,translateExtent:Ne,connectOnClick:Ma,defaultEdgeOptions:$a,fitView:Zs,fitViewOptions:Xs,onNodesDelete:R,onEdgesDelete:C,onDelete:z,onNodeDragStart:I,onNodeDrag:T,onNodeDragStop:P,onSelectionDrag:M,onSelectionDragStart:j,onSelectionDragStop:S,onMove:h,onMoveStart:f,onMoveEnd:u,noPanClassName:Ys,nodeOrigin:Fe,rfId:qn,autoPanOnConnect:za,autoPanOnNodeDrag:Ra,autoPanSpeed:La,onError:Oa,connectionRadius:Ba,isValidConnection:Ha,selectNodesOnDrag:ce,nodeDragThreshold:Fa,connectionDragThreshold:Ga,onBeforeDelete:O,debug:Ua,ariaLabelConfig:Ja,zIndexMode:Qs}),n.jsx(t0,{onSelectionChange:L}),xa,n.jsx(Uf,{proOptions:Ta,position:Aa}),n.jsx(Wf,{rfId:qn,disableKeyboardA11y:Ws})]})})}var Em=zi(_m);function Im(e){const[t,s]=y.useState(e),r=y.useCallback(o=>s(a=>Pi(o,a)),[]);return[t,s,r]}function Mm(e){const[t,s]=y.useState(e),r=y.useCallback(o=>s(a=>Di(o,a)),[]);return[t,s,r]}function Am({dimensions:e,lineWidth:t,variant:s,className:r}){return n.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:xe(["react-flow__background-pattern",s,r])})}function Tm({radius:e,className:t}){return n.jsx("circle",{cx:e,cy:e,r:e,className:xe(["react-flow__background-pattern","dots",t])})}var tt;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(tt||(tt={}));const $m={[tt.Dots]:1,[tt.Lines]:1,[tt.Cross]:6},Pm=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function aa({id:e,variant:t=tt.Dots,gap:s=20,size:r,lineWidth:o=1,offset:a=0,color:i,bgColor:l,style:c,className:d,patternClassName:h}){const f=y.useRef(null),{transform:u,patternId:m}=ae(Pm,he),p=r||$m[t],b=t===tt.Dots,g=t===tt.Cross,v=Array.isArray(s)?s:[s,s],N=[v[0]*u[2]||1,v[1]*u[2]||1],x=p*u[2],w=Array.isArray(a)?a:[a,a],E=g?[x,x]:N,k=[w[0]*u[2]||1+E[0]/2,w[1]*u[2]||1+E[1]/2],I=`${m}${e||""}`;return n.jsxs("svg",{className:xe(["react-flow__background",d]),style:{...c,...Vn,"--xy-background-color-props":l,"--xy-background-pattern-color-props":i},ref:f,"data-testid":"rf__background",children:[n.jsx("pattern",{id:I,x:u[0]%N[0],y:u[1]%N[1],width:N[0],height:N[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${k[0]},-${k[1]})`,children:b?n.jsx(Tm,{radius:x/2,className:h}):n.jsx(Am,{dimensions:E,lineWidth:o,variant:t,className:h})}),n.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${I})`})]})}aa.displayName="Background";const Dm=y.memo(aa);function zm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:n.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Rm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:n.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Lm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:n.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Bm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:n.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Hm(){return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:n.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function ln({children:e,className:t,...s}){return n.jsx("button",{type:"button",className:xe(["react-flow__controls-button",t]),...s,children:e})}const Om=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function la({style:e,showZoom:t=!0,showFitView:s=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:a,onZoomOut:i,onFitView:l,onInteractiveChange:c,className:d,children:h,position:f="bottom-left",orientation:u="vertical","aria-label":m}){const p=fe(),{isInteractive:b,minZoomReached:g,maxZoomReached:v,ariaLabelConfig:N}=ae(Om,he),{zoomIn:x,zoomOut:w,fitView:E}=On(),k=()=>{x(),a?.()},I=()=>{w(),i?.()},T=()=>{E(o),l?.()},P=()=>{p.setState({nodesDraggable:!b,nodesConnectable:!b,elementsSelectable:!b}),c?.(!b)},R=u==="horizontal"?"horizontal":"vertical";return n.jsxs(Ut,{className:xe(["react-flow__controls",R,d]),position:f,style:e,"data-testid":"rf__controls","aria-label":m??N["controls.ariaLabel"],children:[t&&n.jsxs(n.Fragment,{children:[n.jsx(ln,{onClick:k,className:"react-flow__controls-zoomin",title:N["controls.zoomIn.ariaLabel"],"aria-label":N["controls.zoomIn.ariaLabel"],disabled:v,children:n.jsx(zm,{})}),n.jsx(ln,{onClick:I,className:"react-flow__controls-zoomout",title:N["controls.zoomOut.ariaLabel"],"aria-label":N["controls.zoomOut.ariaLabel"],disabled:g,children:n.jsx(Rm,{})})]}),s&&n.jsx(ln,{className:"react-flow__controls-fitview",onClick:T,title:N["controls.fitView.ariaLabel"],"aria-label":N["controls.fitView.ariaLabel"],children:n.jsx(Lm,{})}),r&&n.jsx(ln,{className:"react-flow__controls-interactive",onClick:P,title:N["controls.interactive.ariaLabel"],"aria-label":N["controls.interactive.ariaLabel"],children:b?n.jsx(Hm,{}):n.jsx(Bm,{})}),h]})}la.displayName="Controls";const Vm=y.memo(la);function Fm({id:e,x:t,y:s,width:r,height:o,style:a,color:i,strokeColor:l,strokeWidth:c,className:d,borderRadius:h,shapeRendering:f,selected:u,onClick:m}){const{background:p,backgroundColor:b}=a||{},g=i||p||b;return n.jsx("rect",{className:xe(["react-flow__minimap-node",{selected:u},d]),x:t,y:s,rx:h,ry:h,width:r,height:o,style:{fill:g,stroke:l,strokeWidth:c},shapeRendering:f,onClick:m?v=>m(v,e):void 0})}const Gm=y.memo(Fm),qm=e=>e.nodes.map(t=>t.id),rs=e=>e instanceof Function?e:()=>e;function Ym({nodeStrokeColor:e,nodeColor:t,nodeClassName:s="",nodeBorderRadius:r=5,nodeStrokeWidth:o,nodeComponent:a=Gm,onClick:i}){const l=ae(qm,he),c=rs(t),d=rs(e),h=rs(s),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return n.jsx(n.Fragment,{children:l.map(u=>n.jsx(Xm,{id:u,nodeColorFunc:c,nodeStrokeColorFunc:d,nodeClassNameFunc:h,nodeBorderRadius:r,nodeStrokeWidth:o,NodeComponent:a,onClick:i,shapeRendering:f},u))})}function Zm({id:e,nodeColorFunc:t,nodeStrokeColorFunc:s,nodeClassNameFunc:r,nodeBorderRadius:o,nodeStrokeWidth:a,shapeRendering:i,NodeComponent:l,onClick:c}){const{node:d,x:h,y:f,width:u,height:m}=ae(p=>{const{internals:b}=p.nodeLookup.get(e),g=b.userNode,{x:v,y:N}=b.positionAbsolute,{width:x,height:w}=We(g);return{node:g,x:v,y:N,width:x,height:w}},he);return!d||d.hidden||!li(d)?null:n.jsx(l,{x:h,y:f,width:u,height:m,style:d.style,selected:!!d.selected,className:r(d),color:t(d),borderRadius:o,strokeColor:s(d),strokeWidth:a,shapeRendering:i,onClick:c,id:d.id})}const Xm=y.memo(Zm);var Wm=y.memo(Ym);const Um=200,Jm=150,Qm=e=>!e.hidden,Km=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ai(Zt(e.nodeLookup,{filter:Qm}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},ep="react-flow__minimap-desc";function ca({style:e,className:t,nodeStrokeColor:s,nodeColor:r,nodeClassName:o="",nodeBorderRadius:a=5,nodeStrokeWidth:i,nodeComponent:l,bgColor:c,maskColor:d,maskStrokeColor:h,maskStrokeWidth:f,position:u="bottom-right",onClick:m,onNodeClick:p,pannable:b=!1,zoomable:g=!1,ariaLabel:v,inversePan:N,zoomStep:x=1,offsetScale:w=5}){const E=fe(),k=y.useRef(null),{boundingRect:I,viewBB:T,rfId:P,panZoom:R,translateExtent:C,flowWidth:z,flowHeight:L,ariaLabelConfig:j}=ae(Km,he),M=e?.width??Um,S=e?.height??Jm,A=I.width/M,_=I.height/S,$=Math.max(A,_),O=$*M,F=$*S,V=w*$,Y=I.x-(O-I.width)/2-V,Z=I.y-(F-I.height)/2-V,ee=O+V*2,Q=F+V*2,B=`${ep}-${P}`,D=y.useRef(0),X=y.useRef();D.current=$,y.useEffect(()=>{if(k.current&&R)return X.current=xf({domNode:k.current,panZoom:R,getTransform:()=>E.getState().transform,getViewScale:()=>D.current}),()=>{X.current?.destroy()}},[R]),y.useEffect(()=>{X.current?.update({translateExtent:C,width:z,height:L,inversePan:N,pannable:b,zoomStep:x,zoomable:g})},[b,g,N,x,C,z,L]);const W=m?ne=>{const[ie,le]=X.current?.pointer(ne)||[0,0];m(ne,{x:ie,y:le})}:void 0,se=p?y.useCallback((ne,ie)=>{const le=E.getState().nodeLookup.get(ie).internals.userNode;p(ne,le)},[]):void 0,J=v??j["minimap.ariaLabel"];return n.jsx(Ut,{position:u,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-color-props":typeof h=="string"?h:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*$:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:xe(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:n.jsxs("svg",{width:M,height:S,viewBox:`${Y} ${Z} ${ee} ${Q}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":B,ref:k,onClick:W,children:[J&&n.jsx("title",{id:B,children:J}),n.jsx(Wm,{onClick:se,nodeColor:r,nodeStrokeColor:s,nodeBorderRadius:a,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:l}),n.jsx("path",{className:"react-flow__minimap-mask",d:`M${Y-V},${Z-V}h${ee+V*2}v${Q+V*2}h${-ee-V*2}z
        M${T.x},${T.y}h${T.width}v${T.height}h${-T.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}ca.displayName="MiniMap";const tp=y.memo(ca),np=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,sp={[kt.Line]:"right",[kt.Handle]:"bottom-right"};function rp({nodeId:e,position:t,variant:s=kt.Handle,className:r,style:o=void 0,children:a,color:i,minWidth:l=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:h=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:u,autoScale:m=!0,shouldResize:p,onResizeStart:b,onResize:g,onResizeEnd:v}){const N=Hi(),x=typeof e=="string"?e:N,w=fe(),E=y.useRef(null),k=s===kt.Handle,I=ae(y.useCallback(np(k&&m),[k,m]),he),T=y.useRef(null),P=t??sp[s];y.useEffect(()=>{if(!(!E.current||!x))return T.current||(T.current=Mf({domNode:E.current,nodeId:x,getStoreItems:()=>{const{nodeLookup:C,transform:z,snapGrid:L,snapToGrid:j,nodeOrigin:M,domNode:S}=w.getState();return{nodeLookup:C,transform:z,snapGrid:L,snapToGrid:j,nodeOrigin:M,paneDomNode:S}},onChange:(C,z)=>{const{triggerNodeChanges:L,nodeLookup:j,parentLookup:M,nodeOrigin:S}=w.getState(),A=[],_={x:C.x,y:C.y},$=j.get(x);if($&&$.expandParent&&$.parentId){const O=$.origin??S,F=C.width??$.measured.width??0,V=C.height??$.measured.height??0,Y={id:$.id,parentId:$.parentId,rect:{width:F,height:V,...ci({x:C.x??$.position.x,y:C.y??$.position.y},{width:F,height:V},$.parentId,j,O)}},Z=Gs([Y],j,M,S);A.push(...Z),_.x=C.x?Math.max(O[0]*F,C.x):void 0,_.y=C.y?Math.max(O[1]*V,C.y):void 0}if(_.x!==void 0&&_.y!==void 0){const O={id:x,type:"position",position:{..._}};A.push(O)}if(C.width!==void 0&&C.height!==void 0){const F={id:x,type:"dimensions",resizing:!0,setAttributes:u?u==="horizontal"?"width":"height":!0,dimensions:{width:C.width,height:C.height}};A.push(F)}for(const O of z){const F={...O,type:"position"};A.push(F)}L(A)},onEnd:({width:C,height:z})=>{const L={id:x,type:"dimensions",resizing:!1,dimensions:{width:C,height:z}};w.getState().triggerNodeChanges([L])}})),T.current.update({controlPosition:P,boundaries:{minWidth:l,minHeight:c,maxWidth:d,maxHeight:h},keepAspectRatio:f,resizeDirection:u,onResizeStart:b,onResize:g,onResizeEnd:v,shouldResize:p}),()=>{T.current?.destroy()}},[P,l,c,d,h,f,b,g,v,p]);const R=P.split("-");return n.jsx("div",{className:xe(["react-flow__resize-control","nodrag",...R,s,r]),ref:E,style:{...o,scale:I,...i&&{[k?"backgroundColor":"borderColor"]:i}},children:a})}y.memo(rp);function ke({icon:e,onClick:t,active:s,title:r}){return n.jsx("button",{type:"button",onClick:t,title:r,className:`p-2 rounded-lg transition-colors ${s?"bg-blue-500 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,children:e})}function op({value:e,onChange:t,direction:s="rtl",placeholder:r=" ...",className:o=""}){const a=y.useRef(null),[i,l]=y.useState(null),[c,d]=y.useState(""),[h,f]=y.useState(""),u=y.useCallback((g,v)=>{document.execCommand(g,!1,v),a.current?.focus(),m()},[]),m=y.useCallback(()=>{a.current&&t(a.current.innerHTML)},[t]),p=y.useCallback(g=>{if(!c)return;let v="";if(g==="image")v=`<img src="${c}" alt="${h}" class="inline-media rounded-lg max-w-full my-2" />`;else if(c.includes("youtube.com")||c.includes("youtu.be")){const N=c.match(/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/\s]{11})/)?.[1];N&&(v=`<iframe src="https://www.youtube.com/embed/${N}" class="inline-media rounded-lg w-full aspect-video my-2" frameborder="0" allowfullscreen></iframe>`)}else v=`<video src="${c}" controls class="inline-media rounded-lg max-w-full my-2"></video>`;v&&(document.execCommand("insertHTML",!1,v),m()),l(null),d(""),f("")},[c,h,m]),b=y.useCallback(()=>{const g=prompt(" :");g&&u("createLink",g)},[u]);return n.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 overflow-hidden ${o}`,children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 border-b border-slate-700 bg-slate-900/50",children:[n.jsx(ke,{icon:n.jsx(bl,{className:"w-4 h-4"}),onClick:()=>u("bold"),title:""}),n.jsx(ke,{icon:n.jsx(kl,{className:"w-4 h-4"}),onClick:()=>u("italic"),title:""}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(ke,{icon:n.jsx(jl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","h1"),title:" "}),n.jsx(ke,{icon:n.jsx(Nl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","h2"),title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(ke,{icon:n.jsx(El,{className:"w-4 h-4"}),onClick:()=>u("insertUnorderedList"),title:" "}),n.jsx(ke,{icon:n.jsx(_l,{className:"w-4 h-4"}),onClick:()=>u("insertOrderedList"),title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(ke,{icon:n.jsx(nt,{className:"w-4 h-4"}),onClick:()=>l("image"),title:" "}),n.jsx(ke,{icon:n.jsx(ut,{className:"w-4 h-4"}),onClick:()=>l("video"),title:" "}),n.jsx(ke,{icon:n.jsx(po,{className:"w-4 h-4"}),onClick:b,title:" "}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(ke,{icon:n.jsx(zl,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","blockquote"),title:""}),n.jsx(ke,{icon:n.jsx(Mn,{className:"w-4 h-4"}),onClick:()=>u("formatBlock","pre"),title:""}),n.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),n.jsx(ke,{icon:s==="rtl"?n.jsx(gl,{className:"w-4 h-4"}):n.jsx(xl,{className:"w-4 h-4"}),onClick:()=>{a.current&&(a.current.dir=a.current.dir==="rtl"?"ltr":"rtl")},title:" "}),n.jsx("div",{className:"flex-1"}),n.jsx(ke,{icon:n.jsx(Vl,{className:"w-4 h-4"}),onClick:()=>u("undo"),title:""}),n.jsx(ke,{icon:n.jsx(Rl,{className:"w-4 h-4"}),onClick:()=>u("redo"),title:""})]}),n.jsx("div",{ref:a,contentEditable:!0,dir:s,className:`min-h-[200px] p-4 outline-none rich-text-content ${s==="rtl"?"rtl":""}`,onInput:m,dangerouslySetInnerHTML:{__html:e},"data-placeholder":r,style:{minHeight:"200px"}}),i&&n.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:i==="image"?" ":" "}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:i==="image"?" ":" "}),n.jsx("input",{type:"url",value:c,onChange:g=>d(g.target.value),placeholder:i==="image"?"https://example.com/image.jpg":"https://youtube.com/watch?v=...",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",dir:"ltr"})]}),i==="image"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"  ()"}),n.jsx("input",{type:"text",value:h,onChange:g=>f(g.target.value),placeholder:" ",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),i==="video"&&n.jsx("p",{className:"text-sm text-slate-400",children:"   YouTube    "})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:()=>{l(null),d(""),f("")},className:"flex-1 px-4 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:""}),n.jsx("button",{onClick:()=>p(i),disabled:!c,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:""})]})]})})]})}function ip({onRecordingComplete:e,onClose:t,showLibrarySave:s=!0}){const[r,o]=y.useState(null),[a,i]=y.useState("idle"),[l,c]=y.useState(0),[d,h]=y.useState(null),[f,u]=y.useState(null),[m,p]=y.useState(!0),b=y.useRef(null),g=y.useRef(null),v=y.useRef(null),N=y.useRef(null),x=y.useRef([]),w=y.useRef(null),E=y.useRef(null),k=y.useRef(null),I=y.useRef(null);y.useEffect(()=>()=>{T(),k.current&&clearInterval(k.current),I.current&&cancelAnimationFrame(I.current)},[]);const T=y.useCallback(()=>{w.current&&(w.current.getTracks().forEach(A=>A.stop()),w.current=null),E.current&&(E.current.getTracks().forEach(A=>A.stop()),E.current=null)},[]),P=y.useCallback(async A=>{u(null),i("preparing"),o(A),x.current=[];try{let _;if(A==="camera")_=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:"user"},audio:m}),w.current=_,b.current&&(b.current.srcObject=_,await b.current.play());else if(A==="screen"){const O=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080},audio:!0});if(m)try{const V=(await navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0];O.addTrack(V)}catch{console.log("Could not add microphone audio")}_=O,w.current=_,b.current&&(b.current.srcObject=_,await b.current.play())}else{const O=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080},audio:!1}),F=await navigator.mediaDevices.getUserMedia({video:{width:320,height:240,facingMode:"user"},audio:m});w.current=O,E.current=F,b.current&&(b.current.srcObject=O,await b.current.play()),g.current&&(g.current.srcObject=F,await g.current.play());const V=v.current,Y=V.getContext("2d");V.width=1920,V.height=1080;const Z=()=>{if(a==="stopped")return;Y.drawImage(b.current,0,0,V.width,V.height);const Q=320,B=240,D=20;Y.save(),Y.beginPath(),Y.arc(V.width-D-Q/2,V.height-D-B/2,Math.min(Q,B)/2,0,Math.PI*2),Y.clip(),Y.drawImage(g.current,V.width-D-Q,V.height-D-B,Q,B),Y.restore(),I.current=requestAnimationFrame(Z)};Z();const ee=V.captureStream(30);m&&F.getAudioTracks().length>0&&ee.addTrack(F.getAudioTracks()[0]),_=ee}const $=new MediaRecorder(_,{mimeType:"video/webm;codecs=vp9"});$.ondataavailable=O=>{O.data.size>0&&x.current.push(O.data)},$.onstop=()=>{const O=new Blob(x.current,{type:"video/webm"});h(O),i("stopped"),T(),I.current&&cancelAnimationFrame(I.current)},N.current=$,$.start(1e3),i("recording"),c(0),k.current=window.setInterval(()=>{c(O=>O+1)},1e3)}catch(_){console.error("Recording error:",_),u("   .     ."),i("idle"),o(null),T()}},[m,T]),R=y.useCallback(()=>{N.current&&a==="recording"&&(N.current.pause(),i("paused"),k.current&&clearInterval(k.current))},[a]),C=y.useCallback(()=>{N.current&&a==="paused"&&(N.current.resume(),i("recording"),k.current=window.setInterval(()=>{c(A=>A+1)},1e3))},[a]),z=y.useCallback(()=>{N.current&&(N.current.stop(),k.current&&clearInterval(k.current))},[]),L=y.useCallback(()=>{h(null),i("idle"),o(null),c(0),u(null),T()},[T]),j=y.useCallback(()=>{d&&r&&e&&e(d,r)},[d,r,e]),M=y.useCallback(()=>{if(d){const A=URL.createObjectURL(d),_=document.createElement("a");_.href=A,_.download=`recording-${Date.now()}.webm`,_.click(),URL.revokeObjectURL(A)}},[d]),S=A=>{const _=Math.floor(A/60),$=A%60;return`${_.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`};return n.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h3",{className:"text-lg font-bold text-white",children:" "}),t&&n.jsx("button",{onClick:t,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-4",children:[a==="idle"&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{className:"text-slate-300 text-center mb-6",children:"  "}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[n.jsxs("button",{onClick:()=>P("camera"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-500/20 flex items-center justify-center group-hover:bg-blue-500/30 transition-colors",children:n.jsx(yo,{className:"w-7 h-7 text-blue-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:""}),n.jsx("div",{className:"text-xs text-slate-400",children:"   "})]})]}),n.jsxs("button",{onClick:()=>P("screen"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-emerald-500/20 flex items-center justify-center group-hover:bg-emerald-500/30 transition-colors",children:n.jsx($l,{className:"w-7 h-7 text-emerald-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:""}),n.jsx("div",{className:"text-xs text-slate-400",children:"  "})]})]}),n.jsxs("button",{onClick:()=>P("camera_screen"),className:"flex flex-col items-center gap-3 p-6 bg-slate-700/50 hover:bg-slate-700 rounded-xl transition-colors group",children:[n.jsx("div",{className:"w-14 h-14 rounded-full bg-amber-500/20 flex items-center justify-center group-hover:bg-amber-500/30 transition-colors",children:n.jsx(Tl,{className:"w-7 h-7 text-amber-400"})}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-white font-medium",children:" + "}),n.jsx("div",{className:"text-xs text-slate-400",children:" Loom"})]})]})]}),n.jsx("div",{className:"flex items-center justify-center gap-2 pt-4",children:n.jsxs("button",{onClick:()=>p(!m),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${m?"bg-blue-500/20 text-blue-400":"bg-slate-700 text-slate-400"}`,children:[m?n.jsx(Al,{className:"w-4 h-4"}):n.jsx(Ml,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:m?" ":" "})]})}),f&&n.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-sm text-center",children:f})]}),a==="preparing"&&n.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[n.jsx(pe,{className:"w-12 h-12 text-blue-400 animate-spin mb-4"}),n.jsx("p",{className:"text-slate-300",children:" ..."})]}),(a==="recording"||a==="paused")&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative aspect-video bg-black rounded-xl overflow-hidden",children:[n.jsx("video",{ref:b,className:"w-full h-full object-contain",muted:!0,playsInline:!0}),r==="camera_screen"&&n.jsx("video",{ref:g,className:"absolute bottom-4 right-4 w-32 h-24 rounded-full object-cover border-2 border-white shadow-lg",muted:!0,playsInline:!0}),n.jsx("canvas",{ref:v,className:"hidden"}),n.jsx("div",{className:"absolute top-4 left-4",children:n.jsx("div",{className:`recording-indicator ${a==="paused"?"opacity-50":""}`,children:n.jsx("span",{className:"text-sm font-medium",children:a==="paused"?" ":" "})})}),n.jsx("div",{className:"absolute top-4 right-4 bg-black/50 px-3 py-1 rounded-full",children:n.jsx("span",{className:"text-white font-mono text-sm",children:S(l)})})]}),n.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a==="recording"?n.jsx("button",{onClick:R,className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors",title:" ",children:n.jsx(ul,{className:"w-6 h-6 text-white"})}):n.jsx("button",{onClick:C,className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors",title:"",children:n.jsx(mo,{className:"w-6 h-6 text-white"})}),n.jsx("button",{onClick:z,className:"p-4 bg-red-500 hover:bg-red-600 rounded-full transition-colors",title:" ",children:n.jsx(wo,{className:"w-6 h-6 text-white fill-current"})})]})]}),a==="stopped"&&d&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"aspect-video bg-black rounded-xl overflow-hidden",children:n.jsx("video",{src:URL.createObjectURL(d),controls:!0,className:"w-full h-full object-contain"})}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"text-slate-400 text-sm",children:[": ",S(l)]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:L,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[n.jsx(hl,{className:"w-4 h-4"}),n.jsx("span",{children:" "})]}),n.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[n.jsx(fl,{className:"w-4 h-4"}),n.jsx("span",{children:""})]}),s&&n.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[n.jsx(En,{className:"w-4 h-4"}),n.jsx("span",{children:""})]})]})]})]})]})]})}function ap({block:e,allBlocks:t,edges:s,onUpdate:r,onAddEdge:o,onRemoveEdge:a,onClose:i}){const{enabled:l,isLoading:c}=Ns(),[d,h]=y.useState("content"),f=(p,b)=>{r({content:{...e.content,[p]:b}})},u=s.filter(p=>p.from===e.id),m=t.filter(p=>p.id!==e.id&&!u.some(b=>b.to===p.id));return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit Block"}),n.jsx("button",{onClick:i,className:"p-1.5 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:n.jsxs("div",{className:"p-4 space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title"}),n.jsx("input",{type:"text",value:e.content.title||"",onChange:p=>f("title",p.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Block title"})]}),n.jsx(io,{title:"Content",isOpen:d==="content",onToggle:()=>h(d==="content"?"":"content"),children:lp(e,f,l,c)}),n.jsx(io,{title:"Connections",isOpen:d==="connections",onToggle:()=>h(d==="connections"?"":"connections"),children:n.jsxs("div",{className:"space-y-3",children:[n.jsx("p",{className:"text-xs text-slate-500",children:"Define what happens after this block."}),u.length>0&&n.jsx("div",{className:"space-y-2",children:u.map(p=>{const b=t.find(g=>g.id===p.to);return n.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-900 rounded-lg group",children:[n.jsx("span",{className:"text-sm text-slate-300 flex-1",children:b?.content?.title||"Unknown block"}),p.condition&&n.jsx("span",{className:"text-xs text-warning mr-2",children:"Conditional"}),n.jsx("button",{onClick:()=>a(p.to),className:"p-1 text-slate-500 hover:text-error hover:bg-error/10 rounded transition-colors",title:"Remove connection",children:n.jsx(Te,{className:"w-4 h-4"})})]},`${p.from}-${p.to}`)})}),m.length>0&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Connect to:"}),n.jsxs("select",{onChange:p=>{p.target.value&&(o(p.target.value),p.target.value="")},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"",children:"Select a block..."}),m.map(p=>n.jsx("option",{value:p.id,children:p.content?.title||p.type},p.id))]})]}),e.type==="quiz"&&n.jsxs("div",{className:"mt-4 p-3 bg-slate-900/50 rounded-lg",children:[n.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Conditional Routing"}),n.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Add connections with conditions based on quiz score."}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("button",{onClick:()=>{const p=m[0];p&&o(p.id,{all:[{fact:"quiz.scorePercent",op:"gte",value:50}]})},disabled:m.length===0,className:"w-full px-3 py-2 text-sm bg-emerald-600/20 text-emerald-400 rounded-lg hover:bg-emerald-600/30 disabled:opacity-50 transition-colors",children:'Add "Pass" connection (score >= 50%)'}),n.jsx("button",{onClick:()=>{const p=m[0];p&&o(p.id,{all:[{fact:"quiz.scorePercent",op:"lt",value:50}]})},disabled:m.length===0,className:"w-full px-3 py-2 text-sm bg-red-600/20 text-red-400 rounded-lg hover:bg-red-600/30 disabled:opacity-50 transition-colors",children:'Add "Fail" connection (score < 50%)'})]})]})]})})]})})]})}function io({title:e,isOpen:t,onToggle:s,children:r}){return n.jsxs("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:[n.jsxs("button",{onClick:s,className:"w-full flex items-center justify-between px-4 py-3 bg-slate-800 text-white hover:bg-slate-700 transition-colors",children:[n.jsx("span",{className:"font-medium",children:e}),t?n.jsx(gn,{className:"w-4 h-4"}):n.jsx(xn,{className:"w-4 h-4"})]}),t&&n.jsx("div",{className:"p-4 bg-slate-800/50",children:r})]})}function lp(e,t,s,r){const o=e.content;switch(e.type){case"read":return n.jsx(cp,{content:o,updateContent:t,aiEnabled:s,aiSettingsLoading:r});case"video":return n.jsx(dp,{content:o,updateContent:t,aiEnabled:s,aiSettingsLoading:r});case"image":return n.jsx(up,{content:o,updateContent:t,aiEnabled:s,aiSettingsLoading:r});case"quiz":return n.jsx(hp,{content:o,updateContent:t,aiEnabled:s,aiSettingsLoading:r});case"mission":return n.jsx(fp,{content:o,updateContent:t});case"form":return n.jsx(mp,{content:o,updateContent:t});case"ai_help":return n.jsx(pp,{content:o,updateContent:t});case"checkpoint":return n.jsx(xp,{content:o,updateContent:t});case"animation":return n.jsx(gp,{content:o,updateContent:t});case"code":return n.jsx(yp,{content:o,updateContent:t});case"exercise":return n.jsx(vp,{content:o,updateContent:t});case"resource":return n.jsx(wp,{content:o,updateContent:t});default:return n.jsx("p",{className:"text-slate-500",children:"No editor available for this block type."})}}function cp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const[o,a]=y.useState(!1),[i,l]=y.useState(""),[c,d]=y.useState(!1),[h,f]=y.useState("markdown"),u=async()=>{if(!(!i.trim()||!s)){a(!0);try{const v=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"content",topic:i,existingContent:e.markdown||""})})).json();v.result&&(t("markdown",v.result),d(!1),l(""))}catch(g){console.error("AI generation failed:",g)}finally{a(!1)}}},m=g=>g?g.replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>").replace(/^- (.*$)/gm,"<li>$1</li>").replace(/\n/g,"<br>"):"",p=g=>g?g.replace(/<h1>(.*?)<\/h1>/g,`# $1
`).replace(/<h2>(.*?)<\/h2>/g,`## $1
`).replace(/<h3>(.*?)<\/h3>/g,`### $1
`).replace(/<strong>(.*?)<\/strong>/g,"**$1**").replace(/<b>(.*?)<\/b>/g,"**$1**").replace(/<em>(.*?)<\/em>/g,"*$1*").replace(/<i>(.*?)<\/i>/g,"*$1*").replace(/<code>(.*?)<\/code>/g,"`$1`").replace(/<blockquote>(.*?)<\/blockquote>/g,`> $1
`).replace(/<li>(.*?)<\/li>/g,`- $1
`).replace(/<br\s*\/?>/g,`
`).replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").trim():"",b=g=>{const v=p(g);t("markdown",v)};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm text-slate-400",children:"Editor Mode:"}),n.jsxs("div",{className:"flex bg-slate-900 rounded-lg p-1",children:[n.jsxs("button",{onClick:()=>f("markdown"),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm transition-colors ${h==="markdown"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:[n.jsx(Vt,{className:"w-4 h-4"}),"Markdown"]}),n.jsxs("button",{onClick:()=>f("richtext"),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm transition-colors ${h==="richtext"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:[n.jsx(Ol,{className:"w-4 h-4"}),"Rich Text"]})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:["Content (",h==="markdown"?"Markdown":"Rich Text",")"]}),h==="markdown"?n.jsx("textarea",{value:e.markdown||"",onChange:g=>t("markdown",g.target.value),rows:12,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:`# Heading

Your content here...`}):n.jsx(op,{value:m(e.markdown||""),onChange:b,direction:"ltr",placeholder:"Start writing your content...",className:"min-h-[300px]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Est. Read Time (minutes)"}),n.jsx("input",{type:"number",value:e.estimatedReadTime||3,onChange:g=>t("estimatedReadTime",parseInt(g.target.value)||3),min:1,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),!s&&!r?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(Tt,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI content generation is disabled by the administrator."})]}):c?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:i,onChange:g=>l(g.target.value),placeholder:"What topic should this content cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>d(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:u,disabled:o||!i.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[o?n.jsx(pe,{className:"w-4 h-4 animate-spin"}):n.jsx(be,{className:"w-4 h-4"}),o?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>d(!0),disabled:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(be,{className:"w-4 h-4"}),"Generate Content with AI"]})]})}function dp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const[o,a]=y.useState("url"),[i,l]=y.useState(!1),[c,d]=y.useState(""),[h,f]=y.useState(!1),[u,m]=y.useState(!1),p=async()=>{if(!(!c.trim()||!s)){l(!0);try{const v=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"video_script",topic:c,duration:5})})).json();v.result&&(t("transcript",v.result),t("description",`Video script: ${c}`),f(!1),d(""))}catch(g){console.error("AI generation failed:",g)}finally{l(!1)}}},b=async(g,v)=>{const N=URL.createObjectURL(g);t("url",N),t("recordingMode",v),m(!1),a("url")};return u?n.jsxs("div",{className:"space-y-4",children:[n.jsx(ip,{onRecordingComplete:b,onClose:()=>{m(!1),a("url")},showLibrarySave:!0}),n.jsx("p",{className:"text-xs text-slate-400 text-center",children:"Note: In production, videos will be uploaded to Taalam storage."})]}):n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>a("url"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="url"?"bg-primary-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(po,{className:"w-4 h-4"}),"URL"]}),n.jsxs("button",{onClick:()=>a("upload"),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="upload"?"bg-primary-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(xo,{className:"w-4 h-4"}),"Upload"]}),n.jsxs("button",{onClick:()=>{a("record"),m(!0)},className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${o==="record"?"bg-error text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[n.jsx(yo,{className:"w-4 h-4"}),"Record"]})]}),o==="url"?n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Video URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:g=>t("url",g.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://youtube.com/watch?v=... or video URL"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Supports YouTube, Vimeo, and direct video URLs"})]}):o==="upload"?n.jsxs("div",{className:"border-2 border-dashed border-slate-700 rounded-lg p-6 text-center",children:[n.jsx(ut,{className:"w-10 h-10 text-slate-600 mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Drag and drop or click to upload"}),n.jsx("input",{type:"file",accept:"video/*",className:"hidden"}),n.jsx("button",{className:"px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Choose File"})]}):null,n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Transcript / Script"}),n.jsx("textarea",{value:e.transcript||"",onChange:g=>t("transcript",g.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Video transcript or script..."})]}),!s&&!r?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(Tt,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI script generation is disabled by the administrator."})]}):h?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:c,onChange:g=>d(g.target.value),placeholder:"What should the video script cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>f(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:p,disabled:i||!c.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[i?n.jsx(pe,{className:"w-4 h-4 animate-spin"}):n.jsx(be,{className:"w-4 h-4"}),i?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>f(!0),disabled:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(be,{className:"w-4 h-4"}),"Generate Script with AI"]})]})}function up({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const o=["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=800"],[a,i]=y.useState(!1),[l,c]=y.useState(!1),[d,h]=y.useState(""),[f,u]=y.useState(!1);return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Image URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:m=>t("url",m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/image.jpg"})]}),e.url?n.jsx("div",{className:"relative aspect-video bg-slate-900 rounded-lg overflow-hidden",children:n.jsx("img",{src:e.url,alt:"Preview",className:"w-full h-full object-contain"})}):n.jsxs("button",{onClick:()=>i(!a),className:"w-full aspect-video bg-slate-900 border-2 border-dashed border-slate-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-slate-600 transition-colors",children:[n.jsx(nt,{className:"w-8 h-8 text-slate-600"}),n.jsx("span",{className:"text-sm text-slate-400",children:"Choose from gallery or paste URL above"})]}),a&&!e.url&&n.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.map((m,p)=>n.jsx("button",{onClick:()=>{t("url",m),i(!1)},className:"aspect-video rounded overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all",children:n.jsx("img",{src:m,alt:"",className:"w-full h-full object-cover"})},p))}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Caption (optional)"}),n.jsx("input",{type:"text",value:e.caption||"",onChange:m=>t("caption",m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Image caption..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Alt Text"}),n.jsx("input",{type:"text",value:e.alt||"",onChange:m=>t("alt",m.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe the image for accessibility..."})]}),!r&&s&&n.jsxs("div",{className:"pt-4 border-t border-slate-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Generate with AI"}),!f&&n.jsx("button",{onClick:()=>u(!0),className:"text-xs text-primary-400 hover:text-primary-300",children:"Show"})]}),f&&n.jsxs("div",{className:"space-y-3",children:[n.jsx("textarea",{value:d,onChange:m=>h(m.target.value),placeholder:`Describe the image you want... (e.g., "A diagram showing how neural networks work" or "${e.caption||e.title||"educational illustration"}")`,rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-sm"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:async()=>{if(d.trim()){c(!0);try{const p=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/image-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({prompt:d,contextTitle:e.title})})).json();p.url?(t("url",p.url),u(!1),h("")):console.error("No URL in response:",p)}catch(m){console.error("AI image generation failed:",m)}finally{c(!1)}}},disabled:l||!d.trim(),className:"flex-1 px-3 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-lg text-sm font-medium hover:from-emerald-700 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:l?n.jsxs(n.Fragment,{children:[n.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(be,{className:"w-4 h-4"}),"Generate Image"]})}),n.jsx("button",{onClick:()=>{u(!1),h("")},disabled:l,className:"px-3 py-2 bg-slate-700 text-white rounded-lg text-sm hover:bg-slate-600 disabled:opacity-50 transition-colors",children:"Cancel"})]}),n.jsx("div",{className:"text-xs text-slate-500",children:"Powered by GPT-Image-1.5  Images are generated and hosted by OpenAI"})]})]}),!s&&!r&&n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(AlertCircle,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI image generation is disabled by the administrator."})]})]})}function hp({content:e,updateContent:t,aiEnabled:s,aiSettingsLoading:r}){const o=e.questions||[],[a,i]=y.useState(!1),[l,c]=y.useState(""),[d,h]=y.useState(!1),f=()=>{const b={id:`q_${Date.now()}`,prompt:"",choices:["","","",""],correctIndex:0,tags:[]};t("questions",[...o,b])},u=(b,g)=>{const v=o.map((N,x)=>x===b?{...N,...g}:N);t("questions",v)},m=b=>{t("questions",o.filter((g,v)=>v!==b))},p=async()=>{if(!(!l.trim()||!s)){i(!0);try{const g=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"quiz",topic:l})})).json();if(g.result&&Array.isArray(g.result)){const v=g.result.map((N,x)=>({...N,id:`q_${Date.now()}_${x}`}));t("questions",[...o,...v]),h(!1),c("")}}catch(b){console.error("AI generation failed:",b)}finally{i(!1)}}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{children:n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Passing Score (%)"})}),n.jsx("input",{type:"number",value:e.passingScore||50,onChange:b=>t("passingScore",parseInt(b.target.value)||50),min:0,max:100,className:"w-20 px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),n.jsx("div",{className:"space-y-4",children:o.map((b,g)=>n.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg space-y-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(_s,{className:"w-4 h-4 text-slate-600"}),n.jsxs("span",{className:"text-sm font-medium text-slate-400",children:["Q",g+1]})]}),n.jsx("button",{onClick:()=>m(g),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(Te,{className:"w-4 h-4"})})]}),n.jsx("input",{type:"text",value:b.prompt,onChange:v=>u(g,{prompt:v.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Question..."}),n.jsx("div",{className:"space-y-2",children:b.choices.map((v,N)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"radio",checked:b.correctIndex===N,onChange:()=>u(g,{correctIndex:N}),className:"w-4 h-4 text-emerald-500"}),n.jsx("input",{type:"text",value:v,onChange:x=>{const w=[...b.choices];w[N]=x.target.value,u(g,{choices:w})},className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Option ${N+1}`})]},N))}),n.jsx("input",{type:"text",value:b.explanation||"",onChange:v=>u(g,{explanation:v.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Explanation (shown after answer)..."}),n.jsx("input",{type:"text",value:b.tags.join(", "),onChange:v=>u(g,{tags:v.target.value.split(",").map(N=>N.trim()).filter(Boolean)}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tags (comma-separated)..."})]},b.id))}),n.jsxs("button",{onClick:f,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Question"]}),!s&&!r?n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-warning/10 border border-warning/20 rounded-lg text-warning text-sm",children:[n.jsx(Tt,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:"AI question generation is disabled by the administrator."})]}):d?n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{type:"text",value:l,onChange:b=>c(b.target.value),placeholder:"What topic should the questions cover?",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),n.jsxs("button",{onClick:p,disabled:a||!l.trim(),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[a?n.jsx(pe,{className:"w-4 h-4 animate-spin"}):n.jsx(be,{className:"w-4 h-4"}),a?"Generating...":"Generate"]})]})]}):n.jsxs("button",{onClick:()=>h(!0),disabled:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(be,{className:"w-4 h-4"}),"Generate Questions with AI"]})]})}function fp({content:e,updateContent:t}){const s=e.steps||[],[r,o]=y.useState(null),a=()=>{const c={id:`step_${Date.now()}`,instruction:"",verificationMethod:"self_report"};t("steps",[...s,c])},i=(c,d)=>{const h=s.map((f,u)=>u===c?{...f,...d}:f);t("steps",h)},l=c=>{t("steps",s.filter((d,h)=>h!==c))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:c=>t("description",c.target.value),rows:2,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"What is this mission about?"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"External URL (optional)"}),n.jsx("input",{type:"url",value:e.externalUrl||"",onChange:c=>t("externalUrl",c.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Steps"}),s.map((c,d)=>n.jsx("div",{className:"p-3 bg-slate-900 rounded-lg space-y-2",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded bg-slate-700 flex items-center justify-center text-xs text-slate-400 mt-1",children:d+1}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("input",{type:"text",value:c.instruction,onChange:h=>i(d,{instruction:h.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Step instruction / question..."}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("select",{value:c.verificationMethod||"self_report",onChange:h=>i(d,{verificationMethod:h.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"self_report",children:"Self Report"}),n.jsx("option",{value:"screenshot",children:"Screenshot"}),n.jsx("option",{value:"url_check",children:"URL Check"}),n.jsx("option",{value:"ai_validate",children:"AI Validation"})]}),c.verificationMethod==="ai_validate"&&n.jsx("button",{onClick:()=>o(r===c.id?null:c.id),className:"px-2 py-1 text-xs bg-primary-600/20 text-primary-400 rounded hover:bg-primary-600/30 transition-colors",children:r===c.id?"Hide Options":"AI Options"})]}),c.verificationMethod==="ai_validate"&&r===c.id&&n.jsxs("div",{className:"space-y-2 p-2 bg-slate-800 rounded border border-slate-700",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Expected Criteria"}),n.jsx("textarea",{value:c.expectedCriteria||"",onChange:h=>i(d,{expectedCriteria:h.target.value}),rows:2,className:"w-full px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white placeholder-slate-500 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Describe what makes a correct answer (e.g., 'Must mention key concept X and demonstrate understanding of Y')"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Input Type"}),n.jsxs("select",{value:c.inputType||"text",onChange:h=>i(d,{inputType:h.target.value}),className:"w-full px-2 py-1 bg-slate-900 border border-slate-700 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"text",children:"Single Line (short answer)"}),n.jsx("option",{value:"textarea",children:"Multi Line (long answer)"})]})]})]})]}),n.jsx("button",{onClick:()=>l(d),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(Te,{className:"w-4 h-4"})})]})},c.id))]}),n.jsxs("button",{onClick:a,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Step"]}),n.jsx("div",{className:"p-3 bg-primary-900/20 border border-primary-700/30 rounded-lg",children:n.jsxs("p",{className:"text-xs text-primary-300",children:[n.jsx("strong",{children:"AI Validation:"})," When selected, learners must provide an answer that will be evaluated by AI against your criteria. The AI will provide feedback and mark the step as complete if correct."]})})]})}function mp({content:e,updateContent:t}){const s=e.fields||[],r=i=>{const l={id:`field_${Date.now()}`,type:i,label:"",required:!1};t("fields",[...s,l])},o=(i,l)=>{const c=s.map((d,h)=>h===i?{...d,...l}:d);t("fields",c)},a=i=>{t("fields",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:i=>t("description",i.target.value),rows:2,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Fields"}),s.map((i,l)=>n.jsx("div",{className:"p-2 bg-slate-900 rounded-lg space-y-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("select",{value:i.type,onChange:c=>o(l,{type:c.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"text",children:"Text"}),n.jsx("option",{value:"textarea",children:"Textarea"}),n.jsx("option",{value:"select",children:"Select"}),n.jsx("option",{value:"checkbox",children:"Checkbox"}),n.jsx("option",{value:"radio",children:"Radio"})]}),n.jsx("input",{type:"text",value:i.label,onChange:c=>o(l,{label:c.target.value}),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Label..."}),n.jsxs("label",{className:"flex items-center gap-1 text-xs text-slate-400",children:[n.jsx("input",{type:"checkbox",checked:i.required,onChange:c=>o(l,{required:c.target.checked})}),"Required"]}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(Te,{className:"w-4 h-4"})})]})},i.id))]}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:["text","textarea","select","checkbox","radio"].map(i=>n.jsxs("button",{onClick:()=>r(i),className:"px-3 py-1 bg-slate-700 text-white text-sm rounded hover:bg-slate-600 transition-colors",children:["+ ",i]},i))})]})}function pp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Mode"}),n.jsxs("select",{value:e.mode||"targeted_remediation",onChange:s=>t("mode",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"targeted_remediation",children:"Targeted Remediation"}),n.jsx("option",{value:"open_chat",children:"Open Chat"}),n.jsx("option",{value:"guided_explanation",children:"Guided Explanation"})]}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:e.mode==="targeted_remediation"?"AI focuses on topics the learner struggled with":e.mode==="open_chat"?"Open-ended conversation about the material":"Step-by-step guided explanation"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Max Turns"}),n.jsx("input",{type:"number",value:e.maxTurns||5,onChange:s=>t("maxTurns",parseInt(s.target.value)||5),min:1,max:20,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}function xp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("textarea",{value:e.description||"",onChange:s=>t("description",s.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"What does this checkpoint evaluate?"})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Checkpoints evaluate learner progress and can branch to different paths based on performance. Use the Connections section to set up conditional routing."})]})}function gp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Animation Type"}),n.jsxs("select",{value:e.animationType||"lottie",onChange:s=>t("animationType",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"lottie",children:"Lottie"}),n.jsx("option",{value:"video",children:"Video"}),n.jsx("option",{value:"interactive",children:"Interactive"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Animation URL"}),n.jsx("input",{type:"url",value:e.url||"",onChange:s=>t("url",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.autoplay??!0,onChange:s=>t("autoplay",s.target.checked)}),"Autoplay"]}),n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.loop??!1,onChange:s=>t("loop",s.target.checked)}),"Loop"]})]})]})}const bp=["javascript","typescript","python","java","csharp","cpp","c","ruby","go","rust","php","swift","kotlin","sql","html","css","json","bash","shell","markdown","yaml","xml"];function yp({content:e,updateContent:t}){return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Language"}),n.jsx("select",{value:e.language||"javascript",onChange:s=>t("language",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:bp.map(s=>n.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Code"}),n.jsx("textarea",{value:e.code||"",onChange:s=>t("code",s.target.value),rows:12,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:"// Your code here..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description (optional)"}),n.jsx("input",{type:"text",value:e.description||"",onChange:s=>t("description",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the code..."})]}),n.jsx("div",{className:"flex items-center gap-4",children:n.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx("input",{type:"checkbox",checked:e.showLineNumbers??!0,onChange:s=>t("showLineNumbers",s.target.checked)}),"Show Line Numbers"]})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Highlight Lines (comma-separated)"}),n.jsx("input",{type:"text",value:(e.highlightLines||[]).join(", "),onChange:s=>{const r=s.target.value.split(",").map(o=>parseInt(o.trim())).filter(o=>!isNaN(o)&&o>0);t("highlightLines",r)},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 1, 3, 5-7"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Lines to highlight (e.g., 1, 3, 5)"})]})]})}function vp({content:e,updateContent:t}){const s=e.hints||[],r=()=>{t("hints",[...s,""])},o=(i,l)=>{const c=s.map((d,h)=>h===i?l:d);t("hints",c)},a=i=>{t("hints",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:e.description||"",onChange:i=>t("description",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Problem"}),n.jsx("textarea",{value:e.problem||"",onChange:i=>t("problem",i.target.value),rows:4,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Describe the problem or exercise..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Hints (optional)"}),n.jsx("div",{className:"space-y-2",children:s.map((i,l)=>n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded bg-slate-700 flex items-center justify-center text-xs text-slate-400 mt-1",children:l+1}),n.jsx("input",{type:"text",value:i,onChange:c=>o(l,c.target.value),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Hint..."}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(Te,{className:"w-4 h-4"})})]},l))}),n.jsxs("button",{onClick:r,className:"mt-2 flex items-center gap-2 px-3 py-1 bg-slate-700 text-white text-sm rounded hover:bg-slate-600 transition-colors",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Hint"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Solution"}),n.jsx("textarea",{value:e.solution||"",onChange:i=>t("solution",i.target.value),rows:6,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-none",placeholder:"The solution..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Solution Explanation (optional)"}),n.jsx("textarea",{value:e.solutionExplanation||"",onChange:i=>t("solutionExplanation",i.target.value),rows:3,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Explain why this solution works..."})]})]})}function wp({content:e,updateContent:t}){const s=e.resources||[],r=()=>{const i={id:`res_${Date.now()}`,title:"",url:"",type:"link"};t("resources",[...s,i])},o=(i,l)=>{const c=s.map((d,h)=>h===i?{...d,...l}:d);t("resources",c)},a=i=>{t("resources",s.filter((l,c)=>c!==i))};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),n.jsx("input",{type:"text",value:e.description||"",onChange:i=>t("description",i.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of resources..."})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Resources"}),s.map((i,l)=>n.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:i.title,onChange:c=>o(l,{title:c.target.value}),className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Resource title..."}),n.jsxs("select",{value:i.type,onChange:c=>o(l,{type:c.target.value}),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"link",children:"Link"}),n.jsx("option",{value:"download",children:"Download"}),n.jsx("option",{value:"video",children:"Video"}),n.jsx("option",{value:"document",children:"Document"})]}),n.jsx("button",{onClick:()=>a(l),className:"p-1 text-slate-500 hover:text-error",children:n.jsx(Te,{className:"w-4 h-4"})})]}),n.jsx("input",{type:"url",value:i.url,onChange:c=>o(l,{url:c.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."}),n.jsx("input",{type:"text",value:i.description||"",onChange:c=>o(l,{description:c.target.value}),className:"w-full px-2 py-1 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Description (optional)..."})]},i.id))]}),n.jsxs("button",{onClick:r,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:[n.jsx(et,{className:"w-4 h-4"}),"Add Resource"]})]})}function ao(e){const t=e.find(a=>a.isCurrent),s=e.filter(a=>!a.isCurrent&&a.orderIndex<(t?.orderIndex??999)&&a.graph?.blocks?.length);if(s.length===0)return"No previous module content available.";let r="";const o=e.length;return s.forEach(a=>{r+=`
${"".repeat(60)}
`,r+=`MODULE ${a.orderIndex+1} of ${o}: "${a.title}"
`,a.description&&(r+=`Description: ${a.description}
`),r+=`${"".repeat(60)}

`,a.graph&&a.graph.blocks&&a.graph.blocks.length>0&&a.graph.blocks.forEach((i,l)=>{const c=i.content;if(r+=`Block ${l+1} [${i.type.toUpperCase()}] "${c.title||"Untitled"}"
`,r+=`---
`,i.type==="read"&&c.markdown){const d=c.markdown;r+=d.length>500?`${d.substring(0,500)}...
`:`${d}
`}else i.type==="quiz"&&Array.isArray(c.questions)?(r+=`Quiz with ${c.questions.length} questions
`,c.questions.slice(0,2).forEach((d,h)=>{r+=`  ${h+1}. ${d.prompt}
`}),c.questions.length>2&&(r+=`  ... and ${c.questions.length-2} more questions
`)):i.type==="code"&&c.code?r+=`Language: ${c.language}
Code snippet (${c.code.split(`
`).length} lines)
`:i.type==="mission"&&Array.isArray(c.steps)?r+=`Mission with ${c.steps.length} steps
`:c.description&&(r+=`${c.description}
`);r+=`---

`})}),r.trim()}function jp({onGenerate:e,onClose:t,existingGraph:s,trackModulesContext:r=[],currentModuleId:o}){const{enabled:a,contentModel:i,isLoading:l}=Ns(),[c,d]=y.useState(1),[h,f]=y.useState(!1),[u,m]=y.useState(""),[p,b]=y.useState(!1),[g,v]=y.useState(""),[N,x]=y.useState("beginners"),[w,E]=y.useState("beginner"),[k,I]=y.useState(20),[T,P]=y.useState(6),[R,C]=y.useState(!0),[z,L]=y.useState(!0),[j,M]=y.useState(!0),[S,A]=y.useState(!1),[_,$]=y.useState(!0),[O,F]=y.useState(!1),[V,Y]=y.useState(!1),[Z,ee]=y.useState(!1),[Q,B]=y.useState(!0),[D,X]=y.useState(!1),[W,se]=y.useState(!1),[J,ne]=y.useState(!0),[ie,le]=y.useState(!1),[ce,ue]=y.useState(""),[Se,_e]=y.useState("gpt-4o"),[we,Fe]=y.useState(null);y.useEffect(()=>{!l&&i&&_e(i)},[l,i]);const Ge=async()=>{f(!0),m(""),ue(J?"Researching topic on the web...":"Generating course...");try{const K=await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:"outline",topic:g,targetAudience:N,difficulty:w,duration:k,blockCount:T,includeVideo:R,includeQuiz:z,includeMission:j,includeImage:S,includeCode:_,includeExercise:O,includeResource:V,includeForm:Z,includeAIHelp:Q,includeCheckpoint:D,includeAnimation:W,existingGraph:s,enableWebResearch:J,model:Se,trackModulesContext:r,generateImages:ie&&S})});if(ue("Creating course structure..."),!K.ok)throw new Error("Failed to generate course");const ge=await K.json();if(ge.error)throw new Error(ge.error);if(ge.result&&typeof ge.result=="object")Fe(ge.result),d(3);else throw new Error("Invalid response format")}catch(K){m(K instanceof Error?K.message:"Generation failed")}finally{f(!1)}},qe=()=>{we&&e(we)};return n.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col border border-slate-700 shadow-2xl",children:[n.jsxs("div",{className:"p-6 border-b border-slate-700 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(be,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-white",children:"AI Course Generator"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Create a complete course with AI assistance"})]})]}),n.jsx("button",{onClick:t,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-700 transition-colors",children:n.jsx(Ct,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[!l&&!a?n.jsx(go,{}):l?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx(pe,{className:"w-8 h-8 text-purple-500 animate-spin"})}):c===1&&n.jsxs("div",{className:"space-y-6",children:[r.length>1&&(()=>{const K=r.find(H=>H.isCurrent),ge=r.filter(H=>!H.isCurrent&&H.orderIndex<(K?.orderIndex??999)),je=ge.filter(H=>H.graph?.blocks?.length),Me=ge.filter(H=>!H.graph?.blocks?.length),Ne=Me.length>0&&ge.length>0;return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:`flex items-start gap-3 p-4 border rounded-xl ${Ne?"bg-amber-500/10 border-amber-500/20":"bg-purple-500/10 border-purple-500/20"}`,children:[Ne?n.jsx(Tt,{className:"w-5 h-5 text-amber-400 mt-0.5 flex-shrink-0"}):n.jsx(be,{className:"w-5 h-5 text-purple-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:`font-medium mb-1 ${Ne?"text-amber-300":"text-purple-300"}`,children:"Track-Aware Generation"}),je.length>0?n.jsxs("div",{className:"text-sm text-slate-400 mb-2",children:["AI will reference FULL content from ",je.length," previous module",je.length!==1?"s":""," to ensure progressive learning."]}):ge.length>0?n.jsx("div",{className:"text-sm text-amber-400/80 mb-2",children:"Warning: No content found in previous modules. AI will generate standalone content."}):n.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"This is the first module in the track."}),n.jsx("div",{className:"space-y-1",children:r.map(H=>{const G=!H.isCurrent&&H.orderIndex<(K?.orderIndex??999),U=H.graph?.blocks?.length,q=H.graph?.blocks?.length||0;return n.jsxs("div",{className:`text-xs flex items-center gap-2 ${H.isCurrent?"text-purple-300 font-medium":G&&U?"text-emerald-400":G&&!U?"text-amber-400":"text-slate-500"}`,children:[G&&U&&n.jsx(cn,{className:"w-3 h-3"}),G&&!U&&n.jsx(Tt,{className:"w-3 h-3"}),!G&&n.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current ml-0.5"}),n.jsxs("span",{children:["Module ",H.orderIndex+1,": ",H.title]}),U&&n.jsxs("span",{className:"text-slate-500",children:["(",q," blocks)"]}),G&&!U&&n.jsx("span",{className:"text-amber-400/70",children:"(empty)"}),H.isCurrent&&n.jsx("span",{className:"text-purple-400",children:"(generating)"})]},H.moduleId)})}),je.length>0&&n.jsxs("button",{onClick:()=>b(!p),className:"mt-3 flex items-center gap-1.5 text-xs text-purple-400 hover:text-purple-300 transition-colors",children:[n.jsx(ml,{className:"w-3.5 h-3.5"}),p?"Hide":"Preview"," AI Context",p?n.jsx(gn,{className:"w-3 h-3"}):n.jsx(xn,{className:"w-3 h-3"})]})]})]}),p&&je.length>0&&n.jsxs("div",{className:"p-4 bg-slate-900/80 border border-slate-700 rounded-xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Context Preview"}),n.jsxs("span",{className:"text-xs text-slate-500",children:[ao(r).length.toLocaleString()," characters"]})]}),n.jsx("pre",{className:"text-xs text-slate-400 whitespace-pre-wrap max-h-64 overflow-y-auto font-mono bg-slate-950/50 p-3 rounded-lg",children:ao(r)})]}),Ne&&n.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-500/5 border border-amber-500/10 rounded-lg",children:[n.jsx(dn,{className:"w-4 h-4 text-amber-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"text-xs text-amber-300/80",children:[n.jsx("span",{className:"font-medium",children:"Tip:"})," For best results, generate or add content to ",Me.map(H=>`Module ${H.orderIndex+1}`).join(", ")," first. This ensures the AI can build upon previous concepts."]})]})]})})(),s&&s.blocks.length>0&&n.jsxs("div",{className:"flex items-start gap-3 p-4 bg-primary-500/10 border border-primary-500/20 rounded-xl",children:[n.jsx(dn,{className:"w-5 h-5 text-primary-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-medium text-primary-300 mb-1",children:"Building Upon Existing Content"}),n.jsxs("div",{className:"text-sm text-slate-400",children:["AI will see your ",s.blocks.length," existing blocks and generate content that complements what you already have."]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"What do you want to teach?"}),n.jsx("textarea",{value:g,onChange:K=>v(K.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"e.g., Introduction to Machine Learning, How to use ChatGPT effectively, Basic Python programming..."})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Audience"}),n.jsxs("select",{value:N,onChange:K=>x(K.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginners",children:"Complete Beginners"}),n.jsx("option",{value:"students",children:"Students"}),n.jsx("option",{value:"professionals",children:"Professionals"}),n.jsx("option",{value:"technical",children:"Technical Audience"}),n.jsx("option",{value:"general",children:"General Audience"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Difficulty Level"}),n.jsxs("select",{value:w,onChange:K=>E(K.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginner",children:"Beginner"}),n.jsx("option",{value:"intermediate",children:"Intermediate"}),n.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),n.jsx("button",{onClick:()=>d(2),disabled:!g.trim(),className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Continue"})]}),c===2&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"p-4 bg-slate-900/50 rounded-xl",children:[n.jsx("h3",{className:"font-medium text-white mb-1",children:"Topic"}),n.jsx("p",{className:"text-slate-400",children:g})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Duration (minutes)"}),n.jsx("input",{type:"number",value:k,onChange:K=>I(parseInt(K.target.value)||20),min:5,max:120,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Number of Steps"}),n.jsx("input",{type:"number",value:T,onChange:K=>P(parseInt(K.target.value)||6),min:3,max:20,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Content Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:R,onChange:K=>C(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(ut,{className:"w-5 h-5 text-rose-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Video Blocks"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Add placeholder video sections"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:S,onChange:K=>A(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(nt,{className:"w-5 h-5 text-emerald-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Image Blocks"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Add placeholder images and diagrams"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:_,onChange:K=>$(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Mn,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Code Snippets"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Syntax-highlighted code examples"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:V,onChange:K=>Y(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(ks,{className:"w-5 h-5 text-indigo-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Additional Resources"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Curated links and downloads"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Interactive Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:z,onChange:K=>L(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Ft,{className:"w-5 h-5 text-purple-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Quiz & Assessment"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Test learner understanding with questions"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:j,onChange:K=>M(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(In,{className:"w-5 h-5 text-orange-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Hands-on Mission"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Practical task for learners to complete"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:O,onChange:K=>F(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Cs,{className:"w-5 h-5 text-violet-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Practice Exercises"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Problems with hints and solutions"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:Z,onChange:K=>ee(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Vt,{className:"w-5 h-5 text-warning"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Data Collection Forms"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Gather learner input and surveys"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Support Blocks"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:Q,onChange:K=>B(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(Ss,{className:"w-5 h-5 text-primary-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"AI Help / Remediation"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Personalized AI tutoring when struggling"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:D,onChange:K=>X(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(An,{className:"w-5 h-5 text-accent"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Progress Checkpoints"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Validate understanding before continuing"})]})]}),n.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-900/70 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:W,onChange:K=>se(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-purple-500 focus:ring-purple-500"}),n.jsx(mo,{className:"w-5 h-5 text-pink-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Animations"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Interactive visual animations"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"AI Research & Generation"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-primary-500/10 to-accent/10 border border-primary-500/20 rounded-xl cursor-pointer hover:border-primary-500/40 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:J,onChange:K=>ne(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-blue-500 focus:ring-blue-500"}),n.jsx(wl,{className:"w-5 h-5 text-blue-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Web Research"}),n.jsx("div",{className:"text-xs text-slate-400",children:"AI will search the web for the latest information on this topic to ensure accurate, up-to-date content"})]}),n.jsx(vo,{className:"w-4 h-4 text-blue-400/50"})]}),S&&n.jsxs("label",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-emerald-500/10 to-teal-500/10 border border-emerald-500/20 rounded-xl cursor-pointer hover:border-emerald-500/40 transition-colors",children:[n.jsx("input",{type:"checkbox",checked:ie,onChange:K=>le(K.target.checked),className:"w-5 h-5 rounded border-slate-600 text-emerald-500 focus:ring-emerald-500"}),n.jsx(nt,{className:"w-5 h-5 text-emerald-400"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-white font-medium",children:"Generate AI Images"}),n.jsx("div",{className:"text-xs text-slate-400",children:"Automatically generate educational images/diagrams for image blocks using GPT-Image-1.5"})]}),n.jsx(be,{className:"w-4 h-4 text-emerald-400/50"})]})]})]}),u&&n.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400",children:[n.jsx(dn,{className:"w-5 h-5 flex-shrink-0"}),n.jsx("span",{children:u})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>d(1),className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"Back"}),n.jsx("button",{onClick:Ge,disabled:h,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-all",children:h?n.jsxs(n.Fragment,{children:[n.jsx(pe,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{className:"text-sm",children:ce})]}):n.jsxs(n.Fragment,{children:[n.jsx(Gl,{className:"w-5 h-5"}),"Generate Course"]})})]})]}),c===3&&we&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center gap-3 p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl",children:[n.jsx(cn,{className:"w-6 h-6 text-emerald-400"}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-emerald-400",children:"Course Generated!"}),n.jsxs("div",{className:"text-sm text-slate-400",children:[we.blocks.length," blocks created with proper flow"]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-medium text-slate-300 mb-3",children:"Generated Structure"}),n.jsx("div",{className:"space-y-2",children:we.blocks.map((K,ge)=>{const je=K.content,Me=we.startBlockId===K.id;return n.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-900 rounded-lg",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-700 flex items-center justify-center text-sm font-medium text-slate-300",children:ge+1}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-white font-medium",children:je?.title||K.type}),Me&&n.jsx("span",{className:"px-1.5 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded",children:"Start"})]}),n.jsx("div",{className:"text-xs text-slate-500 capitalize",children:K.type})]})]},K.id)})})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>d(2),className:"flex-1 px-6 py-3 bg-slate-700 text-white rounded-xl font-medium hover:bg-slate-600 transition-colors",children:"Regenerate"}),n.jsxs("button",{onClick:qe,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 transition-all",children:[n.jsx(cn,{className:"w-5 h-5"}),"Use This Course"]})]})]})]}),n.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-900/50",children:n.jsx("div",{className:"flex items-center justify-center gap-2",children:[1,2,3].map(K=>n.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${c>=K?"bg-purple-500":"bg-slate-600"}`},K))})})]})})}const Np={read:{icon:Re,color:"bg-primary-500",label:"Read"},video:{icon:ut,color:"bg-rose-500",label:"Video"},image:{icon:nt,color:"bg-emerald-500",label:"Image"},quiz:{icon:Ft,color:"bg-purple-500",label:"Quiz"},mission:{icon:In,color:"bg-orange-500",label:"Mission"},form:{icon:Vt,color:"bg-teal-500",label:"Form"},ai_help:{icon:Ss,color:"bg-cyan-500",label:"AI Help"},checkpoint:{icon:An,color:"bg-yellow-500",label:"Checkpoint"},animation:{icon:bo,color:"bg-pink-500",label:"Animation"},code:{icon:Mn,color:"bg-slate-600",label:"Code"},exercise:{icon:Cs,color:"bg-violet-500",label:"Exercise"},resource:{icon:ks,color:"bg-indigo-500",label:"Resources"}};function kp(e){const t=e.content;switch(e.type){case"read":return`${t.estimatedReadTime||0} min read`;case"video":return t.url?"Video attached":"No video set";case"image":return t.url?"Image attached":"No image set";case"quiz":const s=t.questions||[];return`${s.length} question${s.length!==1?"s":""}`;case"mission":const r=t.steps||[];return`${r.length} step${r.length!==1?"s":""}`;case"form":const o=t.fields||[];return`${o.length} field${o.length!==1?"s":""}`;case"ai_help":return`Mode: ${t.mode||"remediation"}`;case"checkpoint":return"Progress checkpoint";case"animation":return t.animationType||"Animation";case"code":return t.language||"Code snippet";case"exercise":const a=t.hints||[];return`${a.length} hint${a.length!==1?"s":""}`;case"resource":const i=t.resources||[];return`${i.length} resource${i.length!==1?"s":""}`;default:return""}}function Cp({data:e,selected:t}){const{block:s,isStart:r,isMultiSelected:o,isConnectionTarget:a,hasPassEdge:i,hasFailEdge:l,onEdit:c,onDelete:d,onStartConnection:h}=e,f=Np[s.type]||{icon:Re,color:"bg-slate-600",label:"Block"},u=f.icon,m=s.content?.title||`${f.label} Block`,p=kp(s),b=s.type==="quiz";return n.jsxs("div",{className:`
        relative min-w-[240px] max-w-[300px] bg-slate-800 rounded-xl border-2 transition-all shadow-lg
        ${o?"border-blue-500 bg-slate-700":t?"border-primary-500":"border-slate-700 hover:border-slate-600"}
        ${a?"ring-2 ring-primary-400 ring-dashed ring-offset-2 ring-offset-slate-900":""}
      `,children:[n.jsx(Ke,{type:"target",position:te.Top,className:"!w-3 !h-3 !bg-slate-500 !border-2 !border-slate-400 hover:!bg-primary-500 hover:!border-primary-400 transition-colors"}),r&&n.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-emerald-500 text-white text-xs font-semibold rounded shadow",children:"START"}),n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:`w-10 h-10 ${f.color} rounded-lg flex items-center justify-center flex-shrink-0 shadow-md`,children:n.jsx(u,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:m}),n.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:f.label}),p&&n.jsx("p",{className:"text-xs text-slate-500 mt-1 truncate",children:p})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-1 mt-3 pt-3 border-t border-slate-700",children:[n.jsx("button",{onClick:g=>{g.stopPropagation(),h()},className:"p-1.5 text-slate-400 hover:text-primary-400 hover:bg-slate-700 rounded transition-colors",title:"Connect to another block",children:n.jsx(Sl,{className:"w-4 h-4"})}),n.jsx("button",{onClick:g=>{g.stopPropagation(),c()},className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors",title:"Edit block",children:n.jsx(Bl,{className:"w-4 h-4"})}),n.jsx("button",{onClick:g=>{g.stopPropagation(),d()},className:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded transition-colors",title:"Delete block",children:n.jsx(Te,{className:"w-4 h-4"})})]})]}),b?n.jsxs(n.Fragment,{children:[n.jsx(Ke,{type:"source",position:te.Bottom,id:"pass",className:`!w-3 !h-3 !border-2 transition-colors ${i?"!bg-emerald-500 !border-emerald-400":"!bg-emerald-500/50 !border-emerald-400/50 hover:!bg-emerald-500 hover:!border-emerald-400"}`,style:{left:"30%"}}),n.jsx(Ke,{type:"source",position:te.Bottom,id:"fail",className:`!w-3 !h-3 !border-2 transition-colors ${l?"!bg-red-500 !border-red-400":"!bg-red-500/50 !border-red-400/50 hover:!bg-red-500 hover:!border-red-400"}`,style:{left:"70%"}}),n.jsxs("div",{className:"absolute -bottom-5 left-0 right-0 flex justify-between px-6 pointer-events-none",children:[n.jsx("span",{className:"text-[10px] font-semibold text-emerald-400",children:"Pass"}),n.jsx("span",{className:"text-[10px] font-semibold text-red-400",children:"Fail"})]})]}):n.jsx(Ke,{type:"source",position:te.Bottom,className:"!w-3 !h-3 !bg-slate-500 !border-2 !border-slate-400 hover:!bg-primary-500 hover:!border-primary-400 transition-colors"})]})}const Sp=y.memo(Cp);function os(e){if(!e?.all?.[0])return"normal";const t=e.all[0];return t.fact==="quiz.scorePercent"?t.op==="gte"||t.op==="gt"?"pass":"fail":"normal"}const is=[{type:"read",label:"Read",icon:Re,color:"bg-primary-500"},{type:"video",label:"Video",icon:ut,color:"bg-rose-500"},{type:"image",label:"Image",icon:nt,color:"bg-emerald-500"},{type:"quiz",label:"Quiz",icon:Ft,color:"bg-purple-500"},{type:"mission",label:"Mission",icon:In,color:"bg-orange-500"},{type:"form",label:"Form",icon:Vt,color:"bg-teal-500"},{type:"ai_help",label:"AI Help",icon:Ss,color:"bg-cyan-500"},{type:"checkpoint",label:"Checkpoint",icon:An,color:"bg-yellow-500"},{type:"animation",label:"Animation",icon:bo,color:"bg-pink-500"},{type:"code",label:"Code",icon:Mn,color:"bg-slate-600"},{type:"exercise",label:"Exercise",icon:Cs,color:"bg-violet-500"},{type:"resource",label:"Resources",icon:ks,color:"bg-indigo-500"}],_p={blockNode:Sp},Ep={type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:2},markerEnd:{type:vt.ArrowClosed,color:"#6366f1"}};function Ip({moduleId:e,journeyVersionId:t,onBack:s}){const r=y.useRef(null),{screenToFlowPosition:o,fitView:a}=On(),[i,l]=y.useState({startBlockId:"",blocks:[],edges:[]}),[c,d,h]=Im([]),[f,u,m]=Mm([]),[p,b]=y.useState(null),[g,v]=y.useState(!1),[N,x]=y.useState(!1),[w,E]=y.useState(!1),[k,I]=y.useState(null),[T,P]=y.useState(""),[R,C]=y.useState(t),[z,L]=y.useState(!1),[j,M]=y.useState(!1),[S,A]=y.useState(null),[_,$]=y.useState(new Set),[O,F]=y.useState(!1),[V,Y]=y.useState([]),Z=y.useCallback((H,G)=>H.map((U,q)=>{const re=U.ui?.position||{x:400,y:100+q*200},de=i.edges.filter(ye=>ye.from===U.id),me=de.some(ye=>os(ye.condition)==="pass"),Ae=de.some(ye=>os(ye.condition)==="fail");return{id:U.id,type:"blockNode",position:re,data:{block:U,isStart:G===U.id,isSelected:p===U.id,isMultiSelected:_.has(U.id),isConnectionTarget:k!==null&&k.fromBlockId!==U.id,outgoingEdgesCount:de.length,hasPassEdge:me,hasFailEdge:Ae,onEdit:()=>{b(U.id),M(!0)},onDelete:()=>J(U.id),onStartConnection:()=>I({fromBlockId:U.id})}}}),[p,_,k,i.edges]),ee=y.useCallback(H=>{const G={pass:"#10b981",fail:"#ef4444",normal:"#6366f1"},U={pass:"Pass",fail:"Fail",normal:void 0};return H.map((q,re)=>{const de=os(q.condition),me=G[de],Ae=U[de];return{id:q.id||`edge-${q.from}-${q.to}-${re}`,source:q.from,target:q.to,sourceHandle:de!=="normal"?de:void 0,type:"smoothstep",animated:!0,style:{stroke:me,strokeWidth:2},markerEnd:{type:vt.ArrowClosed,color:me},label:Ae,labelStyle:{fill:me,fontWeight:600,fontSize:12},labelBgStyle:{fill:"#1e293b",fillOpacity:.9},labelBgPadding:[4,8],labelBgBorderRadius:4}})},[]);y.useEffect(()=>{const H=Z(i.blocks,i.startBlockId),G=ee(i.edges);d(H),u(G)},[i,Z,ee,d,u]),y.useEffect(()=>{B()},[e,t]),y.useEffect(()=>{if(S){const H=setTimeout(()=>A(null),4e3);return()=>clearTimeout(H)}},[S]);const Q=(H,G)=>{A({type:H,message:G})},B=async()=>{const{data:H}=await ve.from("modules").select("title, track_id").eq("id",e).single();if(H&&(P(H.title),H.track_id)){const{data:G}=await ve.from("modules").select(`
            id,
            title,
            description,
            order_index,
            journey_versions (
              id,
              graph_json,
              status,
              updated_at
            )
          `).eq("track_id",H.track_id).order("order_index");if(G&&G.length>0){const U=G.map(q=>{const re=q.journey_versions||[];let de=null;if(re.length>0){const me=re.find(Ae=>Ae.status==="published");me?de=me:de=re.sort((Ae,ye)=>new Date(ye.updated_at).getTime()-new Date(Ae.updated_at).getTime())[0]}return{moduleId:q.id,title:q.title,description:q.description,orderIndex:q.order_index,isCurrent:q.id===e,graph:de?.graph_json||null}});Y(U)}}if(t){const{data:G}=await ve.from("journey_versions").select("graph_json").eq("id",t).single();if(G?.graph_json){const U=G.graph_json,q=U.blocks.map((re,de)=>re.ui?.position?re:{...re,ui:{...re.ui,position:{x:400,y:100+de*200}}});l({...U,blocks:q}),setTimeout(()=>a({padding:.2}),100)}}},D=async()=>{v(!0);let H=R;const G=i.blocks.map(q=>{const re=c.find(de=>de.id===q.id);return re?{...q,ui:{...q.ui,position:re.position}}:q}),U={...i,blocks:G};try{if(R){const{error:q}=await ve.from("journey_versions").update({graph_json:U}).eq("id",R);if(q)throw q}else{const{data:q,error:re}=await ve.from("journey_versions").insert({module_id:e,version:1,status:"draft",graph_json:U}).select().single();if(re)throw re;q&&(C(q.id),H=q.id)}return l(U),L(!1),Q("success","Journey saved successfully"),H}catch(q){return console.error("Save error:",q),Q("error","Failed to save journey"),null}finally{v(!1)}},X=async()=>{if(i.blocks.length===0){Q("error","Cannot publish an empty journey. Add some blocks first.");return}x(!0);try{let H=R;if((!H||z)&&(H=await D()),!H)throw new Error("Failed to save journey before publishing");const{error:G}=await ve.from("journey_versions").update({status:"published"}).eq("id",H);if(G)throw G;const{data:U}=await ve.from("modules").select("track_id").eq("id",e).single();if(U?.track_id){const{error:q}=await ve.from("tracks").update({published_version_id:H}).eq("id",U.track_id);if(q)throw q}L(!1),Q("success","Journey published successfully! Learners can now access it.")}catch(H){console.error("Publish error:",H),Q("error","Failed to publish journey. Please try again.")}finally{x(!1)}},W=y.useCallback((H,G)=>{const U=`block_${Date.now()}`;let q=G;if(!q)if(i.blocks.length===0)q={x:400,y:100};else{const ye=i.blocks[i.blocks.length-1],Qt=c.find(Gn=>Gn.id===ye.id)?.position||ye.ui?.position||{x:400,y:0};q={x:Qt.x,y:Qt.y+200}}const re={id:U,type:H,content:Ap(H),ui:{position:q}},de=[...i.blocks,re],me=i.startBlockId||U,Ae=[...i.edges];if(i.blocks.length>0&&!i.edges.some(ye=>ye.to===U)){const ye=i.blocks[i.blocks.length-1];i.edges.some(Jt=>Jt.from===ye.id)||Ae.push({from:ye.id,to:U})}l({...i,blocks:de,edges:Ae,startBlockId:me}),b(U),M(!0),L(!0)},[i,c]),se=y.useCallback((H,G)=>{const U=i.blocks.map(q=>q.id===H?{...q,...G}:q);l({...i,blocks:U}),L(!0)},[i]),J=y.useCallback(H=>{const G=i.blocks.filter(re=>re.id!==H),U=i.edges.filter(re=>re.from!==H&&re.to!==H),q=i.startBlockId===H?G[0]?.id||"":i.startBlockId;l({...i,blocks:G,edges:U,startBlockId:q}),b(null),M(!1),L(!0)},[i]),ne=y.useCallback(()=>{const H=_.size,G=i.blocks.filter(q=>_.has(q.id)).slice(0,5).map(q=>q.content?.title||"Untitled").join(", "),U=H<=5?`Delete ${H} block${H>1?"s":""} (${G})?`:`Delete ${H} blocks (${G}, and ${H-5} more)?`;if(confirm(`${U}

All connections to these blocks will also be removed. This action cannot be undone.`)){F(!0);try{const q=i.blocks.filter(me=>!_.has(me.id)),re=i.edges.filter(me=>!_.has(me.from)&&!_.has(me.to));let de=i.startBlockId;_.has(i.startBlockId)&&(de=q[0]?.id||""),l({...i,blocks:q,edges:re,startBlockId:de}),$(new Set),b(null),M(!1),L(!0),Q("success",`Successfully deleted ${H} block${H>1?"s":""}`)}catch(q){console.error("Error bulk deleting blocks:",q),Q("error","Failed to delete some blocks. Please try again.")}finally{F(!1)}}},[i,_]),ie=y.useCallback(H=>{const G=new Set(_);G.has(H)?G.delete(H):G.add(H),$(G)},[_]),le=y.useCallback(()=>{$(new Set(i.blocks.map(H=>H.id)))},[i.blocks]),ce=y.useCallback(()=>{$(new Set)},[]),ue=y.useCallback((H,G)=>{if(i.edges.find(re=>re.from===H&&re.to===G)||H===G)return;const q={from:H,to:G};l({...i,edges:[...i.edges,q]}),L(!0)},[i]),Se=y.useCallback((H,G)=>{const U=i.edges.filter(q=>!(q.from===H&&q.to===G));l({...i,edges:U}),L(!0)},[i]),_e=y.useCallback(H=>{l({...i,startBlockId:H}),L(!0)},[i]),we=y.useCallback(H=>{H.source&&H.target&&ue(H.source,H.target)},[ue]),Fe=y.useCallback((H,G)=>{k?(k.fromBlockId!==G.id&&ue(k.fromBlockId,G.id),I(null)):(b(G.id),M(!0))},[k,ue]),Ge=y.useCallback((H,G)=>{const U=i.blocks.map(q=>q.id===G.id?{...q,ui:{...q.ui,position:G.position}}:q);l(q=>({...q,blocks:U})),L(!0)},[i.blocks]),qe=y.useCallback(H=>{H.forEach(G=>{Se(G.source,G.target)})},[Se]),K=y.useCallback(H=>{H.preventDefault(),H.dataTransfer.dropEffect="move"},[]),ge=y.useCallback(H=>{H.preventDefault();const G=H.dataTransfer.getData("application/reactflow-type");if(!G)return;const U=o({x:H.clientX,y:H.clientY});W(G,U)},[o,W]),je=y.useCallback((H,G)=>{H.dataTransfer.setData("application/reactflow-type",G),H.dataTransfer.effectAllowed="move"},[]),Me=H=>{const G=H.blocks.map((U,q)=>({...U,ui:{...U.ui,position:U.ui?.position||{x:400,y:100+q*200}}}));l({...H,blocks:G}),E(!1),L(!0),Q("success","AI-generated content added to journey"),setTimeout(()=>a({padding:.2}),100)},Ne=i.blocks.find(H=>H.id===p);return n.jsxs("div",{className:"h-full flex flex-col bg-slate-900",children:[S&&n.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg border ${S.type==="success"?"bg-emerald-500/20 border-emerald-500/30 text-emerald-300":S.type==="error"?"bg-error/20 border-error/30 text-error":"bg-primary-500/20 border-primary-500/30 text-primary-300"}`,children:[S.type==="success"?n.jsx(En,{className:"w-5 h-5"}):S.type==="error"?n.jsx(dn,{className:"w-5 h-5"}):n.jsx(pe,{className:"w-5 h-5"}),n.jsx("span",{className:"font-medium",children:S.message}),n.jsx("button",{onClick:()=>A(null),className:"ml-2 opacity-60 hover:opacity-100",children:n.jsx(Ct,{className:"w-4 h-4"})})]}),n.jsx("header",{className:"bg-slate-800 border-b border-slate-700 px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("button",{onClick:s,className:"flex items-center gap-1 text-slate-400 hover:text-white transition-colors",children:[n.jsx(ls,{className:"w-5 h-5"}),"Back"]}),n.jsx("div",{className:"h-6 w-px bg-slate-700"}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-semibold text-white",children:T}),n.jsxs("p",{className:"text-xs text-slate-500",children:[i.blocks.length," blocks, ",i.edges.length," connections",z&&n.jsx("span",{className:"text-warning ml-2",children:"Unsaved changes"})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[_.size>0&&n.jsxs("button",{onClick:ne,disabled:O,className:"flex items-center gap-2 px-3 py-1.5 bg-error text-white rounded-lg text-sm hover:bg-error/90 disabled:opacity-50 transition-colors",children:[O?n.jsx(pe,{className:"w-4 h-4 animate-spin"}):n.jsx(Te,{className:"w-4 h-4"}),"Delete ",_.size]}),n.jsxs("button",{onClick:()=>E(!0),disabled:O,className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg text-sm hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-colors",children:[n.jsx(be,{className:"w-4 h-4"}),"AI Generate"]}),n.jsxs("button",{onClick:D,disabled:g||!z||O,className:"flex items-center gap-2 px-3 py-1.5 bg-slate-700 text-white rounded-lg text-sm hover:bg-slate-600 disabled:opacity-50 transition-colors",children:[g?n.jsx(pe,{className:"w-4 h-4 animate-spin"}):n.jsx(Ll,{className:"w-4 h-4"}),g?"Saving...":"Save"]}),n.jsxs("button",{onClick:X,disabled:N||i.blocks.length===0||O,className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 disabled:opacity-50 transition-colors",children:[N?n.jsx(pe,{className:"w-4 h-4 animate-spin"}):n.jsx(xo,{className:"w-4 h-4"}),N?"Publishing...":"Publish"]})]})]})}),n.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[n.jsxs("aside",{className:"w-64 bg-slate-800 border-r border-slate-700 flex flex-col",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Drag blocks to canvas"}),n.jsx("div",{className:"grid grid-cols-2 gap-2",children:is.map(({type:H,label:G,icon:U,color:q})=>n.jsxs("div",{draggable:!0,onDragStart:re=>je(re,H),className:"flex flex-col items-center gap-1.5 p-3 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors group cursor-grab active:cursor-grabbing",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(_s,{className:"w-3 h-3 text-slate-500 opacity-0 group-hover:opacity-100 transition-opacity"}),n.jsx("div",{className:`w-8 h-8 ${q} rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform`,children:n.jsx(U,{className:"w-4 h-4 text-white"})})]}),n.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:G})]},H))})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-300",children:"Blocks List"}),i.blocks.length>0&&n.jsx("div",{className:"flex items-center gap-1",children:_.size>0?n.jsxs("button",{onClick:ce,className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:["Clear (",_.size,")"]}):n.jsx("button",{onClick:le,className:"text-xs px-2 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Select All"})})]}),i.blocks.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"No blocks yet. Drag blocks to the canvas or use AI generate."}):n.jsx("div",{className:"space-y-2",children:i.blocks.map((H,G)=>{const U=is.find(me=>me.type===H.type),q=U?.icon||Re,re=i.startBlockId===H.id,de=p===H.id;return n.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg transition-colors cursor-pointer ${_.has(H.id)?"bg-primary-600/20 border border-primary-500":de?"bg-primary-600/10 border border-primary-400":"bg-slate-700/50 hover:bg-slate-700 border border-transparent"}`,onClick:()=>{b(H.id),M(!0)},children:[n.jsx("input",{type:"checkbox",checked:_.has(H.id),onChange:me=>{me.stopPropagation(),ie(H.id)},disabled:O,className:"w-4 h-4 rounded border-slate-600 text-primary-600 focus:ring-primary-500 focus:ring-offset-slate-900"}),n.jsx("div",{className:`w-6 h-6 ${U?.color||"bg-slate-600"} rounded flex items-center justify-center`,children:n.jsx(q,{className:"w-3 h-3 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-white truncate",children:H.content?.title||`${U?.label||"Block"} ${G+1}`}),n.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[re&&n.jsx("span",{className:"text-emerald-400",children:"Start"}),!re&&n.jsx("span",{children:U?.label})]})]}),!re&&n.jsx("button",{onClick:me=>{me.stopPropagation(),_e(H.id)},disabled:O,className:"p-1 text-slate-500 hover:text-emerald-400 rounded disabled:opacity-50",title:"Set as start",children:n.jsx(An,{className:"w-3 h-3"})})]},H.id)})})]}),k&&n.jsx("div",{className:"p-3 bg-primary-600/20 border-t border-primary-500/30",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-primary-300",children:"Click a block to connect"}),n.jsx("button",{onClick:()=>I(null),className:"text-xs text-primary-400 hover:text-primary-300",children:"Cancel"})]})})]}),n.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",ref:r,children:n.jsxs(Em,{nodes:c,edges:f,onNodesChange:h,onEdgesChange:m,onConnect:we,onNodeClick:Fe,onNodeDragStop:Ge,onEdgesDelete:qe,onDragOver:K,onDrop:ge,nodeTypes:_p,defaultEdgeOptions:Ep,fitView:!0,fitViewOptions:{padding:.2},className:"bg-slate-900",proOptions:{hideAttribution:!0},deleteKeyCode:["Backspace","Delete"],selectionOnDrag:!0,panOnDrag:[1,2],selectionMode:1,children:[n.jsx(Dm,{color:"#334155",gap:20,size:1}),n.jsx(Vm,{className:"bg-slate-800 border border-slate-700 rounded-lg"}),n.jsx(tp,{nodeColor:H=>{const G=i.blocks.find(U=>U.id===H.id);if(!G)return"#475569";switch(is.find(U=>U.type===G.type),G.type){case"read":return"#6366f1";case"video":return"#f43f5e";case"image":return"#10b981";case"quiz":return"#a855f7";case"mission":return"#f97316";case"form":return"#14b8a6";case"ai_help":return"#06b6d4";case"checkpoint":return"#eab308";case"animation":return"#ec4899";case"code":return"#475569";case"exercise":return"#8b5cf6";case"resource":return"#6366f1";default:return"#475569"}},maskColor:"rgba(15, 23, 42, 0.8)",className:"bg-slate-800 border border-slate-700 rounded-lg"}),i.blocks.length===0&&n.jsx(Ut,{position:"center",className:"pointer-events-none",children:n.jsxs("div",{className:"text-center pointer-events-auto",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center mx-auto mb-4",children:n.jsx(et,{className:"w-8 h-8 text-slate-600"})}),n.jsx("h3",{className:"text-lg font-medium text-slate-400 mb-2",children:"Start Building Your Journey"}),n.jsx("p",{className:"text-slate-500 mb-4 max-w-md",children:"Drag blocks from the sidebar to create your learning path, or use AI to generate a complete course outline."}),n.jsxs("button",{onClick:()=>E(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-colors",children:[n.jsx(be,{className:"w-5 h-5"}),"Generate with AI"]})]})})]})}),j&&Ne&&n.jsx("aside",{className:"w-96 bg-slate-800 border-l border-slate-700 overflow-y-auto",children:n.jsx(ap,{block:Ne,allBlocks:i.blocks,edges:i.edges,onUpdate:H=>se(Ne.id,H),onAddEdge:(H,G)=>{const U={from:Ne.id,to:H,condition:G};l({...i,edges:[...i.edges.filter(q=>!(q.from===Ne.id&&q.to===H)),U]}),L(!0)},onRemoveEdge:H=>{l({...i,edges:i.edges.filter(G=>!(G.from===Ne.id&&G.to===H))}),L(!0)},onClose:()=>{M(!1),b(null)}})})]}),w&&n.jsx(jp,{onGenerate:Me,onClose:()=>E(!1),existingGraph:i,trackModulesContext:V,currentModuleId:e})]})}function Mp(e){return n.jsx(ia,{children:n.jsx(Ip,{...e})})}function Ap(e){switch(e){case"read":return{title:"New Reading",markdown:`# Title

Your content here...`,estimatedReadTime:3};case"video":return{title:"New Video",url:""};case"image":return{title:"New Image",url:"",caption:"",alt:""};case"quiz":return{title:"Knowledge Check",questions:[],passingScore:50};case"mission":return{title:"New Mission",steps:[]};case"form":return{title:"New Form",fields:[]};case"ai_help":return{title:"AI Help",mode:"targeted_remediation"};case"checkpoint":return{title:"Checkpoint"};case"animation":return{title:"New Animation",animationType:"lottie",url:""};case"code":return{title:"Code Example",code:"// Your code here",language:"javascript",showLineNumbers:!0};case"exercise":return{title:"Practice Exercise",problem:"",solution:"",hints:[]};case"resource":return{title:"Resources",resources:[]};default:return{title:"New Block"}}}function Tp(){const{enabled:e,isLoading:t}=Ns(),[s,r]=y.useState("content"),[o,a]=y.useState(""),[i,l]=y.useState("beginners"),[c,d]=y.useState(""),[h,f]=y.useState(""),[u,m]=y.useState(!1),[p,b]=y.useState(!1),g=async()=>{if(o.trim()){m(!0),f("");try{const w=await(await fetch("https://sowihdefjgpagncacfhy.supabase.co/functions/v1/course-generator",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvd2loZGVmamdwYWduY2FjZmh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjQ3MjksImV4cCI6MjA4MzcwMDcyOX0.XDE5-zoORpJVimoK6OfkZVi_M1q9Y6FGCZUeUhHOgGE"},body:JSON.stringify({type:s,topic:o,targetAudience:i,existingContent:c||void 0})})).json();w.error?f(`Error: ${w.error}`):w.result&&(typeof w.result=="string"?f(w.result):f(JSON.stringify(w.result,null,2)))}catch(x){f(`Error: ${x instanceof Error?x.message:"Generation failed"}`)}finally{m(!1)}}},v=()=>{navigator.clipboard.writeText(h),b(!0),setTimeout(()=>b(!1),2e3)},N=[{id:"content",label:"Reading Content",icon:Vt,description:"Generate educational markdown content"},{id:"quiz",label:"Quiz Questions",icon:Ft,description:"Generate assessment questions with answers"},{id:"video_script",label:"Video Script",icon:ut,description:"Generate video narration scripts"}];return t?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsx(pe,{className:"w-8 h-8 text-purple-500 animate-spin"})}):e?n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"p-6 border-b border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(be,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"AI Content Studio"}),n.jsx("p",{className:"text-slate-400",children:"Generate educational content with AI assistance"})]})]})}),n.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[n.jsx("div",{className:"w-96 border-r border-slate-700 p-6 overflow-y-auto",children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"What to Generate"}),n.jsx("div",{className:"space-y-2",children:N.map(x=>{const w=x.icon,E=s===x.id;return n.jsxs("button",{onClick:()=>r(x.id),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-colors text-left ${E?"bg-purple-600/20 border border-purple-500":"bg-slate-800 border border-slate-700 hover:bg-slate-700"}`,children:[n.jsx(w,{className:`w-5 h-5 ${E?"text-purple-400":"text-slate-400"}`}),n.jsxs("div",{children:[n.jsx("div",{className:`font-medium ${E?"text-purple-300":"text-white"}`,children:x.label}),n.jsx("div",{className:"text-xs text-slate-500",children:x.description})]})]},x.id)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Topic / Subject"}),n.jsx("textarea",{value:o,onChange:x=>a(x.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"What topic should the content cover?"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Audience"}),n.jsxs("select",{value:i,onChange:x=>l(x.target.value),className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[n.jsx("option",{value:"beginners",children:"Complete Beginners"}),n.jsx("option",{value:"students",children:"Students"}),n.jsx("option",{value:"professionals",children:"Professionals"}),n.jsx("option",{value:"technical",children:"Technical Audience"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Existing Content (optional)"}),n.jsx("textarea",{value:c,onChange:x=>d(x.target.value),rows:4,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",placeholder:"Paste existing content to expand upon..."})]}),n.jsx("button",{onClick:g,disabled:!o.trim()||u,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:u?n.jsxs(n.Fragment,{children:[n.jsx(pe,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(be,{className:"w-5 h-5"}),"Generate"]})})]})}),n.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[n.jsx("h2",{className:"font-semibold text-white",children:"Generated Output"}),h&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:g,disabled:u,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:[n.jsx(ll,{className:`w-4 h-4 ${u?"animate-spin":""}`}),"Regenerate"]}),n.jsx("button",{onClick:v,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:p?n.jsxs(n.Fragment,{children:[n.jsx(En,{className:"w-4 h-4 text-emerald-400"}),"Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx(pl,{className:"w-4 h-4"}),"Copy"]})})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:u?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(pe,{className:"w-12 h-12 text-purple-500 animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-400",children:"Generating content..."}),n.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"This may take a moment"})]})}):h?n.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:n.jsx("pre",{className:"text-slate-200 text-sm whitespace-pre-wrap font-mono",children:h})}):n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(be,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),n.jsx("p",{className:"text-slate-400",children:"Generated content will appear here"}),n.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Fill in the form and click Generate to start"})]})})})]})]})]}):n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"p-6 border-b border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:n.jsx(be,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"AI Content Studio"}),n.jsx("p",{className:"text-slate-400",children:"Generate educational content with AI assistance"})]})]})}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:n.jsx(go,{})})]})}function lo(e){return e.startsWith("/admin/builder")?"builder":e.startsWith("/admin/tracks")?"tracks":e.startsWith("/admin/ai-studio")?"ai-studio":e.startsWith("/admin/settings")?"settings":"dashboard"}function Lp({onExit:e,onSettingsChanged:t}){const s=ho(),r=uo(),[o,a]=y.useState(()=>lo(s.pathname)),[i,l]=y.useState(null);y.useEffect(()=>{const f=lo(s.pathname);f!==o&&a(f)},[s.pathname]);const c=(f,u)=>{l({moduleId:f,journeyVersionId:u}),a("builder"),r(`/admin/builder/${f}${u?`?v=${u}`:""}`)},d=()=>{l(null),a("tracks"),r("/admin/tracks")},h=()=>{if(i&&o==="builder")return n.jsx(Mp,{moduleId:i.moduleId,journeyVersionId:i.journeyVersionId,onBack:d});switch(o){case"dashboard":return n.jsx($p,{onNavigate:a});case"tracks":return n.jsx(Xl,{onEditJourney:c});case"builder":return n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Es,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),n.jsx("h2",{className:"text-xl font-semibold text-slate-400 mb-2",children:"Journey Builder"}),n.jsx("p",{className:"text-slate-500 mb-4",children:"Select a module from Tracks to edit its journey"}),n.jsx("button",{onClick:()=>a("tracks"),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Go to Tracks"})]})});case"ai-studio":return n.jsx(Tp,{});case"settings":return n.jsx(Pp,{onSettingsChanged:t});default:return null}};return n.jsx(ql,{activeTab:o,onTabChange:a,onExit:e,children:h()})}function $p({onNavigate:e}){const[t,s]=y.useState({totalTracks:0,activeLearners:0,avgCompletion:0,totalHours:0}),[r,o]=y.useState(!0);y.useEffect(()=>{a()},[]);const a=async()=>{try{const{supabase:l}=await as(async()=>{const{supabase:N}=await import("./index-CxUWKkPj.js").then(x=>x.v);return{supabase:N}},__vite__mapDeps([0,1])),{count:c}=await l.from("tracks").select("*",{count:"exact",head:!0}),{data:d}=await l.from("user_journey_runs").select("user_id"),h=new Set(d?.map(N=>N.user_id)||[]),{data:f}=await l.from("user_journey_runs").select("status"),u=f?.length||0,m=f?.filter(N=>N.status==="completed").length||0,p=u>0?Math.round(m/u*100):0,{data:b}=await l.from("user_block_states").select("time_spent_seconds"),g=b?.reduce((N,x)=>N+(x.time_spent_seconds||0),0)||0,v=Math.round(g/3600);s({totalTracks:c||0,activeLearners:h.size,avgCompletion:p,totalHours:v})}catch(l){console.error("Error loading dashboard stats:",l)}finally{o(!1)}},i=[{label:"Total Tracks",value:r?"...":String(t.totalTracks),icon:Re,color:"bg-primary-500"},{label:"Active Learners",value:r?"...":String(t.activeLearners),icon:Fl,color:"bg-emerald-500"},{label:"Avg. Completion",value:r?"...":`${t.avgCompletion}%`,icon:cl,color:"bg-purple-500"},{label:"Total Hours",value:r?"...":String(t.totalHours),icon:dl,color:"bg-warning"}];return n.jsx("div",{className:"h-full overflow-y-auto",children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Admin Dashboard"}),n.jsx("p",{className:"text-slate-400",children:"Manage your learning content and track performance"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:i.map(l=>{const c=l.icon;return n.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:`w-12 h-12 ${l.color} rounded-xl flex items-center justify-center`,children:n.jsx(c,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-2xl font-bold text-white",children:l.value}),n.jsx("div",{className:"text-sm text-slate-400",children:l.label})]})]})},l.label)})}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Quick Actions"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{onClick:()=>e("tracks"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center",children:n.jsx(Re,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"Create New Track"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Start a new learning path"})]})]}),n.jsxs("button",{onClick:()=>e("ai-studio"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:n.jsx(be,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"AI Content Studio"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Generate content with AI"})]})]}),n.jsxs("button",{onClick:()=>e("tracks"),className:"w-full flex items-center gap-3 p-4 bg-slate-700/50 hover:bg-slate-700 rounded-lg transition-colors text-left",children:[n.jsx("div",{className:"w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center",children:n.jsx(Es,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-white",children:"Edit Existing Journey"}),n.jsx("div",{className:"text-sm text-slate-400",children:"Modify course content"})]})]})]})]}),n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Recent Activity"}),n.jsx("div",{className:"space-y-4",children:[{action:"Track published",item:"GenAI Fundamentals",time:"2 hours ago"},{action:"Module created",item:"Advanced Prompting",time:"5 hours ago"},{action:"Quiz updated",item:"Knowledge Check #3",time:"1 day ago"},{action:"New learner enrolled",item:"John D.",time:"2 days ago"}].map((l,c)=>n.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700 last:border-0",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-white",children:l.action}),n.jsx("div",{className:"text-xs text-slate-500",children:l.item})]}),n.jsx("div",{className:"text-xs text-slate-500",children:l.time})]},c))})]})]})]})})}function Pp({onSettingsChanged:e}){const[t,s]=y.useState("Learning Hub"),[r,o]=y.useState("English"),[a,i]=y.useState("gpt-4o"),[l,c]=y.useState("gpt-4o-mini"),[d,h]=y.useState("gpt-image-1.5"),[f,u]=y.useState(!0),[m,p]=y.useState(!0),[b,g]=y.useState(!1),[v,N]=y.useState(null);y.useEffect(()=>{x()},[]);const x=async()=>{try{const{supabase:k}=await as(async()=>{const{supabase:P}=await import("./index-CxUWKkPj.js").then(R=>R.v);return{supabase:P}},__vite__mapDeps([0,1])),{data:I,error:T}=await k.from("system_settings").select("setting_key, setting_value").in("setting_key",["ai_content_model","ai_help_model","ai_image_model","platform_name","default_language","ai_enabled"]);if(T)throw T;I&&I.forEach(P=>{switch(P.setting_key){case"ai_content_model":i(P.setting_value);break;case"ai_help_model":c(P.setting_value);break;case"ai_image_model":h(P.setting_value);break;case"platform_name":s(P.setting_value);break;case"default_language":o(P.setting_value);break;case"ai_enabled":u(P.setting_value==="true");break}})}catch(k){console.error("Error loading settings:",k),N({type:"error",text:"Failed to load settings. Please check your connection and try again."})}finally{p(!1)}},w=async()=>{g(!0),N(null);try{const{supabase:k}=await as(async()=>{const{supabase:T}=await import("./index-CxUWKkPj.js").then(P=>P.v);return{supabase:T}},__vite__mapDeps([0,1])),I=[{setting_key:"ai_content_model",setting_value:a},{setting_key:"ai_help_model",setting_value:l},{setting_key:"ai_image_model",setting_value:d},{setting_key:"platform_name",setting_value:t},{setting_key:"default_language",setting_value:r},{setting_key:"ai_enabled",setting_value:String(f)}];for(const T of I){const{error:P}=await k.from("system_settings").upsert({setting_key:T.setting_key,setting_value:T.setting_value,category:T.setting_key.startsWith("ai_")?"ai":"general",description:E(T.setting_key)},{onConflict:"setting_key"});if(P)throw console.error(`Error saving ${T.setting_key}:`,P),P}N({type:"success",text:"Settings saved successfully!"}),setTimeout(()=>N(null),3e3),e&&e()}catch(k){console.error("Error saving settings:",k),N({type:"error",text:"Failed to save settings. Please try again."})}finally{g(!1)}},E=k=>({ai_content_model:"AI model used for content generation in AI Studio",ai_help_model:"AI model used for student help and assistance",ai_image_model:"AI model used for generating educational images and diagrams",platform_name:"Platform display name",default_language:"Default content language",ai_enabled:"Whether AI content generation is enabled"})[k]||"";return m?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsx("div",{className:"text-slate-400",children:"Loading settings..."})}):n.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[n.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"Settings"}),n.jsxs("div",{className:"max-w-2xl space-y-6",children:[n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"General Settings"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Platform Name"}),n.jsx("input",{type:"text",value:t,onChange:k=>s(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter platform name"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Default Language"}),n.jsxs("select",{value:r,onChange:k=>o(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"English",children:"English"}),n.jsx("option",{value:"Arabic",children:"Arabic"}),n.jsx("option",{value:"Spanish",children:"Spanish"}),n.jsx("option",{value:"French",children:"French"})]})]})]})]}),n.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[n.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"AI Settings"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Content Generation Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for AI Studio and course generation"}),n.jsxs("select",{value:a,onChange:k=>i(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-4o",children:"GPT-4o (Recommended)"}),n.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o-mini (Faster)"}),n.jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),n.jsx("option",{value:"gpt-5.2",children:"GPT-5.2 (Latest)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"AI Help Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for student assistance and tutoring"}),n.jsxs("select",{value:l,onChange:k=>c(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-4o",children:"GPT-4o (Recommended)"}),n.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o-mini (Faster, Cost-effective)"}),n.jsx("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),n.jsx("option",{value:"gpt-5.2",children:"GPT-5.2 (Latest)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Image Generation Model"}),n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Used for generating educational images and diagrams"}),n.jsxs("select",{value:d,onChange:k=>h(k.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"gpt-image-1.5",children:"GPT Image 1.5 (Latest)"}),n.jsx("option",{value:"gpt-image-1",children:"GPT Image 1"}),n.jsx("option",{value:"dall-e-3",children:"DALL-E 3 (High Quality)"}),n.jsx("option",{value:"dall-e-2",children:"DALL-E 2 (Faster)"})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-slate-300",children:"Enable AI Content Generation"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Allow AI to generate course content"})]}),n.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:f,onChange:k=>u(k.target.checked),className:"sr-only peer"}),n.jsx("div",{className:"w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]})]})]}),v&&n.jsx("div",{className:`p-4 rounded-lg ${v.type==="success"?"bg-success/10 text-success border border-success/20":"bg-error/10 text-error border border-error/20"}`,children:v.text}),n.jsx("button",{onClick:w,disabled:b,className:"w-full px-6 py-3 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Saving...":"Save Settings"})]})]})}const Dp={read:n.jsx(Re,{className:"w-5 h-5 text-blue-400"}),video:n.jsx(ut,{className:"w-5 h-5 text-rose-400"}),quiz:n.jsx(Ft,{className:"w-5 h-5 text-purple-400"}),mission:n.jsx(In,{className:"w-5 h-5 text-orange-400"}),form:n.jsx(Il,{className:"w-5 h-5 text-cyan-400"}),checkpoint:n.jsx(cn,{className:"w-5 h-5 text-emerald-400"}),ai_help:n.jsx(be,{className:"w-5 h-5 text-amber-400"}),animation:n.jsx(Dl,{className:"w-5 h-5 text-pink-400"})},co={read:"",video:"",quiz:"",mission:"",form:"",checkpoint:" ",ai_help:" ",animation:" "};function Bp({blocks:e,edges:t,startBlockId:s,onReorder:r,onEditBlock:o,onDeleteBlock:a,onSetStart:i}){const[l,c]=y.useState(null),[d,h]=y.useState(null),[f,u]=y.useState(new Set),m=y.useRef(null),p=y.useCallback((R,C)=>{c(C),R.dataTransfer.effectAllowed="move",R.dataTransfer.setData("text/plain",C.toString()),m.current&&(m.current.style.opacity="0.5")},[]),b=y.useCallback((R,C)=>{R.preventDefault(),R.dataTransfer.dropEffect="move",l!==null&&l!==C&&h(C)},[l]),g=y.useCallback(()=>{h(null)},[]),v=y.useCallback((R,C)=>{if(R.preventDefault(),l===null||l===C){c(null),h(null);return}const z=[...e],[L]=z.splice(l,1);z.splice(C,0,L);const j=k(z,t);r(z,j),c(null),h(null)},[l,e,t,r]),N=y.useCallback(()=>{c(null),h(null)},[]),x=y.useCallback((R,C)=>{c(C)},[]),w=y.useCallback(R=>{if(l===null)return;const C=R.touches[0],L=document.elementsFromPoint(C.clientX,C.clientY).find(j=>j.hasAttribute("data-block-index"));if(L){const j=parseInt(L.getAttribute("data-block-index")||"-1");j!==-1&&j!==l&&h(j)}},[l]),E=y.useCallback(R=>{if(l!==null&&d!==null&&l!==d){const C=[...e],[z]=C.splice(l,1);C.splice(d,0,z);const L=k(C,t);r(C,L)}c(null),h(null)},[l,d,e,t,r]),k=(R,C)=>{const z=C.filter(j=>j.condition),L=[];for(let j=0;j<R.length-1;j++){const M=R[j],S=R[j+1];z.some(_=>_.from===M.id)||L.push({from:M.id,to:S.id})}return[...L,...z]},I=R=>{const C=new Set(f);C.has(R)?C.delete(R):C.add(R),u(C)},T=R=>t.filter(C=>C.from===R),P=(R,C)=>{const z=C==="up"?R-1:R+1;if(z<0||z>=e.length)return;const L=[...e];[L[R],L[z]]=[L[z],L[R]];const j=k(L,t);r(L,j)};return n.jsxs("div",{className:"space-y-2",children:[e.map((R,C)=>{const z=R.content,L=s===R.id,j=l===C,M=d===C,S=f.has(R.id),A=T(R.id),_=A.some($=>$.condition);return n.jsxs("div",{ref:j?m:null,"data-block-index":C,draggable:!0,onDragStart:$=>p($,C),onDragOver:$=>b($,C),onDragLeave:g,onDrop:$=>v($,C),onDragEnd:N,onTouchStart:$=>x($,C),onTouchMove:w,onTouchEnd:E,className:`
              bg-slate-800 rounded-xl border transition-all
              ${j?"dragging border-blue-500":"border-slate-700"}
              ${M?"border-blue-500 border-dashed bg-blue-500/10":""}
            `,children:[n.jsxs("div",{className:"flex items-center gap-3 p-4",children:[n.jsx("div",{className:"drag-handle p-1 text-slate-500 hover:text-slate-300 touch-manipulation",children:n.jsx(_s,{className:"w-5 h-5"})}),n.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-700 flex items-center justify-center flex-shrink-0",children:Dp[R.type]||n.jsx(Re,{className:"w-5 h-5 text-slate-400"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"font-medium text-white truncate",children:z?.title||co[R.type]||R.type}),L&&n.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded-full flex-shrink-0",children:""}),_&&n.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full flex-shrink-0 flex items-center gap-1",children:[n.jsx(vl,{className:"w-3 h-3"}),""]})]}),n.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:co[R.type]||R.type})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>P(C,"up"),disabled:C===0,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:" ",children:n.jsx(gn,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>P(C,"down"),disabled:C===e.length-1,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:" ",children:n.jsx(xn,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>I(R.id),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"",children:S?n.jsx(gn,{className:"w-4 h-4"}):n.jsx(xn,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>o(R),className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"",children:n.jsx(Hl,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>a(R.id),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",title:"",children:n.jsx(Te,{className:"w-4 h-4"})})]})]}),S&&n.jsx("div",{className:"px-4 pb-4 border-t border-slate-700 mt-2 pt-4",children:n.jsxs("div",{className:"space-y-3",children:[!L&&n.jsx("button",{onClick:()=>i(R.id),className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",children:"  "}),A.length>0&&n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-500 mb-2",children:":"}),n.jsx("div",{className:"space-y-1",children:A.map(($,O)=>{const V=e.find(Y=>Y.id===$.to)?.content;return n.jsxs("div",{className:"text-sm text-slate-400 flex items-center gap-2",children:[n.jsx("span",{className:"text-slate-600",children:""}),n.jsx("span",{children:V?.title||$.to}),$.condition&&n.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded",children:""})]},O)})})]})]})})]},R.id)}),e.length===0&&n.jsx("div",{className:"text-center py-12 text-slate-500",children:"  .   ."})]})}export{jp as AIContentGenerator,Tp as AIStudio,ql as AdminLayout,Lp as AdminPage,ap as BlockEditor,Sp as BlockNode,Bp as DraggableBlockList,Mp as JourneyBuilder,Xl as TrackManager};
